var HN=Object.create;var pb=Object.defineProperty,$N=Object.defineProperties,qN=Object.getOwnPropertyDescriptor,WN=Object.getOwnPropertyDescriptors,ZN=Object.getOwnPropertyNames,l_=Object.getOwnPropertySymbols,QN=Object.getPrototypeOf,mb=Object.prototype.hasOwnProperty,UT=Object.prototype.propertyIsEnumerable;var LT=(s,o,f)=>o in s?pb(s,o,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[o]=f,$t=(s,o)=>{for(var f in o||={})mb.call(o,f)&&LT(s,f,o[f]);if(l_)for(var f of l_(o))UT.call(o,f)&&LT(s,f,o[f]);return s},Li=(s,o)=>$N(s,WN(o));var zT=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(o,f)=>(typeof require<"u"?require:o)[f]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});var VT=(s,o)=>{var f={};for(var u in s)mb.call(s,u)&&o.indexOf(u)<0&&(f[u]=s[u]);if(s!=null&&l_)for(var u of l_(s))o.indexOf(u)<0&&UT.call(s,u)&&(f[u]=s[u]);return f};var fi=(s,o)=>()=>(o||s((o={exports:{}}).exports,o),o.exports);var YN=(s,o,f,u)=>{if(o&&typeof o=="object"||typeof o=="function")for(let g of ZN(o))!mb.call(s,g)&&g!==f&&pb(s,g,{get:()=>o[g],enumerable:!(u=qN(o,g))||u.enumerable});return s};var gb=(s,o,f)=>(f=s!=null?HN(QN(s)):{},YN(o||!s||!s.__esModule?pb(f,"default",{value:s,enumerable:!0}):f,s));var _b=(s,o,f)=>new Promise((u,g)=>{var r=O=>{try{I(f.next(O))}catch(U){g(U)}},E=O=>{try{I(f.throw(O))}catch(U){g(U)}},I=O=>O.done?u(O.value):Promise.resolve(O.value).then(r,E);I((f=f.apply(s,o)).next())});var aC=fi((oC,sC)=>{"use strict";(function(s,o){typeof oC=="object"&&typeof sC<"u"?sC.exports=o():typeof define=="function"&&define.amd?define(o):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=o())})(oC,function(){"use strict";var s,o,f;function u(r,E){if(!s)s=E;else if(!o)o=E;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",O={};s(O),f=E(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}u(["exports"],function(r){"use strict";var E="3.4.0";let I,O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(I==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{I=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{I=t}}return I},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{let t=new URL(O.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function U(t){return O.API_URL_REGEX.test(t)}function V(t){return t.indexOf("mapbox:")===0}function Z(t){return O.API_CDN_URL_REGEX.test(t)}function te(t){return O.API_SPRITE_REGEX.test(t)}function se(t){return O.API_STYLE_REGEX.test(t)&&!te(t)}let pe={create:"create",load:"load",fullLoad:"fullLoad"};function Ce(t){let e=t.name.split("?")[0];return Z(e)&&e.includes("mapbox-gl.js")?"javascript":Z(e)&&e.includes("mapbox-gl.css")?"css":function(n){return O.API_FONTS_REGEX.test(n)}(e)?"fontRange":te(e)?"sprite":se(e)?"style":function(n){return O.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function Te(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ce={},me={};Object.defineProperty(me,"__esModule",{value:!0}),me.setMatrixArrayType=function(t){me.ARRAY_TYPE=Pe=t},me.toRadian=function(t){return t*$e},me.equals=function(t,e){return Math.abs(t-e)<=ke*Math.max(1,Math.abs(t),Math.abs(e))},me.RANDOM=me.ARRAY_TYPE=me.EPSILON=void 0;var ke=1e-6;me.EPSILON=ke;var Pe=typeof Float32Array<"u"?Float32Array:Array;me.ARRAY_TYPE=Pe;var Ze=Math.random;me.RANDOM=Ze;var $e=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ot={};function bt(t){return bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(t)}Object.defineProperty(ot,"__esModule",{value:!0}),ot.create=function(){var t=new Tt.ARRAY_TYPE(4);return Tt.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},ot.clone=function(t){var e=new Tt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ot.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ot.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},ot.fromValues=function(t,e,n,a){var c=new Tt.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},ot.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},ot.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},ot.invert=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=n*h-c*a;return m?(t[0]=h*(m=1/m),t[1]=-a*m,t[2]=-c*m,t[3]=n*m,t):null},ot.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},ot.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},ot.multiply=st,ot.rotate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x+h*y,t[1]=c*x+m*y,t[2]=a*-y+h*x,t[3]=c*-y+m*x,t},ot.scale=function(t,e,n){var a=e[1],c=e[2],h=e[3],m=n[0],y=n[1];return t[0]=e[0]*m,t[1]=a*m,t[2]=c*y,t[3]=h*y,t},ot.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t},ot.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},ot.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ot.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},ot.LDU=function(t,e,n,a){return t[2]=a[2]/a[0],n[0]=a[0],n[1]=a[1],n[3]=a[3]-t[2]*n[1],[t,e,n]},ot.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},ot.subtract=_t,ot.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ot.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=e[0],y=e[1],x=e[2],w=e[3];return Math.abs(n-m)<=Tt.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=Tt.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-x)<=Tt.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-w)<=Tt.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},ot.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ot.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},ot.sub=ot.mul=void 0;var Tt=function(t,e){if(t&&t.__esModule)return t;if(t===null||bt(t)!=="object"&&typeof t!="function")return{default:t};var n=qt(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function qt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(qt=function(a){return a?n:e})(t)}function st(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=n[0],x=n[1],w=n[2],C=n[3];return t[0]=a*y+h*x,t[1]=c*y+m*x,t[2]=a*w+h*C,t[3]=c*w+m*C,t}function _t(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}ot.mul=st,ot.sub=_t;var wt={};function Dt(t){return Dt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(t)}Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var t=new tn.ARRAY_TYPE(6);return tn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},wt.clone=function(t){var e=new tn.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},wt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},wt.fromValues=function(t,e,n,a,c,h){var m=new tn.ARRAY_TYPE(6);return m[0]=t,m[1]=e,m[2]=n,m[3]=a,m[4]=c,m[5]=h,m},wt.set=function(t,e,n,a,c,h,m){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=h,t[5]=m,t},wt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=n*h-a*c;return x?(t[0]=h*(x=1/x),t[1]=-a*x,t[2]=-c*x,t[3]=n*x,t[4]=(c*y-h*m)*x,t[5]=(a*m-n*y)*x,t):null},wt.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},wt.multiply=In,wt.rotate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=Math.sin(n),C=Math.cos(n);return t[0]=a*C+h*w,t[1]=c*C+m*w,t[2]=a*-w+h*C,t[3]=c*-w+m*C,t[4]=y,t[5]=x,t},wt.scale=function(t,e,n){var a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=n[0],w=n[1];return t[0]=e[0]*x,t[1]=a*x,t[2]=c*w,t[3]=h*w,t[4]=m,t[5]=y,t},wt.translate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=n[0],C=n[1];return t[0]=a,t[1]=c,t[2]=h,t[3]=m,t[4]=a*w+h*C+y,t[5]=c*w+m*C+x,t},wt.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=-n,t[3]=a,t[4]=0,t[5]=0,t},wt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},wt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},wt.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},wt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},wt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},wt.subtract=zn,wt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},wt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t},wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},wt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=t[4],y=t[5],x=e[0],w=e[1],C=e[2],A=e[3],S=e[4],F=e[5];return Math.abs(n-x)<=tn.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-w)<=tn.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-C)<=tn.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(h-A)<=tn.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-S)<=tn.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(y-F)<=tn.EPSILON*Math.max(1,Math.abs(y),Math.abs(F))},wt.sub=wt.mul=void 0;var tn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Dt(t)!=="object"&&typeof t!="function")return{default:t};var n=Yt(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function Yt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Yt=function(a){return a?n:e})(t)}function In(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=n[0],C=n[1],A=n[2],S=n[3],F=n[4],R=n[5];return t[0]=a*w+h*C,t[1]=c*w+m*C,t[2]=a*A+h*S,t[3]=c*A+m*S,t[4]=a*F+h*R+y,t[5]=c*F+m*R+x,t}function zn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}wt.mul=In,wt.sub=zn;var qe={};function xt(t){return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(t)}Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=function(){var t=new ht.ARRAY_TYPE(9);return ht.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},qe.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},qe.clone=function(t){var e=new ht.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},qe.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},qe.fromValues=function(t,e,n,a,c,h,m,y,x){var w=new ht.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=a,w[4]=c,w[5]=h,w[6]=m,w[7]=y,w[8]=x,w},qe.set=function(t,e,n,a,c,h,m,y,x,w){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=h,t[5]=m,t[6]=y,t[7]=x,t[8]=w,t},qe.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qe.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=a,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},qe.invert=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],C=e[8],A=C*m-y*w,S=-C*h+y*x,F=w*h-m*x,R=n*A+a*S+c*F;return R?(t[0]=A*(R=1/R),t[1]=(-C*a+c*w)*R,t[2]=(y*a-c*m)*R,t[3]=S*R,t[4]=(C*n-c*x)*R,t[5]=(-y*n+c*h)*R,t[6]=F*R,t[7]=(-w*n+a*x)*R,t[8]=(m*n-a*h)*R,t):null},qe.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],C=e[8];return t[0]=m*C-y*w,t[1]=c*w-a*C,t[2]=a*y-c*m,t[3]=y*x-h*C,t[4]=n*C-c*x,t[5]=c*h-n*y,t[6]=h*w-m*x,t[7]=a*x-n*w,t[8]=n*m-a*h,t},qe.determinant=function(t){var e=t[3],n=t[4],a=t[5],c=t[6],h=t[7],m=t[8];return t[0]*(m*n-a*h)+t[1]*(-m*e+a*c)+t[2]*(h*e-n*c)},qe.multiply=Di,qe.translate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=e[8],S=n[0],F=n[1];return t[0]=a,t[1]=c,t[2]=h,t[3]=m,t[4]=y,t[5]=x,t[6]=S*a+F*m+w,t[7]=S*c+F*y+C,t[8]=S*h+F*x+A,t},qe.rotate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=e[8],S=Math.sin(n),F=Math.cos(n);return t[0]=F*a+S*m,t[1]=F*c+S*y,t[2]=F*h+S*x,t[3]=F*m-S*a,t[4]=F*y-S*c,t[5]=F*x-S*h,t[6]=w,t[7]=C,t[8]=A,t},qe.scale=function(t,e,n){var a=n[0],c=n[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=c*e[3],t[4]=c*e[4],t[5]=c*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},qe.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},qe.fromRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=-n,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qe.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qe.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},qe.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=n+n,y=a+a,x=c+c,w=n*m,C=a*m,A=a*y,S=c*m,F=c*y,R=c*x,B=h*m,z=h*y,j=h*x;return t[0]=1-A-R,t[3]=C-j,t[6]=S+z,t[1]=C+j,t[4]=1-w-R,t[7]=F-B,t[2]=S-z,t[5]=F+B,t[8]=1-w-A,t},qe.normalFromMat4=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],C=e[8],A=e[9],S=e[10],F=e[11],R=e[12],B=e[13],z=e[14],j=e[15],Q=n*y-a*m,J=n*x-c*m,X=n*w-h*m,ue=a*x-c*y,ne=a*w-h*y,de=c*w-h*x,ge=C*B-A*R,we=C*z-S*R,Oe=C*j-F*R,Ee=A*z-S*B,Ne=A*j-F*B,Be=S*j-F*z,Re=Q*Be-J*Ne+X*Ee+ue*Oe-ne*we+de*ge;return Re?(t[0]=(y*Be-x*Ne+w*Ee)*(Re=1/Re),t[1]=(x*Oe-m*Be-w*we)*Re,t[2]=(m*Ne-y*Oe+w*ge)*Re,t[3]=(c*Ne-a*Be-h*Ee)*Re,t[4]=(n*Be-c*Oe+h*we)*Re,t[5]=(a*Oe-n*Ne-h*ge)*Re,t[6]=(B*de-z*ne+j*ue)*Re,t[7]=(z*X-R*de-j*J)*Re,t[8]=(R*ne-B*X+j*Q)*Re,t):null},qe.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},qe.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},qe.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},qe.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},qe.subtract=Kn,qe.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},qe.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t},qe.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},qe.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=t[4],y=t[5],x=t[6],w=t[7],C=t[8],A=e[0],S=e[1],F=e[2],R=e[3],B=e[4],z=e[5],j=e[6],Q=e[7],J=e[8];return Math.abs(n-A)<=ht.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(a-S)<=ht.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(c-F)<=ht.EPSILON*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(h-R)<=ht.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(m-B)<=ht.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(y-z)<=ht.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(x-j)<=ht.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))&&Math.abs(w-Q)<=ht.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(C-J)<=ht.EPSILON*Math.max(1,Math.abs(C),Math.abs(J))},qe.sub=qe.mul=void 0;var ht=function(t,e){if(t&&t.__esModule)return t;if(t===null||xt(t)!=="object"&&typeof t!="function")return{default:t};var n=mt(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function mt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(mt=function(a){return a?n:e})(t)}function Di(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=e[8],S=n[0],F=n[1],R=n[2],B=n[3],z=n[4],j=n[5],Q=n[6],J=n[7],X=n[8];return t[0]=S*a+F*m+R*w,t[1]=S*c+F*y+R*C,t[2]=S*h+F*x+R*A,t[3]=B*a+z*m+j*w,t[4]=B*c+z*y+j*C,t[5]=B*h+z*x+j*A,t[6]=Q*a+J*m+X*w,t[7]=Q*c+J*y+X*C,t[8]=Q*h+J*x+X*A,t}function Kn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}qe.mul=Di,qe.sub=Kn;var Bt={};function Mn(t){return Mn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(t)}Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=function(){var t=new hi.ARRAY_TYPE(16);return hi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Bt.clone=function(t){var e=new hi.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Bt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Bt.fromValues=function(t,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B){var z=new hi.ARRAY_TYPE(16);return z[0]=t,z[1]=e,z[2]=n,z[3]=a,z[4]=c,z[5]=h,z[6]=m,z[7]=y,z[8]=x,z[9]=w,z[10]=C,z[11]=A,z[12]=S,z[13]=F,z[14]=R,z[15]=B,z},Bt.set=function(t,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=h,t[5]=m,t[6]=y,t[7]=x,t[8]=w,t[9]=C,t[10]=A,t[11]=S,t[12]=F,t[13]=R,t[14]=B,t[15]=z,t},Bt.identity=hs,Bt.transpose=function(t,e){if(t===e){var n=e[1],a=e[2],c=e[3],h=e[6],m=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=h,t[11]=e[14],t[12]=c,t[13]=m,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Bt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],C=e[8],A=e[9],S=e[10],F=e[11],R=e[12],B=e[13],z=e[14],j=e[15],Q=n*y-a*m,J=n*x-c*m,X=n*w-h*m,ue=a*x-c*y,ne=a*w-h*y,de=c*w-h*x,ge=C*B-A*R,we=C*z-S*R,Oe=C*j-F*R,Ee=A*z-S*B,Ne=A*j-F*B,Be=S*j-F*z,Re=Q*Be-J*Ne+X*Ee+ue*Oe-ne*we+de*ge;return Re?(t[0]=(y*Be-x*Ne+w*Ee)*(Re=1/Re),t[1]=(c*Ne-a*Be-h*Ee)*Re,t[2]=(B*de-z*ne+j*ue)*Re,t[3]=(S*ne-A*de-F*ue)*Re,t[4]=(x*Oe-m*Be-w*we)*Re,t[5]=(n*Be-c*Oe+h*we)*Re,t[6]=(z*X-R*de-j*J)*Re,t[7]=(C*de-S*X+F*J)*Re,t[8]=(m*Ne-y*Oe+w*ge)*Re,t[9]=(a*Oe-n*Ne-h*ge)*Re,t[10]=(R*ne-B*X+j*Q)*Re,t[11]=(A*X-C*ne-F*Q)*Re,t[12]=(y*we-m*Ee-x*ge)*Re,t[13]=(n*Ee-a*we+c*ge)*Re,t[14]=(B*J-R*ue-z*Q)*Re,t[15]=(C*ue-A*J+S*Q)*Re,t):null},Bt.adjoint=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],C=e[8],A=e[9],S=e[10],F=e[11],R=e[12],B=e[13],z=e[14],j=e[15];return t[0]=y*(S*j-F*z)-A*(x*j-w*z)+B*(x*F-w*S),t[1]=-(a*(S*j-F*z)-A*(c*j-h*z)+B*(c*F-h*S)),t[2]=a*(x*j-w*z)-y*(c*j-h*z)+B*(c*w-h*x),t[3]=-(a*(x*F-w*S)-y*(c*F-h*S)+A*(c*w-h*x)),t[4]=-(m*(S*j-F*z)-C*(x*j-w*z)+R*(x*F-w*S)),t[5]=n*(S*j-F*z)-C*(c*j-h*z)+R*(c*F-h*S),t[6]=-(n*(x*j-w*z)-m*(c*j-h*z)+R*(c*w-h*x)),t[7]=n*(x*F-w*S)-m*(c*F-h*S)+C*(c*w-h*x),t[8]=m*(A*j-F*B)-C*(y*j-w*B)+R*(y*F-w*A),t[9]=-(n*(A*j-F*B)-C*(a*j-h*B)+R*(a*F-h*A)),t[10]=n*(y*j-w*B)-m*(a*j-h*B)+R*(a*w-h*y),t[11]=-(n*(y*F-w*A)-m*(a*F-h*A)+C*(a*w-h*y)),t[12]=-(m*(A*z-S*B)-C*(y*z-x*B)+R*(y*S-x*A)),t[13]=n*(A*z-S*B)-C*(a*z-c*B)+R*(a*S-c*A),t[14]=-(n*(y*z-x*B)-m*(a*z-c*B)+R*(a*x-c*y)),t[15]=n*(y*S-x*A)-m*(a*S-c*A)+C*(a*x-c*y),t},Bt.determinant=function(t){var e=t[0],n=t[1],a=t[2],c=t[3],h=t[4],m=t[5],y=t[6],x=t[7],w=t[8],C=t[9],A=t[10],S=t[11],F=t[12],R=t[13],B=t[14],z=t[15];return(e*m-n*h)*(A*z-S*B)-(e*y-a*h)*(C*z-S*R)+(e*x-c*h)*(C*B-A*R)+(n*y-a*m)*(w*z-S*F)-(n*x-c*m)*(w*B-A*F)+(a*x-c*y)*(w*R-C*F)},Bt.multiply=oo,Bt.translate=function(t,e,n){var a,c,h,m,y,x,w,C,A,S,F,R,B=n[0],z=n[1],j=n[2];return e===t?(t[12]=e[0]*B+e[4]*z+e[8]*j+e[12],t[13]=e[1]*B+e[5]*z+e[9]*j+e[13],t[14]=e[2]*B+e[6]*z+e[10]*j+e[14],t[15]=e[3]*B+e[7]*z+e[11]*j+e[15]):(c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=e[8],S=e[9],F=e[10],R=e[11],t[0]=a=e[0],t[1]=c,t[2]=h,t[3]=m,t[4]=y,t[5]=x,t[6]=w,t[7]=C,t[8]=A,t[9]=S,t[10]=F,t[11]=R,t[12]=a*B+y*z+A*j+e[12],t[13]=c*B+x*z+S*j+e[13],t[14]=h*B+w*z+F*j+e[14],t[15]=m*B+C*z+R*j+e[15]),t},Bt.scale=function(t,e,n){var a=n[0],c=n[1],h=n[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Bt.rotate=function(t,e,n,a){var c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue,ne,de,ge,we,Oe,Ee,Ne=a[0],Be=a[1],Re=a[2],We=Math.hypot(Ne,Be,Re);return We<hi.EPSILON?null:(Ne*=We=1/We,Be*=We,Re*=We,c=Math.sin(n),h=Math.cos(n),x=e[1],w=e[2],C=e[3],S=e[5],F=e[6],R=e[7],z=e[9],j=e[10],Q=e[11],J=Ne*Ne*(m=1-h)+h,ne=Ne*Be*m-Re*c,de=Be*Be*m+h,ge=Re*Be*m+Ne*c,we=Ne*Re*m+Be*c,Oe=Be*Re*m-Ne*c,Ee=Re*Re*m+h,t[0]=(y=e[0])*J+(A=e[4])*(X=Be*Ne*m+Re*c)+(B=e[8])*(ue=Re*Ne*m-Be*c),t[1]=x*J+S*X+z*ue,t[2]=w*J+F*X+j*ue,t[3]=C*J+R*X+Q*ue,t[4]=y*ne+A*de+B*ge,t[5]=x*ne+S*de+z*ge,t[6]=w*ne+F*de+j*ge,t[7]=C*ne+R*de+Q*ge,t[8]=y*we+A*Oe+B*Ee,t[9]=x*we+S*Oe+z*Ee,t[10]=w*we+F*Oe+j*Ee,t[11]=C*we+R*Oe+Q*Ee,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Bt.rotateX=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),h=e[4],m=e[5],y=e[6],x=e[7],w=e[8],C=e[9],A=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*c+w*a,t[5]=m*c+C*a,t[6]=y*c+A*a,t[7]=x*c+S*a,t[8]=w*c-h*a,t[9]=C*c-m*a,t[10]=A*c-y*a,t[11]=S*c-x*a,t},Bt.rotateY=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),h=e[0],m=e[1],y=e[2],x=e[3],w=e[8],C=e[9],A=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c-w*a,t[1]=m*c-C*a,t[2]=y*c-A*a,t[3]=x*c-S*a,t[8]=h*a+w*c,t[9]=m*a+C*c,t[10]=y*a+A*c,t[11]=x*a+S*c,t},Bt.rotateZ=function(t,e,n){var a=Math.sin(n),c=Math.cos(n),h=e[0],m=e[1],y=e[2],x=e[3],w=e[4],C=e[5],A=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c+w*a,t[1]=m*c+C*a,t[2]=y*c+A*a,t[3]=x*c+S*a,t[4]=w*c-h*a,t[5]=C*c-m*a,t[6]=A*c-y*a,t[7]=S*c-x*a,t},Bt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Bt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Bt.fromRotation=function(t,e,n){var a,c,h,m=n[0],y=n[1],x=n[2],w=Math.hypot(m,y,x);return w<hi.EPSILON?null:(m*=w=1/w,y*=w,x*=w,a=Math.sin(e),c=Math.cos(e),t[0]=m*m*(h=1-c)+c,t[1]=y*m*h+x*a,t[2]=x*m*h-y*a,t[3]=0,t[4]=m*y*h-x*a,t[5]=y*y*h+c,t[6]=x*y*h+m*a,t[7]=0,t[8]=m*x*h+y*a,t[9]=y*x*h-m*a,t[10]=x*x*h+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Bt.fromXRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Bt.fromYRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Bt.fromZRotation=function(t,e){var n=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Bt.fromRotationTranslation=pr,Bt.fromQuat2=function(t,e){var n=new hi.ARRAY_TYPE(3),a=-e[0],c=-e[1],h=-e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=a*a+c*c+h*h+m*m;return A>0?(n[0]=2*(y*m+C*a+x*h-w*c)/A,n[1]=2*(x*m+C*c+w*a-y*h)/A,n[2]=2*(w*m+C*h+y*c-x*a)/A):(n[0]=2*(y*m+C*a+x*h-w*c),n[1]=2*(x*m+C*c+w*a-y*h),n[2]=2*(w*m+C*h+y*c-x*a)),pr(t,e,n),t},Bt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Bt.getScaling=vr,Bt.getRotation=function(t,e){var n=new hi.ARRAY_TYPE(3);vr(n,e);var a=1/n[0],c=1/n[1],h=1/n[2],m=e[0]*a,y=e[1]*c,x=e[2]*h,w=e[4]*a,C=e[5]*c,A=e[6]*h,S=e[8]*a,F=e[9]*c,R=e[10]*h,B=m+C+R,z=0;return B>0?(z=2*Math.sqrt(B+1),t[3]=.25*z,t[0]=(A-F)/z,t[1]=(S-x)/z,t[2]=(y-w)/z):m>C&&m>R?(z=2*Math.sqrt(1+m-C-R),t[3]=(A-F)/z,t[0]=.25*z,t[1]=(y+w)/z,t[2]=(S+x)/z):C>R?(z=2*Math.sqrt(1+C-m-R),t[3]=(S-x)/z,t[0]=(y+w)/z,t[1]=.25*z,t[2]=(A+F)/z):(z=2*Math.sqrt(1+R-m-C),t[3]=(y-w)/z,t[0]=(S+x)/z,t[1]=(A+F)/z,t[2]=.25*z),t},Bt.fromRotationTranslationScale=function(t,e,n,a){var c=e[0],h=e[1],m=e[2],y=e[3],x=c+c,w=h+h,C=m+m,A=c*x,S=c*w,F=c*C,R=h*w,B=h*C,z=m*C,j=y*x,Q=y*w,J=y*C,X=a[0],ue=a[1],ne=a[2];return t[0]=(1-(R+z))*X,t[1]=(S+J)*X,t[2]=(F-Q)*X,t[3]=0,t[4]=(S-J)*ue,t[5]=(1-(A+z))*ue,t[6]=(B+j)*ue,t[7]=0,t[8]=(F+Q)*ne,t[9]=(B-j)*ne,t[10]=(1-(A+R))*ne,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Bt.fromRotationTranslationScaleOrigin=function(t,e,n,a,c){var h=e[0],m=e[1],y=e[2],x=e[3],w=h+h,C=m+m,A=y+y,S=h*w,F=h*C,R=h*A,B=m*C,z=m*A,j=y*A,Q=x*w,J=x*C,X=x*A,ue=a[0],ne=a[1],de=a[2],ge=c[0],we=c[1],Oe=c[2],Ee=(1-(B+j))*ue,Ne=(F+X)*ue,Be=(R-J)*ue,Re=(F-X)*ne,We=(1-(S+j))*ne,Ge=(z+Q)*ne,Je=(R+J)*de,Ke=(z-Q)*de,Le=(1-(S+B))*de;return t[0]=Ee,t[1]=Ne,t[2]=Be,t[3]=0,t[4]=Re,t[5]=We,t[6]=Ge,t[7]=0,t[8]=Je,t[9]=Ke,t[10]=Le,t[11]=0,t[12]=n[0]+ge-(Ee*ge+Re*we+Je*Oe),t[13]=n[1]+we-(Ne*ge+We*we+Ke*Oe),t[14]=n[2]+Oe-(Be*ge+Ge*we+Le*Oe),t[15]=1,t},Bt.fromQuat=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=n+n,y=a+a,x=c+c,w=n*m,C=a*m,A=a*y,S=c*m,F=c*y,R=c*x,B=h*m,z=h*y,j=h*x;return t[0]=1-A-R,t[1]=C+j,t[2]=S-z,t[3]=0,t[4]=C-j,t[5]=1-w-R,t[6]=F+B,t[7]=0,t[8]=S+z,t[9]=F-B,t[10]=1-w-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Bt.frustum=function(t,e,n,a,c,h,m){var y=1/(n-e),x=1/(c-a),w=1/(h-m);return t[0]=2*h*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*h*x,t[6]=0,t[7]=0,t[8]=(n+e)*y,t[9]=(c+a)*x,t[10]=(m+h)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=m*h*2*w,t[15]=0,t},Bt.perspectiveNO=qo,Bt.perspectiveZO=function(t,e,n,a,c){var h,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=c*(h=1/(a-c)),t[14]=c*a*h):(t[10]=-1,t[14]=-a),t},Bt.perspectiveFromFieldOfView=function(t,e,n,a){var c=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),m=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),x=2/(m+y),w=2/(c+h);return t[0]=x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(m-y)*x*.5,t[9]=(c-h)*w*.5,t[10]=a/(n-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n/(n-a),t[15]=0,t},Bt.orthoNO=Bi,Bt.orthoZO=function(t,e,n,a,c,h,m){var y=1/(e-n),x=1/(a-c),w=1/(h-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*y,t[13]=(c+a)*x,t[14]=h*w,t[15]=1,t},Bt.lookAt=function(t,e,n,a){var c,h,m,y,x,w,C,A,S,F,R=e[0],B=e[1],z=e[2],j=a[0],Q=a[1],J=a[2],X=n[0],ue=n[1],ne=n[2];return Math.abs(R-X)<hi.EPSILON&&Math.abs(B-ue)<hi.EPSILON&&Math.abs(z-ne)<hi.EPSILON?hs(t):(C=R-X,A=B-ue,S=z-ne,c=Q*(S*=F=1/Math.hypot(C,A,S))-J*(A*=F),h=J*(C*=F)-j*S,m=j*A-Q*C,(F=Math.hypot(c,h,m))?(c*=F=1/F,h*=F,m*=F):(c=0,h=0,m=0),y=A*m-S*h,x=S*c-C*m,w=C*h-A*c,(F=Math.hypot(y,x,w))?(y*=F=1/F,x*=F,w*=F):(y=0,x=0,w=0),t[0]=c,t[1]=y,t[2]=C,t[3]=0,t[4]=h,t[5]=x,t[6]=A,t[7]=0,t[8]=m,t[9]=w,t[10]=S,t[11]=0,t[12]=-(c*R+h*B+m*z),t[13]=-(y*R+x*B+w*z),t[14]=-(C*R+A*B+S*z),t[15]=1,t)},Bt.targetTo=function(t,e,n,a){var c=e[0],h=e[1],m=e[2],y=a[0],x=a[1],w=a[2],C=c-n[0],A=h-n[1],S=m-n[2],F=C*C+A*A+S*S;F>0&&(C*=F=1/Math.sqrt(F),A*=F,S*=F);var R=x*S-w*A,B=w*C-y*S,z=y*A-x*C;return(F=R*R+B*B+z*z)>0&&(R*=F=1/Math.sqrt(F),B*=F,z*=F),t[0]=R,t[1]=B,t[2]=z,t[3]=0,t[4]=A*z-S*B,t[5]=S*R-C*z,t[6]=C*B-A*R,t[7]=0,t[8]=C,t[9]=A,t[10]=S,t[11]=0,t[12]=c,t[13]=h,t[14]=m,t[15]=1,t},Bt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Bt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Bt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Bt.subtract=Ss,Bt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Bt.multiplyScalarAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t[4]=e[4]+n[4]*a,t[5]=e[5]+n[5]*a,t[6]=e[6]+n[6]*a,t[7]=e[7]+n[7]*a,t[8]=e[8]+n[8]*a,t[9]=e[9]+n[9]*a,t[10]=e[10]+n[10]*a,t[11]=e[11]+n[11]*a,t[12]=e[12]+n[12]*a,t[13]=e[13]+n[13]*a,t[14]=e[14]+n[14]*a,t[15]=e[15]+n[15]*a,t},Bt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Bt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=t[4],y=t[5],x=t[6],w=t[7],C=t[8],A=t[9],S=t[10],F=t[11],R=t[12],B=t[13],z=t[14],j=t[15],Q=e[0],J=e[1],X=e[2],ue=e[3],ne=e[4],de=e[5],ge=e[6],we=e[7],Oe=e[8],Ee=e[9],Ne=e[10],Be=e[11],Re=e[12],We=e[13],Ge=e[14],Je=e[15];return Math.abs(n-Q)<=hi.EPSILON*Math.max(1,Math.abs(n),Math.abs(Q))&&Math.abs(a-J)<=hi.EPSILON*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(c-X)<=hi.EPSILON*Math.max(1,Math.abs(c),Math.abs(X))&&Math.abs(h-ue)<=hi.EPSILON*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(m-ne)<=hi.EPSILON*Math.max(1,Math.abs(m),Math.abs(ne))&&Math.abs(y-de)<=hi.EPSILON*Math.max(1,Math.abs(y),Math.abs(de))&&Math.abs(x-ge)<=hi.EPSILON*Math.max(1,Math.abs(x),Math.abs(ge))&&Math.abs(w-we)<=hi.EPSILON*Math.max(1,Math.abs(w),Math.abs(we))&&Math.abs(C-Oe)<=hi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Oe))&&Math.abs(A-Ee)<=hi.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ee))&&Math.abs(S-Ne)<=hi.EPSILON*Math.max(1,Math.abs(S),Math.abs(Ne))&&Math.abs(F-Be)<=hi.EPSILON*Math.max(1,Math.abs(F),Math.abs(Be))&&Math.abs(R-Re)<=hi.EPSILON*Math.max(1,Math.abs(R),Math.abs(Re))&&Math.abs(B-We)<=hi.EPSILON*Math.max(1,Math.abs(B),Math.abs(We))&&Math.abs(z-Ge)<=hi.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ge))&&Math.abs(j-Je)<=hi.EPSILON*Math.max(1,Math.abs(j),Math.abs(Je))},Bt.sub=Bt.mul=Bt.ortho=Bt.perspective=void 0;var hi=function(t,e){if(t&&t.__esModule)return t;if(t===null||Mn(t)!=="object"&&typeof t!="function")return{default:t};var n=Po(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function Po(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Po=function(a){return a?n:e})(t)}function hs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oo(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=e[8],S=e[9],F=e[10],R=e[11],B=e[12],z=e[13],j=e[14],Q=e[15],J=n[0],X=n[1],ue=n[2],ne=n[3];return t[0]=J*a+X*y+ue*A+ne*B,t[1]=J*c+X*x+ue*S+ne*z,t[2]=J*h+X*w+ue*F+ne*j,t[3]=J*m+X*C+ue*R+ne*Q,t[4]=(J=n[4])*a+(X=n[5])*y+(ue=n[6])*A+(ne=n[7])*B,t[5]=J*c+X*x+ue*S+ne*z,t[6]=J*h+X*w+ue*F+ne*j,t[7]=J*m+X*C+ue*R+ne*Q,t[8]=(J=n[8])*a+(X=n[9])*y+(ue=n[10])*A+(ne=n[11])*B,t[9]=J*c+X*x+ue*S+ne*z,t[10]=J*h+X*w+ue*F+ne*j,t[11]=J*m+X*C+ue*R+ne*Q,t[12]=(J=n[12])*a+(X=n[13])*y+(ue=n[14])*A+(ne=n[15])*B,t[13]=J*c+X*x+ue*S+ne*z,t[14]=J*h+X*w+ue*F+ne*j,t[15]=J*m+X*C+ue*R+ne*Q,t}function pr(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=a+a,x=c+c,w=h+h,C=a*y,A=a*x,S=a*w,F=c*x,R=c*w,B=h*w,z=m*y,j=m*x,Q=m*w;return t[0]=1-(F+B),t[1]=A+Q,t[2]=S-j,t[3]=0,t[4]=A-Q,t[5]=1-(C+B),t[6]=R+z,t[7]=0,t[8]=S+j,t[9]=R-z,t[10]=1-(C+F),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function vr(t,e){var n=e[4],a=e[5],c=e[6],h=e[8],m=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,a,c),t[2]=Math.hypot(h,m,y),t}function qo(t,e,n,a,c){var h,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+a)*(h=1/(a-c)),t[14]=2*c*a*h):(t[10]=-1,t[14]=-2*a),t}function Bi(t,e,n,a,c,h,m){var y=1/(e-n),x=1/(a-c),w=1/(h-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*y,t[13]=(c+a)*x,t[14]=(m+h)*w,t[15]=1,t}function Ss(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Bt.perspective=qo,Bt.ortho=Bi,Bt.mul=oo,Bt.sub=Ss;var Zt={},Wt={};function Wo(t){return Wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wo(t)}Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.create=ee,Wt.clone=function(t){var e=new Yi.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Wt.length=le,Wt.fromValues=function(t,e,n){var a=new Yi.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=n,a},Wt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Wt.set=function(t,e,n,a){return t[0]=e,t[1]=n,t[2]=a,t},Wt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Wt.subtract=xe,Wt.multiply=He,Wt.divide=Qe,Wt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Wt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Wt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Wt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Wt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Wt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Wt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t},Wt.distance=at,Wt.squaredDistance=kt,Wt.squaredLength=je,Wt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Wt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Wt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],h=n*n+a*a+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t},Wt.dot=vt,Wt.cross=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=n[0],y=n[1],x=n[2];return t[0]=c*x-h*y,t[1]=h*m-a*x,t[2]=a*y-c*m,t},Wt.lerp=function(t,e,n,a){var c=e[0],h=e[1],m=e[2];return t[0]=c+a*(n[0]-c),t[1]=h+a*(n[1]-h),t[2]=m+a*(n[2]-m),t},Wt.hermite=function(t,e,n,a,c,h){var m=h*h,y=m*(2*h-3)+1,x=m*(h-2)+h,w=m*(h-1),C=m*(3-2*h);return t[0]=e[0]*y+n[0]*x+a[0]*w+c[0]*C,t[1]=e[1]*y+n[1]*x+a[1]*w+c[1]*C,t[2]=e[2]*y+n[2]*x+a[2]*w+c[2]*C,t},Wt.bezier=function(t,e,n,a,c,h){var m=1-h,y=m*m,x=h*h,w=y*m,C=3*h*y,A=3*x*m,S=x*h;return t[0]=e[0]*w+n[0]*C+a[0]*A+c[0]*S,t[1]=e[1]*w+n[1]*C+a[1]*A+c[1]*S,t[2]=e[2]*w+n[2]*C+a[2]*A+c[2]*S,t},Wt.random=function(t,e){e=e||1;var n=2*Yi.RANDOM()*Math.PI,a=2*Yi.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(n)*c,t[1]=Math.sin(n)*c,t[2]=a*e,t},Wt.transformMat4=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=n[3]*a+n[7]*c+n[11]*h+n[15];return t[0]=(n[0]*a+n[4]*c+n[8]*h+n[12])/(m=m||1),t[1]=(n[1]*a+n[5]*c+n[9]*h+n[13])/m,t[2]=(n[2]*a+n[6]*c+n[10]*h+n[14])/m,t},Wt.transformMat3=function(t,e,n){var a=e[0],c=e[1],h=e[2];return t[0]=a*n[0]+c*n[3]+h*n[6],t[1]=a*n[1]+c*n[4]+h*n[7],t[2]=a*n[2]+c*n[5]+h*n[8],t},Wt.transformQuat=function(t,e,n){var a=n[0],c=n[1],h=n[2],m=e[0],y=e[1],x=e[2],w=c*x-h*y,C=h*m-a*x,A=a*y-c*m,S=c*A-h*C,F=h*w-a*A,R=a*C-c*w,B=2*n[3];return C*=B,A*=B,F*=2,R*=2,t[0]=m+(w*=B)+(S*=2),t[1]=y+C+F,t[2]=x+A+R,t},Wt.rotateX=function(t,e,n,a){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[0],h[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),h[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},Wt.rotateY=function(t,e,n,a){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),h[1]=c[1],h[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},Wt.rotateZ=function(t,e,n,a){var c=[],h=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],h[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),h[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),h[2]=c[2],t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},Wt.angle=function(t,e){var n=t[0],a=t[1],c=t[2],h=e[0],m=e[1],y=e[2],x=Math.sqrt(n*n+a*a+c*c)*Math.sqrt(h*h+m*m+y*y),w=x&&vt(t,e)/x;return Math.acos(Math.min(Math.max(w,-1),1))},Wt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Wt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Wt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Wt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=e[0],m=e[1],y=e[2];return Math.abs(n-h)<=Yi.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-m)<=Yi.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(c-y)<=Yi.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},Wt.forEach=Wt.sqrLen=Wt.len=Wt.sqrDist=Wt.dist=Wt.div=Wt.mul=Wt.sub=void 0;var Yi=function(t,e){if(t&&t.__esModule)return t;if(t===null||Wo(t)!=="object"&&typeof t!="function")return{default:t};var n=Ye(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function Ye(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ye=function(a){return a?n:e})(t)}function ee(){var t=new Yi.ARRAY_TYPE(3);return Yi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function le(t){return Math.hypot(t[0],t[1],t[2])}function xe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function He(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Qe(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function at(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function kt(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2];return n*n+a*a+c*c}function je(t){var e=t[0],n=t[1],a=t[2];return e*e+n*n+a*a}function vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Wt.sub=xe,Wt.mul=He,Wt.div=Qe,Wt.dist=at,Wt.sqrDist=kt,Wt.len=le,Wt.sqrLen=je;var St,Lt=(St=ee(),function(t,e,n,a,c,h){var m,y;for(e||(e=3),n||(n=0),y=a?Math.min(a*e+n,t.length):t.length,m=n;m<y;m+=e)St[0]=t[m],St[1]=t[m+1],St[2]=t[m+2],c(St,St,h),t[m]=St[0],t[m+1]=St[1],t[m+2]=St[2];return t});Wt.forEach=Lt;var gt={};function ri(t){return ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ri(t)}Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=Vn,gt.clone=function(t){var e=new Hn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},gt.fromValues=function(t,e,n,a){var c=new Hn.ARRAY_TYPE(4);return c[0]=t,c[1]=e,c[2]=n,c[3]=a,c},gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},gt.set=function(t,e,n,a,c){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t},gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},gt.subtract=$n,gt.multiply=si,gt.divide=Mi,gt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},gt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},gt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},gt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},gt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},gt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},gt.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t[2]=e[2]+n[2]*a,t[3]=e[3]+n[3]*a,t},gt.distance=rr,gt.squaredDistance=bi,gt.length=Mr,gt.squaredLength=wr,gt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},gt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},gt.normalize=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=n*n+a*a+c*c+h*h;return m>0&&(m=1/Math.sqrt(m)),t[0]=n*m,t[1]=a*m,t[2]=c*m,t[3]=h*m,t},gt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},gt.cross=function(t,e,n,a){var c=n[0]*a[1]-n[1]*a[0],h=n[0]*a[2]-n[2]*a[0],m=n[0]*a[3]-n[3]*a[0],y=n[1]*a[2]-n[2]*a[1],x=n[1]*a[3]-n[3]*a[1],w=n[2]*a[3]-n[3]*a[2],C=e[0],A=e[1],S=e[2],F=e[3];return t[0]=A*w-S*x+F*y,t[1]=-C*w+S*m-F*h,t[2]=C*x-A*m+F*c,t[3]=-C*y+A*h-S*c,t},gt.lerp=function(t,e,n,a){var c=e[0],h=e[1],m=e[2],y=e[3];return t[0]=c+a*(n[0]-c),t[1]=h+a*(n[1]-h),t[2]=m+a*(n[2]-m),t[3]=y+a*(n[3]-y),t},gt.random=function(t,e){var n,a,c,h,m,y;e=e||1;do m=(n=2*Hn.RANDOM()-1)*n+(a=2*Hn.RANDOM()-1)*a;while(m>=1);do y=(c=2*Hn.RANDOM()-1)*c+(h=2*Hn.RANDOM()-1)*h;while(y>=1);var x=Math.sqrt((1-m)/y);return t[0]=e*n,t[1]=e*a,t[2]=e*c*x,t[3]=e*h*x,t},gt.transformMat4=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3];return t[0]=n[0]*a+n[4]*c+n[8]*h+n[12]*m,t[1]=n[1]*a+n[5]*c+n[9]*h+n[13]*m,t[2]=n[2]*a+n[6]*c+n[10]*h+n[14]*m,t[3]=n[3]*a+n[7]*c+n[11]*h+n[15]*m,t},gt.transformQuat=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=n[0],y=n[1],x=n[2],w=n[3],C=w*a+y*h-x*c,A=w*c+x*a-m*h,S=w*h+m*c-y*a,F=-m*a-y*c-x*h;return t[0]=C*w+F*-m+A*-x-S*-y,t[1]=A*w+F*-y+S*-m-C*-x,t[2]=S*w+F*-x+C*-y-A*-m,t[3]=e[3],t},gt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},gt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},gt.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=e[0],y=e[1],x=e[2],w=e[3];return Math.abs(n-m)<=Hn.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=Hn.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-x)<=Hn.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-w)<=Hn.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var Hn=function(t,e){if(t&&t.__esModule)return t;if(t===null||ri(t)!=="object"&&typeof t!="function")return{default:t};var n=oi(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function oi(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(oi=function(a){return a?n:e})(t)}function Vn(){var t=new Hn.ARRAY_TYPE(4);return Hn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function si(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Mi(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function rr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function bi(t,e){var n=e[0]-t[0],a=e[1]-t[1],c=e[2]-t[2],h=e[3]-t[3];return n*n+a*a+c*c+h*h}function Mr(t){return Math.hypot(t[0],t[1],t[2],t[3])}function wr(t){var e=t[0],n=t[1],a=t[2],c=t[3];return e*e+n*n+a*a+c*c}gt.sub=$n,gt.mul=si,gt.div=Mi,gt.dist=rr,gt.sqrDist=bi,gt.len=Mr,gt.sqrLen=wr;var so=function(){var t=Vn();return function(e,n,a,c,h,m){var y,x;for(n||(n=4),a||(a=0),x=c?Math.min(c*n+a,e.length):e.length,y=a;y<x;y+=n)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],h(t,t,m),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function Xi(t){return Xi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xi(t)}gt.forEach=so,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=ut,Zt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Zt.setAxisAngle=dt,Zt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>Pi.EPSILON?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n},Zt.getAngle=function(t,e){var n=mi(t,e);return Math.acos(2*n*n-1)},Zt.multiply=lt,Zt.rotateX=function(t,e,n){n*=.5;var a=e[0],c=e[1],h=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x+m*y,t[1]=c*x+h*y,t[2]=h*x-c*y,t[3]=m*x-a*y,t},Zt.rotateY=function(t,e,n){n*=.5;var a=e[0],c=e[1],h=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x-h*y,t[1]=c*x+m*y,t[2]=h*x+a*y,t[3]=m*x-c*y,t},Zt.rotateZ=function(t,e,n){n*=.5;var a=e[0],c=e[1],h=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=a*x+c*y,t[1]=c*x-a*y,t[2]=h*x+m*y,t[3]=m*x-h*y,t},Zt.calculateW=function(t,e){var n=e[0],a=e[1],c=e[2];return t[0]=n,t[1]=a,t[2]=c,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-c*c)),t},Zt.exp=Ct,Zt.ln=ct,Zt.pow=function(t,e,n){return ct(t,e),Ut(t,t,n),Ct(t,t),t},Zt.slerp=en,Zt.random=function(t){var e=Pi.RANDOM(),n=Pi.RANDOM(),a=Pi.RANDOM(),c=Math.sqrt(1-e),h=Math.sqrt(e);return t[0]=c*Math.sin(2*Math.PI*n),t[1]=c*Math.cos(2*Math.PI*n),t[2]=h*Math.sin(2*Math.PI*a),t[3]=h*Math.cos(2*Math.PI*a),t},Zt.invert=function(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=n*n+a*a+c*c+h*h,y=m?1/m:0;return t[0]=-n*y,t[1]=-a*y,t[2]=-c*y,t[3]=h*y,t},Zt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Zt.fromMat3=Fn,Zt.fromEuler=function(t,e,n,a){var c=.5*Math.PI/180;e*=c,n*=c,a*=c;var h=Math.sin(e),m=Math.cos(e),y=Math.sin(n),x=Math.cos(n),w=Math.sin(a),C=Math.cos(a);return t[0]=h*x*C-m*y*w,t[1]=m*y*C+h*x*w,t[2]=m*x*w-h*y*C,t[3]=m*x*C+h*y*w,t},Zt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Zt.setAxes=Zt.sqlerp=Zt.rotationTo=Zt.equals=Zt.exactEquals=Zt.normalize=Zt.sqrLen=Zt.squaredLength=Zt.len=Zt.length=Zt.lerp=Zt.dot=Zt.scale=Zt.mul=Zt.add=Zt.set=Zt.copy=Zt.fromValues=Zt.clone=void 0;var Pi=rt(me),Ue=rt(qe),ze=rt(Wt),et=rt(gt);function it(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(it=function(a){return a?n:e})(t)}function rt(t,e){if(t&&t.__esModule)return t;if(t===null||Xi(t)!=="object"&&typeof t!="function")return{default:t};var n=it(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}function ut(){var t=new Pi.ARRAY_TYPE(4);return Pi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function dt(t,e,n){n*=.5;var a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function lt(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=n[0],x=n[1],w=n[2],C=n[3];return t[0]=a*C+m*y+c*w-h*x,t[1]=c*C+m*x+h*y-a*w,t[2]=h*C+m*w+a*x-c*y,t[3]=m*C-a*y-c*x-h*w,t}function Ct(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=Math.sqrt(n*n+a*a+c*c),y=Math.exp(h),x=m>0?y*Math.sin(m)/m:0;return t[0]=n*x,t[1]=a*x,t[2]=c*x,t[3]=y*Math.cos(m),t}function ct(t,e){var n=e[0],a=e[1],c=e[2],h=e[3],m=Math.sqrt(n*n+a*a+c*c),y=m>0?Math.atan2(m,h)/m:0;return t[0]=n*y,t[1]=a*y,t[2]=c*y,t[3]=.5*Math.log(n*n+a*a+c*c+h*h),t}function en(t,e,n,a){var c,h,m,y,x,w=e[0],C=e[1],A=e[2],S=e[3],F=n[0],R=n[1],B=n[2],z=n[3];return(h=w*F+C*R+A*B+S*z)<0&&(h=-h,F=-F,R=-R,B=-B,z=-z),1-h>Pi.EPSILON?(c=Math.acos(h),m=Math.sin(c),y=Math.sin((1-a)*c)/m,x=Math.sin(a*c)/m):(y=1-a,x=a),t[0]=y*w+x*F,t[1]=y*C+x*R,t[2]=y*A+x*B,t[3]=y*S+x*z,t}function Fn(t,e){var n,a=e[0]+e[4]+e[8];if(a>0)n=Math.sqrt(a+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var h=(c+1)%3,m=(c+2)%3;n=Math.sqrt(e[3*c+c]-e[3*h+h]-e[3*m+m]+1),t[c]=.5*n,t[3]=(e[3*h+m]-e[3*m+h])*(n=.5/n),t[h]=(e[3*h+c]+e[3*c+h])*n,t[m]=(e[3*m+c]+e[3*c+m])*n}return t}Zt.clone=et.clone,Zt.fromValues=et.fromValues,Zt.copy=et.copy,Zt.set=et.set,Zt.add=et.add,Zt.mul=lt;var Ut=et.scale;Zt.scale=Ut;var mi=et.dot;Zt.dot=mi,Zt.lerp=et.lerp;var Vi=et.length;Zt.length=Vi,Zt.len=Vi;var ji=et.squaredLength;Zt.squaredLength=ji,Zt.sqrLen=ji;var Ki=et.normalize;Zt.normalize=Ki,Zt.exactEquals=et.exactEquals,Zt.equals=et.equals;var qi,Ln,vo,Zo=(qi=ze.create(),Ln=ze.fromValues(1,0,0),vo=ze.fromValues(0,1,0),function(t,e,n){var a=ze.dot(e,n);return a<-.999999?(ze.cross(qi,Ln,e),ze.len(qi)<1e-6&&ze.cross(qi,vo,e),ze.normalize(qi,qi),dt(t,qi,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ze.cross(qi,e,n),t[0]=qi[0],t[1]=qi[1],t[2]=qi[2],t[3]=1+a,Ki(t,t))});Zt.rotationTo=Zo;var Dr,Aa,Cc=(Dr=ut(),Aa=ut(),function(t,e,n,a,c,h){return en(Dr,e,c,h),en(Aa,n,a,h),en(t,Dr,Aa,2*h*(1-h)),t});Zt.sqlerp=Cc;var qr,gv=(qr=Ue.create(),function(t,e,n,a){return qr[0]=n[0],qr[3]=n[1],qr[6]=n[2],qr[1]=a[0],qr[4]=a[1],qr[7]=a[2],qr[2]=-e[0],qr[5]=-e[1],qr[8]=-e[2],Ki(t,Fn(t,qr))});Zt.setAxes=gv;var Dn={};function wf(t){return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wf(t)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var t=new Wr.ARRAY_TYPE(8);return Wr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Dn.clone=function(t){var e=new Wr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Dn.fromValues=function(t,e,n,a,c,h,m,y){var x=new Wr.ARRAY_TYPE(8);return x[0]=t,x[1]=e,x[2]=n,x[3]=a,x[4]=c,x[5]=h,x[6]=m,x[7]=y,x},Dn.fromRotationTranslationValues=function(t,e,n,a,c,h,m){var y=new Wr.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=n,y[3]=a;var x=.5*c,w=.5*h,C=.5*m;return y[4]=x*a+w*n-C*e,y[5]=w*a+C*t-x*n,y[6]=C*a+x*e-w*t,y[7]=-x*t-w*e-C*n,y},Dn.fromRotationTranslation=n0,Dn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Dn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Dn.fromMat4=function(t,e){var n=Is.create();e0.getRotation(n,e);var a=new Wr.ARRAY_TYPE(3);return e0.getTranslation(a,e),n0(t,n,a),t},Dn.copy=i0,Dn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Dn.set=function(t,e,n,a,c,h,m,y,x){return t[0]=e,t[1]=n,t[2]=a,t[3]=c,t[4]=h,t[5]=m,t[6]=y,t[7]=x,t},Dn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Dn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Dn.getTranslation=function(t,e){var n=e[4],a=e[5],c=e[6],h=e[7],m=-e[0],y=-e[1],x=-e[2],w=e[3];return t[0]=2*(n*w+h*m+a*x-c*y),t[1]=2*(a*w+h*y+c*m-n*x),t[2]=2*(c*w+h*x+n*y-a*m),t},Dn.translate=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=.5*n[0],x=.5*n[1],w=.5*n[2],C=e[4],A=e[5],S=e[6],F=e[7];return t[0]=a,t[1]=c,t[2]=h,t[3]=m,t[4]=m*y+c*w-h*x+C,t[5]=m*x+h*y-a*w+A,t[6]=m*w+a*x-c*y+S,t[7]=-a*y-c*x-h*w+F,t},Dn.rotateX=function(t,e,n){var a=-e[0],c=-e[1],h=-e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=y*m+C*a+x*h-w*c,S=x*m+C*c+w*a-y*h,F=w*m+C*h+y*c-x*a,R=C*m-y*a-x*c-w*h;return Is.rotateX(t,e,n),t[4]=A*(m=t[3])+R*(a=t[0])+S*(h=t[2])-F*(c=t[1]),t[5]=S*m+R*c+F*a-A*h,t[6]=F*m+R*h+A*c-S*a,t[7]=R*m-A*a-S*c-F*h,t},Dn.rotateY=function(t,e,n){var a=-e[0],c=-e[1],h=-e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=y*m+C*a+x*h-w*c,S=x*m+C*c+w*a-y*h,F=w*m+C*h+y*c-x*a,R=C*m-y*a-x*c-w*h;return Is.rotateY(t,e,n),t[4]=A*(m=t[3])+R*(a=t[0])+S*(h=t[2])-F*(c=t[1]),t[5]=S*m+R*c+F*a-A*h,t[6]=F*m+R*h+A*c-S*a,t[7]=R*m-A*a-S*c-F*h,t},Dn.rotateZ=function(t,e,n){var a=-e[0],c=-e[1],h=-e[2],m=e[3],y=e[4],x=e[5],w=e[6],C=e[7],A=y*m+C*a+x*h-w*c,S=x*m+C*c+w*a-y*h,F=w*m+C*h+y*c-x*a,R=C*m-y*a-x*c-w*h;return Is.rotateZ(t,e,n),t[4]=A*(m=t[3])+R*(a=t[0])+S*(h=t[2])-F*(c=t[1]),t[5]=S*m+R*c+F*a-A*h,t[6]=F*m+R*h+A*c-S*a,t[7]=R*m-A*a-S*c-F*h,t},Dn.rotateByQuatAppend=function(t,e,n){var a=n[0],c=n[1],h=n[2],m=n[3],y=e[0],x=e[1],w=e[2],C=e[3];return t[0]=y*m+C*a+x*h-w*c,t[1]=x*m+C*c+w*a-y*h,t[2]=w*m+C*h+y*c-x*a,t[3]=C*m-y*a-x*c-w*h,t[4]=(y=e[4])*m+(C=e[7])*a+(x=e[5])*h-(w=e[6])*c,t[5]=x*m+C*c+w*a-y*h,t[6]=w*m+C*h+y*c-x*a,t[7]=C*m-y*a-x*c-w*h,t},Dn.rotateByQuatPrepend=function(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=n[0],x=n[1],w=n[2],C=n[3];return t[0]=a*C+m*y+c*w-h*x,t[1]=c*C+m*x+h*y-a*w,t[2]=h*C+m*w+a*x-c*y,t[3]=m*C-a*y-c*x-h*w,t[4]=a*(C=n[7])+m*(y=n[4])+c*(w=n[6])-h*(x=n[5]),t[5]=c*C+m*x+h*y-a*w,t[6]=h*C+m*w+a*x-c*y,t[7]=m*C-a*y-c*x-h*w,t},Dn.rotateAroundAxis=function(t,e,n,a){if(Math.abs(a)<Wr.EPSILON)return i0(t,e);var c=Math.hypot(n[0],n[1],n[2]);a*=.5;var h=Math.sin(a),m=h*n[0]/c,y=h*n[1]/c,x=h*n[2]/c,w=Math.cos(a),C=e[0],A=e[1],S=e[2],F=e[3];t[0]=C*w+F*m+A*x-S*y,t[1]=A*w+F*y+S*m-C*x,t[2]=S*w+F*x+C*y-A*m,t[3]=F*w-C*m-A*y-S*x;var R=e[4],B=e[5],z=e[6],j=e[7];return t[4]=R*w+j*m+B*x-z*y,t[5]=B*w+j*y+z*m-R*x,t[6]=z*w+j*x+R*y-B*m,t[7]=j*w-R*m-B*y-z*x,t},Dn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Dn.multiply=r0,Dn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Dn.lerp=function(t,e,n,a){var c=1-a;return o0(e,n)<0&&(a=-a),t[0]=e[0]*c+n[0]*a,t[1]=e[1]*c+n[1]*a,t[2]=e[2]*c+n[2]*a,t[3]=e[3]*c+n[3]*a,t[4]=e[4]*c+n[4]*a,t[5]=e[5]*c+n[5]*a,t[6]=e[6]*c+n[6]*a,t[7]=e[7]*c+n[7]*a,t},Dn.invert=function(t,e){var n=Ju(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Dn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Dn.normalize=function(t,e){var n=Ju(e);if(n>0){n=Math.sqrt(n);var a=e[0]/n,c=e[1]/n,h=e[2]/n,m=e[3]/n,y=e[4],x=e[5],w=e[6],C=e[7],A=a*y+c*x+h*w+m*C;t[0]=a,t[1]=c,t[2]=h,t[3]=m,t[4]=(y-a*A)/n,t[5]=(x-c*A)/n,t[6]=(w-h*A)/n,t[7]=(C-m*A)/n}return t},Dn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Dn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Dn.equals=function(t,e){var n=t[0],a=t[1],c=t[2],h=t[3],m=t[4],y=t[5],x=t[6],w=t[7],C=e[0],A=e[1],S=e[2],F=e[3],R=e[4],B=e[5],z=e[6],j=e[7];return Math.abs(n-C)<=Wr.EPSILON*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(a-A)<=Wr.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-S)<=Wr.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-F)<=Wr.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(m-R)<=Wr.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-B)<=Wr.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(x-z)<=Wr.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(w-j)<=Wr.EPSILON*Math.max(1,Math.abs(w),Math.abs(j))},Dn.sqrLen=Dn.squaredLength=Dn.len=Dn.length=Dn.dot=Dn.mul=Dn.setReal=Dn.getReal=void 0;var Wr=Df(me),Is=Df(Zt),e0=Df(Bt);function t0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(t0=function(a){return a?n:e})(t)}function Df(t,e){if(t&&t.__esModule)return t;if(t===null||wf(t)!=="object"&&typeof t!="function")return{default:t};var n=t0(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}function n0(t,e,n){var a=.5*n[0],c=.5*n[1],h=.5*n[2],m=e[0],y=e[1],x=e[2],w=e[3];return t[0]=m,t[1]=y,t[2]=x,t[3]=w,t[4]=a*w+c*x-h*y,t[5]=c*w+h*m-a*x,t[6]=h*w+a*y-c*m,t[7]=-a*m-c*y-h*x,t}function i0(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function r0(t,e,n){var a=e[0],c=e[1],h=e[2],m=e[3],y=n[4],x=n[5],w=n[6],C=n[7],A=e[4],S=e[5],F=e[6],R=e[7],B=n[0],z=n[1],j=n[2],Q=n[3];return t[0]=a*Q+m*B+c*j-h*z,t[1]=c*Q+m*z+h*B-a*j,t[2]=h*Q+m*j+a*z-c*B,t[3]=m*Q-a*B-c*z-h*j,t[4]=a*C+m*y+c*w-h*x+A*Q+R*B+S*j-F*z,t[5]=c*C+m*x+h*y-a*w+S*Q+R*z+F*B-A*j,t[6]=h*C+m*w+a*x-c*y+F*Q+R*j+A*z-S*B,t[7]=m*C-a*y-c*x-h*w+R*Q-A*B-S*z-F*j,t}Dn.getReal=Is.copy,Dn.setReal=Is.copy,Dn.mul=r0;var o0=Is.dot;Dn.dot=o0;var s0=Is.length;Dn.length=s0,Dn.len=s0;var Ju=Is.squaredLength;Dn.squaredLength=Ju,Dn.sqrLen=Ju;var hn={};function Cf(t){return Cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cf(t)}Object.defineProperty(hn,"__esModule",{value:!0}),hn.create=l0,hn.clone=function(t){var e=new Ta.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},hn.fromValues=function(t,e){var n=new Ta.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},hn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},hn.set=function(t,e,n){return t[0]=e,t[1]=n,t},hn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},hn.subtract=c0,hn.multiply=u0,hn.divide=h0,hn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},hn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},hn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},hn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},hn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},hn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},hn.scaleAndAdd=function(t,e,n,a){return t[0]=e[0]+n[0]*a,t[1]=e[1]+n[1]*a,t},hn.distance=d0,hn.squaredDistance=f0,hn.length=p0,hn.squaredLength=eh,hn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},hn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},hn.normalize=function(t,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t},hn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},hn.cross=function(t,e,n){var a=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=a,t},hn.lerp=function(t,e,n,a){var c=e[0],h=e[1];return t[0]=c+a*(n[0]-c),t[1]=h+a*(n[1]-h),t},hn.random=function(t,e){e=e||1;var n=2*Ta.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},hn.transformMat2=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c,t[1]=n[1]*a+n[3]*c,t},hn.transformMat2d=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[2]*c+n[4],t[1]=n[1]*a+n[3]*c+n[5],t},hn.transformMat3=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[3]*c+n[6],t[1]=n[1]*a+n[4]*c+n[7],t},hn.transformMat4=function(t,e,n){var a=e[0],c=e[1];return t[0]=n[0]*a+n[4]*c+n[12],t[1]=n[1]*a+n[5]*c+n[13],t},hn.rotate=function(t,e,n,a){var c=e[0]-n[0],h=e[1]-n[1],m=Math.sin(a),y=Math.cos(a);return t[0]=c*y-h*m+n[0],t[1]=c*m+h*y+n[1],t},hn.angle=function(t,e){var n=t[0],a=t[1],c=e[0],h=e[1],m=Math.sqrt(n*n+a*a)*Math.sqrt(c*c+h*h);return Math.acos(Math.min(Math.max(m&&(n*c+a*h)/m,-1),1))},hn.zero=function(t){return t[0]=0,t[1]=0,t},hn.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},hn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},hn.equals=function(t,e){var n=t[0],a=t[1],c=e[0],h=e[1];return Math.abs(n-c)<=Ta.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=Ta.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},hn.forEach=hn.sqrLen=hn.sqrDist=hn.dist=hn.div=hn.mul=hn.sub=hn.len=void 0;var Ta=function(t,e){if(t&&t.__esModule)return t;if(t===null||Cf(t)!=="object"&&typeof t!="function")return{default:t};var n=a0(void 0);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}(me);function a0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(a0=function(a){return a?n:e})(t)}function l0(){var t=new Ta.ARRAY_TYPE(2);return Ta.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function c0(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function u0(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function h0(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function d0(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function f0(t,e){var n=e[0]-t[0],a=e[1]-t[1];return n*n+a*a}function p0(t){return Math.hypot(t[0],t[1])}function eh(t){var e=t[0],n=t[1];return e*e+n*n}hn.len=p0,hn.sub=c0,hn.mul=u0,hn.div=h0,hn.dist=d0,hn.sqrDist=f0,hn.sqrLen=eh;var _v=function(){var t=l0();return function(e,n,a,c,h,m){var y,x;for(n||(n=2),a||(a=0),x=c?Math.min(c*n+a,e.length):e.length,y=a;y<x;y+=n)t[0]=e[y],t[1]=e[y+1],h(t,t,m),e[y]=t[0],e[y+1]=t[1];return e}}();function th(t){return th=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},th(t)}hn.forEach=_v,Object.defineProperty(ce,"__esModule",{value:!0}),r.aa=ce.vec4=r.Q=ce.vec3=ce.vec2=ce.quat2=r.bl=ce.quat=r.a9=ce.mat4=r.ct=ce.mat3=ce.mat2d=r.b7=ce.mat2=ce.glMatrix=void 0;var yv=ds(me);ce.glMatrix=yv;var vv=ds(ot);r.b7=ce.mat2=vv;var xv=ds(wt);ce.mat2d=xv;var Gt=ds(qe);r.ct=ce.mat3=Gt;var Ef=ds(Bt);r.a9=ce.mat4=Ef;var on=ds(Zt);r.bl=ce.quat=on;var nh=ds(Dn);ce.quat2=nh;var _n=ds(hn);ce.vec2=_n;var Af=ds(Wt);r.Q=ce.vec3=Af;var Tf=ds(gt);function Kt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Kt=function(a){return a?n:e})(t)}function ds(t,e){if(t&&t.__esModule)return t;if(t===null||th(t)!=="object"&&typeof t!="function")return{default:t};var n=Kt(e);if(n&&n.has(t))return n.get(t);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var m=c?Object.getOwnPropertyDescriptor(t,h):null;m&&(m.get||m.set)?Object.defineProperty(a,h,m):a[h]=t[h]}return a.default=t,n&&n.set(t,a),a}r.aa=ce.vec4=Tf;var bv=Sa;function Sa(t,e,n,a){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=a}Sa.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,a=0;a<8;a++){var c=this.sampleCurveX(n)-t;if(Math.abs(c)<e)return n;var h=this.sampleCurveDerivativeX(n);if(Math.abs(h)<1e-6)break;n-=c/h}var m=0,y=1;for(n=t,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-t)<e));a++)t>c?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var m0=Te(bv),ih=Qo;function Qo(t,e){this.x=t,this.y=e}Qo.prototype={clone:function(){return new Qo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround:function(t,e){var n=Math.cos(t),a=Math.sin(t),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qo.convert=function(t){return t instanceof Qo?t:Array.isArray(t)?new Qo(t[0],t[1]):t};var ft=Te(ih);let Sf=Math.PI/180,If=180/Math.PI;function kn(t){return t*Sf}function Zr(t){return t*If}let g0=[[0,0],[1,0],[1,1],[0,1]];function rh(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function _0(t,e,n,a){let c=new m0(t,e,n,a);return function(h){return c.solve(h)}}let Yo=_0(.25,.1,.25,1);function Cn(t,e,n){return Math.min(n,Math.max(e,t))}function Ec(t,e,n){return(n=Cn((n-t)/(e-t),0,1))*n*(3-2*n)}function Ms(t,e,n){let a=n-e,c=((t-e)%a+a)%a+e;return c===e?n:c}function Mf(t,e,n){if(!t.length)return n(null,[]);let a=t.length,c=new Array(t.length),h=null;t.forEach((m,y)=>{e(m,(x,w)=>{x&&(h=x),c[y]=w,--a==0&&n(h,c)})})}function Oo(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}let y0=1;function qn(){return y0++}function oh(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Ff(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function v0(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Pf(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ia(t,e){return t.indexOf(e,t.length-e.length)!==-1}function hl(t,e,n){let a={};for(let c in t)a[c]=e.call(this,t[c],c,t);return a}function Ac(t,e,n){let a={};for(let c in t)e.call(this,t[c],c,t)&&(a[c]=t[c]);return a}function Fs(t){return Array.isArray(t)?t.map(Fs):typeof t=="object"&&t?hl(t,Fs):t}let Of={};function Gi(t){Of[t]||(typeof console<"u"&&console.warn(t),Of[t]=!0)}function Js(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Tc(t){let e=0;for(let n,a,c=0,h=t.length,m=h-1;c<h;m=c++)n=t[c],a=t[m],e+=(a.x-n.x)*(n.y+a.y);return e}function Sc([t,e,n]){let a=kn(e+90),c=kn(n);return{x:t*Math.cos(a)*Math.sin(c),y:t*Math.sin(a)*Math.sin(c),z:t*Math.cos(c),azimuthal:e,polar:n}}function Ps(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xo(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,h)=>{let m=c||h;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let sh,ah,lh,Ic,ea,dl,ch=null;function Rf(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ma(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Fa(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<a?e=c+1:n=c}return e}function kf(t,e,n,a){for(;e<n;){let c=e+n>>1;t[c]<=a?e=c+1:n=c}return e}function Xo(t){return t>0?1/(1.001-t):1+t}function x0(t){return t>0?1-1/(1.001-t):-t}function uh(){return sh==null&&(sh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sh}let fs={now:()=>Ic!==void 0?Ic:performance.now(),setNow(t){Ic=t},restoreNow(){Ic=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:a}=t;ea||(ea=document.createElement("canvas"));let c=ea.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>ea.width||a>ea.height)&&(ea.width=n,ea.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(t,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:t=>(ah||(ah=document.createElement("a")),ah.href=t,ah.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(lh==null&&(lh=window.matchMedia("(prefers-reduced-motion: reduce)")),lh.matches)},hasCanvasFingerprintNoise(){if(dl!==void 0)return dl;if(!uh())return dl=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let c=0;c<t.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);let a=e.getImageData(0,0,t.width,t.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return dl=!0,!0;return dl=!1,!1}};function hh(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let a=new URLSearchParams(t.slice(n));for(let c in e)a.set(c,e[c]);return`${t.slice(0,n)}?${a.toString()}`}function dh(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let a=new URLSearchParams,c=new URLSearchParams(t.slice(n));for(let m of e.persistentParams){let y=c.get(m);y&&a.set(m,y)}let h=a.toString();return`${t.slice(0,n)}${h.length>0?`?${h}`:""}`}let fl="mapbox-tiles",fh=500,b0=50,Os,ph;function Bf(){try{return caches}catch{}}function pl(){let t=Bf();t&&!Os&&(Os=t.open(fl))}let Nf=1/0,Pa={supported:!1,testSupport:function(t){!Lf&&ml&&(w0?C0(t):Mc=t)}},Mc,ml,Lf=!1,w0=!1,D0=typeof self<"u"?self:{};function C0(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ml),t.isContextLost())return;Pa.supported=!0}catch{}t.deleteTexture(e),Lf=!0}D0.document&&(ml=D0.document.createElement("img"),ml.onload=function(){Mc&&C0(Mc),Mc=null,w0=!0},ml.onerror=function(){Lf=!0,Mc=null},ml.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let mh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(mh);class gh extends Error{constructor(e,n,a){n===401&&U(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let gl=Ps()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Fc=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(gl())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){let h=new AbortController,m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:gl(),referrerPolicy:a.referrerPolicy,signal:h.signal}),y=!1,x=!1,w=(C=m.url).indexOf("sku=")>0&&U(C);var C;a.type==="json"&&m.headers.set("Accept","application/json");let A=(F,R,B)=>{if(x)return;if(F&&F.message!=="SecurityError"&&Gi(F.toString()),R&&B)return S(R);let z=Date.now();fetch(m).then(j=>{if(j.ok){let Q=w?j.clone():null;return S(j,Q,z)}return c(new gh(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&c(new Error(`${j.message} ${a.url}`))})},S=(F,R,B)=>{(a.type==="arrayBuffer"?F.arrayBuffer():a.type==="json"?F.json():F.text()).then(z=>{x||(R&&B&&function(j,Q,J){if(pl(),!Os)return;let X=xo(Q.headers.get("Cache-Control")||"");if(X["no-store"])return;let ue={status:Q.status,statusText:Q.statusText,headers:new Headers};Q.headers.forEach((ge,we)=>ue.headers.set(we,ge)),X["max-age"]&&ue.headers.set("Expires",new Date(J+1e3*X["max-age"]).toUTCString());let ne=ue.headers.get("Expires");if(!ne||new Date(ne).getTime()-J<42e4)return;let de=dh(j.url,{persistentParams:["language","worldview"]});if(Q.status===206){let ge=j.headers.get("Range");if(!ge)return;ue.status=200,de=hh(de,{range:ge})}(function(ge,we){if(ph===void 0)try{new Response(new ReadableStream),ph=!0}catch{ph=!1}ph?we(ge.body):ge.blob().then(we)})(Q,ge=>{let we=new Response(ge,ue);pl(),Os&&Os.then(Oe=>Oe.put(de,we)).catch(Oe=>Gi(Oe.message))})}(m,R,B),y=!0,c(null,z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(z=>{x||c(new Error(z.message))})};return w?function(F,R){if(pl(),!Os)return R(null);Os.then(B=>{let z=dh(F.url,{persistentParams:["language","worldview"]}),j=F.headers.get("Range");j&&(z=hh(z,{range:j})),B.match(z).then(Q=>{let J=function(X){if(!X)return!1;let ue=new Date(X.headers.get("Expires")||0),ne=xo(X.headers.get("Cache-Control")||"");return ue>Date.now()&&!ne["no-cache"]}(Q);B.delete(z),J&&B.put(z,Q.clone()),R(null,Q,J)}).catch(R)}).catch(R)}(m,A):A(null,null),{cancel:()=>{x=!0,y||h.abort()}}}(t,e);if(Ps()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(a,c){let h=new XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(let m in a.headers)h.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let m=h.response;if(a.type==="json")try{m=JSON.parse(h.response)}catch(y){return c(y)}c(null,m,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new gh(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}}(t,e)},Pc=function(t,e){return Fc(Oo(t,{type:"arrayBuffer"}),e)};function Uf(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let E0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",_h,Oc;_h=[],Oc=0;let zf=function(t,e){if(Pa.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Oc>=O.MAX_PARALLEL_IMAGE_REQUESTS){let h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return _h.push(h),h}Oc++;let n=!1,a=()=>{if(!n)for(n=!0,Oc--;_h.length&&Oc<O.MAX_PARALLEL_IMAGE_REQUESTS;){let h=_h.shift(),{requestParameters:m,callback:y,cancelled:x}=h;x||(h.cancel=zf(m,y).cancel)}},c=Pc(t,(h,m,y,x)=>{a(),h?e(h):m&&(self.createImageBitmap?function(w,C){let A=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(A).then(S=>{C(null,S)}).catch(S=>{C(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,C)=>e(w,C,y,x)):function(w,C){let A=new Image;A.onload=()=>{C(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=E0})},A.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?URL.createObjectURL(S):E0}(m,(w,C)=>e(w,C,y,x)))});return{cancel:()=>{c.cancel(),a()}}},Rc="01",yh="NO_ACCESS_TOKEN",Vf=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ko(t){let e=t.match(Vf);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function _l(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let kc="mapbox.eventData";function jf(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class yl{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=jf(O.ACCESS_TOKEN),a="";return a=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(+("0x"+h)))):O.ACCESS_TOKEN||"",e?`${kc}.${e}:${a}`:`${kc}:${a}`}fetchEventData(){let e=Rf("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{let c=localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));let h=localStorage.getItem(a);h&&(this.anonId=h)}catch{Gi("Unable to read from LocalStorage")}}saveEventData(){let e=Rf("localStorage"),n=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Gi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,a,c){if(!O.EVENTS_URL)return;let h=Ko(O.EVENTS_URL);h.params.push(`access_token=${c||O.ACCESS_TOKEN||""}`);let m={event:this.type,created:new Date(e).toISOString()},y=n?Oo(m,n):m,x={url:_l(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,C){return Fc(Oo(w,{method:"POST"}),C)}(x,w=>{this.pendingRequest=null,a(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let vh=new class extends yl{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>V(n)||U(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=jf(O.ACCESS_TOKEN),n=e?e.u:O.ACCESS_TOKEN,a=n!==this.eventData.tokenU;v0(this.anonId)||(this.anonId=oh(),a=!0);let c=this.queue.shift();if(this.eventData.lastSuccess){let h=new Date(this.eventData.lastSuccess),m=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||h.getDate()!==m.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Rc,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t):this.processRequests()}},ao=vh.postTurnstileEvent.bind(vh),ta=new class extends yl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,a){this.skuToken=e,this.errorCb=a,O.EVENTS_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(yh)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),v0(this.anonId)||(this.anonId=oh()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Rc,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},lo=ta.postMapLoadEvent.bind(ta),A0=new class extends yl{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=oh(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:a,importedStyles:c}=e;if(!O.EVENTS_URL||!t&&!O.ACCESS_TOKEN)return;let h=this.getMapInstanceId(n),m={mapInstanceId:h,eventId:this.getEventId(h),style:a};c.length&&(m.importedStyles=c),this.queueRequest({timestamp:Date.now(),payload:m},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},wv=A0.postStyleLoadEvent.bind(A0),T0=new class extends yl{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){O.EVENTS_URL&&(t||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),a=function(c){let h=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),y=function(F){let R={};if(F){for(let B in F)if(B!=="other")for(let z of F[B]){let j=`${B}ResolveRangeMin`,Q=`${B}ResolveRangeMax`,J=`${B}RequestCount`,X=`${B}RequestCachedCount`;R[j]=Math.min(R[j]||1/0,z.startTime),R[Q]=Math.max(R[Q]||-1/0,z.responseEnd);let ue=ne=>{R[ne]===void 0&&(R[ne]=0),++R[ne]};z.transferSize!==void 0&&z.transferSize===0&&ue(X),ue(J)}}return R}(function(F,R){let B={};if(F)for(let z of F){let j=R(z);B[j]===void 0&&(B[j]=[]),B[j].push(z)}return B}(h,Ce)),x=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=w?w.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},S=(F,R,B)=>{B!=null&&F.push({name:R,value:B.toString()})};for(let F in y)S(A.counters,F,y[F]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(S(A.counters,"interactionRangeMin",c.interactionRange[0]),S(A.counters,"interactionRangeMax",c.interactionRange[1])),m)for(let F of Object.keys(pe)){let R=pe[F],B=m.find(z=>z.name===R);B&&S(A.counters,R,B.startTime)}return S(A.counters,"visibilityHidden",c.visibilityHidden),S(A.attributes,"style",function(F){if(F)for(let R of F){let B=R.name.split("?")[0];if(se(B)){let z=B.split("/").slice(-2);if(z.length===2)return`mapbox://styles/${z[0]}/${z[1]}`}}}(h)),S(A.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),S(A.attributes,"fogEnabled",c.fogEnabled?"true":"false"),S(A.attributes,"projection",c.projection),S(A.attributes,"zoom",c.zoom),S(A.metadata,"devicePixelRatio",x),S(A.metadata,"connectionEffectiveType",C),S(A.metadata,"navigatorUserAgent",navigator.userAgent),S(A.metadata,"screenWidth",window.screen.width),S(A.metadata,"screenHeight",window.screen.height),S(A.metadata,"windowWidth",window.innerWidth),S(A.metadata,"windowHeight",window.innerHeight),S(A.metadata,"mapWidth",c.width/x),S(A.metadata,"mapHeight",c.height/x),S(A.metadata,"webglRenderer",c.renderer),S(A.metadata,"webglVendor",c.vendor),S(A.metadata,"sdkVersion",E),S(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(n);for(let c of a.metadata);for(let c of a.counters);for(let c of a.attributes);this.postEvent(e,a,()=>{},t)}},xh=T0.postPerformanceEvent.bind(T0),bh=new class extends yl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,a){if(!O.API_URL||!O.SESSION_PATH)return;let c=Ko(O.API_URL+O.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||O.ACCESS_TOKEN||""}`);let h={url:_l(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return Fc(Oo(m,{method:"GET"}),y)}(h,m=>{this.pendingRequest=null,n(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(t,e,n,a){this.skuToken=e,this.errorCb=a,O.SESSION_PATH&&O.API_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(yh)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Gf=bh.getSessionAPI.bind(bh),wh=new Set;var ps={exports:{}},S0={exports:{}};S0.exports=function(t,e){var n,a,c,h,m,y,x,w;for(a=t.length-(n=3&t.length),c=e,m=3432918353,y=461845907,w=0;w<a;)x=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,c=27492+(65535&(h=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(w+2))<<16;case 2:x^=(255&t.charCodeAt(w+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(w)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Dv=S0.exports,Hf={exports:{}};Hf.exports=function(t,e){for(var n,a=t.length,c=e^a,h=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:c^=(255&t.charCodeAt(h+2))<<16;case 2:c^=(255&t.charCodeAt(h+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(h)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var $f=Dv,Jo=Hf.exports;ps.exports=$f,ps.exports.murmur3=$f,ps.exports.murmur2=Jo;var Bc=Te(ps.exports);function qf(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Dh(t,e,n){if(n&&n[t]){let a=n[t].indexOf(e);a!==-1&&n[t].splice(a,1)}}class na{constructor(e,n={}){Oo(this,n),this.type=e}}class Ch extends na{constructor(e,n={}){super("error",Oo({error:e},n))}}class Oa{on(e,n){return this._listeners=this._listeners||{},qf(e,n,this._listeners),this}off(e,n){return Dh(e,n,this._listeners),Dh(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},qf(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){typeof e=="string"&&(e=new na(e,n||{}));let a=e.type;if(this.listens(a)){e.target=this;let c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let y of c)y.call(this,e);let h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let y of h)Dh(a,y,this._oneTimeListeners),y.call(this,e);let m=this._eventedParent;m&&(Oo(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Ch&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.z=void 0;var Wf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Nc(t){return(t=Math.round(t))<0?0:t>255?255:t}function Eh(t){return Nc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Lc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ah(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.z={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Wf)return Wf[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=n.indexOf("("),c=n.indexOf(")");if(a!==-1&&c+1===n.length){var h=n.substr(0,a),m=n.substr(a+1,c-(a+1)).split(","),y=1;switch(h){case"rgba":if(m.length!==4)return null;y=Lc(m.pop());case"rgb":return m.length!==3?null:[Eh(m[0]),Eh(m[1]),Eh(m[2]),y];case"hsla":if(m.length!==4)return null;y=Lc(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,w=Lc(m[1]),C=Lc(m[2]),A=C<=.5?C*(w+1):C+w-C*w,S=2*C-A;return[Nc(255*Ah(S,A,x+1/3)),Nc(255*Ah(S,A,x)),Nc(255*Ah(S,A,x-1/3)),y];default:return null}}return null}}catch{}class Jn{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Jn)return e;if(typeof e!="string")return;let n=r.z(e);return n?new Jn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,a,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${c})`}toArray(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*a/c,c]}toArray01(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,a/c,c]}toArray01Scaled(e){let{r:n,g:a,b:c,a:h}=this;return h===0?[0,0,0]:[n/h*e,a/h*e,c/h*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Linear(){let{r:e,g:n,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(n/c,2.2),Math.pow(a/c,2.2),c]}}function gn(t,e,n){return t*(1-n)+e*n}function Uc(t,e,n){return t.map((a,c)=>gn(a,e[c],n))}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);var zc=Object.freeze({__proto__:null,array:Uc,color:function(t,e,n){return new Jn(gn(t.r,e.r,n),gn(t.g,e.g,n),gn(t.b,e.b,n),gn(t.a,e.a,n))},number:gn});function Th(t,...e){for(let n of e)for(let a in n)t[a]=n[a];return t}class es extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ia{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[a,c]of n)this.bindings[a]=c}concat(e){return new ia(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let yn={kind:"null"},At={kind:"number"},Wn={kind:"string"},Zn={kind:"boolean"},bo={kind:"color"},vl={kind:"object"},Bn={kind:"value"},Vc={kind:"collator"},xl={kind:"formatted"},bl={kind:"resolvedImage"};function xr(t,e){return{kind:"array",itemType:t,N:e}}function Wi(t){if(t.kind==="array"){let e=Wi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let I0=[yn,At,Wn,Zn,bo,xl,vl,xr(Bn),bl];function jc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!jc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of I0)if(!jc(n,e))return null}}return`Expected ${Wi(t)} but found ${Wi(e)} instead.`}function Gc(t,e){return e.some(n=>n.kind===t.kind)}function Ra(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Zf{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Sh{constructor(e,n,a,c,h){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=h}}class Fr{constructor(e){this.sections=e}static fromString(e){return new Fr([new Sh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Fr?e:Fr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(a)}return e}}class wo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new wo({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function M0(t,e,n,a){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[t,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[t,e,n,a]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wl(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Jn||t instanceof Zf||t instanceof Fr||t instanceof wo)return!0;if(Array.isArray(t)){for(let e of t)if(!wl(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!wl(t[e]))return!1;return!0}return!1}function or(t){if(t===null)return yn;if(typeof t=="string")return Wn;if(typeof t=="boolean")return Zn;if(typeof t=="number")return At;if(t instanceof Jn)return bo;if(t instanceof Zf)return Vc;if(t instanceof Fr)return xl;if(t instanceof wo)return bl;if(Array.isArray(t)){let e=t.length,n;for(let a of t){let c=or(a);if(n){if(n===c)continue;n=Bn;break}n=c}return xr(n||Bn,e)}return vl}function Ro(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Jn||t instanceof Fr||t instanceof wo?t.toString():JSON.stringify(t)}class ms{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wl(e[1]))return n.error("invalid value");let a=e[1],c=or(a),h=n.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new ms(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toArray()):this.value instanceof Fr?this.value.serialize():this.value}}class mr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Ih={string:Wn,number:At,boolean:Zn,object:vl};class ts{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1,h=e[0];if(h==="array"){let y,x;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Ih)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ih[w],c++}else y=Bn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}a=xr(y,x)}else a=Ih[h];let m=[];for(;c<e.length;c++){let y=n.parse(e[c],c,Bn);if(!y)return null;m.push(y)}return new ts(a,m)}evaluate(e){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(e);if(!jc(this.type,or(a)))return a;if(n===this.args.length-1)throw new mr(`Expected value to be of type ${Wi(this.type)}, but found ${Wi(or(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);let c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class Hc{constructor(e){this.type=xl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let c=[],h=!1;for(let m=1;m<=e.length-1;++m){let y=e[m];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,At),!x))return null;let w=null;if(y["text-font"]&&(w=n.parse(y["text-font"],1,xr(Wn)),!w))return null;let C=null;if(y["text-color"]&&(C=n.parse(y["text-color"],1,bo),!C))return null;let A=c[c.length-1];A.scale=x,A.font=w,A.textColor=C}else{let x=n.parse(e[m],1,Bn);if(!x)return null;let w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Hc(c)}evaluate(e){return new Fr(this.sections.map(n=>{let a=n.content.evaluate(e);return or(a)===bl?new Sh("",a,null,null,null):new Sh(Ro(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Dl{constructor(e,n){this.type=bl,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=n.parse(e[1],1,Wn);if(!a)return n.error("No image name provided.");if(e.length===2)return new Dl(a);let c=n.parse(e[2],1,Wn);return c?new Dl(a,c):n.error("Secondary image variant is not a string.")}evaluate(e){let n=wo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ra(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Cv={"to-boolean":Zn,"to-color":bo,"to-number":At,"to-string":Wn};class Rs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a=e[0],c=[],h=yn;if(a==="to-array"){if(!Array.isArray(e[1]))return null;let m=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);h=xr(n.expectedType.itemType,m)}else{if(!(m>0&&wl(e[1][0])))return null;h=xr(or(e[1][0]),m)}for(let y=0;y<m;y++){let x=e[1][y],w;if(ra(x)==="array")w=n.parse(x,void 0,h.itemType);else{let C=ra(x);if(C!==h.itemType.kind)return n.error(`Expected ${h.itemType.kind} but found ${C}.`);w=n.registry.literal.parse(["literal",x===void 0?null:x],n)}if(!w)return null;c.push(w)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");h=Cv[a];for(let m=1;m<e.length;m++){let y=n.parse(e[m],m,Bn);if(!y)return null;c.push(y)}}return new Rs(h,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(let c of this.args){if(n=c.evaluate(e),a=null,n instanceof Jn)return n;if(typeof n=="string"){let h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:M0(n[0],n[1],n[2],n[3]),!a))return new Jn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new mr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let a of this.args){if(n=a.evaluate(e),n===null)return 0;let c=Number(n);if(!isNaN(c))return c}throw new mr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Fr.fromString(Ro(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wo.fromString(Ro(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Ro(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Dl(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let Ev=["Unknown","Point","LineString","Polygon"];class Qf{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ev[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Jn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class co{constructor(e,n,a,c,h){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=h}evaluate(e){if(!this._evaluate){let n=co.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let a=e[0],c=co.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let h=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=[],x=null,w=-1;for(let[C,A]of m){if(Array.isArray(C)&&C.length!==e.length-1)continue;y.push(C),w++,x=new Lh(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let S=[],F=!1;for(let R=1;R<e.length;R++){let B=e[R],z=Array.isArray(C)?C[R-1]:C.type,j=x.parse(B,1+S.length,z);if(!j){F=!0;break}S.push(j)}if(!F)if(Array.isArray(C)&&C.length!==S.length)x.error(`Expected ${C.length} arguments, but found ${S.length} instead.`);else{for(let R=0;R<S.length;R++){let B=Array.isArray(C)?C[R]:C.type,z=S[R];x.concat(R+1).checkSubtype(B,z.type)}if(x.errors.length===0)return new co(a,h,A,S,w)}}if(y.length===1)n.errors.push(...x.errors);else{let C=(y.length?y:m.map(([S])=>S)).map(Av).join(" | "),A=[];for(let S=1;S<e.length;S++){let F=n.parse(e[S],1+A.length);if(!F)return null;A.push(Wi(F.type))}n.error(`Expected arguments of type ${C}, but found (${A.join(", ")}) instead.`)}return null}static register(e,n){co.definitions=n;for(let a in n)e[a]=co}}function Av(t){return Array.isArray(t)?`(${t.map(Wi).join(", ")})`:`(${Wi(t.type)}...)`}class $c{constructor(e,n,a){this.type=Vc,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Zn);if(!c)return null;let h=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Zn);if(!h)return null;let m=null;return a.locale&&(m=n.parse(a.locale,1,Wn),!m)?null:new $c(c,h,m)}evaluate(e){return new Zf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Yf={exports:{}};Yf.exports=function(){function t(a,c,h,m,y){for(;m>h;){if(m-h>600){var x=m-h+1,w=c-h+1,C=Math.log(x),A=.5*Math.exp(2*C/3),S=.5*Math.sqrt(C*A*(x-A)/x)*(w-x/2<0?-1:1);t(a,c,Math.max(h,Math.floor(c-w*A/x+S)),Math.min(m,Math.floor(c+(x-w)*A/x+S)),y)}var F=a[c],R=h,B=m;for(e(a,h,c),y(a[m],F)>0&&e(a,h,m);R<B;){for(e(a,R,B),R++,B--;y(a[R],F)<0;)R++;for(;y(a[B],F)>0;)B--}y(a[h],F)===0?e(a,h,B):e(a,++B,m),B<=c&&(h=B+1),c<=B&&(m=B-1)}}function e(a,c,h){var m=a[c];a[c]=a[h],a[h]=m}function n(a,c){return a<c?-1:a>c?1:0}return function(a,c,h,m,y){t(a,c,h||0,m||a.length-1,y||n)}}();var F0=Te(Yf.exports);function Tv(t){let e=0;for(let n,a,c=0,h=t.length,m=h-1;c<h;m=c++)n=t[c],a=t[m],e+=(a.x-n.x)*(n.y+a.y);return e}function qc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Wc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Sv(t,e,n){let a=t[0]-e[0],c=t[1]-e[1],h=t[0]-n[0],m=t[1]-n[1];return a*m-h*c==0&&a*h<=0&&c*m<=0}function ka(t,e,n=!1){let a=!1;for(let y=0,x=e.length;y<x;y++){let w=e[y];for(let C=0,A=w.length,S=A-1;C<A;S=C++){let F=w[S],R=w[C];if(Sv(t,F,R))return n;(h=F)[1]>(c=t)[1]!=(m=R)[1]>c[1]&&c[0]<(m[0]-h[0])*(c[1]-h[1])/(m[1]-h[1])+h[0]&&(a=!a)}}var c,h,m;return a}function Xf(t,e,n,a){let c=a[0]-n[0],h=a[1]-n[1],m=(t[0]-n[0])*h-c*(t[1]-n[1]),y=(e[0]-n[0])*h-c*(e[1]-n[1]);return m>0&&y<0||m<0&&y>0}function Cl(t,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(h=[e[0]-t[0],e[1]-t[1]])[1]-c[1]*h[0]!=0&&!(!Xf(t,e,n,a)||!Xf(n,a,t,e));var c,h}let oa=8192;function Iv(t,e){let n=(180+t[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*oa),Math.round(a*c*oa)]}function Mv(t,e){for(let n=0;n<e.length;n++)if(ka(t,e[n]))return!0;return!1}function Kf(t,e,n){for(let a of n)for(let c=0,h=a.length,m=h-1;c<h;m=c++)if(Cl(t,e,a[m],a[c]))return!0;return!1}function Mh(t,e){for(let n=0;n<t.length;++n)if(!ka(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Kf(t[n],t[n+1],e))return!1;return!0}function P0(t,e){for(let n=0;n<e.length;n++)if(Mh(t,e[n]))return!0;return!1}function Jf(t,e,n){let a=[];for(let c=0;c<t.length;c++){let h=[];for(let m=0;m<t[c].length;m++){let y=Iv(t[c][m],n);qc(e,y),h.push(y)}a.push(h)}return a}function Zc(t,e,n){let a=[];for(let c=0;c<t.length;c++){let h=Jf(t[c],e,n);a.push(h)}return a}function ep(t,e,n,a){if(t[0]<n[0]||t[0]>n[2]){let c=.5*a,h=t[0]-n[0]>c?-a:n[0]-t[0]>c?a:0;h===0&&(h=t[0]-n[2]>c?-a:n[2]-t[0]>c?a:0),t[0]+=h}qc(e,t)}function Qc(t,e,n,a){let c=Math.pow(2,a.z)*oa,h=[a.x*oa,a.y*oa],m=[];if(!t)return m;for(let y of t)for(let x of y){let w=[x.x+h[0],x.y+h[1]];ep(w,e,n,c),m.push(w)}return m}function tp(t,e,n,a){let c=Math.pow(2,a.z)*oa,h=[a.x*oa,a.y*oa],m=[];if(!t)return m;for(let x of t){let w=[];for(let C of x){let A=[C.x+h[0],C.y+h[1]];qc(e,A),w.push(A)}m.push(w)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(let x of m)for(let w of x)ep(w,e,n,c)}var y;return m}class Ba{constructor(e,n){this.type=Zn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wl(e[1])){let a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){let h=a.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ba(a,a.features[c].geometry)}else if(a.type==="Feature"){let c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ba(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ba(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(a.type==="Polygon"){let y=Jf(a.coordinates,h,m),x=Qc(n.geometry(),c,h,m);if(!Wc(c,h))return!1;for(let w of x)if(!ka(w,y))return!1}if(a.type==="MultiPolygon"){let y=Zc(a.coordinates,h,m),x=Qc(n.geometry(),c,h,m);if(!Wc(c,h))return!1;for(let w of x)if(!Mv(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){let c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(a.type==="Polygon"){let y=Jf(a.coordinates,h,m),x=tp(n.geometry(),c,h,m);if(!Wc(c,h))return!1;for(let w of x)if(!Mh(w,y))return!1}if(a.type==="MultiPolygon"){let y=Zc(a.coordinates,h,m),x=tp(n.geometry(),c,h,m);if(!Wc(c,h))return!1;for(let w of x)if(!P0(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var O0={exports:{}};(function(t,e){t.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},a=1/298.257223563,c=a*(2-a),h=Math.PI/180,m=function(A,S){if(A===void 0)throw new Error("No latitude given.");if(S&&!n[S])throw new Error("Unknown unit "+S+". Use one of: "+Object.keys(n).join(", "));var F=6378.137*h*(S?n[S]:1),R=Math.cos(A*h),B=1/(1-c*(1-R*R)),z=Math.sqrt(B);this.kx=F*z*R,this.ky=F*z*B*(1-c)},y={units:{configurable:!0}};function x(A,S){return A[0]===S[0]&&A[1]===S[1]}function w(A,S,F){var R=C(S[0]-A[0]);return[A[0]+R*F,A[1]+(S[1]-A[1])*F]}function C(A){for(;A<-180;)A+=360;for(;A>180;)A-=360;return A}return m.fromTile=function(A,S,F){var R=Math.PI*(1-2*(A+.5)/Math.pow(2,S)),B=Math.atan(.5*(Math.exp(R)-Math.exp(-R)))/h;return new m(B,F)},y.units.get=function(){return n},m.prototype.distance=function(A,S){var F=C(A[0]-S[0])*this.kx,R=(A[1]-S[1])*this.ky;return Math.sqrt(F*F+R*R)},m.prototype.bearing=function(A,S){var F=C(S[0]-A[0])*this.kx;return Math.atan2(F,(S[1]-A[1])*this.ky)/h},m.prototype.destination=function(A,S,F){var R=F*h;return this.offset(A,Math.sin(R)*S,Math.cos(R)*S)},m.prototype.offset=function(A,S,F){return[A[0]+S/this.kx,A[1]+F/this.ky]},m.prototype.lineDistance=function(A){for(var S=0,F=0;F<A.length-1;F++)S+=this.distance(A[F],A[F+1]);return S},m.prototype.area=function(A){for(var S=0,F=0;F<A.length;F++)for(var R=A[F],B=0,z=R.length,j=z-1;B<z;j=B++)S+=C(R[B][0]-R[j][0])*(R[B][1]+R[j][1])*(F?-1:1);return Math.abs(S)/2*this.kx*this.ky},m.prototype.along=function(A,S){var F=0;if(S<=0)return A[0];for(var R=0;R<A.length-1;R++){var B=A[R],z=A[R+1],j=this.distance(B,z);if((F+=j)>S)return w(B,z,(S-(F-j))/j)}return A[A.length-1]},m.prototype.pointToSegmentDistance=function(A,S,F){var R=S[0],B=S[1],z=C(F[0]-R)*this.kx,j=(F[1]-B)*this.ky,Q=0;return z===0&&j===0||((Q=(C(A[0]-R)*this.kx*z+(A[1]-B)*this.ky*j)/(z*z+j*j))>1?(R=F[0],B=F[1]):Q>0&&(R+=z/this.kx*Q,B+=j/this.ky*Q)),z=C(A[0]-R)*this.kx,j=(A[1]-B)*this.ky,Math.sqrt(z*z+j*j)},m.prototype.pointOnLine=function(A,S){for(var F,R,B,z,j=1/0,Q=0;Q<A.length-1;Q++){var J=A[Q][0],X=A[Q][1],ue=C(A[Q+1][0]-J)*this.kx,ne=(A[Q+1][1]-X)*this.ky,de=0;ue===0&&ne===0||((de=(C(S[0]-J)*this.kx*ue+(S[1]-X)*this.ky*ne)/(ue*ue+ne*ne))>1?(J=A[Q+1][0],X=A[Q+1][1]):de>0&&(J+=ue/this.kx*de,X+=ne/this.ky*de));var ge=(ue=C(S[0]-J)*this.kx)*ue+(ne=(S[1]-X)*this.ky)*ne;ge<j&&(j=ge,F=J,R=X,B=Q,z=de)}return{point:[F,R],index:B,t:Math.max(0,Math.min(1,z))}},m.prototype.lineSlice=function(A,S,F){var R=this.pointOnLine(F,A),B=this.pointOnLine(F,S);if(R.index>B.index||R.index===B.index&&R.t>B.t){var z=R;R=B,B=z}var j=[R.point],Q=R.index+1,J=B.index;!x(F[Q],j[0])&&Q<=J&&j.push(F[Q]);for(var X=Q+1;X<=J;X++)j.push(F[X]);return x(F[J],B.point)||j.push(B.point),j},m.prototype.lineSliceAlong=function(A,S,F){for(var R=0,B=[],z=0;z<F.length-1;z++){var j=F[z],Q=F[z+1],J=this.distance(j,Q);if((R+=J)>A&&B.length===0&&B.push(w(j,Q,(A-(R-J))/J)),R>=S)return B.push(w(j,Q,(S-(R-J))/J)),B;R>A&&B.push(Q)}return B},m.prototype.bufferPoint=function(A,S){var F=S/this.ky,R=S/this.kx;return[A[0]-R,A[1]-F,A[0]+R,A[1]+F]},m.prototype.bufferBBox=function(A,S){var F=S/this.ky,R=S/this.kx;return[A[0]-R,A[1]-F,A[2]+R,A[3]+F]},m.prototype.insideBBox=function(A,S){return C(A[0]-S[0])>=0&&C(A[0]-S[2])<=0&&A[1]>=S[1]&&A[1]<=S[3]},Object.defineProperties(m,y),m}()})(O0);var Yc=Te(O0.exports),Fh={exports:{}};(function(t,e){t.exports=function(){var n=function(c,h){if(c===void 0&&(c=[]),h===void 0&&(h=a),this.data=c,this.length=this.data.length,this.compare=h,this.length>0)for(var m=(this.length>>1)-1;m>=0;m--)this._down(m)};function a(c,h){return c<h?-1:c>h?1:0}return n.prototype.push=function(c){this.data.push(c),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var c=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),c}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(c){for(var h=this.data,m=this.compare,y=h[c];c>0;){var x=c-1>>1,w=h[x];if(m(y,w)>=0)break;h[c]=w,c=x}h[c]=y},n.prototype._down=function(c){for(var h=this.data,m=this.compare,y=this.length>>1,x=h[c];c<y;){var w=1+(c<<1),C=h[w],A=w+1;if(A<this.length&&m(h[A],C)<0&&(w=A,C=h[A]),m(C,x)>=0)break;h[c]=C,c=w}h[c]=x},n}()})(Fh);var Ph=Te(Fh.exports),pt=8192;function Na(t,e){return e.dist-t.dist}let np=100,ip=50;function R0(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Oh(t){return t[1]-t[0]+1}function ks(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Rh(t,e){if(t[0]>t[1])return[null,null];let n=Oh(t);if(e){if(n===2)return[t,null];let a=Math.floor(n/2);return[[t[0],t[0]+a],[t[0]+a,t[1]]]}{if(n===1)return[t,null];let a=Math.floor(n/2)-1;return[[t[0],t[0]+a],[t[0]+a+1,t[1]]]}}function Bs(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!ks(e,t.length))return n;for(let a=e[0];a<=e[1];++a)qc(n,t[a]);return n}function kh(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let a=0;a<t[n].length;++a)qc(e,t[n][a]);return e}function El(t,e,n){if(R0(t)||R0(e))return NaN;let a=0,c=0;return t[2]<e[0]&&(a=e[0]-t[2]),t[0]>e[2]&&(a=t[0]-e[2]),t[1]>e[3]&&(c=t[1]-e[3]),t[3]<e[1]&&(c=e[1]-t[3]),n.distance([0,0],[a,c])}function Fv(t){return 360*t-180}function Pv(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function rp(t,e){let n=Math.pow(2,e.z),a=(t.y/pt+e.y)/n;return[Fv((t.x/pt+e.x)/n),Pv(a)]}function Ov(t,e){let n=[];for(let a=0;a<t.length;++a)n.push(rp(t[a],e));return n}function k0(t,e,n){let a=n.pointOnLine(e,t).point;return n.distance(t,a)}function B0(t,e,n,a,c){let h=n.slice(a[0],a[1]+1),m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,k0(t[y],h,c)))===0)return 0;return m}function op(t,e,n,a,c){let h=Math.min(c.pointToSegmentDistance(t,n,a),c.pointToSegmentDistance(e,n,a)),m=Math.min(c.pointToSegmentDistance(n,t,e),c.pointToSegmentDistance(a,t,e));return Math.min(h,m)}function Al(t,e,n,a,c){if(!ks(e,t.length)||!ks(a,n.length))return NaN;let h=1/0;for(let m=e[0];m<e[1];++m)for(let y=a[0];y<a[1];++y){if(Cl(t[m],t[m+1],n[y],n[y+1]))return 0;h=Math.min(h,op(t[m],t[m+1],n[y],n[y+1],c))}return h}function N0(t,e,n,a,c){if(!ks(e,t.length)||!ks(a,n.length))return NaN;let h=1/0;for(let m=e[0];m<=e[1];++m)for(let y=a[0];y<=a[1];++y)if((h=Math.min(h,c.distance(t[m],n[y])))===0)return h;return h}function L0(t,e,n){if(ka(t,e,!0))return 0;let a=1/0;for(let c of e){let h=c.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[h-1]&&(a=Math.min(a,n.pointToSegmentDistance(t,c[h-1],c[0])))===0||(a=Math.min(a,k0(t,c,n)))===0)return a}return a}function Bh(t,e,n,a){if(!ks(e,t.length))return NaN;for(let h=e[0];h<=e[1];++h)if(ka(t[h],n,!0))return 0;let c=1/0;for(let h=e[0];h<e[1];++h)for(let m of n)for(let y=0,x=m.length,w=x-1;y<x;w=y++){if(Cl(t[h],t[h+1],m[w],m[y]))return 0;c=Math.min(c,op(t[h],t[h+1],m[w],m[y],a))}return c}function U0(t,e){for(let n of t)for(let a=0;a<=n.length-1;++a)if(ka(n[a],e,!0))return!0;return!1}function Rv(t,e,n,a=1/0){let c=kh(t),h=kh(e);if(a!==1/0&&El(c,h,n)>=a)return a;if(Wc(c,h)){if(U0(t,e))return 0}else if(U0(e,t))return 0;let m=a;for(let y of t)for(let x=0,w=y.length,C=w-1;x<w;C=x++)for(let A of e)for(let S=0,F=A.length,R=F-1;S<F;R=S++){if(Cl(y[C],y[x],A[R],A[S]))return 0;m=Math.min(m,op(y[C],y[x],A[R],A[S],n))}return m}function ns(t,e,n,a,c,h,m){if(h===null||m===null)return;let y=El(Bs(a,h),Bs(c,m),n);y<e&&t.push({dist:y,range1:h,range2:m})}function z0(t,e,n,a,c=1/0){let h=Math.min(a.distance(t[0],n[0][0]),c);if(h===0)return h;let m=new Ph([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Na),y=e?ip:np,x=kh(n);for(;m.length;){let w=m.pop();if(w.dist>=h)continue;let C=w.range1;if(Oh(C)<=y){if(!ks(C,t.length))return NaN;if(e){let A=Bh(t,C,n,a);if((h=Math.min(h,A))===0)return h}else for(let A=C[0];A<=C[1];++A){let S=L0(t[A],n,a);if((h=Math.min(h,S))===0)return h}}else{let A=Rh(C,e);if(A[0]!==null){let S=El(Bs(t,A[0]),x,a);S<h&&m.push({dist:S,range1:A[0],range2:[0,0]})}if(A[1]!==null){let S=El(Bs(t,A[1]),x,a);S<h&&m.push({dist:S,range1:A[1],range2:[0,0]})}}}return h}function La(t,e,n,a,c,h=1/0){let m=Math.min(h,c.distance(t[0],n[0]));if(m===0)return m;let y=new Ph([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Na),x=e?ip:np,w=a?ip:np;for(;y.length;){let C=y.pop();if(C.dist>=m)continue;let A=C.range1,S=C.range2;if(Oh(A)<=x&&Oh(S)<=w){if(!ks(A,t.length)||!ks(S,n.length))return NaN;if(e&&a?m=Math.min(m,Al(t,A,n,S,c)):e||a?e&&!a?m=Math.min(m,B0(n,S,t,A,c)):!e&&a&&(m=Math.min(m,B0(t,A,n,S,c))):m=Math.min(m,N0(t,A,n,S,c)),m===0)return m}else{let F=Rh(A,e),R=Rh(S,a);ns(y,m,c,t,n,F[0],R[0]),ns(y,m,c,t,n,F[0],R[1]),ns(y,m,c,t,n,F[1],R[0]),ns(y,m,c,t,n,F[1],R[1])}}return m}function sp(t,e,n,a,c=1/0){let h=c,m=Bs(t,[0,t.length-1]);for(let y of n)if(!(h!==1/0&&El(m,Bs(y,[0,y.length-1]),a)>=h)&&(h=Math.min(h,La(t,e,y,!0,a,h)),h===0))return h;return h}function Nh(t,e,n,a,c=1/0){let h=c,m=Bs(t,[0,t.length-1]);for(let y of n){if(h!==1/0&&El(m,kh(y),a)>=h)continue;let x=z0(t,e,y,a,h);if(isNaN(x))return x;if((h=Math.min(h,x))===0)return h}return h}function ap(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ua{constructor(e,n){this.type=At,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(wl(e[1])){let a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(ap(a.features[c].geometry.type))return new Ua(a,a.features[c].geometry)}else if(a.type==="Feature"){if(ap(a.geometry.type))return new Ua(a,a.geometry)}else if(ap(a.type))return new Ua(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,h,m){let y=[];for(let w of c)for(let C of w)y.push(rp(C,h));let x=new Yc(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?La(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x):m.type==="MultiLineString"?sp(y,!1,m.coordinates,x):m.type==="Polygon"||m.type==="MultiPolygon"?Nh(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,x):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,h,m){let y=[];for(let w of c){let C=[];for(let A of w)C.push(rp(A,h));y.push(C)}let x=new Yc(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return sp(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,x);if(m.type==="MultiLineString"){let w=1/0;for(let C=0;C<m.coordinates.length;C++){let A=sp(m.coordinates[C],!0,y,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}if(m.type==="Polygon"||m.type==="MultiPolygon"){let w=1/0;for(let C=0;C<y.length;C++){let A=Nh(y[C],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,h,m){let y=[];for(let w of function(C,A){let S=C.length;if(S<=1)return[C];let F=[],R,B;for(let z=0;z<S;z++){let j=Tv(C[z]);j!==0&&(C[z].area=Math.abs(j),B===void 0&&(B=j<0),B===j<0?(R&&F.push(R),R=[C[z]]):R.push(C[z]))}return R&&F.push(R),F}(c)){let C=[];for(let A=0;A<w.length;++A)C.push(Ov(w[A],h));y.push(C)}let x=new Yc(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Nh(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,x);if(m.type==="MultiLineString"){let w=1/0;for(let C=0;C<m.coordinates.length;C++){let A=Nh(m.coordinates[C],!0,y,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return m.type==="Polygon"||m.type==="MultiPolygon"?function(w,C,A){let S=1/0;for(let F of w)for(let R of C){let B=Rv(F,R,A,S);if(isNaN(B))return B;if((S=Math.min(S,B))===0)return S}return S}(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,x):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function lp(t,e){switch(t){case"string":return Ro(e);case"number":return+e;case"boolean":return!!e;case"color":return Jn.parse(e);case"formatted":return Fr.fromString(Ro(e));case"resolvedImage":return wo.fromString(Ro(e))}return e}function cp(t,e,n,a){return a!==void 0&&(t=a*Math.round(t/a)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class sa{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=Bn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let c=n.parse(e[1],1);if(!(c instanceof ms))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let h=n.parse(e[2],2);return h instanceof ms?new sa(a,Ro(c.value),Ro(h.value)):n.error("Scope of 'config' expression must be a string literal.")}return new sa(a,Ro(c.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;let{type:c,value:h,values:m,minValue:y,maxValue:x,stepValue:w}=a,C=a.default.evaluate(e),A=C;if(h){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),A=h.evaluate(e),e.scope=S}return c&&(A=lp(c,A)),A===void 0||y===void 0&&x===void 0&&w===void 0||(typeof A=="number"?A=cp(A,y,x,w):Array.isArray(A)&&(A=A.map(S=>typeof S=="number"?cp(S,y,x,w):S))),h!==void 0&&A!==void 0&&m&&!m.includes(A)&&(A=C,c&&(A=lp(c,A))),(c&&c!==this.type||A!==void 0&&or(A)!==this.type)&&(A=lp(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function aa(t){if(t instanceof co&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ba||t instanceof Ua)return!1;let e=!0;return t.eachChild(n=>{e&&!aa(n)&&(e=!1)}),e}function Xc(t){if(t instanceof co&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Xc(n)&&(e=!1)}),e}function Kc(t){if(t instanceof sa)return!1;let e=!0;return t.eachChild(n=>{e&&!Kc(n)&&(e=!1)}),e}function Jc(t,e){if(t instanceof co&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(a=>{n&&!Jc(a,e)&&(n=!1)}),n}class Do{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=e[1];return n.scope.has(a)?new Do(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lh{constructor(e,n=[],a,c=new ia,h=[],m,y){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=c,this.errors=h,this.expectedType=a,this._scope=m,this.options=y}parse(e,n,a,c,h={}){return n||a?this.concat(n,a,c)._parse(e,h):this._parse(e,h)}_parse(e,n){function a(c,h,m){return m==="assert"?new ts(h,[c]):m==="coerce"?new Rs(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let h=c.parse(e,this);if(!h)return null;if(this.expectedType){let m=this.expectedType,y=h.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else h=a(h,m,n.typeAnnotation||"coerce");else h=a(h,m,n.typeAnnotation||"assert")}if(!(h instanceof ms)&&h.type.kind!=="resolvedImage"&&Uh(h)){let m=new Qf(this._scope,this.options);try{h=new ms(h.type,h.evaluate(m))}catch(y){return this.error(y.message),null}}return h}return Rs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a){let c=typeof e=="number"?this.path.concat(e):this.path,h=a?this.scope.concat(a):this.scope;return new Lh(this.registry,c,n||null,h,this.errors,this._scope,this.options)}error(e,...n){let a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new es(a,e))}checkSubtype(e,n){let a=jc(e,n);return a&&this.error(a),a}}function Uh(t){if(t instanceof Do)return Uh(t.boundExpression);if(t instanceof co&&t.name==="error"||t instanceof $c||t instanceof Ba||t instanceof Ua||t instanceof sa)return!1;let e=t instanceof Rs||t instanceof ts,n=!0;return t.eachChild(a=>{n=e?n&&Uh(a):n&&a instanceof ms}),!!n&&aa(t)&&Jc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function zh(t,e){let n=t.length-1,a,c,h=0,m=n,y=0;for(;h<=m;)if(y=Math.floor((h+m)/2),a=t[y],c=t[y+1],a<=e){if(y===n||e<c)return y;h=y+1}else{if(!(a>e))throw new mr("Input is not a number.");m=y-1}return 0}class eu{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[c,h]of a)this.labels.push(c),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(e[1],1,At);if(!a)return null;let c=[],h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let m=1;m<e.length;m+=2){let y=m===1?-1/0:e[m],x=e[m+1],w=m,C=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let A=n.parse(x,C,h);if(!A)return null;h=h||A.type,c.push([y,A])}return new eu(h,a,c)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let h=n.length;return c>=n[h-1]?a[h-1].evaluate(e):a[zh(n,c)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let V0=.95047,j0=1.08883,Vh=4/29,za=6/29,G0=3*za*za,H0=za*za*za,kv=Math.PI/180,$0=180/Math.PI;function Tl(t){return t>H0?Math.pow(t,1/3):t/G0+Vh}function up(t){return t>za?t*t*t:G0*(t-Vh)}function hp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function dp(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function q0(t){let e=dp(t.r),n=dp(t.g),a=dp(t.b),c=Tl((.4124564*e+.3575761*n+.1804375*a)/V0),h=Tl((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-Tl((.0193339*e+.119192*n+.9503041*a)/j0)),alpha:t.a}}function W0(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,a=isNaN(t.b)?e:e-t.b/200;return e=1*up(e),n=V0*up(n),a=j0*up(a),new Jn(hp(3.2404542*n-1.5371385*e-.4985314*a),hp(-.969266*n+1.8760108*e+.041556*a),hp(.0556434*n-.2040259*e+1.0572252*a),t.alpha)}function jh(t,e,n){let a=e-t;return t+n*(a>180||a<-180?a-360*Math.round(a/360):a)}let la={forward:q0,reverse:W0,interpolate:function(t,e,n){return{l:gn(t.l,e.l,n),a:gn(t.a,e.a,n),b:gn(t.b,e.b,n),alpha:gn(t.alpha,e.alpha,n)}}},Pr={forward:function(t){let{l:e,a:n,b:a}=q0(t),c=Math.atan2(a,n)*$0;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:t.a}},reverse:function(t){let e=t.h*kv,n=t.c;return W0({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:jh(t.h,e.h,n),c:gn(t.c,e.c,n),l:gn(t.l,e.l,n),alpha:gn(t.alpha,e.alpha,n)}}};var tu=Object.freeze({__proto__:null,hcl:Pr,lab:la});class Co{constructor(e,n,a,c,h){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(let[m,y]of h)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,n,a,c){let h=0;if(e.name==="exponential")h=fp(n,e.base,a,c);else if(e.name==="linear")h=fp(n,1,a,c);else if(e.name==="cubic-bezier"){let m=e.controlPoints;h=new m0(m[0],m[1],m[2],m[3]).solve(fp(n,1,a,c))}return h}static parse(e,n){let[a,c,h,...m]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let w=c.slice(1);if(w.length!==4||w.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,At),!h)return null;let y=[],x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=bo:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let w=0;w<m.length;w+=2){let C=m[w],A=m[w+1],S=w+3,F=w+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(y.length&&y[y.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let R=n.parse(A,F,x);if(!R)return null;x=x||R.type,y.push([C,R])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Co(x,a,c,h,y):n.error(`Type ${Wi(x)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);let c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);let h=n.length;if(c>=n[h-1])return a[h-1].evaluate(e);let m=zh(n,c),y=Co.interpolationFactor(this.interpolation,c,n[m],n[m+1]),x=a[m].evaluate(e),w=a[m+1].evaluate(e);return this.operator==="interpolate"?zc[this.type.kind.toLowerCase()](x,w,y):this.operator==="interpolate-hcl"?Pr.reverse(Pr.interpolate(Pr.forward(x),Pr.forward(w),y)):la.reverse(la.interpolate(la.forward(x),la.forward(w),y))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function fp(t,e,n,a){let c=a-n,h=t-n;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class Gh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null,c=n.expectedType;c&&c.kind!=="value"&&(a=c);let h=[];for(let y of e.slice(1)){let x=n.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,h.push(x)}let m=c&&h.some(y=>jc(c,y.type));return new Gh(m?Bn:a,h)}evaluate(e){let n,a=null,c=0;for(let h of this.args){if(c++,a=h.evaluate(e),a&&a instanceof wo&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Hh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let a=[];for(let h=1;h<e.length-1;h+=2){let m=e[h];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,h);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);let y=n.parse(e[h+1],h+1);if(!y)return null;a.push([m,y])}let c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new Hh(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class nu{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,At),c=n.parse(e[2],2,xr(n.expectedType||Bn));return a&&c?new nu(c.type.itemType,a,c):null}evaluate(e){let n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new mr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new mr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new mr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pp{constructor(e,n){this.type=Zn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Bn),c=n.parse(e[2],2,Bn);return a&&c?Gc(a.type,[Zn,Wn,At,yn,Bn])?new pp(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(a.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Ra(n,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(or(n))} instead.`);if(!Ra(a,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Wi(or(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sl{constructor(e,n,a){this.type=At,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Bn),c=n.parse(e[2],2,Bn);if(!a||!c)return null;if(!Gc(a.type,[Zn,Wn,At,yn,Bn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(a.type)} instead`);if(e.length===4){let h=n.parse(e[3],3,At);return h?new Sl(a,c,h):null}return new Sl(a,c)}evaluate(e){let n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Ra(n,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(or(n))} instead.`);if(!Ra(a,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Wi(or(a))} instead.`);if(this.fromIndex){let c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class mp{constructor(e,n,a,c,h,m){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=h,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let h={},m=[];for(let w=2;w<e.length-1;w+=2){let C=e[w],A=e[w+1];Array.isArray(C)||(C=[C]);let S=n.concat(w);if(C.length===0)return S.error("Expected at least one branch label.");for(let R of C){if(typeof R!="number"&&typeof R!="string")return S.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return S.error("Numeric branch labels must be integer values.");if(a){if(S.checkSubtype(a,or(R)))return null}else a=or(R);if(h[String(R)]!==void 0)return S.error("Branch labels must be unique.");h[String(R)]=m.length}let F=n.parse(A,w,c);if(!F)return null;c=c||F.type,m.push(F)}let y=n.parse(e[1],1,Bn);if(!y)return null;let x=n.parse(e[e.length-1],e.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new mp(a,c,y,h,m,x):null}evaluate(e){let n=this.input.evaluate(e);return(or(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(let m of n){let y=c[this.cases[m]];y===void 0?(c[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[y][1].push(m)}let h=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,y]of a)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class gp{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let c=[];for(let m=1;m<e.length-1;m+=2){let y=n.parse(e[m],m,Zn);if(!y)return null;let x=n.parse(e[m+1],m+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}let h=n.parse(e[e.length-1],e.length-1,a);return h?new gp(a,c,h):null}evaluate(e){for(let[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Il{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let a=n.parse(e[1],1,Bn),c=n.parse(e[2],2,At);if(!a||!c)return null;if(!Gc(a.type,[xr(Bn),Wn,Bn]))return n.error(`Expected first argument to be of type array or string, but found ${Wi(a.type)} instead`);if(e.length===4){let h=n.parse(e[3],3,At);return h?new Il(a.type,a,c,h):null}return new Il(a.type,a,c)}evaluate(e){let n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Ra(n,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${Wi(or(n))} instead.`);if(this.endIndex){let c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Z0(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _p(t,e,n,a){return a.compare(e,n)===0}function Va(t,e,n){let a=t!=="=="&&t!=="!=";return class bO{constructor(h,m,y){this.type=Zn,this.lhs=h,this.rhs=m,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||m.type.kind==="value"}static parse(h,m){if(h.length!==3&&h.length!==4)return m.error("Expected two or three arguments.");let y=h[0],x=m.parse(h[1],1,Bn);if(!x)return null;if(!Z0(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Wi(x.type)}'.`);let w=m.parse(h[2],2,Bn);if(!w)return null;if(!Z0(y,w.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Wi(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error(`Cannot compare types '${Wi(x.type)}' and '${Wi(w.type)}'.`);a&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new ts(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new ts(x.type,[w])));let C=null;if(h.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(h[3],3,Vc),!C)return null}return new bO(x,w,C)}evaluate(h){let m=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){let x=or(m),w=or(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new mr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let x=or(m),w=or(y);if(x.kind!=="string"||w.kind!=="string")return e(h,m,y)}return this.collator?n(h,m,y,this.collator.evaluate(h)):e(h,m,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){let h=[t];return this.eachChild(m=>{h.push(m.serialize())}),h}}}let Bv=Va("==",function(t,e,n){return e===n},_p),yp=Va("!=",function(t,e,n){return e!==n},function(t,e,n,a){return!_p(0,e,n,a)}),$h=Va("<",function(t,e,n){return e<n},function(t,e,n,a){return a.compare(e,n)<0}),Q0=Va(">",function(t,e,n){return e>n},function(t,e,n,a){return a.compare(e,n)>0}),Nv=Va("<=",function(t,e,n){return e<=n},function(t,e,n,a){return a.compare(e,n)<=0}),Y0=Va(">=",function(t,e,n){return e>=n},function(t,e,n,a){return a.compare(e,n)>=0});class vp{constructor(e,n,a,c,h,m){this.type=Wn,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let a=n.parse(e[1],1,At);if(!a)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=n.parse(c.locale,1,Wn),!h))return null;let m=null;if(c.currency&&(m=n.parse(c.currency,1,Wn),!m))return null;let y=null;if(c.unit&&(y=n.parse(c.unit,1,Wn),!y))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,At),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=n.parse(c["max-fraction-digits"],1,At),!w)?null:new vp(a,h,m,y,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class iu{constructor(e){this.type=At,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Wi(a.type)} instead.`):new iu(a):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new mr(`Expected value to be of type string or array, but found ${Wi(or(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function X0(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Ml={"==":Bv,"!=":yp,">":Q0,"<":$h,">=":Y0,"<=":Nv,array:ts,at:nu,boolean:ts,case:gp,coalesce:Gh,collator:$c,format:Hc,image:Dl,in:pp,"index-of":Sl,interpolate:Co,"interpolate-hcl":Co,"interpolate-lab":Co,length:iu,let:Hh,literal:ms,match:mp,number:ts,"number-format":vp,object:ts,slice:Il,step:eu,string:ts,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:Do,within:Ba,distance:Ua,config:sa};function K0(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let h=c?c.evaluate(t):1,m=M0(e,n,a,h);if(m)throw new mr(m);return new Jn(e/255*h,n/255*h,a/255*h,h)}function J0(t,[e,n,a,c]){e=e.evaluate(t),n=n.evaluate(t),a=a.evaluate(t);let h=c?c.evaluate(t):1,m=function(w,C,A,S){return typeof w=="number"&&w>=0&&w<=360?typeof C=="number"&&C>=0&&C<=100&&typeof A=="number"&&A>=0&&A<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[w,C,A,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[w,C,A,S]:[w,C,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[w,C,A,S]:[w,C,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,h);if(m)throw new mr(m);let y=`hsla(${e}, ${n}%, ${a}%, ${h})`,x=Jn.parse(y);if(!x)throw new mr(`Failed to parse HSLA color: ${y}`);return x}function xp(t,e){return t in e}function bp(t,e){let n=e[t];return n===void 0?null:n}function ja(t){return{type:t}}function eg(t){return{result:"success",value:t}}function Ga(t){return{result:"error",value:t}}function tg(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function qh(t){return t["property-type"]==="data-driven"}function ng(t){return tg(t.expression,"measure-light")}function ig(t){return tg(t.expression,"zoom")}function Fl(t){return!!t.expression&&t.expression.interpolated}function wp(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Lv(t){return t}function ru(t,e){let n=e.type==="color",a=t.stops&&typeof t.stops[0][0]=="object",c=a||!(a||t.property!==void 0),h=t.type||(Fl(e)?"exponential":"interval");if(n&&((t=Th({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Jn.parse(w[1])])),t.default=Jn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!tu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,y,x;if(h==="exponential")m=Dp;else if(h==="interval")m=Uv;else if(h==="categorical"){m=rg,y=Object.create(null);for(let w of t.stops)y[w[0]]=w[1];x=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=og}if(a){let w={},C=[];for(let F=0;F<t.stops.length;F++){let R=t.stops[F],B=R[0].zoom;w[B]===void 0&&(w[B]={zoom:B,type:t.type,property:t.property,default:t.default,stops:[]},C.push(B)),w[B].stops.push([R[0].value,R[1]])}let A=[];for(let F of C)A.push([w[F].zoom,ru(w[F],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Co.interpolationFactor.bind(void 0,S),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},R)=>Dp({stops:A,base:t.base},e,F).evaluate(F,R)}}if(c){let w=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Co.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(t,e,C,y,x)}}return{kind:"source",evaluate(w,C){let A=C&&C.properties?C.properties[t.property]:void 0;return A===void 0?ou(t.default,e.default):m(t,e,A,y,x)}}}function ou(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function rg(t,e,n,a,c){return ou(typeof n===c?a[n]:void 0,t.default,e.default)}function Uv(t,e,n){if(ra(n)!=="number")return ou(t.default,e.default);let a=t.stops.length;if(a===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];let c=zh(t.stops.map(h=>h[0]),n);return t.stops[c][1]}function Dp(t,e,n){let a=t.base!==void 0?t.base:1;if(ra(n)!=="number")return ou(t.default,e.default);let c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];let h=zh(t.stops.map(C=>C[0]),n),m=function(C,A,S,F){let R=F-S,B=C-S;return R===0?0:A===1?B/R:(Math.pow(A,B)-1)/(Math.pow(A,R)-1)}(n,a,t.stops[h][0],t.stops[h+1][0]),y=t.stops[h][1],x=t.stops[h+1][1],w=zc[e.type]||Lv;if(t.colorSpace&&t.colorSpace!=="rgb"){let C=tu[t.colorSpace];w=(A,S)=>C.reverse(C.interpolate(C.forward(A),C.forward(S),m))}return typeof y.evaluate=="function"?{evaluate(...C){let A=y.evaluate.apply(void 0,C),S=x.evaluate.apply(void 0,C);if(A!==void 0&&S!==void 0)return w(A,S,m)}}:w(y,x,m)}function og(t,e,n){return e.type==="color"?n=Jn.parse(n):e.type==="formatted"?n=Fr.fromString(n.toString()):e.type==="resolvedImage"?n=wo.fromString(n.toString()):ra(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),ou(n,t.default,e.default)}co.register(Ml,{error:[{kind:"error"},[Wn],(t,[e])=>{throw new mr(e.evaluate(t))}],typeof:[Wn,[Bn],(t,[e])=>Wi(or(e.evaluate(t)))],"to-rgba":[xr(At,4),[bo],(t,[e])=>e.evaluate(t).toArray()],rgb:[bo,[At,At,At],K0],rgba:[bo,[At,At,At,At],K0],hsl:[bo,[At,At,At],J0],hsla:[bo,[At,At,At,At],J0],has:{type:Zn,overloads:[[[Wn],(t,[e])=>xp(e.evaluate(t),t.properties())],[[Wn,vl],(t,[e,n])=>xp(e.evaluate(t),n.evaluate(t))]]},get:{type:Bn,overloads:[[[Wn],(t,[e])=>bp(e.evaluate(t),t.properties())],[[Wn,vl],(t,[e,n])=>bp(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Bn,[Wn],(t,[e])=>bp(e.evaluate(t),t.featureState||{})],properties:[vl,[],t=>t.properties()],"geometry-type":[Wn,[],t=>t.geometryType()],id:[Bn,[],t=>t.id()],zoom:[At,[],t=>t.globals.zoom],pitch:[At,[],t=>t.globals.pitch||0],"distance-from-center":[At,[],t=>t.distanceFromCenter()],"measure-light":[At,[Wn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[At,[],t=>t.globals.heatmapDensity||0],"line-progress":[At,[],t=>t.globals.lineProgress||0],"raster-value":[At,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[At,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[At,[],t=>t.globals.skyRadialProgress||0],accumulated:[Bn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[At,ja(At),(t,e)=>{let n=0;for(let a of e)n+=a.evaluate(t);return n}],"*":[At,ja(At),(t,e)=>{let n=1;for(let a of e)n*=a.evaluate(t);return n}],"-":{type:At,overloads:[[[At,At],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[At],(t,[e])=>-e.evaluate(t)]]},"/":[At,[At,At],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[At,[At,At],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[At,[At],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[At,[At],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[At,[At],(t,[e])=>Math.log(e.evaluate(t))],log2:[At,[At],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[At,[At],(t,[e])=>Math.sin(e.evaluate(t))],cos:[At,[At],(t,[e])=>Math.cos(e.evaluate(t))],tan:[At,[At],(t,[e])=>Math.tan(e.evaluate(t))],asin:[At,[At],(t,[e])=>Math.asin(e.evaluate(t))],acos:[At,[At],(t,[e])=>Math.acos(e.evaluate(t))],atan:[At,[At],(t,[e])=>Math.atan(e.evaluate(t))],min:[At,ja(At),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[At,ja(At),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[At,[At],(t,[e])=>Math.abs(e.evaluate(t))],round:[At,[At],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[At,[At],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[At,[At],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Zn,[Wn,Bn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Zn,[Bn],(t,[e])=>t.id()===e.value],"filter-type-==":[Zn,[Wn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Zn,[Wn,Bn],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Zn,[Bn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Zn,[Wn,Bn],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Zn,[Bn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Zn,[Wn,Bn],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Zn,[Bn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Zn,[Wn,Bn],(t,[e,n])=>{let a=t.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Zn,[Bn],(t,[e])=>{let n=t.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Zn,[Bn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Zn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Zn,[xr(Wn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Zn,[xr(Bn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Zn,[Wn,xr(Bn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Zn,[Wn,xr(Bn)],(t,[e,n])=>function(a,c,h,m){for(;h<=m;){let y=h+m>>1;if(c[y]===a)return!0;c[y]>a?m=y-1:h=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Zn,overloads:[[[Zn,Zn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ja(Zn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Zn,overloads:[[[Zn,Zn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ja(Zn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Zn,[Zn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Zn,[Wn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Wn,[Wn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Wn,[Wn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Wn,ja(Bn),(t,e)=>e.map(n=>Ro(n.evaluate(t))).join("")],"resolved-locale":[Wn,[Vc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[At,[At,At,Bn],(t,e)=>{let[n,a,c]=e.map(m=>m.evaluate(t));if(n>a||n===a)return n;let h;if(typeof c=="string")h=function(m){let y=0;if(m.length===0)return y;for(let x=0;x<m.length;x++)y=(y<<5)-y+m.charCodeAt(x),y|=0;return y}(c);else{if(typeof c!="number")throw new mr(`Invalid seed input: ${c}`);h=c}return n+X0(h)()*(a-n)}]});class Wh{constructor(e,n,a,c){this.expression=e,this._warningHistory={},this._evaluator=new Qf(a,c),this._defaultValue=n?function(h){return h.type==="color"&&(wp(h.default)||Array.isArray(h.default))?new Jn(0,0,0,0):h.type==="color"?Jn.parse(h.default)||null:h.default===void 0?null:h.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,a,c,h,m,y,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,h,m,y,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Zh(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ml}function Pl(t,e,n,a){let c=new Lh(Ml,[],e?function(m){let y={color:bo,string:Wn,number:At,enum:Wn,boolean:Zn,formatted:xl,resolvedImage:bl};return m.type==="array"?xr(y[m.value]||Bn,m.length):y[m.type]}(e):void 0,void 0,void 0,n,a),h=c.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?eg(new Wh(h,e,n,a)):Ga(c.errors)}class su{constructor(e,n,a){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!Xc(n.expression),this.isConfigDependent=!Kc(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,h,m)}evaluate(e,n,a,c,h,m){return this._styleExpression.evaluate(e,n,a,c,h,m)}}class au{constructor(e,n,a,c,h){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Xc(n.expression),this.isLightConstant=h,this.isConfigDependent=!Kc(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,h,m)}evaluate(e,n,a,c,h,m){return this._styleExpression.evaluate(e,n,a,c,h,m)}interpolationFactor(e,n,a){return this.interpolationType?Co.interpolationFactor(this.interpolationType,e,n,a):0}}function sg(t,e,n,a){if((t=Pl(t,e,n,a)).result==="error")return t;let c=t.value.expression,h=aa(c);if(!h&&!qh(e))return Ga([new es("","data expressions not supported")]);let m=Jc(c,["zoom","pitch","distance-from-center"]);if(!m&&!ig(e))return Ga([new es("","zoom expressions not supported")]);let y=Jc(c,["measure-light"]);if(!y&&!ng(e))return Ga([new es("","measure-light expression not supported")]);let x=e.expression&&e.expression.relaxZoomRestriction,w=Qh(c);return w||m||x?w instanceof es?Ga([w]):w instanceof Co&&!Fl(e)?Ga([new es("",'"interpolate" expressions cannot be used with this property')]):eg(w?new au(h?"camera":"composite",t.value,w.labels,w instanceof Co?w.interpolation:void 0,y):new su(h?"constant":"source",t.value,y)):Ga([new es("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class lu{constructor(e,n){this._parameters=e,this._specification=n,Th(this,ru(this._parameters,this._specification))}static deserialize(e){return new lu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qh(t){let e=null;if(t instanceof Hh)e=Qh(t.result);else if(t instanceof Gh){for(let n of t.args)if(e=Qh(n),e)break}else(t instanceof eu||t instanceof Co)&&t.input instanceof co&&t.input.name==="zoom"&&(e=t);return e instanceof es||t.eachChild(n=>{let a=Qh(n);a instanceof es?e=a:e&&a&&e!==a&&(e=new es("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ag=gs,ca=3;function gs(t,e,n){var a=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var h=0;h<this.d*this.d;h++){var m=c[ca+h],y=c[ca+h+1];a.push(m===y?null:c.subarray(m,y))}var x=c[ca+a.length+1];this.keys=c.subarray(c[ca+a.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var C=n/e*t;this.min=-C,this.max=t+C}gs.prototype.insert=function(t,e,n,a,c){this._forEachCell(e,n,a,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c)},gs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},gs.prototype._insertCell=function(t,e,n,a,c,h){this.cells[c].push(h)},gs.prototype.query=function(t,e,n,a,c){var h=this.min,m=this.max;if(t<=h&&e<=h&&m<=n&&m<=a&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,a,this._queryCell,y,{},c),y},gs.prototype._queryCell=function(t,e,n,a,c,h,m,y){var x=this.cells[c];if(x!==null)for(var w=this.keys,C=this.bboxes,A=0;A<x.length;A++){var S=x[A];if(m[S]===void 0){var F=4*S;(y?y(C[F+0],C[F+1],C[F+2],C[F+3]):t<=C[F+2]&&e<=C[F+3]&&n>=C[F+0]&&a>=C[F+1])?(m[S]=!0,h.push(w[S])):m[S]=!1}}},gs.prototype._forEachCell=function(t,e,n,a,c,h,m,y){for(var x=this._convertToCellCoord(t),w=this._convertToCellCoord(e),C=this._convertToCellCoord(n),A=this._convertToCellCoord(a),S=x;S<=C;S++)for(var F=w;F<=A;F++){var R=this.d*F+S;if((!y||y(this._convertFromCellCoord(S),this._convertFromCellCoord(F),this._convertFromCellCoord(S+1),this._convertFromCellCoord(F+1)))&&c.call(this,t,e,n,a,R,h,m,y))return}},gs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},gs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},gs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ca+this.cells.length+1+1,n=0,a=0;a<this.cells.length;a++)n+=this.cells[a].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,m=0;m<t.length;m++){var y=t[m];c[ca+m]=h,c.set(y,h),h+=y.length}return c[ca+t.length]=h,c.set(this.keys,h),c[ca+t.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};var Ol=Te(ag);let Yh={};function It(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Yh[e]={klass:t,omit:n.omit||[]}}It(Object,"Object"),Ol.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Ol.deserialize=function(t){return new Ol(t.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),It(Ol,"Grid"),It(Jn,"Color"),It(Error,"Error"),It(Fr,"Formatted"),It(Sh,"FormattedSection"),It(gh,"AJAXError"),It(wo,"ResolvedImage"),It(lu,"StylePropertyFunction"),It(Wh,"StyleExpression",{omit:["_evaluator"]}),It(au,"ZoomDependentExpression"),It(su,"ZoomConstantExpression"),It(co,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ml)Yh[Ml[t]._classRegistryKey]||It(Ml[t],`Expression${t}`);function lg(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function cg(t){return self.ImageBitmap&&t instanceof ImageBitmap}function cu(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(lg(t)||cg(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let a of t)n.push(cu(a,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[a,c]of t.entries())n[a]=cu(c);return n}if(typeof t=="object"){let n=t.constructor,a=n._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);let c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let h in t)t.hasOwnProperty(h)&&(Yh[a].omit.indexOf(h)>=0||(c[h]=cu(t[h],e)));t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof t)}function d(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||lg(t)||cg(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(d);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let c=new Map;for(let h of Object.keys(t))h!=="$name"&&c.set(h,d(t[h]));return c}let{klass:n}=Yh[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let a=Object.create(n.prototype);for(let c of Object.keys(t))c!=="$name"&&(a[c]=d(t[c]));return a}throw new Error("can't deserialize object of type "+typeof t)}let i={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function l(t){for(let e of t)if(v(e.charCodeAt(0)))return!0;return!1}function p(t){for(let e of t)if(!_(e.charCodeAt(0)))return!1;return!0}function _(t){return!(i.Arabic(t)||i["Arabic Supplement"](t)||i["Arabic Extended-A"](t)||i["Arabic Presentation Forms-A"](t)||i["Arabic Presentation Forms-B"](t))}function v(t){return!(t!==746&&t!==747&&(t<4352||!(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||!(!i["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Hangul Compatibility Jamo"](t)||i["Hangul Jamo Extended-A"](t)||i["Hangul Jamo Extended-B"](t)||i["Hangul Jamo"](t)||i["Hangul Syllables"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i.Kanbun(t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)&&t!==12540||!(!i["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!i["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||i["Unified Canadian Aboriginal Syllabics"](t)||i["Unified Canadian Aboriginal Syllabics Extended"](t)||i["Vertical Forms"](t)||i["Yijing Hexagram Symbols"](t)||i["Yi Syllables"](t)||i["Yi Radicals"](t))))}function b(t){return!(v(t)||function(e){return!!(i["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||i["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||i["Letterlike Symbols"](e)||i["Number Forms"](e)||i["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||i["Control Pictures"](e)&&e!==9251||i["Optical Character Recognition"](e)||i["Enclosed Alphanumerics"](e)||i["Geometric Shapes"](e)||i["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||i["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||i["CJK Symbols and Punctuation"](e)||i.Katakana(e)||i["Private Use Area"](e)||i["CJK Compatibility Forms"](e)||i["Small Form Variants"](e)||i["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function D(t){return t>=1424&&t<=2303||i["Arabic Presentation Forms-A"](t)||i["Arabic Presentation Forms-B"](t)}function T(t,e){return!(!e&&D(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||i.Khmer(t))}function M(t){for(let e of t)if(D(e.charCodeAt(0)))return!0;return!1}let P="deferred",k="loading",N="loaded",L=null,H="unavailable",G=null,$=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(H="error"),L&&L(t)};function q(){Y.fire(new na("pluginStateChange",{pluginStatus:H,pluginURL:G}))}let Y=new Oa,re=function(){return H},ie=function(){if(H!==P||!G)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");H=k,q(),G&&Pc({url:G},t=>{t?$(t):(H=N,q())})},ae={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>H===N||ae.applyArabicShaping!=null,isLoading:()=>H===k,setState(t){H=t.pluginStatus,G=t.pluginURL},isParsed:()=>ae.applyArabicShaping!=null&&ae.processBidirectionalText!=null&&ae.processStyledBidirectionalText!=null,getPluginURL:()=>G};class W{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(let c of n)if(!T(c.charCodeAt(0),a))return!1;return!0}(e,ae.isLoaded())}}class K{constructor(e,n,a,c){this.property=e,this.value=n,this.expression=function(h,m,y,x){if(wp(h))return new lu(h,m);if(Zh(h)||Array.isArray(h)&&h.length>0){let w=sg(h,m,y,x);if(w.result==="error")throw new Error(w.value.map(C=>`${C.key}: ${C.message}`).join(", "));return w.value}{let w=h;return typeof h=="string"&&m.type==="color"&&(w=Jn.parse(h)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class fe{constructor(e,n,a){this.property=e,this.value=new K(e,void 0,n,a)}transitioned(e,n){return new ve(this.property,this.value,n,Oo({},e.transition,this.transition),e.now)}untransitioned(){return new ve(this.property,this.value,null,{},0)}}class he{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Fs(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property,this._scope,this._options)),this._values[e].value=new K(this._values[e].property,n===null?void 0:Fs(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let a=this._properties.properties;if(e)for(let c in e){let h=e[c];if(Ia(c,"-transition")){let m=c.slice(0,-11);a[m]&&this.setTransition(m,h)}else a[c]&&this.setValue(c,h)}}getTransition(e){return Fs(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new fe(this._values[e].property)),this._values[e].transition=Fs(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a);let c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){let a=new Ie(this._properties);for(let c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){let e=new Ie(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ve{constructor(e,n,a,c,h){let m=c.delay||0,y=c.duration||0;h=h||0,this.property=e,this.value=n,this.begin=h+m,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){let c=e.now||0,h=this.value.possiblyEvaluate(e,n,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return m.possiblyEvaluate(e,n,a);{let y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,a),h,rh(y))}}return h}}class Ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){let c=new Fe(this._properties);for(let h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,a);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ye{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.isConfigDependent=!1}getValue(e){return Fs(this._values[e].value)}setValue(e,n){this._values[e]=new K(this._values[e].property,n===null?void 0:Fs(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){let c=new Fe(this._properties);for(let h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,a);return c}}class Ae{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c)}}class Fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class _e{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){let c=zc[this.specification.type];return c?c(e,n,a):e}}class De{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c){return new Ae(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,c)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Ae(this,{kind:"constant",value:void 0},e.parameters);let c=zc[this.specification.type];return c?new Ae(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,h,m){return e.kind==="constant"?e.value:e.evaluate(n,a,c,h,m)}}class Xe{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class be{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new W(0,{});for(let a in e){let c=e[a];c.specification.overridable&&this.overridableProperties.push(a);let h=this.defaultPropertyValues[a]=new K(c,void 0),m=this.defaultTransitionablePropertyValues[a]=new fe(c);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(n)}}}function Se(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Me(t){if(Array.isArray(t))return t.map(Me);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Me(t[n]);return e}return Se(t)}It(De,"DataDrivenProperty"),It(_e,"DataConstantProperty"),It(Xe,"ColorRampProperty");var oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ve(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Ve(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function yt(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ve(t)||(t=Pn(t));let n=t,a=!0;try{a=function(w){if(!Rt(w))return w;let C=Me(w);return zt(C),C=Mt(C),C}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let c=oe[`filter_${e}`],h=Pl(a,c),m=null;if(h.result==="error")throw new Error(h.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,C,A)=>h.value.evaluate(w,C,{},A);let y=null,x=null;if(a!==n){let w=Pl(n,c);if(w.result==="error")throw new Error(w.value.map(C=>`${C.key}: ${C.message}`).join(", "));y=(C,A,S,F,R)=>w.value.evaluate(C,A,{},S,void 0,void 0,F,R),x=!aa(w.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:nn(a),needFeature:!!x}}function Mt(t){if(!Array.isArray(t))return t;let e=function(n){if(jt.has(n[0])){for(let a=1;a<n.length;a++)if(Rt(n[a]))return!0}return n}(t);return e===!0?e:e.map(n=>Mt(n))}function zt(t){let e=!1,n=[];if(t[0]==="case"){for(let a=1;a<t.length-1;a+=2)e=e||Rt(t[a]),n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Rt(t[1]);for(let a=2;a<t.length-1;a+=2)n.push(t[a+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Rt(t[1]);for(let a=1;a<t.length-1;a+=2)n.push(t[a+1])}e&&(t.length=0,t.push("any",...n));for(let a=1;a<t.length;a++)zt(t[a])}function Rt(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Rt(t[n]))return!0;return!1}let jt=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function En(t,e){return t<e?-1:t>e?1:0}function nn(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(nn(t[e]))return!0;return!1}function Pn(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?An(t[1],t[2],"=="):e==="!="?sr(An(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?An(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Pn))):e==="all"?["all"].concat(t.slice(1).map(Pn)):e==="none"?["all"].concat(t.slice(1).map(Pn).map(sr)):e==="in"?Fi(t[1],t.slice(2)):e==="!in"?sr(Fi(t[1],t.slice(2))):e==="has"?ei(t[1]):e!=="!has"||sr(ei(t[1]));var n}function An(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Fi(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(En)]]:["filter-in-small",t,["literal",e]]}}function ei(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function sr(t){return["!",t]}let Ji="";function gi(t,e){return e?`${t}${Ji}${e}`:t}let ai="-transition",dn=new Set(["fill","line","background","hillshade","raster"]);class pn extends Oa{constructor(e,n,a,c){if(super(),this.id=e.id,this.fqid=gi(this.id,a),this.type=e.type,this.scope=a,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new ye(n.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new he(n.paint,this.scope,c);for(let h in e.paint)this.setPaintProperty(h,e.paint[h]);for(let h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fe(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return dn.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Ia(e,ai)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let a=this._transitionablePaint,c=a._properties.properties;if(Ia(e,ai)){let A=e.slice(0,-11);return c[A]&&a.setTransition(A,n||void 0),!1}if(!c[e])return!1;let h=a._values[e],m=h.value.isDataDriven(),y=h.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let x=a._values[e].value,w=x.isDataDriven(),C=Ia(e,"pattern")||e==="line-dasharray";return w||m||C||this._handleOverridablePaintPropertyUpdate(e,y,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Ac({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Ae&&qh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=yt(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,c,h,m,y,x,w){}queryIntersectsMatchingFeature(e,n,a,c){}}let Ci={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _i{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function an(t,e=1){let n=0,a=0;return{members:t.map(c=>{let h=Ci[c.type].BYTES_PER_ELEMENT,m=n=Qr(n,Math.max(e,h)),y=c.components||1;return a=Math.max(a,h),n+=h*y,{name:c.name,type:c.type,components:y,offset:m}}),size:Qr(n,Math.max(a,e)),alignment:e}}function Qr(t,e){return Math.ceil(t/e)*e}class Or extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}Or.prototype.bytesPerElement=4,It(Or,"StructArrayLayout2i4");class gr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let h=3*e;return this.int16[h+0]=n,this.int16[h+1]=a,this.int16[h+2]=c,e}}gr.prototype.bytesPerElement=6,It(gr,"StructArrayLayout3i6");class Rr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,a,c)}emplace(e,n,a,c,h){let m=4*e;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=h,e}}Rr.prototype.bytesPerElement=8,It(Rr,"StructArrayLayout4i8");class Yr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,h)}emplace(e,n,a,c,h,m){let y=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=h,this.int16[y+4]=m,e}}Yr.prototype.bytesPerElement=10,It(Yr,"StructArrayLayout5i10");class zr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,h,m,y)}emplace(e,n,a,c,h,m,y,x){let w=6*e,C=12*e,A=3*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.uint8[C+4]=c,this.uint8[C+5]=h,this.uint8[C+6]=m,this.uint8[C+7]=y,this.float32[A+2]=x,e}}zr.prototype.bytesPerElement=12,It(zr,"StructArrayLayout2i4ub1f12");class _r extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,a,c)}emplace(e,n,a,c,h){let m=4*e;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=h,e}}_r.prototype.bytesPerElement=16,It(_r,"StructArrayLayout4f16");class Cr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Cr.prototype.bytesPerElement=8,It(Cr,"StructArrayLayout2f8");class Er extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,h)}emplace(e,n,a,c,h,m){let y=6*e,x=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=c,this.uint16[y+3]=h,this.float32[x+2]=m,e}}Er.prototype.bytesPerElement=12,It(Er,"StructArrayLayout4ui1f12");class _s extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,a,c)}emplace(e,n,a,c,h){let m=4*e;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,this.uint16[m+3]=h,e}}_s.prototype.bytesPerElement=8,It(_s,"StructArrayLayout4ui8");class is extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,h,m)}emplace(e,n,a,c,h,m,y){let x=6*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=h,this.int16[x+4]=m,this.int16[x+5]=y,e}}is.prototype.bytesPerElement=12,It(is,"StructArrayLayout6i12");class ys extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y,x,w,C,A,S){let F=this.length;return this.resize(F+1),this.emplace(F,e,n,a,c,h,m,y,x,w,C,A,S)}emplace(e,n,a,c,h,m,y,x,w,C,A,S,F){let R=12*e;return this.int16[R+0]=n,this.int16[R+1]=a,this.int16[R+2]=c,this.int16[R+3]=h,this.uint16[R+4]=m,this.uint16[R+5]=y,this.uint16[R+6]=x,this.uint16[R+7]=w,this.int16[R+8]=C,this.int16[R+9]=A,this.int16[R+10]=S,this.int16[R+11]=F,e}}ys.prototype.bytesPerElement=24,It(ys,"StructArrayLayout4i4ui4i24");class vs extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,c,h,m)}emplace(e,n,a,c,h,m,y){let x=10*e,w=5*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.float32[w+2]=h,this.float32[w+3]=m,this.float32[w+4]=y,e}}vs.prototype.bytesPerElement=20,It(vs,"StructArrayLayout3i3f20");class ua extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ua.prototype.bytesPerElement=4,It(ua,"StructArrayLayout1ul4");class ko extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){let c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}ko.prototype.bytesPerElement=4,It(ko,"StructArrayLayout2ui4");class uu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y,x,w,C,A,S,F){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,a,c,h,m,y,x,w,C,A,S,F)}emplace(e,n,a,c,h,m,y,x,w,C,A,S,F,R){let B=20*e,z=10*e;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=c,this.int16[B+3]=h,this.int16[B+4]=m,this.float32[z+3]=y,this.float32[z+4]=x,this.float32[z+5]=w,this.float32[z+6]=C,this.int16[B+14]=A,this.uint32[z+8]=S,this.uint16[B+18]=F,this.uint16[B+19]=R,e}}uu.prototype.bytesPerElement=40,It(uu,"StructArrayLayout5i4f1i1ul2ui40");class Rl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,h,m,y)}emplace(e,n,a,c,h,m,y,x){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+4]=h,this.int16[w+5]=m,this.int16[w+6]=y,this.int16[w+7]=x,e}}Rl.prototype.bytesPerElement=16,It(Rl,"StructArrayLayout3i2i2i16");class hu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,h)}emplace(e,n,a,c,h,m){let y=4*e,x=8*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=h,this.int16[x+7]=m,e}}hu.prototype.bytesPerElement=16,It(hu,"StructArrayLayout2f1f2i16");class Ns extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,a,c)}emplace(e,n,a,c,h){let m=12*e,y=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=a,this.float32[y+1]=c,this.float32[y+2]=h,e}}Ns.prototype.bytesPerElement=12,It(Ns,"StructArrayLayout2ub2f12");class yr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=a,this.uint16[h+2]=c,e}}yr.prototype.bytesPerElement=6,It(yr,"StructArrayLayout3ui6");class du extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue){let ne=this.length;return this.resize(ne+1),this.emplace(ne,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue)}emplace(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue,ne){let de=30*e,ge=15*e,we=60*e;return this.int16[de+0]=n,this.int16[de+1]=a,this.int16[de+2]=c,this.float32[ge+2]=h,this.float32[ge+3]=m,this.uint16[de+8]=y,this.uint16[de+9]=x,this.uint32[ge+5]=w,this.uint32[ge+6]=C,this.uint32[ge+7]=A,this.uint16[de+16]=S,this.uint16[de+17]=F,this.uint16[de+18]=R,this.float32[ge+10]=B,this.float32[ge+11]=z,this.uint8[we+48]=j,this.uint8[we+49]=Q,this.uint8[we+50]=J,this.uint32[ge+13]=X,this.int16[de+28]=ue,this.uint8[we+58]=ne,e}}du.prototype.bytesPerElement=60,It(du,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class zv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue,ne,de,ge,we,Oe,Ee,Ne,Be,Re,We,Ge){let Je=this.length;return this.resize(Je+1),this.emplace(Je,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue,ne,de,ge,we,Oe,Ee,Ne,Be,Re,We,Ge)}emplace(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j,Q,J,X,ue,ne,de,ge,we,Oe,Ee,Ne,Be,Re,We,Ge,Je){let Ke=20*e,Le=40*e,Ft=80*e;return this.float32[Ke+0]=n,this.float32[Ke+1]=a,this.int16[Le+4]=c,this.int16[Le+5]=h,this.int16[Le+6]=m,this.int16[Le+7]=y,this.int16[Le+8]=x,this.int16[Le+9]=w,this.int16[Le+10]=C,this.int16[Le+11]=A,this.int16[Le+12]=S,this.uint16[Le+13]=F,this.uint16[Le+14]=R,this.uint16[Le+15]=B,this.uint16[Le+16]=z,this.uint16[Le+17]=j,this.uint16[Le+18]=Q,this.uint16[Le+19]=J,this.uint16[Le+20]=X,this.uint16[Le+21]=ue,this.uint16[Le+22]=ne,this.uint16[Le+23]=de,this.uint16[Le+24]=ge,this.uint16[Le+25]=we,this.uint16[Le+26]=Oe,this.uint16[Le+27]=Ee,this.uint32[Ke+14]=Ne,this.float32[Ke+15]=Be,this.float32[Ke+16]=Re,this.float32[Ke+17]=We,this.float32[Ke+18]=Ge,this.uint8[Ft+76]=Je,e}}zv.prototype.bytesPerElement=80,It(zv,"StructArrayLayout2f9i15ui1ul4f1ub80");class Cp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Cp.prototype.bytesPerElement=4,It(Cp,"StructArrayLayout1f4");class fu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,a,c,h)}emplace(e,n,a,c,h,m){let y=5*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.float32[y+3]=h,this.float32[y+4]=m,e}}fu.prototype.bytesPerElement=20,It(fu,"StructArrayLayout5f20");class Vv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,h,m,y)}emplace(e,n,a,c,h,m,y,x){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=c,this.float32[w+3]=h,this.float32[w+4]=m,this.float32[w+5]=y,this.float32[w+6]=x,e}}Vv.prototype.bytesPerElement=28,It(Vv,"StructArrayLayout7f28");class jv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,a,c)}emplace(e,n,a,c,h){let m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,this.uint16[m+4]=h,e}}jv.prototype.bytesPerElement=12,It(jv,"StructArrayLayout1ul3ui12");class Gv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Gv.prototype.bytesPerElement=2,It(Gv,"StructArrayLayout1ui2");class pu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){let c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){let h=3*e;return this.float32[h+0]=n,this.float32[h+1]=a,this.float32[h+2]=c,e}}pu.prototype.bytesPerElement=12,It(pu,"StructArrayLayout3f12");class Hv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z){let j=this.length;return this.resize(j+1),this.emplace(j,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z)}emplace(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j){let Q=16*e;return this.float32[Q+0]=n,this.float32[Q+1]=a,this.float32[Q+2]=c,this.float32[Q+3]=h,this.float32[Q+4]=m,this.float32[Q+5]=y,this.float32[Q+6]=x,this.float32[Q+7]=w,this.float32[Q+8]=C,this.float32[Q+9]=A,this.float32[Q+10]=S,this.float32[Q+11]=F,this.float32[Q+12]=R,this.float32[Q+13]=B,this.float32[Q+14]=z,this.float32[Q+15]=j,e}}Hv.prototype.bytesPerElement=64,It(Hv,"StructArrayLayout16f64");class ug extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,h,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,h,m,y)}emplace(e,n,a,c,h,m,y,x){let w=10*e,C=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=a,this.uint16[w+2]=c,this.uint16[w+3]=h,this.float32[C+2]=m,this.float32[C+3]=y,this.float32[C+4]=x,e}}ug.prototype.bytesPerElement=20,It(ug,"StructArrayLayout4ui3f20");class $v extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}$v.prototype.bytesPerElement=2,It($v,"StructArrayLayout1i2");class qv extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}qv.prototype.bytesPerElement=1,It(qv,"StructArrayLayout1ub1");class _C extends _i{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_C.prototype.size=40;class yC extends uu{get(e){return new _C(this,e)}}It(yC,"CollisionBoxArray");class vC extends _i{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}vC.prototype.size=60;class xC extends du{get(e){return new vC(this,e)}}It(xC,"PlacedSymbolArray");class bC extends _i{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}bC.prototype.size=80;class wC extends zv{get(e){return new bC(this,e)}}It(wC,"SymbolInstanceArray");class DC extends Cp{getoffsetX(e){return this.float32[1*e+0]}}It(DC,"GlyphOffsetArray");class CC extends Or{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}It(CC,"SymbolLineVertexArray");class EC extends _i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}EC.prototype.size=12;class AC extends jv{get(e){return new EC(this,e)}}It(AC,"FeatureIndexArray");class TC extends ko{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}It(TC,"FillExtrusionCentroidArray");let c3=an([{name:"a_pos",components:2,type:"Int16"}],4),u3=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class er{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let h=this.segments[this.segments.length-1];return e>er.MAX_VERTEX_ARRAY_LENGTH&&Gi(`Max vertices per segment is ${er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>er.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new er([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function SC(t,e){return 256*(t=Cn(Math.floor(t),0,255))+Cn(Math.floor(e),0,255)}er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It(er,"SegmentVector");let h3=an([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),d3=an([{name:"a_dash",components:4,type:"Uint16"}]);class Ep{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(IC(e)),this.positions.push(n,a,c)}eachPosition(e,n){let a=IC(e),c=0,h=this.ids.length-1;for(;c<h;){let m=c+h>>1;this.ids[m]>=a?h=m:c=m+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){let a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Wv(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){let n=new Ep,a;n.ids=e.ids,n.positions=e.positions;for(let c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function IC(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bc(String(t))}function Wv(t,e,n,a){for(;n<a;){let c=t[n+a>>1],h=n-1,m=a+1;for(;;){do h++;while(t[h]<c);do m--;while(t[m]>c);if(h>=m)break;hg(t,h,m),hg(e,3*h,3*m),hg(e,3*h+1,3*m+1),hg(e,3*h+2,3*m+2)}m-n<a-m?(Wv(t,e,n,m),n=m+1):(Wv(t,e,m+1,a),a=m)}}function hg(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}It(Ep,"FeaturePositionMap");class Ha{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class dg extends Ha{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class uo extends Ha{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class kl extends Ha{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Zv extends Ha{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class MC extends Ha{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class FC extends Ha{constructor(e){super(e),this.current=Jn.transparent}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}let f3=new Float32Array(16);class Ap extends Ha{constructor(e){super(e),this.current=f3}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}let p3=new Float32Array(9),m3=new Float32Array(4);class Qv extends Ha{constructor(e){super(e),this.current=m3}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Yv(t){return[SC(255*t.r,255*t.g),SC(255*t.b,255*t.a)]}class Tp{constructor(e,n,a){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=a}setUniform(e,n,a,c,h){n.set(e,h,c.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new FC(e):new uo(e)}}class Xh{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,c,h){let m=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;m&&n.set(e,h,m)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new MC(e):new uo(e)}}class $a{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,h,m,y){let x=this.paintVertexArray.length,w=this.expression.evaluate(new W(0,{brightness:m}),n,{},h,c,y);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,n,a,c,h,m,y){let x=this.expression.evaluate({zoom:0,brightness:y},a,c,void 0,h);this._setPaintValue(e,n,x)}_setPaintValue(e,n,a){if(this.type==="color"){let c=Yv(a);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ls{constructor(e,n,a,c,h,m){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,a,c,h,m,y){let x=this.expression.evaluate(new W(this.zoom,{brightness:m}),n,{},h,c,y),w=this.expression.evaluate(new W(this.zoom+1,{brightness:m}),n,{},h,c,y),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,x,w)}updatePaintArray(e,n,a,c,h,m,y){let x=this.expression.evaluate({zoom:this.zoom,brightness:y},a,c,void 0,h),w=this.expression.evaluate({zoom:this.zoom+1,brightness:y},a,c,void 0,h);this._setPaintValue(e,n,x,w)}_setPaintValue(e,n,a,c){if(this.type==="color"){let h=Yv(a),m=Yv(c);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],m[0],m[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,h){let m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Cn(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(e,h,y)}getBinding(e,n){return new uo(e)}}class Bl{constructor(e,n,a,c,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?d3:h3).members;for(let m=0;m<n.length;++m);this.paintVertexArray=new c}populatePaintArray(e,n,a){let c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,h,m,y){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,n,a,c){if(!c||!a)return;let h=c[a];if(!h)return;let{tl:m,br:y,pixelRatio:x}=h;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mu{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[];let c=[];for(let h in e.paint._values){let m=e.paint.get(h);if(!a(h)||!(m instanceof Ae&&qh(m.property.specification)))continue;let y=_3(h,e.type),x=m.value,w=m.property.specification.type,C=!!m.property.useIntegerZoom,A=h==="line-dasharray"||h.endsWith("pattern"),S=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||S)if(x.kind==="source"||S||A){let F=PC(h,w,"source");this.binders[h]=A?new Bl(x,y,w,F,e.id):new $a(x,y,w,F),c.push(`/a_${h}`)}else{let F=PC(h,w,"composite");this.binders[h]=new Ls(x,y,w,C,n,F),c.push(`/z_${h}`)}else this.binders[h]=A?new Xh(x.value,y):new Tp(x.value,y,w),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof $a||n instanceof Ls?n.maxValue:0}populatePaintArrays(e,n,a,c,h,m,y){for(let x in this.binders){let w=this.binders[x];(w instanceof $a||w instanceof Ls||w instanceof Bl)&&w.populatePaintArray(e,n,a,c,h,m,y)}}setConstantPatternPositions(e){for(let n in this.binders){let a=this.binders[n];a instanceof Xh&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,c,h,m,y,x){let w=!1,C=Object.keys(e),A=C.length!==0,S=A?C:n.uniqueIds;for(let F in this.binders){let R=this.binders[F];if((R instanceof $a||R instanceof Ls||R instanceof Bl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){let B=h.paint.get(F);R.expression=B.value;for(let z of S){let j=e[z.toString()];n.eachPosition(z,(Q,J,X)=>{let ue=c.feature(Q);R.updatePaintArray(J,X,ue,j,m,y,x)})}if(!A)for(let z of a.uniqueIds){let j=e[z.toString()];a.eachPosition(z,(Q,J,X)=>{let ue=c.feature(Q);R.updatePaintArray(J,X,ue,j,m,y,x)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let a=this.binders[n];(a instanceof Tp||a instanceof Xh)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof $a||a instanceof Ls||a instanceof Bl)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Tp||a instanceof Xh||a instanceof Ls)for(let c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let a in this.binders){let c=this.binders[a];if(c instanceof Tp||c instanceof Xh||c instanceof Ls)for(let h of c.uniformNames)n.push({name:h,property:a,binding:c.getBinding(e,h)})}return n}setUniforms(e,n,a,c,h){for(let{name:m,property:y,binding:x}of a)this.binders[y].setUniform(e,x,h,c.get(y),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof $a||n instanceof Ls||n instanceof Bl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let a=this.binders[n];(a instanceof $a||a instanceof Ls||a instanceof Bl)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof $a||n instanceof Ls||n instanceof Bl)&&n.destroy()}}}class Nl{constructor(e,n,a=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new mu(c,n,a);this.needsUpload=!1,this._featureMap=new Ep,this._featureMapWithoutIds=new Ep,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,h,m,y,x){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,c,h,m,y,x);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,h,m){for(let y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,y,c,h,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let g3={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _3(t,e){return g3[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let y3={"line-pattern":{source:Er,composite:Er},"fill-pattern":{source:Er,composite:Er},"fill-extrusion-pattern":{source:Er,composite:Er},"line-dasharray":{source:_s,composite:_s}},v3={color:{source:Cr,composite:_r},number:{source:Cp,composite:Cr}};function PC(t,e,n){let a=y3[t];return a&&a[n]||v3[e][n]}It(Tp,"ConstantBinder"),It(Xh,"PatternConstantBinder"),It($a,"SourceExpressionBinder"),It(Bl,"PatternCompositeBinder"),It(Ls,"CompositeExpressionBinder"),It(mu,"ProgramConfiguration",{omit:["_buffers"]}),It(Nl,"ProgramConfigurationSet");let ho=pt/Math.PI/2,Xv=5,OC=6,x3=16383,Kh=64,Kv=[Kh,32,16],xs=-ho,bs=ho;function Jh(t,e,n,a=ho){return n=kn(n),[t*Math.sin(n)*a,-e*a,t*Math.cos(n)*a]}function gu(t,e,n){return Jh(Math.cos(kn(t)),Math.sin(kn(t)),e,n)}let ed=63710088e-1,Jv=2*Math.PI*ed;class Un{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Un(Ms(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,a=this.lat*n,c=e.lat*n,h=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return ed*Math.acos(Math.min(h,1))}toBounds(e=0){let n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Ll({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return gu(this.lat,this.lng,ho+e*ho/ed)}static convert(e){if(e instanceof Un)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Un(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Un(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ll{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{let a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Un?new Un(e.lng,e.lat):Un.convert(e),this}setSouthWest(e){return this._sw=e instanceof Un?new Un(e.lng,e.lat):Un.convert(e),this}extend(e){let n=this._sw,a=this._ne,c,h;if(e instanceof Un)c=e,h=e;else{if(!(e instanceof Ll))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ll.convert(e)):this.extend(Un.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Un.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new Un(c.lng,c.lat),this._ne=new Un(h.lng,h.lat)),this}getCenter(){return new Un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Un(this.getWest(),this.getNorth())}getSouthEast(){return new Un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:a}=Un.convert(e),c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof Ll?e:new Ll(e)}}var RC={};(function(t,e){(function(n){function a(h,m,y){var x=c(256*h,256*(m=Math.pow(2,y)-m-1),y),w=c(256*(h+1),256*(m+1),y);return x[0]+","+x[1]+","+w[0]+","+w[1]}function c(h,m,y){var x=2*Math.PI*6378137/256/Math.pow(2,y);return[h*x-2*Math.PI*6378137/2,m*x-2*Math.PI*6378137/2]}n.getURL=function(h,m,y,x,w,C){return C=C||{},h+"?"+["bbox="+a(y,x,w),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+m].join("&")},n.getTileBBox=a,n.getMercCoords=c,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,RC);var b3=RC;class _u{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Sp(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let a=b3.getTileBBox(this.x,this.y,this.z),c=function(h,m,y){let x,w="";for(let C=h;C>0;C--)x=1<<C-1,w+=(m&x?1:0)+(y&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kC{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Sp(e,n.z,n.z,n.x,n.y)}}class Vr{constructor(e,n,a,c,h){this.overscaledZ=e,this.wrap=n,this.canonical=new _u(a,+c,+h),this.key=n===0&&e===a?this.canonical.key:Sp(n,e,a,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Vr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Sp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let a=this.canonical.z-e;return Sp(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Vr(n,this.wrap,n,a,c),new Vr(n,this.wrap,n,a+1,c),new Vr(n,this.wrap,n,a,c+1),new Vr(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Sp(t,e,n,a,c){let h=1<<Math.min(n,22),m=h*(c%h)+a%h;return t&&n<22&&(m+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}let w3=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Vr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Vr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Vr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Vr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];It(_u,"CanonicalTileID"),It(Vr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let D3=0,C3=25.5;function ex(t){return Jv*Math.cos(t*Math.PI/180)}function Ul(t){return(180+t)/360}function qa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function fo(t,e){return t/ex(e)}function Bo(t){return 360*t-180}function kr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function BC(t,e){return t*ex(kr(e))}let tr=85.051129;function NC(t){return Math.cos(kn(Cn(t,-tr,tr)))}function yu(t,e){let n=Cn(e,D3,C3),a=Math.pow(2,n);return NC(t)*Jv/(512*a)}function LC(t){return 1/Math.cos(t*Math.PI/180)}function fg(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/pt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/pt/(1<<t.z)}class jr{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){let a=Un.convert(e);return new jr(Ul(a.lng),qa(a.lat),fo(n,a.lat))}toLngLat(){return new Un(Bo(this.x),kr(this.y))}toAltitude(){return BC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jv*LC(kr(this.y))}}function tx(t,e,n,a,c,h,m,y,x){let w=(e+a)/2,C=(n+c)/2,A=new ft(w,C);y(A),function(S,F,R,B,z,j){let Q=R-z,J=B-j;return Math.abs((B-F)*Q-(R-S)*J)/Math.hypot(Q,J)}(A.x,A.y,h.x,h.y,m.x,m.y)>=x?(tx(t,e,n,w,C,h,A,y,x),tx(t,w,C,a,c,A,m,y,x)):t.push(m)}function UC(t,e,n){let a=t[0],c=a.x,h=a.y;e(a);let m=[a];for(let y=1;y<t.length;y++){let x=t[y],{x:w,y:C}=x;e(x),tx(m,c,h,w,C,a,x,e,n),c=w,h=C,a=x}return m}function nx(t,e,n,a){if(a(e,n)){let c=e.add(n)._mult(.5);nx(t,e,c,a),nx(t,c,n,a)}else t.push(n)}function E3(t,e){let n=t[0],a=[n];for(let c=1;c<t.length;c++){let h=t[c];nx(a,n,h,e),n=h}return a}let ix=Math.pow(2,14)-1,zC=-ix-1;function A3(t,e){let n=Math.round(t.x*e),a=Math.round(t.y*e);return t.x=Cn(n,zC,ix),t.y=Cn(a,zC,ix),(n<t.x||n>t.x+1||a<t.y||a>t.y+1)&&Gi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Wa(t,e,n){let a=t.loadGeometry(),c=t.extent,h=pt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:y,x,y:w,projection:C}=n,A=S=>{let F=Bo((e.x+S.x/c)/m),R=kr((e.y+S.y/c)/m),B=C.project(F,R);S.x=(B.x*y-x)*c,S.y=(B.y*y-w)*c};for(let S=0;S<a.length;S++)if(t.type!==1)a[S]=UC(a[S],A,1);else{let F=[];for(let R of a[S])R.x<0||R.x>=c||R.y<0||R.y>=c||(A(R),F.push(R));a[S]=F}}for(let m of a)for(let y of m)A3(y,h);return a}function zl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Wa(t):[]}}function pg(t,e,n,a,c){t.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}function mg(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class rx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Or,this.indexArray=new yr,this.segments=new er,this.programConfigurations=new Nl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,c){let h=this.layers[0],m=[],y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(let{feature:w,id:C,index:A,sourceLayerIndex:S}of e){let F=this.layers[0]._featureFilter.needGeometry,R=zl(w,F);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),R,a))continue;let B=y?y.evaluate(R,{},a):void 0,z={id:C,properties:w.properties,type:w.type,sourceLayerIndex:S,index:A,geometry:F?R.geometry:Wa(w,a,c),patterns:{},sortKey:B};m.push(z)}y&&m.sort((w,C)=>w.sortKey-C.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new is,x=c.projection);for(let w of m){let{geometry:C,index:A,sourceLayerIndex:S}=w,F=e[A].feature;this.addFeature(w,C,A,n.availableImages,a,x,n.brightness),n.featureIndex.insert(F,C,A,S,this.index)}}update(e,n,a,c,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,m?this.stateDependentLayers:this.layers,a,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,u3.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,c,h,m,y){for(let x of n)for(let w of x){let C=w.x,A=w.y;if(C<0||C>=pt||A<0||A>=pt)continue;if(m){let R=m.projectTilePoint(C,A,h),B=m.upVector(h,C,A),z=this.globeExtVertexArray;mg(z,R,B),mg(z,R,B),mg(z,R,B),mg(z,R,B)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=S.vertexLength;pg(this.layoutVertexArray,C,A,-1,-1),pg(this.layoutVertexArray,C,A,1,-1),pg(this.layoutVertexArray,C,A,1,1),pg(this.layoutVertexArray,C,A,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,h,y)}}function ox(t,e){for(let n=0;n<t.length;n++)if(vu(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(vu(t,e[n]))return!0;return!!sx(t,e)}function T3(t,e,n){return!!vu(t,e)||!!ax(e,t,n)}function VC(t,e){if(t.length===1)return GC(e,t[0]);for(let n=0;n<e.length;n++){let a=e[n];for(let c=0;c<a.length;c++)if(vu(t,a[c]))return!0}for(let n=0;n<t.length;n++)if(GC(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(sx(t,e[n]))return!0;return!1}function S3(t,e,n){if(t.length>1){if(sx(t,e))return!0;for(let a=0;a<e.length;a++)if(ax(e[a],t,n))return!0}for(let a=0;a<t.length;a++)if(ax(t[a],e,n))return!0;return!1}function sx(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let a=t[n],c=t[n+1];for(let h=0;h<e.length-1;h++)if(I3(a,c,e[h],e[h+1]))return!0}return!1}function I3(t,e,n,a){return Js(t,n,a)!==Js(e,n,a)&&Js(t,e,n)!==Js(t,e,a)}function ax(t,e,n){let a=n*n;if(e.length===1)return t.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(jC(t,e[c-1],e[c])<a)return!0;return!1}function jC(t,e,n){let a=e.distSqr(n);if(a===0)return t.distSqr(e);let c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/a;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function GC(t,e){let n,a,c,h=!1;for(let m=0;m<t.length;m++){n=t[m];for(let y=0,x=n.length-1;y<n.length;x=y++)a=n[y],c=n[x],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(h=!h)}return h}function vu(t,e){let n=!1;for(let a=0,c=t.length-1;a<t.length;c=a++){let h=t[a],m=t[c];h.y>e.y!=m.y>e.y&&e.x<(m.x-h.x)*(e.y-h.y)/(m.y-h.y)+h.x&&(n=!n)}return n}function HC(t,e,n,a,c){for(let m of t)if(e<=m.x&&n<=m.y&&a>=m.x&&c>=m.y)return!0;let h=[new ft(e,n),new ft(e,c),new ft(a,c),new ft(a,n)];if(t.length>2){for(let m of h)if(vu(t,m))return!0}for(let m=0;m<t.length-1;m++)if(M3(t[m],t[m+1],h))return!0;return!1}function M3(t,e,n){let a=n[0],c=n[2];if(t.x<a.x&&e.x<a.x||t.x>c.x&&e.x>c.x||t.y<a.y&&e.y<a.y||t.y>c.y&&e.y>c.y)return!1;let h=Js(t,e,n[0]);return h!==Js(t,e,n[1])||h!==Js(t,e,n[2])||h!==Js(t,e,n[3])}function td(t,e,n,a,c,h){let m=e.y-t.y,y=t.x-e.x;if(h=h||0){let x=m*m+y*y;if(x===0)return!0;let w=Math.sqrt(x);m/=w,y/=w}return!((n.x-t.x)*m+(n.y-t.y)*y-h<0||(a.x-t.x)*m+(a.y-t.y)*y-h<0||(c.x-t.x)*m+(c.y-t.y)*y-h<0)}function lx(t,e,n,a,c,h,m){return!(td(t,e,a,c,h,m)||td(e,n,a,c,h,m)||td(n,t,a,c,h,m)||td(a,c,t,e,n,m)||td(c,h,t,e,n,m)||td(h,a,t,e,n,m))}function nd(t,e,n){let a=e.paint.get(t).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(t)}function gg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function $C(t,e,n,a,c){if(!e[0]&&!e[1])return t;let h=ft.convert(e)._mult(c);n==="viewport"&&h._rotate(-a);let m=[];for(let y=0;y<t.length;y++)m.push(t[y].sub(h));return m}function qC(t,e,n,a){let c=ft.convert(t)._mult(a);return e==="viewport"&&c._rotate(-n),c}It(rx,"CircleBucket",{omit:["layers"]});let F3=new be({"circle-sort-key":new De(oe.layout_circle["circle-sort-key"]),visibility:new _e(oe.layout_circle.visibility)});var P3={paint:new be({"circle-radius":new De(oe.paint_circle["circle-radius"]),"circle-color":new De(oe.paint_circle["circle-color"]),"circle-blur":new De(oe.paint_circle["circle-blur"]),"circle-opacity":new De(oe.paint_circle["circle-opacity"]),"circle-translate":new _e(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new _e(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _e(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _e(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new De(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new De(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new De(oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new _e(oe.paint_circle["circle-emissive-strength"])}),layout:F3};class cx{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){let c=r.Q.dot(n,this.dir);if(Math.abs(c)<1e-6)return!1;let h=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,n,a){if(r.Q.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;let[c,h,m]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],C=c*c+h*h+m*m,A=2*(y*c+x*h+w*m),S=A*A-4*C*(y*y+x*x+w*w-n*n);if(S<0){let F=Math.max(-A/2,0),R=y+c*F,B=x+h*F,z=w+m*F,j=Math.hypot(R,B,z);return a[0]=R*n/j,a[1]=B*n/j,a[2]=z*n/j,!1}{let F=(-A-Math.sqrt(S))/(2*C);if(F<0){let R=Math.hypot(y,x,w);return a[0]=y*n/R,a[1]=x*n/R,a[2]=w*n/R,!1}return a[0]=y+c*F,a[1]=x+h*F,a[2]=w+m*F,!0}}}class ux{constructor(e,n,a,c,h){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=h}static fromInvProjectionMatrix(e,n,a){let c=[-1,1,1],h=[1,1,1],m=[1,-1,1],y=[-1,-1,1],x=r.Q.transformMat4(c,c,e),w=r.Q.transformMat4(h,h,e),C=r.Q.transformMat4(m,m,e),A=r.Q.transformMat4(y,y,e);return new ux(x,w,C,A,n/a)}}function Ip(t,e,n){let a=1/0,c=-1/0,h=[];for(let m of t){r.Q.sub(h,m,e);let y=r.Q.dot(h,n);a=Math.min(a,y),c=Math.max(c,y)}return[a,c]}function WC(t,e){let n=!0;for(let a=0;a<t.planes.length;a++){let c=t.planes[a],h=0;for(let m=0;m<e.length;m++)h+=r.Q.dot(c,e[m])+c[3]>=0;if(h===0)return 0;h!==e.length&&(n=!1)}return n?2:1}function ZC(t,e){for(let n of t.projections){let a=Ip(e,t.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function QC(t,e){let n=0,a=[0,0,0,0];for(let c=0;c<t.length;c++)a[0]=t[c][0],a[1]=t[c][1],a[2]=t[c][2],a[3]=1,r.aa.dot(a,e)>=0&&n++;return n}class hx{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Oi.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.Q.sub([],this.points[2],this.points[3]),r.Q.sub([],this.points[0],this.points[3]),r.Q.sub([],this.points[4],this.points[0]),r.Q.sub([],this.points[5],this.points[1]),r.Q.sub([],this.points[6],this.points[2]),r.Q.sub([],this.points[7],this.points[3])];for(let a of this.frustumEdges){let c=[0,-a[2],a[1]],h=[a[2],0,-a[0]];this.projections.push({axis:c,projection:Ip(this.points,this.points[0],c)}),this.projections.push({axis:h,projection:Ip(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,n,a,c){let h=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let C=r.aa.transformMat4([],w,e),A=1/C[3]/n*h;return r.aa.mul(C,C,[A,A,c?1/C[3]:A,A])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let C=r.Q.sub([],m[w[0]],m[w[1]]),A=r.Q.sub([],m[w[2]],m[w[1]]),S=r.Q.normalize([],r.Q.cross([],C,A)),F=-r.Q.dot(S,m[w[1]]);return S.concat(F)}),x=[];for(let w=0;w<m.length;w++)x.push([m[w][0],m[w][1],m[w][2]]);return new hx(x,y)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!QC(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!QC(e,this.planes[c]))return 0;for(let c of a)for(let h of this.frustumEdges){let m=r.Q.cross([],c,h),y=r.Q.length(m);if(y===0)continue;r.Q.scale(m,m,1/y);let x=Ip(this.points,this.points[0],m),w=Ip(e,this.points[0],m);if(x[0]>w[1]||w[0]>x[1])return 0}return 1}}class Oi{static fromPoints(e){let n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let c of e)r.Q.min(n,n,c),r.Q.max(a,a,c);return new Oi(n,a)}static fromTileIdAndHeight(e,n,a){let c=1<<e.canonical.z,h=e.canonical.x,m=e.canonical.y;return new Oi([h/c,m/c,n],[(h+1)/c,(m+1)/c,a])}static applyTransform(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)r.Q.transformMat4(a[c],a[c],n);return Oi.fromPoints(a)}static projectAabbCorners(e,n){let a=e.getCorners();for(let c=0;c<a.length;++c)r.Q.transformMat4(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=r.Q.scale([],r.Q.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],a=r.Q.clone(this.min),c=r.Q.clone(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],c[h]=n[h]?this.center[h]:this.max[h];return c[2]=this.max[2],new Oi(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?WC(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?WC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?ZC(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?ZC(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}It(Oi,"Aabb");let O3=an([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_g}=O3,R3=an([{name:"a_pos_3",components:3,type:"Int16"}]);var YC=an([{name:"a_pos",type:"Int16",components:2}]);function yg(t){return t*ho/ed}let k3=[new Oi([xs,xs,xs],[bs,bs,bs]),new Oi([xs,xs,xs],[0,0,bs]),new Oi([0,xs,xs],[bs,0,bs]),new Oi([xs,0,xs],[0,bs,bs]),new Oi([0,0,xs],[bs,bs,bs])];function XC(t,e,n,a=!0){let c=r.Q.scale([],t._camera.position,t.worldSize),h=[e,n,1,1];r.aa.transformMat4(h,h,t.pixelMatrixInverse),r.aa.scale(h,h,1/h[3]);let m=r.Q.sub([],h,c),y=r.Q.normalize([],m),x=t.globeMatrix,w=[x[12],x[13],x[14]],C=r.Q.sub([],w,c),A=r.Q.length(C),S=r.Q.normalize([],C),F=t.worldSize/(2*Math.PI),R=r.Q.dot(S,y),B=Math.asin(F/A);if(B<Math.acos(R)){if(!a)return null;let Ee=[],Ne=[];r.Q.scale(Ee,y,A/R),r.Q.normalize(Ne,r.Q.sub(Ne,Ee,C)),r.Q.normalize(y,r.Q.add(y,C,r.Q.scale(y,Ne,Math.tan(B)*A)))}let z=[];new cx(c,y).closestPointOnSphere(w,F,z);let j=r.Q.normalize([],Ma(x,0)),Q=r.Q.normalize([],Ma(x,1)),J=r.Q.normalize([],Ma(x,2)),X=r.Q.dot(j,z),ue=r.Q.dot(Q,z),ne=r.Q.dot(J,z),de=Zr(Math.asin(-ue/F)),ge=Zr(Math.atan2(X,ne));ge=t.center.lng+function(Ee,Ne){let Be=(Ne-Ee+180)%360-180;return Be<-180?Be+360:Be}(t.center.lng,ge);let we=Ul(ge),Oe=Cn(qa(de),0,1);return new jr(we,Oe)}class B3{constructor(e,n,a){this.a=r.Q.sub([],e,a),this.b=r.Q.sub([],n,a),this.center=a;let c=r.Q.normalize([],this.a),h=r.Q.normalize([],this.b);this.angle=Math.acos(r.Q.dot(c,h))}}function dx(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(a,c,h,m){let y=Math.sin(h);return a*(Math.sin((1-m)*h)/y)+c*(Math.sin(m*h)/y)}(t.a[e],t.b[e],t.angle,Cn(n,0,1))+t.center[e]}function ha(t){if(t.z<=1)return k3[t.z+2*t.y+t.x];let e=fx(vg(t));return Oi.fromPoints(e)}function Za(t,e,n){return r.Q.scale(t,t,1-n),r.Q.scaleAndAdd(t,t,e,n)}function KC(t,e,n){for(let a of t)r.Q.transformMat4(a,a,e),r.Q.scale(a,a,n)}function JC(t,e,n,a){let c=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){let we=ha(n).getCorners();return KC(we,h,c),Oi.fromPoints(we)}let m=vg(n,a),y=fx(m,ho+yg(t._tileCoverLift));KC(y,h,c);let x=Number.MAX_VALUE,w=[-x,-x,-x],C=[x,x,x];if(m.contains(t.center)){for(let Ee of y)r.Q.min(C,C,Ee),r.Q.max(w,w,Ee);w[2]=0;let we=t.point,Oe=[we.x*c,we.y*c,0];return r.Q.min(C,C,Oe),r.Q.max(w,w,Oe),new Oi(C,w)}if(t._tileCoverLift>0){for(let we of y)r.Q.min(C,C,we),r.Q.max(w,w,we);return new Oi(C,w)}let A=[h[12]*c,h[13]*c,h[14]*c],S=m.getCenter(),F=Cn(t.center.lat,-tr,tr),R=Cn(S.lat,-tr,tr),B=Ul(t.center.lng),z=qa(F),j=B-Ul(S.lng),Q=z-qa(R);j>.5?j-=1:j<-.5&&(j+=1);let J=0;if(Math.abs(j)>Math.abs(Q))J=j>=0?1:3;else{J=Q>=0?0:2;let we=[h[4]*c,h[5]*c,h[6]*c],Oe=-Math.sin(kn(Q>=0?m.getSouth():m.getNorth()))*ho;r.Q.scaleAndAdd(A,A,we,Oe)}let X=y[J],ue=y[(J+1)%4],ne=new B3(X,ue,A),de=[dx(ne,0)||X[0],dx(ne,1)||X[1],dx(ne,2)||X[2]],ge=Vl(t.zoom);if(ge>0){let we=function({x:Ee,y:Ne,z:Be},Re,We,Ge,Je){let Ke=1/(1<<Be),Le=Ee*Ke,Ft=Le+Ke,Et=Ne*Ke,tt=Et+Ke,Ht=0,Nt=(Le+Ft)/2-Ge;return Nt>.5?Ht=-1:Nt<-.5&&(Ht=1),Le=((Le+Ht)*Re-(Ge*=Re))*We+Ge,Ft=((Ft+Ht)*Re-Ge)*We+Ge,Et=(Et*Re-(Je*=Re))*We+Je,tt=(tt*Re-Je)*We+Je,[[Le,tt,0],[Ft,tt,0],[Ft,Et,0],[Le,Et,0]]}(n,e,t._pixelsPerMercatorPixel,B,z);for(let Ee=0;Ee<y.length;Ee++)Za(y[Ee],we[Ee],ge);let Oe=r.Q.add([],we[J],we[(J+1)%4]);r.Q.scale(Oe,Oe,.5),Za(de,Oe,ge)}for(let we of y)r.Q.min(C,C,we),r.Q.max(w,w,we);return C[2]=Math.min(X[2],ue[2]),r.Q.min(C,C,de),r.Q.max(w,w,de),new Oi(C,w)}function vg({x:t,y:e,z:n},a=!1){let c=1/(1<<n),h=new Un(Bo(t*c),e===(1<<n)-1&&a?-90:kr((e+1)*c)),m=new Un(Bo((t+1)*c),e===0&&a?90:kr(e*c));return new Ll(h,m)}function fx(t,e=ho){let n=kn(t.getNorth()),a=kn(t.getSouth()),c=Math.cos(n),h=Math.cos(a),m=Math.sin(n),y=Math.sin(a),x=t.getWest(),w=t.getEast();return[Jh(h,y,x,e),Jh(h,y,w,e),Jh(c,m,w,e),Jh(c,m,x,e)]}function Mp(t,e,n,a){let c=1<<n.z,h=(t/pt+n.x)/c;return gu(kr((e/pt+n.y)/c),Bo(h),a)}function xg({min:t,max:e}){return x3/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let eE=new Float64Array(16);function bg(t){let e=xg(t),n=r.a9.fromScaling(eE,[e,e,e]);return r.a9.translate(n,n,r.Q.negate([],t.min))}function px(t){let e=r.a9.fromTranslation(eE,t.min),n=1/xg(t);return r.a9.scale(e,e,[n,n,n])}function mx(t){let e=pt/(2*Math.PI);return t/(2*Math.PI)/e}function tE(t,e){return pt/(512*Math.pow(2,t))*xg(ha(e))}function nE(t,e,n,a,c){let h=mx(n),m=[t,e,-n/(2*Math.PI)],y=r.a9.identity(new Float64Array(16));return r.a9.translate(y,y,m),r.a9.scale(y,y,[h,h,h]),r.a9.rotateX(y,y,kn(-c)),r.a9.rotateY(y,y,kn(-a)),y}function Vl(t){return Ec(Xv,OC,t)}function iE(t,e){let n=gu(e.lat,e.lng),a=function(h){let m=gu(h._center.lat,h._center.lng),y=r.Q.fromValues(0,1,0),x=r.Q.cross([],y,m),w=r.a9.fromRotation([],-h.angle,m);x=r.Q.transformMat4(x,x,w),r.a9.fromRotation(w,-h._pitch,x);let C=r.Q.normalize([],m);return r.Q.scale(C,C,yg(h.cameraToCenterDistance/h.pixelsPerMeter)),r.Q.transformMat4(C,C,w),r.Q.add([],m,C)}(t),c=r.Q.subtract([],a,n);return r.Q.angle(c,n)}function gx(t,e){return iE(t,e)>Math.PI/2*1.01}let rE=kn(85),N3=Math.cos(rE),L3=Math.sin(rE),U3=r.a9.create(),oE=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function sE(t,e,n,a,c,h,m,y,x){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(x*=t.pixelToTileUnitsFactor);let w=t.tileID.canonical,C=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let A of e)for(let S of A){let F=S.add(y),R=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(F.x,F.y,!0):0,B=n.projection.projectTilePoint(F.x,F.y,w);if(R>0){let J=n.projection.upVector(w,F.x,F.y);B.x+=J[0]*C*R,B.y+=J[1]*C*R,B.z+=J[2]*C*R}let z=h?F:z3(B.x,B.y,B.z,a),j=h?t.tilespaceRays.map(J=>j3(J,R)):t.queryGeometry.screenGeometry,Q=r.aa.transformMat4([],[B.x,B.y,B.z,1],a);if(!m&&h?x*=Q[3]/n.cameraToCenterDistance:m&&!h&&(x*=n.cameraToCenterDistance/Q[3]),h){let J=kr((S.y/pt+w.y)/(1<<w.z));x/=n.projection.pixelsPerMeter(J,1)/fo(1,J)}if(T3(j,z,x))return!0}return!1}function z3(t,e,n,a){let c=r.aa.transformMat4([],[t,e,n,1],a);return new ft(c[0]/c[3],c[1]/c[3])}let aE=r.Q.fromValues(0,0,0),V3=r.Q.fromValues(0,0,1);function j3(t,e){let n=r.Q.create();return aE[2]=e,t.intersectsPlane(aE,V3,n),new ft(n[0],n[1])}class lE extends rx{}function cE(t,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return t.width=e,t.height=n,t.data=c,t}function uE(t,e,n){let{width:a,height:c}=e;a===t.width&&c===t.height||(_x(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,a),height:Math.min(t.height,c)},n),t.width=a,t.height=c,t.data=e.data)}function _x(t,e,n,a,c,h,m){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,x=e.data,w=h===4&&m;for(let C=0;C<c.height;C++){let A=((n.y+C)*t.width+n.x)*h,S=((a.y+C)*e.width+a.x)*h;if(w)for(let F=0;F<c.width;F++){let R=A+F*h+3,B=S+F*h;x[B+0]=255,x[B+1]=255,x[B+2]=255,x[B+3]=y[R]}else for(let F=0;F<c.width*h;F++)x[S+F]=y[A+F]}return e}It(lE,"HeatmapBucket",{omit:["layers"]});class jl{constructor(e,n){cE(this,e,1,n)}resize(e){uE(this,new jl(e),1)}clone(){return new jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,h){_x(e,n,a,c,h,1)}}class rs{constructor(e,n){cE(this,e,4,n)}resize(e){uE(this,new rs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,h,m){_x(e,n,a,c,h,4,m)}}class hE{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}It(jl,"AlphaImage"),It(rs,"RGBAImage");let G3=new be({visibility:new _e(oe.layout_heatmap.visibility)});var H3={paint:new be({"heatmap-radius":new De(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new De(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _e(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xe(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _e(oe.paint_heatmap["heatmap-opacity"])}),layout:G3};function Fp(t){let e={},n=t.resolution||256,a=t.clips?t.clips.length:1,c=t.image||new rs({width:n,height:a}),h=(m,y,x)=>{e[t.evaluationKey]=x;let w=t.expression.evaluate(e);w&&(c.data[m+y+0]=Math.floor(255*w.r/w.a),c.data[m+y+1]=Math.floor(255*w.g/w.a),c.data[m+y+2]=Math.floor(255*w.b/w.a),c.data[m+y+3]=Math.floor(255*w.a))};if(t.clips)for(let m=0,y=0;m<a;++m,y+=4*n)for(let x=0,w=0;x<n;x++,w+=4){let C=x/(n-1),{start:A,end:S}=t.clips[m];h(y,w,A*(1-C)+S*C)}else for(let m=0,y=0;m<n;m++,y+=4)h(0,y,m/(n-1));return c}let $3=new be({visibility:new _e(oe.layout_hillshade.visibility)});var q3={paint:new be({"hillshade-illumination-direction":new _e(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _e(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _e(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _e(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _e(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _e(oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new _e(oe.paint_hillshade["hillshade-emissive-strength"])}),layout:$3};let W3=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z3}=W3;var yx={exports:{}};function wg(t,e,n){n=n||2;var a,c,h,m,y,x,w,C=e&&e.length,A=C?e[0]*n:t.length,S=dE(t,0,A,n,!0),F=[];if(!S||S.next===S.prev)return F;if(C&&(S=function(B,z,j,Q){var J,X,ue,ne=[];for(J=0,X=z.length;J<X;J++)(ue=dE(B,z[J]*Q,J<X-1?z[J+1]*Q:B.length,Q,!1))===ue.next&&(ue.steiner=!0),ne.push(nk(ue));for(ne.sort(J3),J=0;J<ne.length;J++)j=ek(ne[J],j);return j}(t,e,S,n)),t.length>80*n){a=h=t[0],c=m=t[1];for(var R=n;R<A;R+=n)(y=t[R])<a&&(a=y),(x=t[R+1])<c&&(c=x),y>h&&(h=y),x>m&&(m=x);w=(w=Math.max(h-a,m-c))!==0?32767/w:0}return Pp(S,F,n,a,c,w,0),F}function dE(t,e,n,a,c){var h,m;if(c===bx(t,e,n,a)>0)for(h=e;h<n;h+=a)m=mE(h,t[h],t[h+1],m);else for(h=n-a;h>=e;h-=a)m=mE(h,t[h],t[h+1],m);return m&&Dg(m,m.next)&&(Rp(m),m=m.next),m}function xu(t,e){if(!t)return t;e||(e=t);var n,a=t;do if(n=!1,a.steiner||!Dg(a,a.next)&&hr(a.prev,a,a.next)!==0)a=a.next;else{if(Rp(a),(a=e=a.prev)===a.next)break;n=!0}while(n||a!==e);return e}function Pp(t,e,n,a,c,h,m){if(t){!m&&h&&function(C,A,S,F){var R=C;do R.z===0&&(R.z=vx(R.x,R.y,A,S,F)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==C);R.prevZ.nextZ=null,R.prevZ=null,function(B){var z,j,Q,J,X,ue,ne,de,ge=1;do{for(j=B,B=null,X=null,ue=0;j;){for(ue++,Q=j,ne=0,z=0;z<ge&&(ne++,Q=Q.nextZ);z++);for(de=ge;ne>0||de>0&&Q;)ne!==0&&(de===0||!Q||j.z<=Q.z)?(J=j,j=j.nextZ,ne--):(J=Q,Q=Q.nextZ,de--),X?X.nextZ=J:B=J,J.prevZ=X,X=J;j=Q}X.nextZ=null,ge*=2}while(ue>1)}(R)}(t,a,c,h);for(var y,x,w=t;t.prev!==t.next;)if(y=t.prev,x=t.next,h?Y3(t,a,c,h):Q3(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),Rp(t),t=x.next,w=x.next;else if((t=x)===w){m?m===1?Pp(t=X3(xu(t),e,n),e,n,a,c,h,2):m===2&&K3(t,e,n,a,c,h):Pp(xu(t),e,n,a,c,h,1);break}}}function Q3(t){var e=t.prev,n=t,a=t.next;if(hr(e,n,a)>=0)return!1;for(var c=e.x,h=n.x,m=a.x,y=e.y,x=n.y,w=a.y,C=c<h?c<m?c:m:h<m?h:m,A=y<x?y<w?y:w:x<w?x:w,S=c>h?c>m?c:m:h>m?h:m,F=y>x?y>w?y:w:x>w?x:w,R=a.next;R!==e;){if(R.x>=C&&R.x<=S&&R.y>=A&&R.y<=F&&id(c,y,h,x,m,w,R.x,R.y)&&hr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Y3(t,e,n,a){var c=t.prev,h=t,m=t.next;if(hr(c,h,m)>=0)return!1;for(var y=c.x,x=h.x,w=m.x,C=c.y,A=h.y,S=m.y,F=y<x?y<w?y:w:x<w?x:w,R=C<A?C<S?C:S:A<S?A:S,B=y>x?y>w?y:w:x>w?x:w,z=C>A?C>S?C:S:A>S?A:S,j=vx(F,R,e,n,a),Q=vx(B,z,e,n,a),J=t.prevZ,X=t.nextZ;J&&J.z>=j&&X&&X.z<=Q;){if(J.x>=F&&J.x<=B&&J.y>=R&&J.y<=z&&J!==c&&J!==m&&id(y,C,x,A,w,S,J.x,J.y)&&hr(J.prev,J,J.next)>=0||(J=J.prevZ,X.x>=F&&X.x<=B&&X.y>=R&&X.y<=z&&X!==c&&X!==m&&id(y,C,x,A,w,S,X.x,X.y)&&hr(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;J&&J.z>=j;){if(J.x>=F&&J.x<=B&&J.y>=R&&J.y<=z&&J!==c&&J!==m&&id(y,C,x,A,w,S,J.x,J.y)&&hr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;X&&X.z<=Q;){if(X.x>=F&&X.x<=B&&X.y>=R&&X.y<=z&&X!==c&&X!==m&&id(y,C,x,A,w,S,X.x,X.y)&&hr(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function X3(t,e,n){var a=t;do{var c=a.prev,h=a.next.next;!Dg(c,h)&&fE(c,a,a.next,h)&&Op(c,h)&&Op(h,c)&&(e.push(c.i/n|0),e.push(a.i/n|0),e.push(h.i/n|0),Rp(a),Rp(a.next),a=t=h),a=a.next}while(a!==t);return xu(a)}function K3(t,e,n,a,c,h){var m=t;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&ik(m,y)){var x=pE(m,y);return m=xu(m,m.next),x=xu(x,x.next),Pp(m,e,n,a,c,h,0),void Pp(x,e,n,a,c,h,0)}y=y.next}m=m.next}while(m!==t)}function J3(t,e){return t.x-e.x}function ek(t,e){var n=function(c,h){var m,y=h,x=c.x,w=c.y,C=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var A=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(A<=x&&A>C&&(C=A,m=y.x<y.next.x?y:y.next,A===x))return m}y=y.next}while(y!==h);if(!m)return null;var S,F=m,R=m.x,B=m.y,z=1/0;y=m;do x>=y.x&&y.x>=R&&x!==y.x&&id(w<B?x:C,w,R,B,w<B?C:x,w,y.x,y.y)&&(S=Math.abs(w-y.y)/(x-y.x),Op(y,c)&&(S<z||S===z&&(y.x>m.x||y.x===m.x&&tk(m,y)))&&(m=y,z=S)),y=y.next;while(y!==F);return m}(t,e);if(!n)return e;var a=pE(n,t);return xu(a,a.next),xu(n,n.next)}function tk(t,e){return hr(t.prev,t,e.prev)<0&&hr(e.next,t,t.next)<0}function vx(t,e,n,a,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nk(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function id(t,e,n,a,c,h,m,y){return(c-m)*(e-y)>=(t-m)*(h-y)&&(t-m)*(a-y)>=(n-m)*(e-y)&&(n-m)*(h-y)>=(c-m)*(a-y)}function ik(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,a){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&fE(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(Op(t,e)&&Op(e,t)&&function(n,a){var c=n,h=!1,m=(n.x+a.x)/2,y=(n.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==n);return h}(t,e)&&(hr(t.prev,t,e.prev)||hr(t,e.prev,e))||Dg(t,e)&&hr(t.prev,t,t.next)>0&&hr(e.prev,e,e.next)>0)}function hr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Dg(t,e){return t.x===e.x&&t.y===e.y}function fE(t,e,n,a){var c=Eg(hr(t,e,n)),h=Eg(hr(t,e,a)),m=Eg(hr(n,a,t)),y=Eg(hr(n,a,e));return c!==h&&m!==y||!(c!==0||!Cg(t,n,e))||!(h!==0||!Cg(t,a,e))||!(m!==0||!Cg(n,t,a))||!(y!==0||!Cg(n,e,a))}function Cg(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Eg(t){return t>0?1:t<0?-1:0}function Op(t,e){return hr(t.prev,t,t.next)<0?hr(t,e,t.next)>=0&&hr(t,t.prev,e)>=0:hr(t,e,t.prev)<0||hr(t,t.next,e)<0}function pE(t,e){var n=new xx(t.i,t.x,t.y),a=new xx(e.i,e.x,e.y),c=t.next,h=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,a.next=n,n.prev=a,h.next=a,a.prev=h,a}function mE(t,e,n,a){var c=new xx(t,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Rp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function xx(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bx(t,e,n,a){for(var c=0,h=e,m=n-a;h<n;h+=a)c+=(t[m]-t[h])*(t[h+1]+t[m+1]),m=h;return c}yx.exports=wg,yx.exports.default=wg,wg.deviation=function(t,e,n,a){var c=e&&e.length,h=Math.abs(bx(t,0,c?e[0]*n:t.length,n));if(c)for(var m=0,y=e.length;m<y;m++)h-=Math.abs(bx(t,e[m]*n,m<y-1?e[m+1]*n:t.length,n));var x=0;for(m=0;m<a.length;m+=3){var w=a[m]*n,C=a[m+1]*n,A=a[m+2]*n;x+=Math.abs((t[w]-t[A])*(t[C+1]-t[w+1])-(t[w]-t[C])*(t[A+1]-t[w+1]))}return h===0&&x===0?0:Math.abs((x-h)/h)},wg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},a=0,c=0;c<t.length;c++){for(var h=0;h<t[c].length;h++)for(var m=0;m<e;m++)n.vertices.push(t[c][h][m]);c>0&&n.holes.push(a+=t[c-1].length)}return n};var Ag=Te(yx.exports);function wx(t,e){let n=t.length;if(n<=1)return[t];let a=[],c,h;for(let m=0;m<n;m++){let y=Tc(t[m]);y!==0&&(t[m].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(c&&a.push(c),c=[t[m]]):c.push(t[m]))}if(c&&a.push(c),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(F0(a[m],e,1,a[m].length-1,rk),a[m]=a[m].slice(0,e));return a}function rk(t,e){return e.area-t.area}function Dx(t,e,n){let a=n.patternDependencies,c=!1;for(let h of e){let m=h.paint.get(`${t}-pattern`);m.isConstant()||(c=!0);let y=m.constantOr(null);y&&(c=!0,a[y]=!0)}return c}function Cx(t,e,n,a,c){let h=c.patternDependencies;for(let m of e){let y=m.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a},n,{},c.availableImages);x=x&&x.name?x.name:x,h[x]=!0,n.patterns[m.id]=x}}return n}class Ex{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Or,this.indexArray=new yr,this.indexArray2=new ko,this.programConfigurations=new Nl(e.layers,e.zoom),this.segments=new er,this.segments2=new er,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,a,c){this.hasPattern=Dx("fill",this.layers,n);let h=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:y,id:x,index:w,sourceLayerIndex:C}of e){let A=this.layers[0]._featureFilter.needGeometry,S=zl(y,A);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),S,a))continue;let F=h?h.evaluate(S,{},a,n.availableImages):void 0,R={id:x,properties:y.properties,type:y.type,sourceLayerIndex:C,index:w,geometry:A?S.geometry:Wa(y,a,c),patterns:{},sortKey:F};m.push(R)}h&&m.sort((y,x)=>y.sortKey-x.sortKey);for(let y of m){let{geometry:x,index:w,sourceLayerIndex:C}=y;if(this.hasPattern){let A=Cx("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(A)}else this.addFeature(y,x,w,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,x,w,C,this.index)}}update(e,n,a,c,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,m?this.stateDependentLayers:this.layers,a,c,h)}addFeatures(e,n,a,c,h,m){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,c,h,m=[],y){for(let x of wx(n,500)){let w=0;for(let B of x)w+=B.length;let C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=C.vertexLength,S=[],F=[];for(let B of x){if(B.length===0)continue;B!==x[0]&&F.push(S.length/2);let z=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),j=z.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(j+B.length-1,j),S.push(B[0].x),S.push(B[0].y);for(let Q=1;Q<B.length;Q++)this.layoutVertexArray.emplaceBack(B[Q].x,B[Q].y),this.indexArray2.emplaceBack(j+Q-1,j+Q),S.push(B[Q].x),S.push(B[Q].y);z.vertexLength+=B.length,z.primitiveLength+=B.length}let R=Ag(S,F);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(A+R[B],A+R[B+1],A+R[B+2]);C.vertexLength+=w,C.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,m,c,y)}}It(Ex,"FillBucket",{omit:["layers","patternFeatures"]});let ok=new be({"fill-sort-key":new De(oe.layout_fill["fill-sort-key"]),visibility:new _e(oe.layout_fill.visibility)});var sk={paint:new be({"fill-antialias":new _e(oe.paint_fill["fill-antialias"]),"fill-opacity":new De(oe.paint_fill["fill-opacity"]),"fill-color":new De(oe.paint_fill["fill-color"]),"fill-outline-color":new De(oe.paint_fill["fill-outline-color"]),"fill-translate":new _e(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new _e(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new De(oe.paint_fill["fill-pattern"]),"fill-emissive-strength":new _e(oe.paint_fill["fill-emissive-strength"])}),layout:ok};let ak=an([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),lk=an([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ck=an([{name:"a_centroid_pos",components:2,type:"Uint16"}]),uk=an([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hk=an([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dk}=ak;var Tg={},fk=ih,gE=rd;function rd(t,e,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=a,this._values=c,t.readFields(pk,this,e)}function pk(t,e,n){t==1?e.id=n.readVarint():t==2?function(a,c){for(var h=a.readVarint()+a.pos;a.pos<h;){var m=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[m]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function mk(t){for(var e,n,a=0,c=0,h=t.length,m=h-1;c<h;m=c++)a+=((n=t[m]).x-(e=t[c]).x)*(e.y+n.y);return a}rd.types=["Unknown","Point","LineString","Polygon"],rd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,a=1,c=0,h=0,m=0,y=[];t.pos<n;){if(c<=0){var x=t.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)h+=t.readSVarint(),m+=t.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new fk(h,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},rd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,a=0,c=0,h=0,m=1/0,y=-1/0,x=1/0,w=-1/0;t.pos<e;){if(a<=0){var C=t.readVarint();n=7&C,a=C>>3}if(a--,n===1||n===2)(c+=t.readSVarint())<m&&(m=c),c>y&&(y=c),(h+=t.readSVarint())<x&&(x=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,y,w]},rd.prototype.toGeoJSON=function(t,e,n){var a,c,h=this.extent*Math.pow(2,n),m=this.extent*t,y=this.extent*e,x=this.loadGeometry(),w=rd.types[this.type];function C(F){for(var R=0;R<F.length;R++){var B=F[R];F[R]=[360*(B.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<x.length;a++)A[a]=x[a][0];C(x=A);break;case 2:for(a=0;a<x.length;a++)C(x[a]);break;case 3:for(x=function(F){var R=F.length;if(R<=1)return[F];for(var B,z,j=[],Q=0;Q<R;Q++){var J=mk(F[Q]);J!==0&&(z===void 0&&(z=J<0),z===J<0?(B&&j.push(B),B=[F[Q]]):B.push(F[Q]))}return B&&j.push(B),j}(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)C(x[a][c])}x.length===1?x=x[0]:w="Multi"+w;var S={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(S.id=this.id),S};var gk=gE,_E=yE;function yE(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(_k,this,e),this.length=this._features.length}function _k(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(a){for(var c=null,h=a.readVarint()+a.pos;a.pos<h;){var m=a.readVarint()>>3;c=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return c}(n))}yE.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new gk(this._pbf,e,this.extent,this._keys,this._values)};var yk=_E;function vk(t,e,n){if(t===3){var a=new yk(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}var Ax=Tg.VectorTile=function(t,e){this.layers=t.readFields(vk,{},e)},Sg=Tg.VectorTileFeature=gE;function Ig(t,e,n,a){let c=[],h=a===0?(m,y,x,w,C,A)=>{m.push(new ft(A,x+(A-y)/(w-y)*(C-x)))}:(m,y,x,w,C,A)=>{m.push(new ft(y+(A-x)/(C-x)*(w-y),A))};for(let m of t){let y=[];for(let x of m){if(x.length<=2)continue;let w=[];for(let S=0;S<x.length-1;S++){let F=x[S].x,R=x[S].y,B=x[S+1].x,z=x[S+1].y,j=a===0?F:R,Q=a===0?B:z;j<e?Q>e&&h(w,F,R,B,z,e):j>n?Q<n&&h(w,F,R,B,z,n):w.push(x[S]),Q<e&&j>=e&&h(w,F,R,B,z,e),Q>n&&j<=n&&h(w,F,R,B,z,n)}let C=x[x.length-1],A=a===0?C.x:C.y;A>=e&&A<=n&&w.push(C),w.length&&(C=w[w.length-1],w[0].x===C.x&&w[0].y===C.y||w.push(w[0]),y.push(w))}y.length&&c.push(y)}return c}function Mg(t,e){return t.x-e.x||t.y-e.y}function vE(t,e){return Mg(t.min,e.min)===0&&Mg(t.max,e.max)===0}function xE(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function bE(t,e,n){let a=1/pt,c=1/(1<<n.canonical.z),h=(e.x*a+n.canonical.x)*c+n.wrap,m=(e.y*a+n.canonical.y)*c;return{min:new ft((t.x*a+n.canonical.x)*c+n.wrap,(t.y*a+n.canonical.y)*c),max:new ft(h,m)}}function xk(t,e,n){let a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*pt,h=(e.y*a-n.canonical.y)*pt;return{min:new ft(((t.x-n.wrap)*a-n.canonical.x)*pt,(t.y*a-n.canonical.y)*pt),max:new ft(c,h)}}function wE(t,e,n,a,c,h,m){let y=t.indices,x=t.vertices,w=[];for(let C=a;C<a+c;C+=3){let A=e[n[C+0]+h],S=e[n[C+1]+h],F=e[n[C+2]+h],R=Math.min(A.x,S.x,F.x),B=Math.max(A.x,S.x,F.x),z=Math.min(A.y,S.y,F.y),j=Math.max(A.y,S.y,F.y);w.length=0,t.grid.query(new ft(R,z),new ft(B,j),w);for(let Q=0;Q<w.length;Q++){let J=w[Q];if(lx(x[y[3*J+0]],x[y[3*J+1]],x[y[3*J+2]],A,S,F,m))return!0}}return!1}function DE(t,e,n,a){if(!t||!n)return!1;let c=t.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<t.vertices.length)return DE(n,a,t,e);let h=e.canonical,m=a.canonical,y=Math.pow(2,m.z-h.z);c=t.vertices.map(x=>new ft((x.x+h.x*pt)*y-m.x*pt,(x.y+h.y*pt)*y-m.y*pt))}return wE(n,c,t.indices,0,t.indices.length,0,0)}Tg.VectorTileLayer=_E;class CE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function EE(t,e,n,a){let c=0,h=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(n[m]<t[m]||n[m]>e[m])return null}else{let y=1/a[m],x=(t[m]-n[m])*y,w=(e[m]-n[m])*y;if(x>w){let C=x;x=w,w=C}if(x>c&&(c=x),w<h&&(h=w),c>h)return null}return c}function AE(t,e,n,a,c,h,m,y,x,w,C){let A=a-t,S=c-e,F=h-n,R=m-t,B=y-e,z=x-n,j=C[1]*z-C[2]*B,Q=C[2]*R-C[0]*z,J=C[0]*B-C[1]*R,X=A*j+S*Q+F*J;if(Math.abs(X)<1e-15)return null;let ue=1/X,ne=w[0]-t,de=w[1]-e,ge=w[2]-n,we=(ne*j+de*Q+ge*J)*ue;if(we<0||we>1)return null;let Oe=de*F-ge*S,Ee=ge*A-ne*F,Ne=ne*S-de*A,Be=(C[0]*Oe+C[1]*Ee+C[2]*Ne)*ue;return Be<0||we+Be>1?null:(R*Oe+B*Ee+z*Ne)*ue}function TE(t,e,n){return(t-e)/(n-e)}function SE(t,e,n,a,c,h,m,y,x){let w=1<<n,C=h-a,A=m-c,S=(t+1)/w*C+a,F=(e+0)/w*A+c,R=(e+1)/w*A+c;y[0]=(t+0)/w*C+a,y[1]=F,x[0]=S,x[1]=R}class IE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(h){let m=Math.ceil(Math.log2(h.dim/8)),y=[],x=Math.ceil(Math.pow(2,m)),w=1/x,C=(F,R,B,z,j)=>{let Q=z?1:0,J=(F+1)*B-Q,X=R*B,ue=(R+1)*B-Q;j[0]=F*B,j[1]=X,j[2]=J,j[3]=ue},A=new CE(x),S=[];for(let F=0;F<x*x;F++){C(F%x,Math.floor(F/x),w,!1,S);let R=Gl(S[0],S[1],h),B=Gl(S[2],S[1],h),z=Gl(S[2],S[3],h),j=Gl(S[0],S[3],h);A.minimums.push(Math.min(R,B,z,j)),A.maximums.push(Math.max(R,B,z,j)),A.leaves.push(1)}for(y.push(A),x/=2;x>=1;x/=2){let F=y[y.length-1];A=new CE(x);for(let R=0;R<x*x;R++){C(R%x,Math.floor(R/x),2,!0,S);let B=F.getElevation(S[0],S[1]),z=F.getElevation(S[2],S[1]),j=F.getElevation(S[2],S[3]),Q=F.getElevation(S[0],S[3]),J=F.isLeaf(S[0],S[1]),X=F.isLeaf(S[2],S[1]),ue=F.isLeaf(S[2],S[3]),ne=F.isLeaf(S[0],S[3]),de=Math.min(B.min,z.min,j.min,Q.min),ge=Math.max(B.max,z.max,j.max,Q.max),we=J&&X&&ue&&ne;A.maximums.push(ge),A.minimums.push(de),A.leaves.push(ge-de<=5&&we?1:0)}y.push(A)}return y}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,h,m,y=1){return EE([e,n,-100],[a,c,this.maximums[0]*y],h,m)}raycast(e,n,a,c,h,m,y=1){if(!this.nodeCount)return null;let x=this.raycastRoot(e,n,a,c,h,m,y);if(x==null)return null;let w=[],C=[],A=[],S=[],F=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;F.length>0;){let{idx:R,t:B,nodex:z,nodey:j,depth:Q}=F.pop();if(this.leaves[R]){SE(z,j,Q,e,n,a,c,A,S);let X=1<<Q,ue=(z+0)/X,ne=(z+1)/X,de=(j+0)/X,ge=(j+1)/X,we=Gl(ue,de,this.dem)*y,Oe=Gl(ne,de,this.dem)*y,Ee=Gl(ne,ge,this.dem)*y,Ne=Gl(ue,ge,this.dem)*y,Be=AE(A[0],A[1],we,S[0],A[1],Oe,S[0],S[1],Ee,h,m),Re=AE(S[0],S[1],Ee,A[0],S[1],Ne,A[0],A[1],we,h,m),We=Math.min(Be!==null?Be:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{let Ge=r.Q.scaleAndAdd([],h,m,B);if(ME(we,Oe,Ne,Ee,TE(Ge[0],A[0],S[0]),TE(Ge[1],A[1],S[1]))>=Ge[2])return B}continue}let J=0;for(let X=0;X<this._siblingOffset.length;X++){SE((z<<1)+this._siblingOffset[X][0],(j<<1)+this._siblingOffset[X][1],Q+1,e,n,a,c,A,S),A[2]=-100,S[2]=this.maximums[this.childOffsets[R]+X]*y;let ue=EE(A,S,h,m);if(ue!=null){let ne=ue;w[X]=ne;let de=!1;for(let ge=0;ge<J&&!de;ge++)ne>=w[C[ge]]&&(C.splice(ge,0,X),de=!0);de||(C[J]=X),J++}}for(let X=0;X<J;X++){let ue=C[X];F.push({idx:this.childOffsets[R]+ue,t:w[ue],nodex:(z<<1)+this._siblingOffset[ue][0],nodey:(j<<1)+this._siblingOffset[ue][1],depth:Q+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,h){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);let m=c-1,y=e[m],x=0,w=0;for(let C=0;C<this._siblingOffset.length;C++){let A=2*n+this._siblingOffset[C][0],S=2*a+this._siblingOffset[C][1],F=y.getElevation(A,S),R=y.isLeaf(A,S),B=this._addNode(F.min,F.max,R);R&&(x|=1<<C),w||(w=B)}for(let C=0;C<this._siblingOffset.length;C++)x&1<<C||this._construct(e,2*n+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],m,w+C)}}function ME(t,e,n,a,c,h){return gn(gn(t,n,h),gn(e,a,h),c)}function Gl(t,e,n){let a=n.dim,c=Cn(t*a-.5,0,a-1),h=Cn(e*a-.5,0,a-1),m=Math.floor(c),y=Math.floor(h),x=Math.min(m+1,a-1),w=Math.min(y+1,a-1);return ME(n.get(m,y),n.get(x,y),n.get(m,w),n.get(x,w),c-m,h-y)}let bk={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function wk(t,e,n){return(256*t*256+256*e+n)/10-1e4}function Dk(t,e,n){return 256*t+e+n/256-32768}class Fg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Gi(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let h=this.dim=n.height-2,m=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<h;x++)m[this._idx(-1,x)]=m[this._idx(0,x)],m[this._idx(h,x)]=m[this._idx(h-1,x)],m[this._idx(x,-1)]=m[this._idx(x,0)],m[this._idx(x,h)]=m[this._idx(x,h-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(h,-1)]=m[this._idx(h-1,0)],m[this._idx(-1,h)]=m[this._idx(0,h-1)],m[this._idx(h,h)]=m[this._idx(h-1,h-1)]}let y=a==="terrarium"?Dk:wk;for(let x=0;x<m.length;++x){let w=4*x;this.floatView[x]=y(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=fs.now()}_buildQuadTree(){this._tree=new IE(this)}get(e,n,a=!1){a&&(e=Cn(e,-1,this.dim),n=Cn(n,-1,this.dim));let c=this._idx(e,n);return this.floatView[c]}set(e,n,a){let c=this._idx(e,n),h=this.floatView[c];return this.floatView[c]=a,a-h}static getUnpackVector(e){return bk[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let a=[0,0,0,0],c=Fg.getUnpackVector(n),h=Math.floor((e+c[3])/c[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new hE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,h=n*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:c=h-1;break;case 1:h=c+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}let x=-n*this.dim,w=-a*this.dim;for(let C=m;C<y;C++)for(let A=c;A<h;A++){let S=4*this._idx(A,C),F=4*this._idx(A+x,C+w);this.pixels[S+0]=e.pixels[F+0],this.pixels[S+1]=e.pixels[F+1],this.pixels[S+2]=e.pixels[F+2],this.pixels[S+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}It(Fg,"DEMData"),It(IE,"DemMinMaxQuadTree",{omit:["dem"]});class od{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){let c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;let h=c.dem,m=c.tileID,y=1<<n.canonical.z-m.canonical.z;return new od(c,h.dim/pt/y,[(n.canonical.x/y-m.canonical.x)*h.dim,(n.canonical.y/y-m.canonical.y)*h.dim])}tileCoordToPixel(e,n){let a=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(a);return new ft(c,h)}getElevationAt(e,n,a,c){let h=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],y=Math.floor(h),x=Math.floor(m),w=this._dem;return c=!!c,a?gn(gn(w.get(y,x,c),w.get(y,x+1,c),m-x),gn(w.get(y+1,x,c),w.get(y+1,x+1,c),m-x),h-y):w.get(y,x,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*fo(1,e)*this._dem.stride}}let Ck=Sg.types,Ek=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Ak=["fill-extrusion-flood-light-ground-radius"],Tk=Math.pow(2,13),Sk=Math.pow(2,15)-1,FE=new ft(0,1),Hl=2147483648;function kp(t,e,n,a,c,h,m,y){t.emplaceBack((e<<1)+m,(n<<1)+h,(Math.floor(a*Tk)<<1)+c,Math.round(y))}function Pg(t,e,n,a,c,h){t.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,h)}function Bp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class PE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class OE{constructor(){this.centroidXY=new ft(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ft(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ft(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ft(this.max.x-this.min.x,this.max.y-this.min.y)}}class RE{constructor(){this.acc=new ft(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===pt)&&n.x===a.x)!=((n.y===0||n.y===pt)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,gn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pt!=e.x>pt&&this.addBorderIntersection(1,gn(n.y,e.y,(pt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,gn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pt!=e.y>pt&&this.addBorderIntersection(3,gn(n.x,e.x,(pt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{let a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new ft(0,0):new ft(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function kE(t,e){let n=t.add(e)._unit(),a=Cn(t.x*n.x+t.y*n.y,-1,1);var c,h,m;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*Sk*((h=t).x*(m=e).y-h.y*m.x<0?-1:1)}let Ik=[t=>t.x<0,t=>t.x>pt,t=>t.y<0,t=>t.y>pt];function Mk(t,e,n,a){let c=[4];if(a===0)return c;n._mult(a);let h=t.sub(n),m=e.sub(n),y=[t,e,h,m];for(let x=0;x<4;x++)for(let w of y)if(Ik[x](w)){c.push(x);break}return c}class BE{constructor(e){this.vertexArray=new Yr,this.indexArray=new yr,this.programConfigurations=new Nl(e.layers,e.zoom,n=>Ak.includes(n)),this._segments=new er,this.hiddenByLandmarkVertexArray=new qv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){let h=e.length;if(h>2){let m=Math.max(0,this._segments.get().length-1),y=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[m].length),x;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{let w=e[0],C=e[1];x=kE(w.sub(e[h-1])._perp()._unit(),C.sub(w)._perp()._unit())}for(let w=0;w<h;w++){let C=w===h-1?0:w+1,A=e[w],S=e[C],F=e[C===h-1?0:C+1],R=S.sub(A)._perp()._unit(),B=kE(R,F.sub(S)._perp()._unit()),z=x,j=B;if(Tx(A,S,n)||c&&UE(A,n)&&UE(S,n)){x=B;continue}let Q=y.vertexLength;Pg(this.vertexArray,A,S,1,1,z),Pg(this.vertexArray,A,S,1,0,z),Pg(this.vertexArray,A,S,0,1,j),Pg(this.vertexArray,A,S,0,0,j),y.vertexLength+=4;let J=Mk(A,S,R,a);for(let X of J)this._segmentToGroundQuads[m].push({id:Q,region:X}),this._segmentToRegionTriCounts[m][X]+=2,y.primitiveLength+=2;x=B}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,h)=>c.region-h.region);for(let a=0;a<n;a++){let c=this._segmentToGroundQuads[a],h=e[a],m=this._segmentToRegionTriCounts[a];m.reduce((x,w)=>x+w,0);let y=0;for(let x=0;x<=4;x++){let w=m[x];if(w!==0){let C=this.regionSegments[x];C||(C=this.regionSegments[x]=new er);let A={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+y,vertexLength:h.vertexLength,primitiveLength:w};C.get().push(A)}y+=w}for(let x=0;x<c.length;x++){let w=c[x].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,h,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,h,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,lk.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,h,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,h,m)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let a=e.flags&Hl?1:0;for(let c=e.groundVertexArrayOffset;c<n;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,uk.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class Og{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new yr,this.footprintVertices=new Or,this.footprintSegments=[],this.layoutVertexArray=new Rr,this.centroidVertexArray=new TC,this.indexArray=new yr,this.programConfigurations=new Nl(e.layers,e.zoom,n=>Ek.includes(n)),this.segments=new er,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new BE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,a,c){this.features=[],this.hasPattern=Dx("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=fg(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:h,id:m,index:y,sourceLayerIndex:x}of e){let w=this.layers[0]._featureFilter.needGeometry,C=zl(h,w);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),C,a))continue;let A={id:m,sourceLayerIndex:x,index:y,geometry:w?C.geometry:Wa(h,a,c),properties:h.properties,type:h.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cx("fill-extrusion",this.layers,A,this.zoom,n)):this.addFeature(A,A.geometry,y,a,{},n.availableImages,c,n.brightness),n.featureIndex.insert(h,A.geometry,y,x,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,h,m){for(let y of this.features){let{geometry:x}=y;this.addFeature(y,x,y.index,n,a,c,h,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,h){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let y=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,y,a,c,h),this.groundEffect.update(e,n,y,a,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dk),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,hk.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ck.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,h,m,y,x){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,C=[new ft(0,0),new ft(pt,pt)],A=y.projection,S=A.name==="globe",F=Ck[e.type]==="Polygon",R=new RE;R.centroidDataIndex=this.centroidData.length;let B=new OE,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);B.height=j,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new is);let Q=wx(n,500);for(let ge=Q.length-1;ge>=0;ge--){let we=Q[ge];(we.length===0||(J=we[0]).every(Oe=>Oe.x<=0)||J.every(Oe=>Oe.x>=pt)||J.every(Oe=>Oe.y<=0)||J.every(Oe=>Oe.y>=pt))&&Q.splice(ge,1)}var J;let X;if(S)X=GE(Q,C,c);else{X=[];for(let ge of Q)X.push({polygon:ge,bounds:C})}let ue=F?this.edgeRadius:0,ne=ue>0&&this.zoom<17,de=(ge,we)=>{if(ge.length===0)return!1;let Oe=ge[ge.length-1];return we.x===Oe.x&&we.y===Oe.y};for(let{polygon:ge,bounds:we}of X){let Oe=0,Ee=0;for(let We of ge)F&&!We[0].equals(We[We.length-1])&&We.push(We[0]),Ee+=F?We.length-1:We.length;let Ne=this.segments.prepareSegment((F?5:4)*Ee,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);let Be={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Re=new PE;if(Re.vertexOffset=this.footprintVertices.length,Re.indexOffset=3*this.footprintIndices.length,Re.ringIndices=[],F){let We=[],Ge=[];Oe=Ne.vertexLength;for(let Ke=0;Ke<ge.length;Ke++){let Le=ge[Ke];Le.length&&Ke!==0&&Ge.push(We.length/2);let Ft=[],Et,tt;Et=Le[1].sub(Le[0])._perp()._unit(),Re.ringIndices.push(Le.length-1);for(let Ht=1;Ht<Le.length;Ht++){let Nt=Le[Ht],Pt=Le[Ht===Le.length-1?1:Ht+1],nt=Nt.clone();if(ue){tt=Pt.sub(Nt)._perp()._unit();let Vt=Et.add(tt)._unit(),ln=ue*Math.min(4,1/(Et.x*Vt.x+Et.y*Vt.y));nt.x+=ln*Vt.x,nt.y+=ln*Vt.y,nt.x=Math.round(nt.x),nt.y=Math.round(nt.y),Et=tt}!z||ue!==0&&!ne||de(Ft,nt)||Ft.push(nt),kp(this.layoutVertexArray,nt.x,nt.y,0,0,1,1,0),Ne.vertexLength++,this.footprintVertices.emplaceBack(Nt.x,Nt.y),We.push(Nt.x,Nt.y),S&&Bp(this.layoutVertexExtArray,A.projectTilePoint(nt.x,nt.y,c),A.upVector(c,nt.x,nt.y))}z&&(ue===0||ne)&&(Ft.length!==0&&de(Ft,Ft[0])&&Ft.pop(),this.groundEffect.addData(Ft,we,w))}let Je=Ag(We,Ge);for(let Ke=0;Ke<Je.length;Ke+=3)this.footprintIndices.emplaceBack(Re.vertexOffset+Je[Ke+0],Re.vertexOffset+Je[Ke+1],Re.vertexOffset+Je[Ke+2]),this.indexArray.emplaceBack(Oe+Je[Ke],Oe+Je[Ke+2],Oe+Je[Ke+1]),Ne.primitiveLength++;Re.indexCount+=Je.length,Re.vertexCount+=this.footprintVertices.length-Re.vertexOffset}for(let We=0;We<ge.length;We++){let Ge=ge[We];R.startRing(B,Ge[0]);let Je=Ge.length>4&&zE(Ge[Ge.length-2],Ge[0],Ge[1]),Ke=ue?Fk(Ge[Ge.length-2],Ge[0],Ge[1],ue):0,Le=[],Ft,Et,tt;Et=Ge[1].sub(Ge[0])._perp()._unit();let Ht=!0;for(let Nt=1,Pt=0;Nt<Ge.length;Nt++){let nt=Ge[Nt-1],Vt=Ge[Nt],ln=Ge[Nt===Ge.length-1?1:Nt+1];if(R.appendEdge(B,Vt,nt),Tx(Vt,nt,we)){ue&&(Et=ln.sub(Vt)._perp()._unit(),Ht=!Ht);continue}let Xt=Vt.sub(nt)._perp(),fn=Xt.x/(Math.abs(Xt.x)+Math.abs(Xt.y)),cn=Xt.y>0?1:0,bn=nt.dist(Vt);if(Pt+bn>32768&&(Pt=0),ue){tt=ln.sub(Vt)._perp()._unit();let jn=LE(nt,Vt,ln,NE(Et,tt),ue);isNaN(jn)&&(jn=0);let On=Vt.sub(nt)._unit();nt=nt.add(On.mult(Ke))._round(),Vt=Vt.add(On.mult(-jn))._round(),Ke=jn,Et=tt,z&&this.zoom>=17&&(de(Le,nt)||Le.push(nt),de(Le,Vt)||Le.push(Vt))}let Qt=Ne.vertexLength,di=Ge.length>4&&zE(nt,Vt,ln),li=VE(Pt,Je,Ht);if(kp(this.layoutVertexArray,nt.x,nt.y,fn,cn,0,0,li),kp(this.layoutVertexArray,nt.x,nt.y,fn,cn,0,1,li),Pt+=bn,li=VE(Pt,di,!Ht),Je=di,kp(this.layoutVertexArray,Vt.x,Vt.y,fn,cn,0,0,li),kp(this.layoutVertexArray,Vt.x,Vt.y,fn,cn,0,1,li),Ne.vertexLength+=4,this.indexArray.emplaceBack(Qt+0,Qt+1,Qt+2),this.indexArray.emplaceBack(Qt+1,Qt+3,Qt+2),Ne.primitiveLength+=2,ue){let jn=Oe+(Nt===1?Ge.length-2:Nt-2),On=Nt===1?Oe:jn+1;if(this.indexArray.emplaceBack(Qt+1,jn,Qt+3),this.indexArray.emplaceBack(jn,On,Qt+3),Ne.primitiveLength+=2,Ft===void 0&&(Ft=Qt),!Tx(ln,Ge[Nt],we)){let Gn=Nt===Ge.length-1?Ft:Ne.vertexLength;this.indexArray.emplaceBack(Qt+2,Qt+3,Gn),this.indexArray.emplaceBack(Qt+3,Gn+1,Gn),this.indexArray.emplaceBack(Qt+3,On,Gn+1),Ne.primitiveLength+=3}Ht=!Ht}if(S){let jn=this.layoutVertexExtArray,On=A.projectTilePoint(nt.x,nt.y,c),Gn=A.projectTilePoint(Vt.x,Vt.y,c),Ei=A.upVector(c,nt.x,nt.y),yi=A.upVector(c,Vt.x,Vt.y);Bp(jn,On,Ei),Bp(jn,On,Ei),Bp(jn,Gn,yi),Bp(jn,Gn,yi)}}F&&(Oe+=Ge.length-1),z&&ue&&this.zoom>=17&&(Le.length!==0&&de(Le,Le[0])&&Le.pop(),this.groundEffect.addData(Le,we,w,ue>0))}this.footprintSegments.push(Re),Be.triangleCount=this.indexArray.length-Be.triangleArrayOffset,this.polygonSegments.push(Be),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=R.borders?FE:this.encodeCentroid(R,B),this.centroidData.push(B),R.borders){this.featuresOnBorder.push(R);let ge=this.featuresOnBorder.length-1;for(let we=0;we<R.borders.length;we++)R.borders[we][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[we].push(ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,m,c,x),this.groundEffect.addPaintPropertiesData(e,a,h,m,c,x),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){let e=[];for(let y=0;y<this.centroidData.length;y++){let x=this.centroidData[y],w=+(x.min.y+x.max.y>pt),C=2*w+(+(x.min.x+x.max.x>pt)^w);for(let A=0;A<x.polygonSegLen;A++){let S=x.polygonSegIdx+A;e.push({centroidIdx:y,subtile:C,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let n=new yr;e.sort((y,x)=>y.triangleSegmentIdx===x.triangleSegmentIdx?y.subtile-x.subtile:y.triangleSegmentIdx-x.triangleSegmentIdx);let a=0,c=0,h=0;for(let y of e){if(y.triangleSegmentIdx!==a)break;h++}let m=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let y=0,x=c,w=c;for(let C=x;C<h&&e[C].subtile===y;C++)w++;for(;x!==h;){let C=e[x];y=C.subtile;let A=this.centroidData[C.centroidIdx].min.clone(),S=this.centroidData[C.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=x;R<w;R++){let B=e[R],z=this.polygonSegments[B.polygonSegmentIdx],j=this.centroidData[B.centroidIdx].min,Q=this.centroidData[B.centroidIdx].max,J=this.indexArray.uint16;for(let X=z.triangleArrayOffset;X<z.triangleArrayOffset+z.triangleCount;X++)n.emplaceBack(J[3*X],J[3*X+1],J[3*X+2]);F.primitiveLength+=z.triangleCount,A.x=Math.min(A.x,j.x),A.y=Math.min(A.y,j.y),S.x=Math.max(S.x,Q.x),S.y=Math.max(S.y,Q.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:A,max:S}),x=w;for(let R=x;R<h&&e[R].subtile===e[x].subtile;R++)w++}c=h;for(let C=c;C<m&&e[C].triangleSegmentIdx===e[c].triangleSegmentIdx;C++)h++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){let c=0,h=0,m=1<<e.canonical.z;if(n){let B=n.getMinMaxForTile(e);B&&(c=B.min,h=B.max)}h+=this.maxHeight;let y=e.toUnwrapped(),x,w=[y.canonical.x/m+y.wrap,y.canonical.y/m],C=[(y.canonical.x+1)/m+y.wrap,(y.canonical.y+1)/m],A=new er,S=(B,z,j)=>[B[0]*(1-j[0])+z[0]*j[0],B[1]*(1-j[1])+z[1]*j[1]],F=[],R=[];for(let B of this.triangleSubSegments){F[0]=B.min.x/pt,F[1]=B.min.y/pt,R[0]=B.max.x/pt,R[1]=B.max.y/pt;let z=S(w,C,F),j=S(w,C,R);if(new Oi([z[0],z[1],c],[j[0],j[1],h]).intersectsPrecise(a)===0){x&&(A.segments.push(x),x=void 0);continue}let Q=B.segment;x&&x.vertexOffset!==Q.vertexOffset&&(A.segments.push(x),x=void 0),x?(x.vertexLength+=Q.vertexLength,x.primitiveLength+=Q.primitiveLength):x={vertexOffset:Q.vertexOffset,primitiveLength:Q.primitiveLength,vertexLength:Q.vertexLength,primitiveOffset:Q.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&A.segments.push(x),A}encodeCentroid(e,n){let a=e.centroid(),c=n.span(),h=Math.min(7,Math.round(c.x*this.tileToMeter/10)),m=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new ft(Cn(a.x,1,pt-1)<<3|h,Cn(a.y,1,pt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new ft(0,0);let n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){let c=n[0][0]!==a?0:1;return new ft(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{let c=n[2][0]!==a?2:3;return new ft((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Hl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Hl?FE:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||h!==c.x){for(let m=n;m<a;++m)this.centroidVertexArray.emplace(m,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(h,m){if(h.length!==m.length)return!1;for(let y=0;y<h.length;y++)if(h[y].sourceId!==m[y].sourceId||!vE(h[y],m[y]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let h of this.centroidData)h.flags&=2147483647;let c=[];for(let h of this.activeReplacements){let m=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&Hl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let x=0;x<y.footprintSegLen;x++){let w=this.footprintSegments[y.footprintSegIdx+x];if(c.length=0,Pk(this.footprintVertices,w.vertexOffset,w.vertexCount,h.footprintTileId.canonical,e.canonical,c),wE(h.footprint,c,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-m)){y.flags|=Hl;break}}}for(let h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let h=0;h<a.footprintSegLen;h++){let m=this.footprintSegments[a.footprintSegIdx+h],y=0;for(let x of m.ringIndices){for(let w=y,C=x+y-1;w<x+y;C=w++){let A=this.footprintVertices.int16[2*(w+m.vertexOffset)+0],S=this.footprintVertices.int16[2*(w+m.vertexOffset)+1],F=this.footprintVertices.int16[2*(C+m.vertexOffset)+1];S>n!=F>n&&e<(this.footprintVertices.int16[2*(C+m.vertexOffset)+0]-A)*(n-S)/(F-S)+A&&(c=!c)}y=x}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0,h=4*(e+pt)*pt+(n+pt);if(this.partLookup.hasOwnProperty(h)){let m=this.partLookup[h];return m?{height:m.height,hidden:!!(m.flags&Hl)}:void 0}for(let m of this.centroidData)e>m.max.x||m.min.x>e||n>m.max.y||m.min.y>n||this.footprintContainsPoint(e,n,m)&&m&&m.height>a&&(a=m.height,this.partLookup[h]=m,c=!!(m.flags&Hl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[h]=void 0}}function NE(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Fk(t,e,n,a){let c=e.sub(t)._perp()._unit(),h=n.sub(e)._perp()._unit();return LE(t,e,n,NE(c,h),a)}function LE(t,e,n,a,c){let h=Math.sqrt(1-a*a);return Math.min(t.dist(e)/3,e.dist(n)/3,c*h/a)}function Tx(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function UE(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function zE(t,e,n){if(t.x<0||t.x>=pt||e.x<0||e.x>=pt||n.x<0||n.x>=pt)return!1;let a=n.sub(e),c=a.perp(),h=t.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&c.x*h.x+c.y*h.y<0}function VE(t,e,n){let a=e?2|t:-3&t;return n?1|a:-2&a}function jE(){let t=Math.PI/32,e=Math.tan(t),n=ed;return n*Math.sqrt(1+2*e*e)-n}function GE(t,e,n){let a=1<<n.z,c=Bo(n.x/a),h=Bo((n.x+1)/a),m=kr(n.y/a),y=kr((n.y+1)/a);return function(x,w,C,A,S=0,F){let R=[];if(!x.length||!C||!A)return R;let B=(ne,de)=>{for(let ge of ne)R.push({polygon:ge,bounds:de})},z=Math.ceil(Math.log2(C)),j=Math.ceil(Math.log2(A)),Q=z-j,J=[];for(let ne=0;ne<Math.abs(Q);ne++)J.push(Q>0?0:1);for(let ne=0;ne<Math.min(z,j);ne++)J.push(0),J.push(1);let X=x;if(X=Ig(X,w[0].y-S,w[1].y+S,1),X=Ig(X,w[0].x-S,w[1].x+S,0),!X.length)return R;let ue=[];for(J.length?ue.push({polygons:X,bounds:w,depth:0}):B(X,w);ue.length;){let ne=ue.pop(),de=ne.depth,ge=J[de],we=ne.bounds[0],Oe=ne.bounds[1],Ee=ge===0?we.x:we.y,Ne=ge===0?Oe.x:Oe.y,Be=F?F(ge,Ee,Ne):.5*(Ee+Ne),Re=Ig(ne.polygons,Ee-S,Be+S,ge),We=Ig(ne.polygons,Be-S,Ne+S,ge);if(Re.length){let Ge=[we,new ft(ge===0?Be:Oe.x,ge===1?Be:Oe.y)];J.length>de+1?ue.push({polygons:Re,bounds:Ge,depth:de+1}):B(Re,Ge)}if(We.length){let Ge=[new ft(ge===0?Be:we.x,ge===1?Be:we.y),Oe];J.length>de+1?ue.push({polygons:We,bounds:Ge,depth:de+1}):B(We,Ge)}}return R}(t,e,Math.ceil((h-c)/11.25),Math.ceil((m-y)/11.25),1,(x,w,C)=>{if(x===0)return .5*(w+C);{let A=kr((n.y+w/pt)/a);return(qa(.5*(kr((n.y+C/pt)/a)+A))*a-n.y)*pt}})}function Pk(t,e,n,a,c,h){let m=Math.pow(2,a.z-c.z);for(let y=0;y<n;y++){let x=t.int16[2*(y+e)+0],w=t.int16[2*(y+e)+1];x=(x+c.x*pt)*m-a.x*pt,w=(w+c.y*pt)*m-a.y*pt,h.push(new ft(x,w))}}It(Og,"FillExtrusionBucket",{omit:["layers","features"]}),It(OE,"PartData"),It(PE,"FootprintSegment"),It(RE,"BorderCentroidData"),It(BE,"GroundEffect");let Ok=new be({visibility:new _e(oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new _e(oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Rk={paint:new be({"fill-extrusion-opacity":new _e(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new De(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _e(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _e(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new De(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new De(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new De(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _e(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new _e(oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new _e(oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new _e(oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new _e(oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new _e(oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new _e(oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new _e(oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new De(oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new De(oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new _e(oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new _e(oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new _e(oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new _e(oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new _e(oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Ok};class sd extends ft{constructor(e,n,a){super(e,n),this.z=a}}function Np(t,e){return t.x*e.x+t.y*e.y}function HE(t,e){if(t.length===1){let n=0,a=e[n++],c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){let h=e[n],m=t[0],y=c.sub(a),x=h.sub(a),w=m.sub(a),C=Np(y,y),A=Np(y,x),S=Np(x,x),F=Np(w,y),R=Np(w,x),B=C*S-A*A,z=(S*F-A*R)/B,j=(C*R-A*F)/B,Q=a.z*(1-z-j)+c.z*z+h.z*j;if(isFinite(Q))return Q}return 1/0}{let n=1/0;for(let a of e)n=Math.min(n,a.z);return n}}function $E(t,e,n,a,c,h,m,y){let x=m*c.getElevationAt(t,e,!0,!0),w=h[0]!==0,C=w?h[1]===0?m*(h[0]/7-450):m*function(A,S,F){let R=Math.floor(S[0]/8),B=Math.floor(S[1]/8),z=10*(S[0]-8*R),j=10*(S[1]-8*B),Q=A.getElevationAt(R,B,!0,!0),J=A.getMeterToDEM(F),X=Math.floor(.5*(z*J-1)),ue=Math.floor(.5*(j*J-1)),ne=A.tileCoordToPixel(R,B),de=2*X+1,ge=2*ue+1,we=function(We,Ge,Je,Ke,Le){return[We.getElevationAtPixel(Ge,Je,!0),We.getElevationAtPixel(Ge+Le,Je,!0),We.getElevationAtPixel(Ge,Je+Le,!0),We.getElevationAtPixel(Ge+Ke,Je+Le,!0)]}(A,ne.x-X,ne.y-ue,de,ge),Oe=Math.abs(we[0]-we[1]),Ee=Math.abs(we[2]-we[3]),Ne=Math.abs(we[0]-we[2])+Math.abs(we[1]-we[3]),Be=Math.min(.25,.5*J*(Oe+Ee)/de),Re=Math.min(.25,.5*J*Ne/ge);return Q+Math.max(Be*z,Re*j)}(c,h,y):x;return{base:x+(n===0)?-1:n,top:w?Math.max(C+a,x+n+2):x+a}}let kk=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Bk}=kk,Nk=an([{name:"a_packed",components:4,type:"Float32"}]),{members:Lk}=Nk,Uk=an([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:zk}=Uk;class qE{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new jl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let a=this.getKey(e,n);return this.positions[a]}trim(){let e=this.width,n=this.height=Ff(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){let c=[],h=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,y=!0;c.push({left:h,right:m,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){y=!y;let C=e[w];h=x*a,x+=C,m=x*a,c.push({left:h,right:m,isDash:y,zeroLength:C===0})}return c}addRoundDash(e,n,a){let c=n/2;for(let h=-a;h<=a;h++){let m=this.width*(this.nextRow+a+h),y=0,x=e[y];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++y]);let C=Math.abs(w-x.left),A=Math.abs(w-x.right),S=Math.min(C,A),F,R=h/a*(c+1);if(x.isDash){let B=c-Math.abs(R);F=Math.sqrt(S*S+B*B)}else F=c-Math.sqrt(S*S+R*R);this.image.data[m+w]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){let w=e[x],C=e[x+1];w.zeroLength?e.splice(x,1):C&&C.isDash===w.isDash&&(C.left=w.left,e.splice(x,1))}let a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);let h=this.width*this.nextRow,m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);let w=Math.abs(x-y.left),C=Math.abs(x-y.right),A=Math.min(w,C);this.image.data[h+x]=Math.max(0,Math.min(255,(y.isDash?A:-A)+n+128))}}addDash(e,n){let a=this.getKey(e,n);if(this.positions[a])return this.positions[a];let c=n==="round",h=c?7:0,m=2*h+1;if(this.nextRow+m>this.height)return Gi("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let C=0;C<e.length;C++)e[C]<0&&(Gi("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),y+=e[C];if(y!==0){let C=this.width/y,A=this.getDashRanges(e,this.width,C);c?this.addRoundDash(A,C,h):this.addRegularDash(A,n==="square"?.5*C:0)}let x=this.nextRow+h;this.nextRow+=m;let w={tl:[x,h],br:[y,0]};return this.positions[a]=w,w}}It(qE,"LineAtlas");let Vk=Sg.types,jk=Math.cos(Math.PI/180*37.5),Gk=Math.cos(Math.PI/180*5);class Sx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new zr,this.layoutVertexArray2=new _r,this.patternVertexArray=new Cr,this.indexArray=new yr,this.programConfigurations=new Nl(e.layers,e.zoom),this.segments=new er,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,a,c){this.hasPattern=Dx("line",this.layers,n);let h=this.layers[0].layout.get("line-sort-key"),m=[];for(let{feature:C,id:A,index:S,sourceLayerIndex:F}of e){let R=this.layers[0]._featureFilter.needGeometry,B=zl(C,R);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),B,a))continue;let z=h?h.evaluate(B,{},a):void 0,j={id:A,properties:C.properties,type:C.type,sourceLayerIndex:F,index:S,geometry:R?B.geometry:Wa(C,a,c),patterns:{},sortKey:z};m.push(j)}h&&m.sort((C,A)=>C.sortKey-A.sortKey);let{lineAtlas:y,featureIndex:x}=n,w=this.addConstantDashes(y);for(let C of m){let{geometry:A,index:S,sourceLayerIndex:F}=C;if(w&&this.addFeatureDashes(C,y),this.hasPattern){let R=Cx("line",this.layers,C,this.zoom,n);this.patternFeatures.push(R)}else this.addFeature(C,A,S,a,y.positions,n.availableImages,n.brightness);x.insert(e[S].feature,A,S,F,this.index)}}addConstantDashes(e){let n=!1;for(let a of this.layers){let c=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")n=!0;else{let m=h.value,y=c.value;if(!y)continue;e.addDash(y,m)}}return n}addFeatureDashes(e,n){let a=this.zoom;for(let c of this.layers){let h=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(h.kind==="constant"&&m.kind==="constant")continue;let y,x;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:a},e);x=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),n.addDash(y,x),e.patterns[c.id]=n.getKey(y,x)}}update(e,n,a,c,h){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,m?this.stateDependentLayers:this.layers,a,c,h)}addFeatures(e,n,a,c,h,m){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,c,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lk)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,zk)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bk),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,c,h,m,y){let x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),C=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),S=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let F of n)this.addLine(F,e,w,C,A,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,m,c,y)}addLine(e,n,a,c,h,m){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;let y=a==="none";if(this.patternJoinNone=this.hasPattern&&y,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let x=Vk[n.type]==="Polygon",w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let C=0;for(;C<w-1&&e[C].equals(e[C+1]);)C++;if(w<(x?3:2))return;a==="bevel"&&(h=1.05);let A=this.overscaling<=16?15*pt/(512*this.overscaling):0,S=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray),F,R,B,z,j;this.e1=this.e2=-1,x&&(F=e[w-2],j=e[C].sub(F)._unit()._perp());for(let Q=C;Q<w;Q++){if(B=Q===w-1?x?e[C+1]:void 0:e[Q+1],B&&e[Q].equals(B))continue;j&&(z=j),F&&(R=F),F=e[Q],j=B?B.sub(F)._unit()._perp():z,z=z||j;let J=R&&B,X=J?a:x||y?"butt":c,ue=z.x*j.x+z.y*j.y;if(y){let Ne=function(Be){if(Be.patternJoinNone){let Re=Be.segmentPoints.length/2,We=Be.lineSoFar-Be.segmentStart;for(let Ge=0;Ge<Re;++Ge){let Je=Be.segmentPoints[2*Ge+1],Ke=Math.round(Be.segmentPoints[2*Ge])+.5+.25*Je;Be.patternVertexArray.emplaceBack(Ke,We),Be.patternVertexArray.emplaceBack(Ke,We)}Be.segmentPoints=[],Be.segmentStart=Be.lineSoFar}Be.e1=Be.e2=-1};if(J&&ue<Gk){this.updateDistance(R,F),this.addCurrentVertex(F,z,1,1,S),Ne(this),this.addCurrentVertex(F,j,-1,-1,S);continue}if(R){if(!B){this.updateDistance(R,F),this.addCurrentVertex(F,z,1,1,S),Ne(this);continue}X="miter"}}let ne=z.add(j);ne.x===0&&ne.y===0||ne._unit();let de=ne.x*j.x+ne.y*j.y,ge=de!==0?1/de:1/0,we=2*Math.sqrt(2-2*de),Oe=de<jk&&R&&B,Ee=z.x*j.y-z.y*j.x>0;if(Oe&&Q>C){let Ne=F.dist(R);if(Ne>2*A){let Be=F.sub(F.sub(R)._mult(A/Ne)._round());this.updateDistance(R,Be),this.addCurrentVertex(Be,z,0,0,S),R=Be}}if(J&&X==="round"&&(ge<m?X="miter":ge<=2&&(X="fakeround")),X==="miter"&&ge>h&&(X="bevel"),X==="bevel"&&(ge>2&&(X="flipbevel"),ge<h&&(X="miter")),R&&this.updateDistance(R,F),X==="miter")ne._mult(ge),this.addCurrentVertex(F,ne,0,0,S);else if(X==="flipbevel"){if(ge>100)ne=j.mult(-1);else{let Ne=ge*z.add(j).mag()/z.sub(j).mag();ne._perp()._mult(Ne*(Ee?-1:1))}this.addCurrentVertex(F,ne,0,0,S),this.addCurrentVertex(F,ne.mult(-1),0,0,S)}else if(X==="bevel"||X==="fakeround"){let Ne=-Math.sqrt(ge*ge-1),Be=Ee?Ne:0,Re=Ee?0:Ne;if(R&&this.addCurrentVertex(F,z,Be,Re,S),X==="fakeround"){let We=Math.round(180*we/Math.PI/20);for(let Ge=1;Ge<We;Ge++){let Je=Ge/We;if(Je!==.5){let Le=Je-.5;Je+=Je*Le*(Je-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Le*Le+(.848013+ue*(.215638*ue-1.06021)))}let Ke=j.sub(z)._mult(Je)._add(z)._unit()._mult(Ee?-1:1);this.addHalfVertex(F,Ke.x,Ke.y,!1,Ee,0,S)}}B&&this.addCurrentVertex(F,j,-Be,-Re,S)}else X==="butt"?this.addCurrentVertex(F,ne,0,0,S):X==="square"?(R||this.addCurrentVertex(F,ne,-1,-1,S),this.addCurrentVertex(F,ne,0,0,S),R&&this.addCurrentVertex(F,ne,1,1,S)):X==="round"&&(R&&(this.addCurrentVertex(F,z,0,0,S),this.addCurrentVertex(F,z,1,1,S,!0)),B&&(this.addCurrentVertex(F,j,-1,-1,S,!0),this.addCurrentVertex(F,j,0,0,S)));if(Oe&&Q<w-1){let Ne=F.dist(B);if(Ne>2*A){let Be=F.add(B.sub(F)._mult(A/Ne)._round());this.updateDistance(F,Be),this.addCurrentVertex(Be,j,0,0,S),F=Be}}}}addCurrentVertex(e,n,a,c,h,m=!1){let y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*a,n.y-n.x*a,m,!1,a,h),this.addHalfVertex(e,y,x,m,!0,-c,h),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,a)}addHalfVertex({x:e,y:n},a,c,h,m,y,x){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}It(Sx,"LineBucket",{omit:["layers","patternFeatures"]});let Hk=new be({"line-cap":new De(oe.layout_line["line-cap"]),"line-join":new De(oe.layout_line["line-join"]),"line-miter-limit":new _e(oe.layout_line["line-miter-limit"]),"line-round-limit":new _e(oe.layout_line["line-round-limit"]),"line-sort-key":new De(oe.layout_line["line-sort-key"]),visibility:new _e(oe.layout_line.visibility)});var WE={paint:new be({"line-opacity":new De(oe.paint_line["line-opacity"]),"line-color":new De(oe.paint_line["line-color"]),"line-translate":new _e(oe.paint_line["line-translate"]),"line-translate-anchor":new _e(oe.paint_line["line-translate-anchor"]),"line-width":new De(oe.paint_line["line-width"]),"line-gap-width":new De(oe.paint_line["line-gap-width"]),"line-offset":new De(oe.paint_line["line-offset"]),"line-blur":new De(oe.paint_line["line-blur"]),"line-dasharray":new De(oe.paint_line["line-dasharray"]),"line-pattern":new De(oe.paint_line["line-pattern"]),"line-gradient":new Xe(oe.paint_line["line-gradient"]),"line-trim-offset":new _e(oe.paint_line["line-trim-offset"]),"line-emissive-strength":new _e(oe.paint_line["line-emissive-strength"]),"line-border-width":new De(oe.paint_line["line-border-width"]),"line-border-color":new De(oe.paint_line["line-border-color"])}),layout:Hk};function ZE(t,e,n){return e*(pt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function QE(t,e){return 1/ZE(t,1,e.tileZoom)}function YE(t,e,n,a){return t.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let XE=t=>{let e=[];KE(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let a=t.layout.get("line-join").constantOr("miter")==="none",c=!!t.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function KE(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let JE=new class extends De{possiblyEvaluate(t,e){return e=new W(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,a){return e=Oo({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,a)}}(WE.paint.properties["line-width"].specification);function eA(t,e){return e>0?e+2*t:t}JE.useIntegerZoom=!0;let $k=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qk=an([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Wk=an([{name:"a_projected_pos",components:4,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Zk=an([{name:"a_z_offset",components:1,type:"Float32"}],4),Qk=an([{name:"a_texb",components:2,type:"Uint16"}]),Yk=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Xk=an([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let tA=an([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kk=an([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),an([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Br=24;let Us=128;function Ix(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new W(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:c}=n,h=0;for(;h<a.length&&a[h]<=t;)h++;h=Math.max(0,h-1);let m=h;for(;m<a.length&&a[m]<t+1;)m++;m=Math.min(a.length-1,m);let y=a[h],x=a[m];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new W(y)),maxSize:n.evaluate(new W(x)),interpolationType:c}}}function Rg(t,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return t.kind==="source"?a/Us:t.kind==="composite"?gn(a/Us,c/Us,n):e}function ad(t,e){let n=0,a=0;if(t.kind==="constant")a=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:c,minZoom:h,maxZoom:m}=t,y=c?Cn(Co.interpolationFactor(c,e,h,m),0,1):0;t.kind==="camera"?a=gn(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:a}}var Jk=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Us,evaluateSizeForFeature:Rg,evaluateSizeForZoom:ad,getSizeData:Ix});function eB(t,e,n){return t.sections.forEach(a=>{a.text=function(c,h,m){let y=h.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),ae.applyArabicShaping&&(c=ae.applyArabicShaping(c)),c}(a.text,e,n)}),t}let Lp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function tB(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function nB(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var iB={read:function(t,e,n,a,c){var h,m,y=8*c-a-1,x=(1<<y)-1,w=x>>1,C=-7,A=n?c-1:0,S=n?-1:1,F=t[e+A];for(A+=S,h=F&(1<<-C)-1,F>>=-C,C+=y;C>0;h=256*h+t[e+A],A+=S,C-=8);for(m=h&(1<<-C)-1,h>>=-C,C+=a;C>0;m=256*m+t[e+A],A+=S,C-=8);if(h===0)h=1-w;else{if(h===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,a),h-=w}return(F?-1:1)*m*Math.pow(2,h-a)},write:function(t,e,n,a,c,h){var m,y,x,w=8*h-c-1,C=(1<<w)-1,A=C>>1,S=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=a?0:h-1,R=a?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=C):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+A>=1?S/x:S*Math.pow(2,1-A))*x>=2&&(m++,x/=2),m+A>=C?(y=0,m=C):m+A>=1?(y=(e*x-1)*Math.pow(2,c),m+=A):(y=e*Math.pow(2,A-1)*Math.pow(2,c),m=0));c>=8;t[n+F]=255&y,F+=R,y/=256,c-=8);for(m=m<<c|y,w+=c;w>0;t[n+F]=255&m,F+=R,m/=256,w-=8);t[n+F-R]|=128*B}},nA=Ri,kg=iB;function Ri(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ri.Varint=0,Ri.Fixed64=1,Ri.Bytes=2,Ri.Fixed32=5;var Mx=4294967296,iA=1/Mx,rA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qa(t){return t.type===Ri.Bytes?t.readVarint()+t.pos:t.pos+1}function ld(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function oA(t,e,n){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=t;c--)n.buf[c+a]=n.buf[c]}function rB(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function oB(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function sB(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function aB(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function lB(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function cB(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function uB(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function hB(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function dB(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Bg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function cd(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function sA(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ri.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,h=this.pos;this.type=7&a,t(c,e,this),this.pos===h&&this.skip(a)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Bg(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=sA(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Bg(this.buf,this.pos)+Bg(this.buf,this.pos+4)*Mx;return this.pos+=8,t},readSFixed64:function(){var t=Bg(this.buf,this.pos)+sA(this.buf,this.pos+4)*Mx;return this.pos+=8,t},readFloat:function(){var t=kg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,a=this.buf;return e=127&(n=a[this.pos++]),n<128?e:(e|=(127&(n=a[this.pos++]))<<7,n<128?e:(e|=(127&(n=a[this.pos++]))<<14,n<128?e:(e|=(127&(n=a[this.pos++]))<<21,n<128?e:function(c,h,m){var y,x,w=m.buf;if(y=(112&(x=w[m.pos++]))>>4,x<128||(y|=(127&(x=w[m.pos++]))<<3,x<128)||(y|=(127&(x=w[m.pos++]))<<10,x<128)||(y|=(127&(x=w[m.pos++]))<<17,x<128)||(y|=(127&(x=w[m.pos++]))<<24,x<128)||(y|=(1&(x=w[m.pos++]))<<31,x<128))return ld(c,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=a[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&rA?function(n,a,c){return rA.decode(n.subarray(a,c))}(this.buf,e,t):function(n,a,c){for(var h="",m=a;m<c;){var y,x,w,C=n[m],A=null,S=C>239?4:C>223?3:C>191?2:1;if(m+S>c)break;S===1?C<128&&(A=C):S===2?(192&(y=n[m+1]))==128&&(A=(31&C)<<6|63&y)<=127&&(A=null):S===3?(x=n[m+2],(192&(y=n[m+1]))==128&&(192&x)==128&&((A=(15&C)<<12|(63&y)<<6|63&x)<=2047||A>=55296&&A<=57343)&&(A=null)):S===4&&(x=n[m+2],w=n[m+3],(192&(y=n[m+1]))==128&&(192&x)==128&&(192&w)==128&&((A=(15&C)<<18|(63&y)<<12|(63&x)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,S=1):A>65535&&(A-=65536,h+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),h+=String.fromCharCode(A),m+=S}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ri.Bytes)return t.push(this.readVarint(e));var n=Qa(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ri.Bytes)return t.push(this.readSVarint());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ri.Bytes)return t.push(this.readBoolean());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ri.Bytes)return t.push(this.readFloat());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ri.Bytes)return t.push(this.readDouble());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ri.Bytes)return t.push(this.readFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ri.Bytes)return t.push(this.readSFixed32());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ri.Bytes)return t.push(this.readFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ri.Bytes)return t.push(this.readSFixed64());var e=Qa(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ri.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ri.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ri.Fixed32)this.pos+=4;else{if(e!==Ri.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),cd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),cd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),cd(this.buf,-1&t,this.pos),cd(this.buf,Math.floor(t*iA),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),cd(this.buf,-1&t,this.pos),cd(this.buf,Math.floor(t*iA),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,m,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(a,0,n),function(h,m){var y=(7&h)<<4;m.buf[m.pos++]|=y|((h>>>=3)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(a,c,h){for(var m,y,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===c.length?(a[h++]=239,a[h++]=191,a[h++]=189):y=m;continue}if(m<56320){a[h++]=239,a[h++]=191,a[h++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[h++]=239,a[h++]=191,a[h++]=189,y=null);m<128?a[h++]=m:(m<2048?a[h++]=m>>6|192:(m<65536?a[h++]=m>>12|224:(a[h++]=m>>18|240,a[h++]=m>>12&63|128),a[h++]=m>>6&63|128),a[h++]=63&m|128)}return h}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&oA(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),kg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var a=this.pos-n;a>=128&&oA(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(t,e,n){this.writeTag(t,Ri.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,rB,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,oB,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,lB,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,sB,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,aB,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,cB,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,uB,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,hB,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,dB,e)},writeBytesField:function(t,e){this.writeTag(t,Ri.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ri.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ri.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ri.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ri.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ri.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ri.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ri.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ri.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ri.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var ud=Te(nA);let Fx=3;function fB(t,e,n){e.glyphs=[],t===1&&n.readMessage(pB,e)}function pB(t,e,n){if(t===3){let{id:a,bitmap:c,width:h,height:m,left:y,top:x,advance:w}=n.readMessage(mB,{});e.glyphs.push({id:a,bitmap:new jl({width:h+2*Fx,height:m+2*Fx},c),metrics:{width:h,height:m,left:y,top:x,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function mB(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let aA=Fx,os={horizontal:1,vertical:2,horizontalOnly:3};class Up{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let a=new Up;return a.scale=e||1,a.fontStack=n,a}static forImage(e){let n=new Up;return n.imageName=e,n}}class hd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let a=new hd;for(let c=0;c<e.sections.length;c++){let h=e.sections[c];h.image?a.addImageSection(h):a.addTextSection(h,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let h=0;h<n.length;h++){let m=n.charCodeAt(h+1)||null,y=n.charCodeAt(h-1)||null;c+=!a&&(m&&b(m)&&!Lp[n[h+1]]||y&&b(y)&&!Lp[n[h-1]])||!Lp[n[h]]?n[h]:Lp[n[h]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Ng[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Ng[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let a=new hd;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Up.forText(e.scale,e.fontStack||n));let a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Gi("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Up.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Gi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Px(t,e,n,a,c,h,m,y,x,w,C,A,S,F,R){let B=hd.fromFeature(t,c);A===os.vertical&&B.verticalizePunctuation(S);let z=[],j=function(ne,de,ge,we,Oe,Ee){if(!ne)return[];let Ne=[],Be=function(Je,Ke,Le,Ft,Et,tt){let Ht=0;for(let Nt=0;Nt<Je.length();Nt++){let Pt=Je.getSection(Nt);Ht+=lA(Je.getCodePoint(Nt),Pt,Ft,Et,Ke,tt)}return Ht/Math.max(1,Math.ceil(Ht/Le))}(ne,de,ge,we,Oe,Ee),Re=ne.text.indexOf("\u200B")>=0,We=0;for(let Je=0;Je<ne.length();Je++){let Ke=ne.getSection(Je),Le=ne.getCodePoint(Je);if(Ng[Le]||(We+=lA(Le,Ke,we,Oe,de,Ee)),Je<ne.length()-1){let Ft=!((Ge=Le)<11904||!(i["Bopomofo Extended"](Ge)||i.Bopomofo(Ge)||i["CJK Compatibility Forms"](Ge)||i["CJK Compatibility Ideographs"](Ge)||i["CJK Compatibility"](Ge)||i["CJK Radicals Supplement"](Ge)||i["CJK Strokes"](Ge)||i["CJK Symbols and Punctuation"](Ge)||i["CJK Unified Ideographs Extension A"](Ge)||i["CJK Unified Ideographs"](Ge)||i["Enclosed CJK Letters and Months"](Ge)||i["Halfwidth and Fullwidth Forms"](Ge)||i.Hiragana(Ge)||i["Ideographic Description Characters"](Ge)||i["Kangxi Radicals"](Ge)||i["Katakana Phonetic Extensions"](Ge)||i.Katakana(Ge)||i["Vertical Forms"](Ge)||i["Yi Radicals"](Ge)||i["Yi Syllables"](Ge)));(gB[Le]||Ft||Ke.imageName)&&Ne.push(uA(Je+1,We,Be,Ne,_B(Le,ne.getCodePoint(Je+1),Ft&&Re),!1))}}var Ge;return hA(uA(ne.length(),We,Be,Ne,0,!0))}(B,w,h,e,a,F),{processBidirectionalText:Q,processStyledBidirectionalText:J}=ae;if(Q&&B.sections.length===1){let ne=Q(B.toString(),j);for(let de of ne){let ge=new hd;ge.text=de,ge.sections=B.sections;for(let we=0;we<de.length;we++)ge.sectionIndex.push(0);z.push(ge)}}else if(J){let ne=J(B.text,B.sectionIndex,j);for(let de of ne){let ge=new hd;ge.text=de[0],ge.sectionIndex=de[1],ge.sections=B.sections,z.push(ge)}}else z=function(ne,de){let ge=[],we=ne.text,Oe=0;for(let Ee of de)ge.push(ne.substring(Oe,Ee)),Oe=Ee;return Oe<we.length&&ge.push(ne.substring(Oe,we.length)),ge}(B,j);let X=[],ue={positionedLines:X,text:B.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,de,ge,we,Oe,Ee,Ne,Be,Re,We,Ge,Je){let Ke=0,Le=0,Ft=0,Et=Be==="right"?1:Be==="left"?0:.5,tt=!1;for(let ln of Oe){let Xt=ln.getSections();for(let fn of Xt){if(fn.imageName)continue;let cn=de[fn.fontStack];if(cn&&(tt=cn.ascender!==void 0&&cn.descender!==void 0,!tt))break}if(!tt)break}let Ht=0;for(let ln of Oe){ln.trim();let Xt=ln.getMaxScale(),fn=(Xt-1)*Br,cn={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Ht]=cn;let bn=cn.positionedGlyphs,Qt=0;if(!ln.length()){Le+=Ee,++Ht;continue}let di=0,li=0;for(let On=0;On<ln.length();On++){let Gn=ln.getSection(On),Ei=ln.getSectionIndex(On),yi=ln.getCodePoint(On),Hi=Gn.scale,Ni=null,Gr=null,Zi=null,ki=Br,ar=0,Ar=!(Re===os.horizontal||!Ge&&!v(yi)||Ge&&(Ng[yi]||(Nt=yi,i.Arabic(Nt)||i["Arabic Supplement"](Nt)||i["Arabic Extended-A"](Nt)||i["Arabic Presentation Forms-A"](Nt)||i["Arabic Presentation Forms-B"](Nt))));if(Gn.imageName){let Tr=we[Gn.imageName];if(!Tr)continue;Zi=Gn.imageName,ne.iconsInText=ne.iconsInText||!0,Gr=Tr.paddedRect;let wi=Tr.displaySize;Hi=Hi*Br/Je,Ni={width:wi[0],height:wi[1],left:0,top:-aA,advance:Ar?wi[1]:wi[0],localGlyph:!1},ar=tt?-Ni.height*Hi:Xt*Br-17-wi[1]*Hi,ki=Ni.advance;let po=(Ar?wi[0]:wi[1])*Hi-Br*Xt;po>0&&po>Qt&&(Qt=po)}else{let Tr=ge[Gn.fontStack];if(!Tr)continue;Tr[yi]&&(Gr=Tr[yi]);let wi=de[Gn.fontStack];if(!wi)continue;let po=wi.glyphs[yi];if(!po)continue;if(Ni=po.metrics,ki=yi!==8203?Br:0,tt){let Xa=wi.ascender!==void 0?Math.abs(wi.ascender):0,ws=wi.descender!==void 0?Math.abs(wi.descender):0,$s=(Xa+ws)*Hi;di<$s&&(di=$s,li=(Xa-ws)/2*Hi),ar=-Xa*Hi}else ar=(Xt-Hi)*Br-17}Ar?(ne.verticalizable=!0,bn.push({glyph:yi,imageName:Zi,x:Ke,y:Le+ar,vertical:Ar,scale:Hi,localGlyph:Ni.localGlyph,fontStack:Gn.fontStack,sectionIndex:Ei,metrics:Ni,rect:Gr}),Ke+=ki*Hi+We):(bn.push({glyph:yi,imageName:Zi,x:Ke,y:Le+ar,vertical:Ar,scale:Hi,localGlyph:Ni.localGlyph,fontStack:Gn.fontStack,sectionIndex:Ei,metrics:Ni,rect:Gr}),Ke+=Ni.advance*Hi+We)}bn.length!==0&&(Ft=Math.max(Ke-We,Ft),tt?dA(bn,Et,Qt,li,Ee*Xt/2):dA(bn,Et,Qt,0,Ee/2)),Ke=0;let jn=Ee*Xt+Qt;cn.lineOffset=Math.max(Qt,fn),Le+=jn,++Ht}var Nt;let Pt=Le,{horizontalAlign:nt,verticalAlign:Vt}=Ox(Ne);(function(ln,Xt,fn,cn,bn,Qt){let di=(Xt-fn)*bn,li=-Qt*cn;for(let jn of ln)for(let On of jn.positionedGlyphs)On.x+=di,On.y+=li})(ne.positionedLines,Et,nt,Vt,Ft,Pt),ne.top+=-Vt*Pt,ne.bottom=ne.top+Pt,ne.left+=-nt*Ft,ne.right=ne.left+Ft,ne.hasBaseline=tt}(ue,e,n,a,z,m,y,x,A,w,S,R),!function(ne){for(let de of ne)if(de.positionedGlyphs.length!==0)return!1;return!0}(X)&&ue}let Ng={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gB={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lA(t,e,n,a,c,h){if(e.imageName){let m=a[e.imageName];return m?m.displaySize[0]*e.scale*Br/h+c:0}{let m=n[e.fontStack],y=m&&m.glyphs[t];return y?y.metrics.advance*e.scale+c:0}}function cA(t,e,n,a){let c=Math.pow(t-e,2);return a?t<e?c/2:2*c:c+Math.abs(n)*n}function _B(t,e,n){let a=0;return t===10&&(a-=1e4),n&&(a+=150),t!==40&&t!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function uA(t,e,n,a,c,h){let m=null,y=cA(e,n,c,h);for(let x of a){let w=cA(e-x.x,n,c,h)+x.badness;w<=y&&(m=x,y=w)}return{index:t,x:e,priorBreak:m,badness:y}}function hA(t){return t?hA(t.priorBreak).concat(t.index):[]}function Ox(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function dA(t,e,n,a,c){if(!(e||n||a||c))return;let h=t.length-1,m=t[h],y=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=h;x++)t[x].x-=y,t[x].y+=n+a+c}function yB(t,e,n,a){let{horizontalAlign:c,verticalAlign:h}=Ox(a),m=n[0]-t.displaySize[0]*c,y=n[1]-t.displaySize[1]*h;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:m,right:m+t.displaySize[0]}}function fA(t,e,n,a,c,h){let m=t.imagePrimary,y;if(m.content){let z=m.content,j=m.pixelRatio||1;y=[z[0]/j,z[1]/j,m.displaySize[0]-z[2]/j,m.displaySize[1]-z[3]/j]}let x=e.left*h,w=e.right*h,C,A,S,F;n==="width"||n==="both"?(F=c[0]+x-a[3],A=c[0]+w+a[1]):(F=c[0]+(x+w-m.displaySize[0])/2,A=F+m.displaySize[0]);let R=e.top*h,B=e.bottom*h;return n==="height"||n==="both"?(C=c[1]+R-a[0],S=c[1]+B+a[2]):(C=c[1]+(R+B-m.displaySize[1])/2,S=C+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:C,right:A,bottom:S,left:F,collisionPadding:y}}class Ya extends ft{constructor(e,n,a,c,h){super(e,n),this.angle=c,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new Ya(this.x,this.y,this.z,this.angle,this.segment)}}function pA(t,e,n,a,c){if(e.segment===void 0)return!0;let h=e,m=e.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=t[m].dist(h),h=t[m]}y+=t[m].dist(t[m+1]),m++;let x=[],w=0;for(;y<n/2;){let C=t[m],A=t[m+1];if(!A)return!1;let S=t[m-1].angleTo(C)-C.angleTo(A);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:S}),w+=S;y-x[0].distance>a;)w-=x.shift().angleDelta;if(w>c)return!1;m++,y+=C.dist(A)}return!0}function mA(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function gA(t,e,n){return t?.6*e*n:0}function _A(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function vB(t,e,n,a,c,h){let m=gA(n,c,h),y=_A(n,a)*h,x=0,w=mA(t)/2;for(let C=0;C<t.length-1;C++){let A=t[C],S=t[C+1],F=A.dist(S);if(x+F>w){let R=(w-x)/F,B=gn(A.x,S.x,R),z=gn(A.y,S.y,R),j=new Ya(B,z,0,S.angleTo(A),C);return!m||pA(t,j,y,m,e)?j:void 0}x+=F}}function xB(t,e,n,a,c,h,m,y,x){let w=gA(a,h,m),C=_A(a,c),A=C*m,S=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-A<e/4&&(e=A+e/4),yA(t,S?e/2*y%e:(C/2+2*h)*m*y%e,e,w,n,A,S,!1,x)}function yA(t,e,n,a,c,h,m,y,x){let w=h/2,C=mA(t),A=0,S=e-n,F=[];for(let R=0;R<t.length-1;R++){let B=t[R],z=t[R+1],j=B.dist(z),Q=z.angleTo(B);for(;S+n<A+j;){S+=n;let J=(S-A)/j,X=gn(B.x,z.x,J),ue=gn(B.y,z.y,J);if(X>=0&&X<x&&ue>=0&&ue<x&&S-w>=0&&S+w<=C){let ne=new Ya(X,ue,0,Q,R);a&&!pA(t,ne,h,a,c)||F.push(ne)}}A+=j}return y||F.length||m||(F=yA(t,A/2,n,a,c,h,m,!0,x)),F}function vA(t,e,n,a,c){let h=[];for(let m=0;m<t.length;m++){let y=t[m],x;for(let w=0;w<y.length-1;w++){let C=y[w],A=y[w+1];C.x<e&&A.x<e||(C.x<e?C=new ft(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x<e&&(A=new ft(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y<n&&A.y<n||(C.y<n?C=new ft(C.x+(n-C.y)/(A.y-C.y)*(A.x-C.x),n)._round():A.y<n&&(A=new ft(C.x+(n-C.y)/(A.y-C.y)*(A.x-C.x),n)._round()),C.x>=a&&A.x>=a||(C.x>=a?C=new ft(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x>=a&&(A=new ft(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y>=c&&A.y>=c||(C.y>=c?C=new ft(C.x+(c-C.y)/(A.y-C.y)*(A.x-C.x),c)._round():A.y>=c&&(A=new ft(C.x+(c-C.y)/(A.y-C.y)*(A.x-C.x),c)._round()),x&&C.equals(x[x.length-1])||(x=[C],h.push(x)),x.push(A)))))}}return h}function xA(t){let e=0,n=0;for(let m of t)e+=m.w*m.h,n=Math.max(n,m.w);t.sort((m,y)=>y.h-m.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],c=0,h=0;for(let m of t)for(let y=a.length-1;y>=0;y--){let x=a[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,h=Math.max(h,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){let w=a.pop();y<a.length&&(a[y]=w)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(a.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h,fill:e/(c*h)||0}}It(Ya,"Anchor");let No=1;class Rx{constructor(e,{pixelRatio:n,version:a,stretchX:c,stretchY:h,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=h,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+No,this.paddedRect.y+No]}get br(){return[this.paddedRect.x+this.paddedRect.w-No,this.paddedRect.y+this.paddedRect.h-No]}get displaySize(){return[(this.paddedRect.w-2*No)/this.pixelRatio,(this.paddedRect.h-2*No)/this.pixelRatio]}}class bA{constructor(e,n){let a={},c={};this.haveRenderCallbacks=[];let h=[];this.addImages(e,a,h),this.addImages(n,c,h);let{w:m,h:y}=xA(h),x=new rs({width:m||1,height:y||1});for(let w in e){let C=e[w],A=a[w].paddedRect;rs.copy(C.data,x,{x:0,y:0},{x:A.x+No,y:A.y+No},C.data,C.sdf)}for(let w in n){let C=n[w],A=c[w].paddedRect,S=A.x+No,F=A.y+No,R=C.data.width,B=C.data.height;rs.copy(C.data,x,{x:0,y:0},{x:S,y:F},C.data),rs.copy(C.data,x,{x:0,y:B-1},{x:S,y:F-1},{width:R,height:1}),rs.copy(C.data,x,{x:0,y:0},{x:S,y:F+B},{width:R,height:1}),rs.copy(C.data,x,{x:R-1,y:0},{x:S-1,y:F},{width:1,height:B}),rs.copy(C.data,x,{x:0,y:0},{x:S+R,y:F},{width:1,height:B})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(e,n,a){for(let c in e){let h=e[c],m={x:0,y:0,w:h.data.width+2*No,h:h.data.height+2*No};a.push(m),n[c]=new Rx(m,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(let c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),n),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),n)}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;let[c,h]=e.tl,m=!!Object.keys(this.patternPositions).length;a.update(n.data,{useMipmap:m},{x:c,y:h})}}It(Rx,"ImagePosition"),It(bA,"ImageAtlas");let zp=1e20;function wA(t,e,n,a,c,h,m,y,x){for(let w=e;w<e+a;w++)DA(t,n*h+w,h,c,m,y,x);for(let w=n;w<n+c;w++)DA(t,w*h+e,1,a,m,y,x)}function DA(t,e,n,a,c,h,m){h[0]=0,m[0]=-zp,m[1]=zp,c[0]=t[e];for(let y=1,x=0,w=0;y<a;y++){c[y]=t[e+y*n];let C=y*y;do{let A=h[x];w=(c[y]-c[A]+C-A*A)/(y-A)/2}while(w<=m[x]&&--x>-1);x++,h[x]=y,m[x]=w,m[x+1]=zp}for(let y=0,x=0;y<a;y++){for(;m[x+1]<y;)x++;let w=h[x],C=y-w;t[e+y*n]=c[w]+C*C}}let zs=2,kx={none:0,ideographs:1,all:2};class dd{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){let c=[],h=this.urls[n]||O.GLYPHS_URL;for(let m in e)for(let y of e[m])c.push({stack:m,id:y});Mf(c,({stack:m,id:y},x)=>{let w=this.entries[m];w||(w=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=w.glyphs[y];if(C!==void 0)return void x(null,{stack:m,id:y,glyph:C});if(C=this._tinySDF(w,m,y),C)return w.glyphs[y]=C,void x(null,{stack:m,id:y,glyph:C});let A=Math.floor(y/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:m,id:y,glyph:C});let S=w.requests[A];S||(S=w.requests[A]=[],dd.loadGlyphRange(m,A,h,this.requestManager,(F,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(let B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(w.glyphs[+B]=R.glyphs[+B]);w.ranges[A]=!0}for(let B of S)B(F,R);delete w.requests[A]})),S.push((F,R)=>{F?x(F):R&&x(null,{stack:m,id:y,glyph:R.glyphs[y]||null})})},(m,y)=>{if(m)a(m);else if(y){let x={};for(let{stack:w,id:C,glyph:A}of y)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[C]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;a(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==kx.none&&(this.localGlyphMode===kx.all?!!this.localFontFamily:!!this.localFontFamily&&(i["CJK Unified Ideographs"](e)||i["Hangul Syllables"](e)||i.Hiragana(e)||i.Katakana(e)||i["CJK Symbols and Punctuation"](e)||i["CJK Unified Ideographs Extension A"](e)||i["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,a){let c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let B="400";/bold/i.test(n)?B="900":/medium/i.test(n)?B="500":/light/i.test(n)&&(B="200"),h=e.tinySDF=new dd.TinySDF({fontFamily:c,fontWeight:B,fontSize:24*zs,buffer:3*zs,radius:8*zs}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];let m=String.fromCodePoint(a),{data:y,width:x,height:w,glyphWidth:C,glyphHeight:A,glyphLeft:S,glyphTop:F,glyphAdvance:R}=h.draw(m);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new jl({width:x,height:w},y),metrics:{width:C/zs,height:A/zs,left:S/zs,top:F/zs-27,advance:R/zs,localGlyph:!0}}}}dd.loadGlyphRange=function(t,e,n,a,c){let h=256*e,m=h+255,y=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${h}-${m}`),mh.Glyphs);Pc(y,(x,w)=>{if(x)c(x);else if(w){let C={},A=function(S){return new ud(S).readFields(fB,{})}(w);for(let S of A.glyphs)C[S.id]=S;c(null,{glyphs:C,ascender:A.ascender,descender:A.descender})}})},dd.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;let y=this.size=t+4*e,x=this._createCanvas(y),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${h} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(t),m=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),w=y+2*this.buffer,C=x+2*this.buffer,A=Math.max(w*C,0),S=new Uint8ClampedArray(A),F={data:S,width:w,height:C,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return F;let{ctx:R,buffer:B,gridInner:z,gridOuter:j}=this;R.clearRect(B,B,y,x),R.fillText(t,B,B+m);let Q=R.getImageData(B,B,y,x);j.fill(zp,0,A),z.fill(0,0,A);for(let J=0;J<x;J++)for(let X=0;X<y;X++){let ue=Q.data[4*(J*y+X)+3]/255;if(ue===0)continue;let ne=(J+B)*w+X+B;if(ue===1)j[ne]=0,z[ne]=zp;else{let de=.5-ue;j[ne]=de>0?de*de:0,z[ne]=de<0?de*de:0}}wA(j,0,0,w,C,w,this.f,this.v,this.z),wA(z,B,B,y,x,w,this.f,this.v,this.z);for(let J=0;J<A;J++){let X=Math.sqrt(j[J])-Math.sqrt(z[J]);S[J]=Math.round(255-255*(X/this.radius+this.cutoff))}return F}};let $l=No;function CA(t,e,n,a){let c=[],h=t.imagePrimary,m=h.pixelRatio,y=h.paddedRect.w-2*$l,x=h.paddedRect.h-2*$l,w=t.right-t.left,C=t.bottom-t.top,A=h.stretchX||[[0,y]],S=h.stretchY||[[0,x]],F=(Ee,Ne)=>Ee+Ne[1]-Ne[0],R=A.reduce(F,0),B=S.reduce(F,0),z=y-R,j=x-B,Q=0,J=R,X=0,ue=B,ne=0,de=z,ge=0,we=j;if(h.content&&a){let Ee=h.content;Q=Lg(A,0,Ee[0]),X=Lg(S,0,Ee[1]),J=Lg(A,Ee[0],Ee[2]),ue=Lg(S,Ee[1],Ee[3]),ne=Ee[0]-Q,ge=Ee[1]-X,de=Ee[2]-Ee[0]-J,we=Ee[3]-Ee[1]-ue}let Oe=(Ee,Ne,Be,Re)=>{let We=Ug(Ee.stretch-Q,J,w,t.left),Ge=zg(Ee.fixed-ne,de,Ee.stretch,R),Je=Ug(Ne.stretch-X,ue,C,t.top),Ke=zg(Ne.fixed-ge,we,Ne.stretch,B),Le=Ug(Be.stretch-Q,J,w,t.left),Ft=zg(Be.fixed-ne,de,Be.stretch,R),Et=Ug(Re.stretch-X,ue,C,t.top),tt=zg(Re.fixed-ge,we,Re.stretch,B),Ht=new ft(We,Je),Nt=new ft(Le,Je),Pt=new ft(Le,Et),nt=new ft(We,Et),Vt=new ft(Ge/m,Ke/m),ln=new ft(Ft/m,tt/m),Xt=e*Math.PI/180;if(Xt){let li=Math.sin(Xt),jn=Math.cos(Xt),On=[jn,-li,li,jn];Ht._matMult(On),Nt._matMult(On),nt._matMult(On),Pt._matMult(On)}let fn=Ee.stretch+Ee.fixed,cn=Be.stretch+Be.fixed,bn=Ne.stretch+Ne.fixed,Qt=Re.stretch+Re.fixed,di=t.imageSecondary;return{tl:Ht,tr:Nt,bl:nt,br:Pt,texPrimary:{x:h.paddedRect.x+$l+fn,y:h.paddedRect.y+$l+bn,w:cn-fn,h:Qt-bn},texSecondary:di?{x:di.paddedRect.x+$l+fn,y:di.paddedRect.y+$l+bn,w:cn-fn,h:Qt-bn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vt,pixelOffsetBR:ln,minFontScaleX:de/m/w,minFontScaleY:we/m/C,isSDF:n}};if(a&&(h.stretchX||h.stretchY)){let Ee=EA(A,z,R),Ne=EA(S,j,B);for(let Be=0;Be<Ee.length-1;Be++){let Re=Ee[Be],We=Ee[Be+1];for(let Ge=0;Ge<Ne.length-1;Ge++)c.push(Oe(Re,Ne[Ge],We,Ne[Ge+1]))}}else c.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Lg(t,e,n){let a=0;for(let c of t)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function EA(t,e,n){let a=[{fixed:-$l,stretch:0}];for(let[c,h]of t){let m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(h-c)})}return a.push({fixed:e+$l,stretch:n}),a}function Ug(t,e,n,a){return t/e*n+a}function zg(t,e,n,a){return t-e*n/a}function bB(t,e,n,a){let c=e+t.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+t.positionedLines[a-1].lineOffset))/2}function wB(t,e=1,n=!1){let a=1/0,c=1/0,h=-1/0,m=-1/0,y=t[0];for(let F=0;F<y.length;F++){let R=y[F];(!F||R.x<a)&&(a=R.x),(!F||R.y<c)&&(c=R.y),(!F||R.x>h)&&(h=R.x),(!F||R.y>m)&&(m=R.y)}let x=Math.min(h-a,m-c),w=x/2,C=new Ph([],DB);if(x===0)return new ft(a,c);for(let F=a;F<h;F+=x)for(let R=c;R<m;R+=x)C.push(new fd(F+w,R+w,w,t));let A=function(F){let R=0,B=0,z=0,j=F[0];for(let Q=0,J=j.length,X=J-1;Q<J;X=Q++){let ue=j[Q],ne=j[X],de=ue.x*ne.y-ne.x*ue.y;B+=(ue.x+ne.x)*de,z+=(ue.y+ne.y)*de,R+=3*de}return new fd(B/R,z/R,0,F)}(t),S=C.length;for(;C.length;){let F=C.pop();(F.d>A.d||!A.d)&&(A=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,S)),F.max-A.d<=e||(w=F.h/2,C.push(new fd(F.p.x-w,F.p.y-w,w,t)),C.push(new fd(F.p.x+w,F.p.y-w,w,t)),C.push(new fd(F.p.x-w,F.p.y+w,w,t)),C.push(new fd(F.p.x+w,F.p.y+w,w,t)),S+=4)}return n&&(console.log(`num probes: ${S}`),console.log(`best distance: ${A.d}`)),A.p}function DB(t,e){return e.max-t.max}class fd{constructor(e,n,a,c){this.p=new ft(e,n),this.h=a,this.d=function(h,m){let y=!1,x=1/0;for(let w=0;w<m.length;w++){let C=m[w];for(let A=0,S=C.length,F=S-1;A<S;F=A++){let R=C[A],B=C[F];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(y=!y),x=Math.min(x,jC(h,R,B))}}return(y?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}let Bx=Number.POSITIVE_INFINITY,CB=Math.sqrt(2);function AA(t,[e,n]){let a=0,c=0;if(n===Bx){e<0&&(e=0);let h=e/CB;switch(t){case"top-right":case"top-left":c=h-7;break;case"bottom-right":case"bottom-left":c=7-h;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(t){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(t){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Nx(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EB(t,e,n,a,c,h,m,y,x,w,C,A,S,F,R){let B=h.textMaxSize.evaluate(e,{},A);B===void 0&&(B=m);let z=t.layers[0].layout,j=z.get("icon-offset").evaluate(e,{},A),Q=SA(n.horizontal)||n.vertical,J=S.name==="globe",X=Br,ue=m/X,ne=t.tilePixelRatio*B/X,de=(We=t.overscaling,t.zoom>18&&We>2&&(We>>=1),Math.max(pt/(512*We),1)*z.get("symbol-spacing")),ge=z.get("text-padding")*t.tilePixelRatio,we=z.get("icon-padding")*t.tilePixelRatio,Oe=kn(z.get("text-max-angle")),Ee=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ne=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Be=z.get("symbol-placement"),Re=de/2;var We;let Ge=z.get("icon-text-fit").evaluate(e,{},A),Je=z.get("icon-text-fit-padding").evaluate(e,{},A),Ke=Ge!=="none",Le;t.hasAnyIconTextFit===!1&&Ke&&(t.hasAnyIconTextFit=!0),a&&Ke&&(t.allowVerticalPlacement&&n.vertical&&(Le=fA(a,n.vertical,Ge,Je,j,ue)),Q&&(a=fA(a,Q,Ge,Je,j,ue)));let Ft=(Et,tt,Ht)=>{if(tt.x<0||tt.x>=pt||tt.y<0||tt.y>=pt)return;let Nt=null;if(J){let{x:Pt,y:nt,z:Vt}=S.projectTilePoint(tt.x,tt.y,Ht);Nt={anchor:new Ya(Pt,nt,Vt,0,void 0),up:S.upVector(Ht,tt.x,tt.y)}}(function(Pt,nt,Vt,ln,Xt,fn,cn,bn,Qt,di,li,jn,On,Gn,Ei,yi,Hi,Ni,Gr,Zi,ki,ar,Ar,Tr,wi,po,Xa){let ws=Pt.addToLineVertexArray(nt,ln),$s,Xl,Kl,Cu,IT,MT,FT,PT=0,OT=0,RT=0,kT=0,lb=-1,cb=-1,da={},BT=Bc(""),Eu=Vt?Vt.anchor:nt,ub=Qt.layout.get("icon-text-fit").evaluate(ki,{},wi)!=="none",hb=0,db=0;if(Qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[hb,db]=Qt.layout.get("text-offset").evaluate(ki,{},wi).map(Lo=>Lo*Br):(hb=Qt.layout.get("text-radial-offset").evaluate(ki,{},wi)*Br,db=Bx),Pt.allowVerticalPlacement&&Xt.vertical){let Lo=Xt.vertical;if(Ei)MT=Lx(Lo),bn&&(FT=Lx(bn));else{let Uo=Qt.layout.get("text-rotate").evaluate(ki,{},wi)+90;Kl=Vg(di,Eu,nt,li,jn,On,Lo,Gn,Uo,yi),bn&&(Cu=Vg(di,Eu,nt,li,jn,On,bn,Ni,Uo))}}if(fn){let Lo=Qt.layout.get("icon-rotate").evaluate(ki,{},wi),Uo=CA(fn,Lo,Ar,ub),xd=bn?CA(bn,Lo,Ar,ub):void 0;Xl=Vg(di,Eu,nt,li,jn,On,fn,Ni,Lo),PT=4*Uo.length;let NT=Pt.iconSizeData,Au=null;NT.kind==="source"?(Au=[Us*Qt.layout.get("icon-size").evaluate(ki,{},wi)],Au[0]>ql&&Gi(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Vp}. Reduce your "icon-size".`)):NT.kind==="composite"&&(Au=[Us*ar.compositeIconSizes[0].evaluate(ki,{},wi),Us*ar.compositeIconSizes[1].evaluate(ki,{},wi)],(Au[0]>ql||Au[1]>ql)&&Gi(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${Vp}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,Uo,Au,Zi,Gr,ki,!1,Vt,nt,ws.lineStartIndex,ws.lineLength,-1,Tr,wi,po,Xa),lb=Pt.icon.placedSymbolArray.length-1,xd&&(OT=4*xd.length,Pt.addSymbols(Pt.icon,xd,Au,Zi,Gr,ki,os.vertical,Vt,nt,ws.lineStartIndex,ws.lineLength,-1,Tr,wi,po,Xa),cb=Pt.icon.placedSymbolArray.length-1)}for(let Lo in Xt.horizontal){let Uo=Xt.horizontal[Lo];$s||(BT=Bc(Uo.text),Ei?IT=Lx(Uo):$s=Vg(di,Eu,nt,li,jn,On,Uo,Gn,Qt.layout.get("text-rotate").evaluate(ki,{},wi),yi));let xd=Uo.positionedLines.length===1;if(RT+=TA(Pt,Vt,nt,Uo,cn,Qt,Ei,ki,yi,ws,Xt.vertical?os.horizontal:os.horizontalOnly,xd?Object.keys(Xt.horizontal):[Lo],da,lb,ar,Tr,wi,po),xd)break}Xt.vertical&&(kT+=TA(Pt,Vt,nt,Xt.vertical,cn,Qt,Ei,ki,yi,ws,os.vertical,["vertical"],da,cb,ar,Tr,wi,po));let Jl=-1,fb=(Lo,Uo)=>Lo?Math.max(Lo,Uo):Uo;Jl=fb(IT,Jl),Jl=fb(MT,Jl),Jl=fb(FT,Jl);let GN=Jl>-1?1:0;Pt.glyphOffsetArray.length>=65535&&Gi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ki.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,ki.sortKey),Pt.symbolInstances.emplaceBack(nt.x,nt.y,Eu.x,Eu.y,Eu.z,da.right>=0?da.right:-1,da.center>=0?da.center:-1,da.left>=0?da.left:-1,da.vertical>=0?da.vertical:-1,lb,cb,BT,$s!==void 0?$s:Pt.collisionBoxArray.length,$s!==void 0?$s+1:Pt.collisionBoxArray.length,Kl!==void 0?Kl:Pt.collisionBoxArray.length,Kl!==void 0?Kl+1:Pt.collisionBoxArray.length,Xl!==void 0?Xl:Pt.collisionBoxArray.length,Xl!==void 0?Xl+1:Pt.collisionBoxArray.length,Cu||Pt.collisionBoxArray.length,Cu?Cu+1:Pt.collisionBoxArray.length,li,RT,kT,PT,OT,GN,0,hb,db,Jl,0,ub?1:0)})(t,tt,Nt,Et,n,a,c,Le,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ge,Ee,x,0,we,Ne,j,e,h,w,C,A,F,R)};if(Be==="line")for(let Et of vA(e.geometry,0,0,pt,pt)){let tt=xB(Et,de,Oe,n.vertical||Q,a,X,ne,t.overscaling,pt);for(let Ht of tt)Q&&AB(t,Q.text,Re,Ht)||Ft(Et,Ht,A)}else if(Be==="line-center"){for(let Et of e.geometry)if(Et.length>1){let tt=vB(Et,Oe,n.vertical||Q,a,X,ne);tt&&Ft(Et,tt,A)}}else if(e.type==="Polygon")for(let Et of wx(e.geometry,0)){let tt=wB(Et,16);Ft(Et[0],new Ya(tt.x,tt.y,0,0,void 0),A)}else if(e.type==="LineString")for(let Et of e.geometry)Ft(Et,new Ya(Et[0].x,Et[0].y,0,0,void 0),A);else if(e.type==="Point")for(let Et of e.geometry)for(let tt of Et)Ft([tt],new Ya(tt.x,tt.y,0,0,void 0),A)}let Vp=255,ql=Vp*Us;function TA(t,e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z,j){let Q=function(ue,ne,de,ge,we,Oe,Ee,Ne){let Be=[];if(ne.positionedLines.length===0)return Be;let Re=ge.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,We=function(Ft){let Et=Ft[0],tt=Ft[1],Ht=Et*tt;return Ht>0?[Et,-tt]:Ht<0?[-Et,tt]:Et===0?[tt,Et]:[tt,-Et]}(de),Ge=Math.abs(ne.top-ne.bottom);for(let Ft of ne.positionedLines)Ge-=Ft.lineOffset;let Je=ne.positionedLines.length,Ke=Ge/Je,Le=ne.top-de[1];for(let Ft=0;Ft<Je;++Ft){let Et=ne.positionedLines[Ft];Le=bB(ne,Ke,Le,Ft);for(let tt of Et.positionedGlyphs){if(!tt.rect)continue;let Ht=tt.rect||{},Nt=aA+1,Pt=!0,nt=1,Vt=0;if(tt.imageName){let Zi=Ee[tt.imageName];if(!Zi)continue;if(Zi.sdf){Gi("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,nt=Zi.pixelRatio,Nt=No/nt}let ln=(we||Ne)&&tt.vertical,Xt=tt.metrics.advance*tt.scale/2,fn=tt.metrics,cn=tt.rect;if(cn===null)continue;Ne&&ne.verticalizable&&(Vt=tt.imageName?Xt-tt.metrics.width*tt.scale/2:0);let bn=we?[tt.x+Xt,tt.y]:[0,0],Qt=[0,0],di=[0,0],li=!1;we||(ln?(di=[tt.x+Xt+We[0],tt.y+We[1]-Vt],li=!0):Qt=[tt.x+Xt+de[0],tt.y+de[1]-Vt]);let jn=cn.w*tt.scale/(nt*(tt.localGlyph?zs:1)),On=cn.h*tt.scale/(nt*(tt.localGlyph?zs:1)),Gn,Ei,yi,Hi;if(ln){let Zi=tt.y-Le,ki=new ft(-Xt,Xt-Zi),ar=-Math.PI/2,Ar=new ft(...di);Gn=new ft(-Xt+Qt[0],Qt[1]),Gn._rotateAround(ar,ki)._add(Ar),Gn.x+=-Zi+Xt,Gn.y-=(fn.left-Nt)*tt.scale;let Tr=tt.imageName?fn.advance*tt.scale:Br*tt.scale,wi=String.fromCodePoint(tt.glyph);tB(wi)?Gn.x+=(1-Nt)*tt.scale:nB(wi)?Gn.x+=Tr-fn.height*tt.scale+(-Nt-1)*tt.scale:Gn.x+=tt.imageName||fn.width+2*Nt===cn.w&&fn.height+2*Nt===cn.h?(Tr-On)/2:(Tr-(fn.height+2*Nt)*tt.scale)/2,Ei=new ft(Gn.x,Gn.y-jn),yi=new ft(Gn.x+On,Gn.y),Hi=new ft(Gn.x+On,Gn.y-jn)}else{let Zi=(fn.left-Nt)*tt.scale-Xt+Qt[0],ki=(-fn.top-Nt)*tt.scale+Qt[1],ar=Zi+jn,Ar=ki+On;Gn=new ft(Zi,ki),Ei=new ft(ar,ki),yi=new ft(Zi,Ar),Hi=new ft(ar,Ar)}if(Re){let Zi;Zi=we?new ft(0,0):li?new ft(We[0],We[1]):new ft(de[0],de[1]),Gn._rotateAround(Re,Zi),Ei._rotateAround(Re,Zi),yi._rotateAround(Re,Zi),Hi._rotateAround(Re,Zi)}let Ni=new ft(0,0),Gr=new ft(0,0);Be.push({tl:Gn,tr:Ei,bl:yi,br:Hi,texPrimary:Ht,texSecondary:void 0,writingMode:ne.writingMode,glyphOffset:bn,sectionIndex:tt.sectionIndex,isSDF:Pt,pixelOffsetTL:Ni,pixelOffsetBR:Gr,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,a,x,h,m,y,c,t.allowVerticalPlacement),J=t.textSizeData,X=null;J.kind==="source"?(X=[Us*h.layout.get("text-size").evaluate(y,{},z)],X[0]>ql&&Gi(`${t.layerIds[0]}: Value for "text-size" is >= ${Vp}. Reduce your "text-size".`)):J.kind==="composite"&&(X=[Us*R.compositeTextSizes[0].evaluate(y,{},z),Us*R.compositeTextSizes[1].evaluate(y,{},z)],(X[0]>ql||X[1]>ql)&&Gi(`${t.layerIds[0]}: Value for "text-size" is >= ${Vp}. Reduce your "text-size".`)),t.addSymbols(t.text,Q,X,x,m,y,C,e,n,w.lineStartIndex,w.lineLength,F,B,z,j,!1);for(let ue of A)S[ue]=t.text.placedSymbolArray.length-1;return 4*Q.length}function SA(t){for(let e in t)return t[e];return null}function Vg(t,e,n,a,c,h,m,y,x,w){let C=m.top,A=m.bottom,S=m.left,F=m.right,R=m.collisionPadding;if(R&&(S-=R[0],C-=R[1],F+=R[2],A+=R[3]),x){let B=new ft(S,C),z=new ft(F,C),j=new ft(S,A),Q=new ft(F,A),J=kn(x),X=new ft(0,0);w&&(X=new ft(w[0],w[1])),B._rotateAround(J,X),z._rotateAround(J,X),j._rotateAround(J,X),Q._rotateAround(J,X),S=Math.min(B.x,z.x,j.x,Q.x),F=Math.max(B.x,z.x,j.x,Q.x),C=Math.min(B.y,z.y,j.y,Q.y),A=Math.max(B.y,z.y,j.y,Q.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,S,C,F,A,y,a,c,h),t.length-1}function Lx(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function AB(t,e,n,a){let c=t.compareText;if(e in c){let h=c[e];for(let m=h.length-1;m>=0;m--)if(a.dist(h[m])<n)return!0}else c[e]=[];return c[e].push(a),!1}function IA(t,e){let n=t.fovAboveCenter,a=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-a)/Math.cos(t._pitch),h=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),m=Math.sin(t._pitch)*h+c;return Math.min(1.01*m,c*(1/t._horizonShift))}function jp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),a=t.x*n,c=(t.x+1)*n,h=t.y*n,m=(t.y+1)*n,y=Bo(a),x=Bo(c),w=kr(h),C=kr(m),A=e.project(y,w),S=e.project(x,w),F=e.project(x,C),R=e.project(y,C),B=Math.min(A.x,S.x,F.x,R.x),z=Math.min(A.y,S.y,F.y,R.y),j=Math.max(A.x,S.x,F.x,R.x),Q=Math.max(A.y,S.y,F.y,R.y),J=n/16;function X(ne,de,ge,we,Oe,Ee){let Ne=(ge+Oe)/2,Be=(we+Ee)/2,Re=e.project(Bo(Ne),kr(Be)),We=Math.max(0,B-Re.x,z-Re.y,Re.x-j,Re.y-Q);B=Math.min(B,Re.x),j=Math.max(j,Re.x),z=Math.min(z,Re.y),Q=Math.max(Q,Re.y),We>J&&(X(ne,Re,ge,we,Ne,Be),X(Re,de,Ne,Be,Oe,Ee))}X(A,S,a,h,c,h),X(S,F,c,h,c,m),X(F,R,c,m,a,m),X(R,A,a,m,a,h),B-=J,z-=J,j+=J,Q+=J;let ue=1/Math.max(j-B,Q-z);return{scale:ue,x:B*ue,y:z*ue,x2:j*ue,y2:Q*ue,projection:e}}function MA(t,{x:e,y:n},a=0){return new ft(((e-a)*t.scale-t.x)*pt,(n*t.scale-t.y)*pt)}let TB=r.a9.identity(new Float32Array(16));class Wl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Un(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return fo(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return IA(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){let h=e.horizonLineFromTop(!1),m=new ft(n,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,n,a){let c=new ft(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{let h=this.pointCoordinate(e,c.x,c.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return TB}createTileMatrix(e,n,a){let c,h,m,y=a.canonical,x=r.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=jp(y,this);c=1,h=w.x+a.wrap*w.scale,m=w.y,r.a9.scale(x,x,[c/w.scale,c/w.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*a.wrap)*c,m=y.y*c;return r.a9.translate(x,x,[h,m,0]),r.a9.scale(x,x,[c/pt,c/pt,1]),x}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class SB extends Wl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(kn(n));this.n=(c+Math.sin(kn(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:a,c,r0:h}=this,m=kn(e-this.center[0]),y=kn(n),x=Math.sqrt(c-2*a*Math.sin(y))/a;return{x:x*Math.sin(m*a),y:x*Math.cos(m*a)-h,z:0}}unproject(e,n){let{n:a,c,r0:h}=this,m=h+n,y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));let x=kn(this.center[0])*a;y=Ms(y,-Math.PI-x,Math.PI-x);let w=Cn(Zr(y/a)+this.center[0],-180,180),C=Math.asin(Cn((c-(e*e+m*m)*a*a)/(2*a),-1,1)),A=Cn(Zr(C),-tr,tr);return new Un(w,A)}}let Gp=1.340264,Hp=-.081106,$p=893e-6,qp=.003796,jg=Math.sqrt(3)/2;class IB extends Wl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let a=Math.asin(jg*Math.sin(n)),c=a*a,h=c*c*c;return{x:.5*(e*Math.cos(a)/(jg*(Gp+3*Hp*c+h*(7*$p+9*qp*c)))/Math.PI+.5),y:1-.5*(a*(Gp+Hp*c+h*($p+qp*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,h=c*c*c;for(let C,A,S,F=0;F<12&&(A=a*(Gp+Hp*c+h*($p+qp*c))-n,S=Gp+3*Hp*c+h*(7*$p+9*qp*c),C=A/S,a=Cn(a-C,-Math.PI/3,Math.PI/3),c=a*a,h=c*c*c,!(Math.abs(C)<1e-12));++F);let m=jg*e*(Gp+3*Hp*c+h*(7*$p+9*qp*c))/Math.cos(a),y=Math.asin(Math.sin(a)/jg),x=Cn(180*m/Math.PI,-180,180),w=Cn(180*y/Math.PI,-tr,tr);return new Un(x,w)}}class MB extends Wl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let a=360*(e-.5),c=Cn(360*(.5-n),-tr,tr);return new Un(a,c)}}let pd=Math.PI/2;function Gg(t){return Math.tan((pd+t)/2)}class FB extends Wl{constructor(e){super(e),this.center=e.center||[0,30];let[n,a]=this.parallels=e.parallels||[30,30],c=kn(n),h=kn(a);this.southernCenter=c+h<0,this.southernCenter&&(c=-c,h=-h);let m=Math.cos(c),y=Gg(c);this.n=c===h?Math.sin(c):Math.log(m/Math.cos(h))/Math.log(Gg(h)/y),this.f=m*Math.pow(Gg(c),this.n)/this.n}project(e,n){n=kn(n),this.southernCenter&&(n=-n),e=kn(e-this.center[0]);let a=1e-6,{n:c,f:h}=this;h>0?n<-pd+a&&(n=-pd+a):n>pd-a&&(n=pd-a);let m=h/Math.pow(Gg(n),c),y=m*Math.sin(c*e),x=h-m*Math.cos(c*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:a,f:c}=this,h=c-n,m=Math.sign(h),y=Math.sign(a)*Math.sqrt(e*e+h*h),x=Math.atan2(e,Math.abs(h))*m;h*a<0&&(x-=Math.PI*Math.sign(e)*m);let w=Cn(Zr(x/a)+this.center[0],-180,180),C=Cn(Zr(2*Math.atan(Math.pow(c/y,1/a))-pd),-tr,tr);return new Un(w,this.southernCenter?-C:C)}}class FA extends Wl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ul(e),y:qa(n),z:0}}unproject(e,n){let a=Bo(e),c=kr(n);return new Un(a,c)}}let PA=kn(tr);class PB extends Wl{project(e,n){let a=(n=kn(n))*n,c=a*a;return{x:.5*((e=kn(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,h=0,m=a*a;do{m=a*a;let w=m*m;h=(a*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-n)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),a=Cn(a-h,-PA,PA)}while(Math.abs(h)>1e-6&&--c>0);m=a*a;let y=Cn(Zr(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=Zr(a);return new Un(y,x)}}let OA=kn(tr);class OB extends Wl{project(e,n){n=kn(n),e=kn(e);let a=Math.cos(n),c=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),m=Math.sin(h)/h,y=.5*(e*c+2*a*Math.sin(e/2)/m)||0,x=.5*(n+Math.sin(n)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,h=25,m=1e-6,y=0,x=0;do{let w=Math.cos(c),C=Math.sin(c),A=2*C*w,S=C*C,F=w*w,R=Math.cos(a/2),B=Math.sin(a/2),z=2*R*B,j=B*B,Q=1-F*R*R,J=Q?1/Q:0,X=Q?Math.acos(w*R)*Math.sqrt(1/Q):0,ue=.5*(2*X*w*B+2*a/Math.PI)-e,ne=.5*(X*C+c)-n,de=.5*J*(F*j+X*w*R*S)+1/Math.PI,ge=J*(z*A/4-X*C*B),we=.125*J*(A*B-X*C*F*z),Oe=.5*J*(S*R+X*j*w)+.5,Ee=ge*we-Oe*de;y=(ne*ge-ue*Oe)/Ee,x=(ue*we-ne*de)/Ee,a=Cn(a-y,-Math.PI,Math.PI),c=Cn(c-x,-OA,OA)}while((Math.abs(y)>m||Math.abs(x)>m)&&--h>0);return new Un(Zr(a),Zr(c))}}class RA extends Wl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(kn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:a,cosPhi:c}=this;return{x:kn(e)*c*a+.5,y:-Math.sin(kn(n))/c*a+.5,z:0}}unproject(e,n){let{scale:a,cosPhi:c}=this,h=-(n-.5)/a,m=Cn(Zr((e-.5)/a)/c,-180,180),y=Math.asin(Cn(h*c,-1,1)),x=Cn(Zr(y),-tr,tr);return new Un(m,x)}}class RB extends FA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){let c=Mp(e,n,a),h=bg(ha(a));return r.Q.transformMat4(c,c,h),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n){let a=gu(n.lat,n.lng),c=r.Q.normalize([],a),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,m=fo(1,0)*pt*h;r.Q.scaleAndAdd(a,a,c,m);let y=r.a9.identity(new Float64Array(16));return r.a9.multiply(y,e.pixelMatrix,e.globeMatrix),r.Q.transformMat4(a,a,y),new ft(a[0],a[1])}pixelsPerMeter(e,n){return fo(1,0)*n}pixelSpaceConversion(e,n,a){let c=fo(1,e)*n,h=gn(fo(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/h}createTileMatrix(e,n,a){let c=px(ha(a.canonical));return r.a9.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){let{center:a}=e,c=bg(ha(n));return r.a9.rotateY(c,c,kn(a.lng)),r.a9.rotateX(c,c,kn(a.lat)),r.a9.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return XC(e,n,a,!0)||new jr(0,0)}pointCoordinate3D(e,n,a){let c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!XC(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(c,h){let m=c.cameraToCenterDistance,y=c._centerAltitude*h,x=c._camera,w=c._camera.forward(),C=r.Q.add([],r.Q.scale([],w,-m),[0,0,y]),A=c.worldSize/(2*Math.PI),S=[0,0,-A],F=c.width/c.height,R=Math.tan(c.fovAboveCenter),B=r.Q.scale([],x.up(),R),z=r.Q.scale([],x.right(),R*F),j=r.Q.normalize([],r.Q.add([],r.Q.add([],w,B),z)),Q=[],J;if(new cx(C,j).closestPointOnSphere(S,A,Q)){let X=r.Q.add([],Q,S),ue=r.Q.sub([],X,C);J=Math.cos(c.fovAboveCenter)*r.Q.length(ue)}else{let X=r.Q.sub([],C,S),ue=r.Q.sub([],S,C);r.Q.normalize(ue,ue);let ne=r.Q.length(X)-A;J=Math.sqrt(ne*(ne+2*A));let de=Math.acos(J/(A+ne))-Math.acos(r.Q.dot(w,ue));J*=Math.cos(de)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Vl(e.zoom);if(a>0){let c=IA(e,fo(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return gn(n,c+h*(1-Math.cos(m)),Math.pow(a,10))}return n}upVector(e,n,a){return Mp(n,a,e,1)}upVectorScale(e){return{metersToTile:yg(xg(ha(e)))}}}function kA(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new FA(t);case"equirectangular":return new MB(t);case"naturalEarth":return new PB(t);case"equalEarth":return new IB(t);case"winkelTripel":return new OB(t);case"albers":return n?new RA(t):new SB(t);case"lambertConformalConic":return n?new RA(t):new FB(t);case"globe":return new RB(t)}throw new Error(`Invalid projection name: ${t.name}`)}let kB=Sg.types,BB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hg(t,e,n,a,c,h,m,y,x,w,C,A,S){let F=y?Math.min(ql,Math.round(y[0])):0,R=y?Math.min(ql,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),h,m,(F<<1)+(x?1:0),R,16*w,16*C,256*A,256*S)}function $g(t,e,n){t.emplaceBack(e,n)}function qg(t,e,n,a,c,h,m){t.emplaceBack(e,n,a,c,h,m)}function Wg(t,e,n,a,c){t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c),t.emplaceBack(e,n,a,c)}function NB(t){for(let e of t.sections)if(M(e.text))return!0;return!1}class Ux{constructor(e){this.layoutVertexArray=new ys,this.indexArray=new yr,this.programConfigurations=e,this.segments=new er,this.dynamicLayoutVertexArray=new _r,this.opacityVertexArray=new ua,this.placedSymbolArray=new xC,this.iconTransitioningVertexArray=new ko,this.globeExtVertexArray=new vs,this.zOffsetVertexArray=new Cp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,c,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$k.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wk.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,BB,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Qk.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qk.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Zk.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}It(Ux,"SymbolBuffers");class zx{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new er,this.collisionVertexArray=new Ns,this.collisionVertexArrayExt=new _r}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Yk.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Xk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}It(zx,"CollisionBuffers");class Zg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a9.identity([]),this.placementViewportMatrix=r.a9.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ix(this.zoom,n["text-size"]),this.iconSizeData=Ix(this.zoom,n["icon-size"]);let a=this.layers[0].layout,c=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>os[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new Ux(new Nl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ux(new Nl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new DC,this.lineVertexArray=new CC,this.symbolInstances=new wC}calculateGlyphDependencies(e,n,a,c,h){for(let m=0;m<e.length;m++){let y=e.codePointAt(m);if(y===void 0)break;if(n[y]=!0,c&&h&&y<=65535){let x=Lp[e.charAt(m)];x&&(n[x.charCodeAt(0)]=!0)}}}populate(e,n,a,c){let h=this.layers[0],m=h.layout,y=this.projection.name==="globe",x=m.get("text-font"),w=m.get("text-field"),C=m.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof Fr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),S=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!A&&!S)return;let R=n.iconDependencies,B=n.glyphDependencies,z=n.availableImages,j=new W(this.zoom);for(let{feature:Q,id:J,index:X,sourceLayerIndex:ue}of e){let ne=h._featureFilter.needGeometry,de=zl(Q,ne);if(!h._featureFilter.filter(j,de,a))continue;if(ne||(de.geometry=Wa(Q,a,c)),y&&Q.type!==1&&a.z<=5){let Ee=de.geometry,Ne=.98078528056,Be=(Re,We)=>{let Ge=Mp(Re.x,Re.y,a,1),Je=Mp(We.x,We.y,a,1);return r.Q.dot(Ge,Je)<Ne};for(let Re=0;Re<Ee.length;Re++)Ee[Re]=E3(Ee[Re],Be)}let ge,we;if(A){let Ee=h.getValueAndResolveTokens("text-field",de,a,z),Ne=Fr.factory(Ee);NB(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||re()==="unavailable"||this.hasRTLText&&ae.isParsed())&&(ge=eB(Ne,h,de))}if(S){let Ee=h.getValueAndResolveTokens("icon-image",de,a,z);we=Ee instanceof wo?Ee:wo.fromString(Ee)}if(!ge&&!we)continue;let Oe=this.sortFeaturesByKey?F.evaluate(de,{},a):void 0;if(this.features.push({id:J,text:ge,icon:we,index:X,sourceLayerIndex:ue,geometry:de.geometry,properties:Q.properties,type:kB[Q.type],sortKey:Oe}),we&&(R[we.namePrimary]=!0,we.nameSecondary&&(R[we.nameSecondary]=!0)),ge){let Ee=x.evaluate(de,{},a).join(","),Ne=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(os.vertical)>=0;for(let Be of ge.sections)if(Be.image)R[Be.image.namePrimary]=!0;else{let Re=l(ge.toString()),We=Be.fontStack||Ee,Ge=B[We]=B[We]||{};this.calculateGlyphDependencies(Be.text,Ge,Ne,this.allowVerticalPlacement,Re)}}}m.get("symbol-placement")==="line"&&(this.features=function(Q){let J={},X={},ue=[],ne=0;function de(Ee){ue.push(Q[Ee]),ne++}function ge(Ee,Ne,Be){let Re=X[Ee];return delete X[Ee],X[Ne]=Re,ue[Re].geometry[0].pop(),ue[Re].geometry[0]=ue[Re].geometry[0].concat(Be[0]),Re}function we(Ee,Ne,Be){let Re=J[Ne];return delete J[Ne],J[Ee]=Re,ue[Re].geometry[0].shift(),ue[Re].geometry[0]=Be[0].concat(ue[Re].geometry[0]),Re}function Oe(Ee,Ne,Be){let Re=Be?Ne[0][Ne[0].length-1]:Ne[0][0];return`${Ee}:${Re.x}:${Re.y}`}for(let Ee=0;Ee<Q.length;Ee++){let Ne=Q[Ee],Be=Ne.geometry,Re=Ne.text?Ne.text.toString():null;if(!Re){de(Ee);continue}let We=Oe(Re,Be),Ge=Oe(Re,Be,!0);if(We in X&&Ge in J&&X[We]!==J[Ge]){let Je=we(We,Ge,Be),Ke=ge(We,Ge,ue[Je].geometry);delete J[We],delete X[Ge],X[Oe(Re,ue[Ke].geometry,!0)]=Ke,ue[Je].geometry=null}else We in X?ge(We,Ge,Be):Ge in J?we(We,Ge,Be):(de(Ee),J[We]=ne-1,X[Ge]=ne-1)}return ue.filter(Ee=>Ee.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,J)=>Q.sortKey-J.sortKey)}update(e,n,a,c,h){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let y=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,y,a,c,h),this.icon.programConfigurations.updatePaintArrays(e,n,y,a,c,h)}updateZOffset(){let e=(h,m,y)=>{a+=m,a>h.length&&h.resize(a);for(let x=-m;x<0;x++)h.emplace(x+a,y)},n=(h,m,y)=>{c+=m,c>h.length&&h.resize(c);for(let x=-m;x<0;x++)h.emplace(x+c,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:x,numIconVertices:w}=m,C=m.zOffset,A=w>0;if((y>0||x>0)&&(e(this.text.zOffsetVertexArray,y,C),e(this.text.zOffsetVertexArray,x,C)),A){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:F}=m;S>=0&&n(this.icon.zOffsetVertexArray,w,C),F>=0&&n(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let a=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:c,y:h}of n)this.lineVertexArray.emplaceBack(c,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,h,m,y,x,w,C,A,S,F,R,B,z){let j=e.indexArray,Q=e.layoutVertexArray,J=e.globeExtVertexArray,X=e.segments.prepareSegment(4*n.length,Q,j,this.canOverlap?m.sortKey:void 0),ue=this.glyphOffsetArray.length,ne=X.vertexLength,de=this.allowVerticalPlacement&&y===os.vertical?Math.PI/2:0,ge=m.text&&m.text.sections;for(let Oe=0;Oe<n.length;Oe++){let{tl:Ee,tr:Ne,bl:Be,br:Re,texPrimary:We,texSecondary:Ge,pixelOffsetTL:Je,pixelOffsetBR:Ke,minFontScaleX:Le,minFontScaleY:Ft,glyphOffset:Et,isSDF:tt,sectionIndex:Ht}=n[Oe],Nt=X.vertexLength,Pt=Et[1];if(Hg(Q,w.x,w.y,Ee.x,Pt+Ee.y,We.x,We.y,a,tt,Je.x,Je.y,Le,Ft),Hg(Q,w.x,w.y,Ne.x,Pt+Ne.y,We.x+We.w,We.y,a,tt,Ke.x,Je.y,Le,Ft),Hg(Q,w.x,w.y,Be.x,Pt+Be.y,We.x,We.y+We.h,a,tt,Je.x,Ke.y,Le,Ft),Hg(Q,w.x,w.y,Re.x,Pt+Re.y,We.x+We.w,We.y+We.h,a,tt,Ke.x,Ke.y,Le,Ft),x){let{x:nt,y:Vt,z:ln}=x.anchor,[Xt,fn,cn]=x.up;qg(J,nt,Vt,ln,Xt,fn,cn),qg(J,nt,Vt,ln,Xt,fn,cn),qg(J,nt,Vt,ln,Xt,fn,cn),qg(J,nt,Vt,ln,Xt,fn,cn),Wg(e.dynamicLayoutVertexArray,nt,Vt,ln,de)}else Wg(e.dynamicLayoutVertexArray,w.x,w.y,w.z,de);if(z){let nt=Ge||We;$g(e.iconTransitioningVertexArray,nt.x,nt.y),$g(e.iconTransitioningVertexArray,nt.x+nt.w,nt.y),$g(e.iconTransitioningVertexArray,nt.x,nt.y+nt.h),$g(e.iconTransitioningVertexArray,nt.x+nt.w,nt.y+nt.h)}j.emplaceBack(Nt,Nt+1,Nt+2),j.emplaceBack(Nt+1,Nt+2,Nt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),Oe!==n.length-1&&Ht===n[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,m,m.index,{},F,R,B,ge&&ge[Ht])}let we=x?x.anchor:w;e.placedSymbolArray.emplaceBack(we.x,we.y,we.z,w.x,w.y,ue,this.glyphOffsetArray.length-ue,ne,C,A,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,S,0)}_commitLayoutVertex(e,n,a,c,h,m,y){e.emplaceBack(n,a,c,h,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,a,c,h,m,y){let x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=x.vertexLength,C=y.tileAnchorX,A=y.tileAnchorY;for(let F=0;F<4;F++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,h,m,C,A,new ft(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,h,m,C,A,new ft(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,h,m,C,A,new ft(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,h,m,C,A,new ft(e.x1,e.y2)),x.vertexLength+=4;let S=a.indexArray;S.emplaceBack(w,w+1),S.emplaceBack(w+1,w+2),S.emplaceBack(w+2,w+3),S.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,h,m){for(let y=c;y<h;y++){let x=a.get(y),w=this.getSymbolInstanceTextSize(e,m,n,y);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,a,c,h,m){for(let y=c;y<h;y++){let x=a.get(y),w=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zx(Rl,tA.members,ko),this.iconCollisionBox=new zx(Rl,tA.members,ko);let a=ad(this.iconSizeData,e),c=ad(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,n,a,c){let h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),m=Rg(this.textSizeData,e,h)/Br;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,a){let c=this.icon.placedSymbolArray.get(a),h=Rg(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,h,m){for(let y=c;y<h;y++){let x=a.get(y),w=this.getSymbolInstanceTextSize(e,m,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,h,m){for(let y=c;y<h;y++){let x=a.get(y),w=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding,m.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let a=ad(this.iconSizeData,e),c=ad(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let m=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,h,m,y,x,w){let C={};if(n<a){let{x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X,featureIndex:ue}=e.get(n);C.textBox={x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X},C.textFeatureIndex=ue}if(c<h){let{x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X,featureIndex:ue}=e.get(c);C.verticalTextBox={x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X},C.verticalTextFeatureIndex=ue}if(m<y){let{x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X,featureIndex:ue}=e.get(m);C.iconBox={x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X},C.iconFeatureIndex=ue}if(x<w){let{x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X,featureIndex:ue}=e.get(x);C.verticalIconBox={x1:A,y1:S,x2:F,y2:R,padding:B,projectedAnchorX:z,projectedAnchorY:j,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:X},C.verticalIconFeatureIndex=ue}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),a=Math.cos(e),c=[],h=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);let x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.tileAnchorX+a*x.tileAnchorY)),h.push(x.featureIndex)}return m.sort((y,x)=>c[y]-c[x]||h[x]-h[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);let{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),h>=0&&h!==c&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}It(Zg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zg.addDynamicAttributes=Wg;let LB=new be({"symbol-placement":new _e(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new _e(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _e(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new De(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _e(oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new _e(oe.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new _e(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _e(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new _e(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _e(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new De(oe.layout_symbol["icon-size"]),"icon-text-fit":new De(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new De(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new De(oe.layout_symbol["icon-image"]),"icon-rotate":new De(oe.layout_symbol["icon-rotate"]),"icon-padding":new _e(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new _e(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new De(oe.layout_symbol["icon-offset"]),"icon-anchor":new De(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _e(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _e(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _e(oe.layout_symbol["text-rotation-alignment"]),"text-field":new De(oe.layout_symbol["text-field"]),"text-font":new De(oe.layout_symbol["text-font"]),"text-size":new De(oe.layout_symbol["text-size"]),"text-max-width":new De(oe.layout_symbol["text-max-width"]),"text-line-height":new De(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new De(oe.layout_symbol["text-letter-spacing"]),"text-justify":new De(oe.layout_symbol["text-justify"]),"text-radial-offset":new De(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _e(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new De(oe.layout_symbol["text-anchor"]),"text-max-angle":new _e(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new _e(oe.layout_symbol["text-writing-mode"]),"text-rotate":new De(oe.layout_symbol["text-rotate"]),"text-padding":new _e(oe.layout_symbol["text-padding"]),"text-keep-upright":new _e(oe.layout_symbol["text-keep-upright"]),"text-transform":new De(oe.layout_symbol["text-transform"]),"text-offset":new De(oe.layout_symbol["text-offset"]),"text-allow-overlap":new _e(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _e(oe.layout_symbol["text-ignore-placement"]),"text-optional":new _e(oe.layout_symbol["text-optional"]),visibility:new _e(oe.layout_symbol.visibility)});var Vx={paint:new be({"icon-opacity":new De(oe.paint_symbol["icon-opacity"]),"icon-emissive-strength":new De(oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new De(oe.paint_symbol["text-emissive-strength"]),"icon-color":new De(oe.paint_symbol["icon-color"]),"icon-halo-color":new De(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new De(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new De(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new _e(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new _e(oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new De(oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new De(oe.paint_symbol["text-opacity"]),"text-color":new De(oe.paint_symbol["text-color"],{runtimeType:bo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new De(oe.paint_symbol["text-halo-color"]),"text-halo-width":new De(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new De(oe.paint_symbol["text-halo-blur"]),"text-translate":new _e(oe.paint_symbol["text-translate"]),"text-translate-anchor":new _e(oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new _e(oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new _e(oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new _e(oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new _e(oe.paint_symbol["icon-color-brightness-max"])}),layout:LB};class BA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:yn,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It(BA,"FormatSectionOverride",{omit:["defaultValue"]});class Qg extends pn{constructor(e,n,a){super(e,Vx,n,a),this._colorAdjustmentMatrix=r.a9.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let a=this.layout.get("text-writing-mode");if(a){let c=[];for(let h of a)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(h,m,y,x){h=x0(h),m=Xo(m);let w=r.a9.create(),C=h/3,A=1-2*C,S=[A,C,C,0,C,A,C,0,C,C,A,0,0,0,0,1],F=.5-.5*m,R=x-y;return r.a9.multiply(w,[R,0,0,0,0,R,0,0,0,0,R,0,y,y,y,1],[m,0,0,0,0,m,0,0,0,0,m,0,F,F,F,1]),r.a9.multiply(w,w,S),w}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){let h=this.layout.get(e).evaluate(n,{},a,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Zh(m.value)||!h?h:function(y,x){return x.replace(/{([^{}]+)}/g,(w,C)=>C in y?String(y[C]):"")}(n.properties,h)}createBucket(e){return new Zg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Vx.paint.overridableProperties){if(!Qg.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),a=new BA(n),c=new Wh(a,n.property.specification,this.scope,this.options),h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new su("source",c):new au("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Ae(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Qg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let a=e.get("text-field"),c=Vx.paint.properties[n],h=!1,m=y=>{for(let x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Fr)m(a.value.value.sections);else if(a.value.kind==="source"){let y=w=>{h||(w instanceof ms&&or(w.value)===xl?m(w.value.sections):w instanceof Hc?m(w.sections):w.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return h}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),n&&a.push("symbolSDF"),a}getDefaultProgramParams(e,n){return{config:new mu(this,n),overrideFog:!1}}}let UB=new be({visibility:new _e(oe.layout_background.visibility)});var zB={paint:new be({"background-color":new _e(oe.paint_background["background-color"]),"background-pattern":new _e(oe.paint_background["background-pattern"]),"background-opacity":new _e(oe.paint_background["background-opacity"]),"background-emissive-strength":new _e(oe.paint_background["background-emissive-strength"])}),layout:UB};let VB=new be({visibility:new _e(oe.layout_raster.visibility)});var jB={paint:new be({"raster-opacity":new _e(oe.paint_raster["raster-opacity"]),"raster-color":new Xe(oe.paint_raster["raster-color"]),"raster-color-mix":new _e(oe.paint_raster["raster-color-mix"]),"raster-color-range":new _e(oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new _e(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _e(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _e(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new _e(oe.paint_raster["raster-saturation"]),"raster-contrast":new _e(oe.paint_raster["raster-contrast"]),"raster-resampling":new _e(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new _e(oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new _e(oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new _e(oe.paint_raster["raster-array-band"]),"raster-elevation":new _e(oe.paint_raster["raster-elevation"])}),layout:VB},jx=an([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gx{constructor(e,n,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,a){let{width:c,height:h}=e,{context:m}=this,{gl:y}=m;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),a||this.size&&this.size[0]===c&&this.size[1]===h){let{x,y:w}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,x,w,y.RGBA,y.UNSIGNED_BYTE,e);else{let C=this.format,A=y.UNSIGNED_BYTE;this.format===y.R32F&&(C=y.RED,A=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,x,w,c,h,C,A,e.data)}}else if(this.size=[c,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let x=this.format;this.format===y.R8&&(x=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,x,y.UNSIGNED_BYTE,e)}else{let x=this.format,w=this.format,C=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(x=y.DEPTH_COMPONENT16,C=y.UNSIGNED_SHORT),this.format===y.R8&&(w=y.RED),this.format===y.R32F&&(C=y.FLOAT,w=y.RED),y.texImage2D(y.TEXTURE_2D,0,x,c,h,0,w,C,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,a=!1){let{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c){let{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),n!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Yg{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}function Xg(t,e,n,a,c,h,m,y){let x=[t,e,1,n,a,1,c,h,1],w=[m,y,1],C=r.ct.adjoint([],x),[A,S,F]=r.Q.transformMat3(w,w,C);return r.ct.multiply(x,x,[A,0,0,0,S,0,0,0,F])}function NA(t,e,n,a,c,h,m,y){let x=function(w,C,A,S,F,R,B,z){let j=Xg(0,0,1,0,1,1,0,1),Q=Xg(w,C,A,S,F,R,B,z),J=r.ct.adjoint([],j);return r.ct.multiply(Q,Q,J)}(t,e,n,a,c,h,m,y);return[x[2]/x[8]/pt,x[5]/x[8]/pt]}function Kg(t){return[t[0],Math.min(Math.max(t[1],-tr),tr)]}class LA extends Oa{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new na("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=zf(this.map._requestManager.transformRequest(this.url,mh.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ch(a)):c&&(this.image=c instanceof HTMLImageElement?fs.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Yg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new na("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Yg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(let h of e)h[1]>a&&(a=h[1]),h[1]<n&&(n=h[1]);let c=(a+n)/2;if(c>tr?this.onNorthPole=!0:c<-tr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let h=e.map(jr.fromLngLat);this.tileID=function(m){let y=1/0,x=1/0,w=-1/0,C=-1/0;for(let B of m)y=Math.min(y,B.x),x=Math.min(x,B.y),w=Math.max(w,B.x),C=Math.max(C,B.y);let A=Math.max(w-y,C-x),S=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),F=Math.pow(2,S),R=Math.floor((y+w)/2*F);return R>1&&(R-=1),new _u(S,R,Math.floor((x+C)/2*F))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new na("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let j in this.tiles){let Q=this.tiles[j];Q.state!=="loaded"&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=jp(new _u(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){let Q=j[1].x-j[0].x,J=j[1].y-j[0].y,X=j[2].x-j[1].x,ue=j[2].y-j[1].y,ne=j[3].x-j[2].x,de=j[3].y-j[2].y,ge=j[0].x-j[3].x,we=j[0].y-j[3].y,Oe=Q*ue-X*J,Ee=X*de-ne*ue,Ne=ne*we-ge*de,Be=ge*J-Q*we;return Oe>0&&Ee>0&&Ne>0&&Be>0||Oe<0&&Ee<0&&Ne<0&&Be<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let c=jp(this.tileID,this.map.transform.projection),[h,m,y,x]=this.coordinates.map(j=>{let Q=c.projection.project(j[0],j[1]);return MA(c,Q)._round()});this.perspectiveTransform=NA(h.x,h.y,m.x,m.y,y.x,y.y,x.x,x.y);let w=this._boundsArray=new Rr;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(m.x,m.y,pt,0),w.emplaceBack(x.x,x.y,0,pt),w.emplaceBack(y.x,y.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,jx.members),this.boundsSegments=er.simpleSegment(0,0,4,2);let C=[],A=[Kg((S=this.coordinates)[0]),Kg(S[1]),Kg(S[2]),Kg(S[3])];var S;let[F,R,B,z]=function(j){let Q=j[0][0],J=Q,X=j[0][1],ue=X;for(let ne=1;ne<j.length;ne++)j[ne][0]<Q?Q=j[ne][0]:j[ne][0]>J&&(J=j[ne][0]),j[ne][1]<X?X=j[ne][1]:j[ne][1]>ue&&(ue=j[ne][1]);return[Q,X,J-Q,ue-X]}(A);{let j=new Rr,[Q,J,X,ue]=function(Je){let Ke=Je[0].x,Le=Ke,Ft=Je[0].y,Et=Ft;for(let tt=1;tt<Je.length;tt++)Je[tt].x<Ke?Ke=Je[tt].x:Je[tt].x>Le&&(Le=Je[tt].x),Je[tt].y<Ft?Ft=Je[tt].y:Je[tt].y>Et&&(Et=Je[tt].y);return[Ke,Ft,Le-Ke,Et-Ft]}(a),ne=Je=>[(Je.x-Q)/X,(Je.y-J)/ue],[de,ge,we,Oe]=a.map(ne),Ee=function(Je,Ke,Le,Ft,Et,tt,Ht,Nt){let Pt=Xg(0,0,1,0,1,1,0,1),nt=Xg(Je,Ke,Le,Ft,Et,tt,Ht,Nt),Vt=r.ct.adjoint([],nt);return r.ct.multiply(Pt,Pt,Vt)}(de[0],de[1],ge[0],ge[1],we[0],we[1],Oe[0],Oe[1]);this.elevatedGlobePerspectiveTransform=NA(de[0],de[1],ge[0],ge[1],we[0],we[1],Oe[0],Oe[1]);let Ne=(Je,Ke)=>{C.push(Je.lng);let Le=Math.round((Je.lng-F)/B*pt),Ft=Math.round((Je.lat-R)/z*pt),Et=ne(Ke),tt=r.Q.transformMat3([],[Et[0],Et[1],1],Ee),Ht=Math.round(tt[0]/tt[2]*pt),Nt=Math.round(tt[1]/tt[2]*pt);j.emplaceBack(Le,Ft,Ht,Nt)},Be=a[3].x-a[0].x,Re=a[3].y-a[0].y,We=a[2].x-a[1].x,Ge=a[2].y-a[1].y;for(let Je=0;Je<65;Je++){let Ke=Je/64,Le=[a[0].x+Ke*Be,a[0].y+Ke*Re],Ft=[a[1].x+Ke*We,a[1].y+Ke*Ge],Et=Ft[0]-Le[0],tt=Ft[1]-Le[1];for(let Ht=0;Ht<65;Ht++){let Nt=Ht/64,Pt={x:Le[0]+Et*Nt,y:Le[1]+tt*Nt,z:0};Ne(n.projection.unproject(Pt.x,Pt.y),Pt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,jx.members)}{this.maxLongitudeTriangleSize=0;let j=[],Q=new yr,J=(X,ue,ne)=>{Q.emplaceBack(X,ue,ne);let de=C[X],ge=C[ue],we=C[ne],Oe=Math.min(Math.min(de,ge),we),Ee=Math.max(Math.max(de,ge),we)-Oe;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),j.push(Oe+Ee/2)};for(let X=0;X<64;X++)for(let ue=0;ue<64;ue++){let ne=65*X+ue,de=ne+1,ge=ne+65,we=ge+1;J(ne,ge,de),J(de,ge,we)}[j,Q]=function(X,ue){let ne=Array.from({length:X.length},(we,Oe)=>Oe);ne.sort((we,Oe)=>X[we]-X[Oe]);let de=[],ge=new yr;for(let we=0;we<ne.length;we++){let Oe=ne[we];de.push(X[Oe]);let Ee=3*Oe,Ne=Ee+1;ge.emplaceBack(ue.uint16[Ee],ue.uint16[Ne],ue.uint16[Ne+1])}return[de,ge]}(j,Q),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Q)}this.elevatedGlobeSegments=er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/pt,0,z/pt,0,0,R,F,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof Yg||(this.texture?this.texture.update(this.image):(this.texture=new Gx(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let a=this.elevatedGlobeTrianglesCenterLongitudes,c=((C,A)=>C+360*Math.round((A-C)/360))(e+180,a[0]),h=new er,m=(C,A)=>{h.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:n.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=y){let C=kf(a,0,a.length,c+y);return C===a.length||m(C,Fa(a,C+1,a.length,c+360-y)-C),h}c<a[0]&&(c+=360);let x=Fa(a,0,a.length,c-y);if(x===a.length)return m(0,a.length),h;m(0,x-0);let w=kf(a,x+1,a.length,c+y);return w!==a.length&&m(w,a.length-w),h}}let GB=(Math.pow(256,2)-1)/16907520;class UA extends pn{constructor(e,n,a){super(e,jB,n,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof LA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Fp({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let HB=new be({visibility:new _e(oe["layout_raster-particle"].visibility)});var $B={paint:new be({"raster-particle-array-band":new _e(oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new _e(oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Xe(oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new _e(oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new _e(oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new _e(oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new _e(oe["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:HB};class zA extends pn{constructor(e,n,a){super(e,$B,n,a),this._updateColorRamp(),this.lastInvalidatedAt=fs.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Fp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=fs.now()}}class qB extends pn{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let WB=new be({visibility:new _e(oe.layout_sky.visibility)});var ZB={paint:new be({"sky-type":new _e(oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new _e(oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _e(oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _e(oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _e(oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xe(oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _e(oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _e(oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _e(oe.paint_sky["sky-opacity"])}),layout:WB};function Hx(t,e,n){let a=[0,0,1],c=r.bl.identity([]);return r.bl.rotateY(c,c,n?-kn(t)+Math.PI:kn(t)),r.bl.rotateX(c,c,-kn(e)),r.Q.transformQuat(a,a,c),r.Q.normalize(a,a)}var QB={paint:new be({})};function VA(t,e){let n=Jg(t.projection,t.zoom,t.width,t.height),a=function(h,m,y,x,w){let C=new Un(y.lng-180*Zl,y.lat),A=new Un(y.lng+180*Zl,y.lat),S=h.project(C.lng,C.lat),F=h.project(A.lng,A.lat),R=-Math.atan2(F.y-S.y,F.x-S.x),B=jr.fromLngLat(y);B.y=Cn(B.y,-1+Zl,1-Zl);let z=B.toLngLat(),j=h.project(z.lng,z.lat),Q=jr.fromLngLat(z);Q.x+=Zl;let J=Q.toLngLat(),X=h.project(J.lng,J.lat),ue=HA(X.x-j.x,X.y-j.y,R),ne=jr.fromLngLat(z);ne.y+=Zl;let de=ne.toLngLat(),ge=h.project(de.lng,de.lat),we=HA(ge.x-j.x,ge.y-j.y,R),Oe=Math.abs(ue.x)/Math.abs(we.y),Ee=r.a9.identity([]);r.a9.rotateZ(Ee,Ee,-R*(1-(w?0:x)));let Ne=r.a9.identity([]);return r.a9.scale(Ne,Ne,[1,1-(1-Oe)*x,1]),Ne[4]=-we.x/we.y*x,r.a9.rotateZ(Ne,Ne,R),r.a9.multiply(Ne,Ee,Ne),Ne}(t.projection,0,t.center,n,e),c=jA(t);return r.a9.scale(a,a,[c,c,1]),a}function jA(t){let e=t.projection,n=Jg(t.projection,t.zoom,t.width,t.height),a=GA(e,t.center),c=GA(e,Un.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function Jg(t,e,n,a,c=1/0){let h=t.range;if(!h)return 0;let m=Math.min(c,Math.max(n,a)),y=Math.log(m/1024)/Math.LN2;return Ec(h[0]+y,h[1]+y,e)}let Zl=1/4e4;function GA(t,e){let n=Cn(e.lat,-tr,tr),a=new Un(e.lng-180*Zl,n),c=new Un(e.lng+180*Zl,n),h=t.project(a.lng,n),m=t.project(c.lng,n),y=jr.fromLngLat(a),x=jr.fromLngLat(c),w=m.x-h.x,C=m.y-h.y,A=x.x-y.x,S=x.y-y.y,F=Math.sqrt((A*A+S*S)/(w*w+C*C));return Math.log(F)/Math.LN2}function HA(t,e,n){let a=Math.cos(n),c=Math.sin(n);return{x:t*a-e*c,y:t*c+e*a}}function $A(t,e,n){r.a9.identity(t),r.a9.rotateZ(t,t,kn(e[2])),r.a9.rotateX(t,t,kn(e[0])),r.a9.rotateY(t,t,kn(e[1])),r.a9.scale(t,t,n),r.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function e_(t,e,n,a,c,h,m,y){let x=[n[0]-e[0],n[1]-e[1],0],w=[a[0]-e[0],a[1]-e[1],0];if(r.Q.length(x)<1e-12||r.Q.length(w)<1e-12)return r.bl.identity(t);let C=r.Q.cross([],x,w);r.Q.normalize(C,C),r.Q.subtract(w,a,e),x[2]=(h-c)*y,w[2]=(m-c)*y;let A=x;return r.Q.cross(A,x,w),r.Q.normalize(A,A),r.bl.rotationTo(t,C,A)}function $x(t,e,n=!1){let a=Vl(e.zoom),c=function(h,m,y){let x=m.worldSize,w=[h[12],h[13],h[14]],C=kr(w[1]/x),A=Bo(w[0]/x),S=r.a9.identity([]),F=fo(1,C)*x,R=fo(1,0)*x*yu(C,m.zoom),B=1/mx(x),z=R*B;if(y){let X=Jg(m.projection,m.zoom,m.width,m.height,1024);z=B*m.projection.pixelSpaceConversion(m.center.lat,x,X)}let j=gu(C,A);r.Q.add(j,j,r.Q.scale([],r.Q.normalize([],j),F*z*w[2]));let Q=function(X){let ue=[X[0],X[1],X[2]],ne=[0,1,0],de=r.Q.cross([],ne,ue);return r.Q.cross(ne,ue,de),r.Q.squaredLength(ne)===0&&(ne=[0,1,0],r.Q.cross(de,ue,ne)),r.Q.normalize(de,de),r.Q.normalize(ne,ne),r.Q.normalize(ue,ue),[de[0],de[1],de[2],0,ne[0],ne[1],ne[2],0,ue[0],ue[1],ue[2],0,X[0],X[1],X[2],1]}(j);r.a9.scale(S,S,[z,z,z*F]),r.a9.translate(S,S,[-w[0],-w[1],-w[2]]);let J=r.a9.multiply([],m.globeMatrix,Q);return r.a9.multiply(J,J,S),r.a9.multiply(J,J,h),J}(t,e,n);if(a>0){let h=function(m,y){let x=y.worldSize,w=fo(1,0)*x*yu(y.center.lat,y.zoom)/mx(x),C=fo(1,y.center.lat)*x,A=r.a9.identity([]);return r.a9.rotateY(A,A,kn(y.center.lng)),r.a9.rotateX(A,A,kn(y.center.lat)),r.a9.translate(A,A,[0,0,ho]),r.a9.scale(A,A,[w,w,w*C]),r.a9.translate(A,A,[y.point.x-.5*x,y.point.y-.5*x,0]),r.a9.multiply(A,A,m),r.a9.multiply(A,y.globeMatrix,A)}(t,e);return function(m,y,x){let w=(R,B,z)=>{let j=r.Q.length(R),Q=r.Q.length(B),J=Za(R,B,z);return r.Q.scale(J,J,1/r.Q.length(J)*gn(j,Q,z))},C=w([m[0],m[1],m[2]],[y[0],y[1],y[2]],x),A=w([m[4],m[5],m[6]],[y[4],y[5],y[6]],x),S=w([m[8],m[9],m[10]],[y[8],y[9],y[10]],x),F=Za([m[12],m[13],m[14]],[y[12],y[13],y[14]],x);return[C[0],C[1],C[2],0,A[0],A[1],A[2],0,S[0],S[1],S[2],0,F[0],F[1],F[2],1]}(c,h,a)}return c}function qA(t,e,n,a){let c=Oi.projectAabbCorners(a,n),h=Number.MAX_VALUE,m=-1;for(let w=0;w<c.length;++w){let C=c[w];C[0]=(.5*C[0]+.5)*e.width,C[1]=(.5-.5*C[1])*e.height,C[2]<h&&(m=w,h=C[2])}let y=w=>new ft(c[w][0],c[w][1]),x;switch(m){case 0:case 6:x=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:x=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:x=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:x=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(ox(t,x))return h}let YB=an([{name:"a_pos_3f",components:3,type:"Float32"}]),XB=an([{name:"a_color_3f",components:3,type:"Float32"}]),KB=an([{name:"a_color_4f",components:4,type:"Float32"}]),JB=an([{name:"a_uv_2f",components:2,type:"Float32"}]),eN=an([{name:"a_normal_3f",components:3,type:"Float32"}]),tN=an([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),nN=an([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class t_{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function WA(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class ZA{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class QA{constructor(){this.instancedDataArray=new Hv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class qx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,n,a,c){this.tileToMeter=fg(a);let h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:m,id:y,index:x,sourceLayerIndex:w}of e){let C=y??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),A=zl(m,h);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),A,a))continue;let S={id:C,sourceLayerIndex:w,index:x,geometry:h?A.geometry:Wa(m,a,c),properties:m.properties,type:m.type,patterns:{}},F=this.addFeature(S,S.geometry,A);F&&n.featureIndex.insert(m,S.geometry,x,w,this.index,this.instancesPerModel[F].instancedDataArray.length,pt/32)}this.lookup=null}update(e,n,a,c){for(let h in this.instancesPerModel){let m=this.instancesPerModel[h];for(let y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];for(let c of a.features){let h=this.layers[0],m=c.feature,y=this.canonical,x=h.paint.get("model-rotation").evaluate(m,{},y),w=h.paint.get("model-scale").evaluate(m,{},y),C=h.paint.get("model-translation").evaluate(m,{},y);r.Q.exactEquals(c.rotation,x)&&r.Q.exactEquals(c.scale,w)&&r.Q.exactEquals(c.translation,C)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,tN.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){let c=this.layers[0],h=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!h)return Gi(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),h;WA(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new QA);let m=this.instancesPerModel[h],y=m.instancedDataArray,x=new ZA(a,y.length);for(let w of n)for(let C of w){if(C.x<0||C.x>=pt||C.y<0||C.y>=pt)continue;let A=(this.lookupDim-1)/pt,S=this.lookupDim*(C.y*A|0)+C.x*A|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let F=y.length;y.resize(F+1),m.instancesEvaluatedElevation.push(0),y.float32[16*F]=C.x,y.float32[16*F+1]=C.y}return x.instancedDataCount=m.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(x),this.evaluate(x,{},m,!1)),h}getModelUris(){return this.modelUris}evaluate(e,n,a,c){let h=this.layers[0],m=e.feature,y=this.canonical,x=e.rotation=h.paint.get("model-rotation").evaluate(m,n,y),w=e.scale=h.paint.get("model-scale").evaluate(m,n,y),C=e.translation=h.paint.get("model-translation").evaluate(m,n,y),A=h.paint.get("model-color").evaluate(m,n,y);A.a=h.paint.get("model-color-mix-intensity").evaluate(m,n,y);let S=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),$A(S,x,w);let F=Math.round(100*A.a)+A.b/1.05;for(let R=0;R<e.instancedDataCount;++R){let B=e.instancedDataOffset+R,z=16*B,j=a.instancedDataArray.float32,Q=0;c&&(Q=j[z+6]-a.instancesEvaluatedElevation[B]);let J=0|j[z+1];j[z]=(0|j[z])+A.r/1.05,j[z+1]=J+A.g/1.05,j[z+2]=F,j[z+3]=1/(y.z>10?this.tileToMeter:fg(y,J)),j[z+4]=C[0],j[z+5]=C[1],j[z+6]=C[2]+Q,j[z+7]=S[0],j[z+8]=S[1],j[z+9]=S[2],j[z+10]=S[4],j[z+11]=S[5],j[z+12]=S[6],j[z+13]=S[8],j[z+14]=S[9],j[z+15]=S[10],a.instancesEvaluatedElevation[B]=C[2]}}}It(qx,"ModelBucket",{omit:["layers"]}),It(QA,"PerModelAttributes"),It(ZA,"ModelFeature");let iN=new be({visibility:new _e(oe.layout_model.visibility),"model-id":new De(oe.layout_model["model-id"])});var rN={paint:new be({"model-opacity":new _e(oe.paint_model["model-opacity"]),"model-rotation":new De(oe.paint_model["model-rotation"]),"model-scale":new De(oe.paint_model["model-scale"]),"model-translation":new De(oe.paint_model["model-translation"]),"model-color":new De(oe.paint_model["model-color"]),"model-color-mix-intensity":new De(oe.paint_model["model-color-mix-intensity"]),"model-type":new _e(oe.paint_model["model-type"]),"model-cast-shadows":new _e(oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new _e(oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new _e(oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new De(oe.paint_model["model-emissive-strength"]),"model-roughness":new De(oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new De(oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new _e(oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new _e(oe.paint_model["model-front-cutoff"])}),layout:iN};let bu=64,md={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YA(t,e,n,a,c,h,m,y,x,w=!1){let C=n.zoom,A=n.project(a),S=yu(a.lat,C),F=1/S;r.a9.identity(t),r.a9.translate(t,t,[A.x+m[0]*F,A.y+m[1]*F,m[2]]);let R=1,B=1,z=n.worldSize;if(w){if(n.projection.name==="mercator"){let X=0;n.elevation&&(X=n.elevation.getAtPointOrZero(new jr(A.x/z,A.y/z),0));let ue=r.aa.transformMat4([],[A.x,A.y,X,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=ue,B=ue*yu(n.center.lat,C)}else if(n.projection.name==="globe"){let X=$x(t,n),ue=r.a9.multiply([],n.projMatrix,X),ne=[0,0,0,1];r.aa.transformMat4(ne,ne,ue);let de=ne[3]/n.cameraToCenterDistance,ge=Vl(C),we=n.projection.pixelsPerMeter(a.lat,z)*yu(a.lat,C),Oe=n.projection.pixelsPerMeter(n.center.lat,z)*yu(n.center.lat,C);R=de/gn(we,NC(n.center.lat),ge),B=de*S/we,R*=Oe,B*=Oe}}else R=F;r.a9.scale(t,t,[R,R,B]);let j=[...t],Q=e.orientation,J=[];if($A(J,[Q[0]+c[0],Q[1]+c[1],Q[2]+c[2]],h),r.a9.multiply(t,j,J),y&&n.elevation){let X=0,ue=[];if(x&&n.elevation){X=function(ge,we,Oe,Ee,Ne){let Be=we.elevation;if(!Be)return 0;let Re=Oi.projectAabbCorners(Oe,Ee),We=fo(1,Ne.lat)*we.worldSize,Ge=function(Vt,ln){let Xt=[0,0,1],fn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let cn of fn){let bn=Vt[cn.corners[0]],Qt=Vt[cn.corners[1]],di=Vt[cn.corners[2]],li=[Qt[0]-bn[0],Qt[1]-bn[1],ln*(Qt[2]-bn[2])],jn=r.Q.cross(li,li,[di[0]-bn[0],di[1]-bn[1],ln*(di[2]-bn[2])]);r.Q.normalize(jn,jn),cn.dotProductWithUp=r.Q.dot(jn,Xt)}return fn.sort((cn,bn)=>cn.dotProductWithUp-bn.dotProductWithUp),fn[0].corners}(Re,We),Je=Re[Ge[0]],Ke=Re[Ge[1]],Le=Re[Ge[2]],Ft=Re[Ge[3]],Et=Be.getAtPointOrZero(new jr(Je[0]/we.worldSize,Je[1]/we.worldSize),0),tt=Be.getAtPointOrZero(new jr(Ke[0]/we.worldSize,Ke[1]/we.worldSize),0),Ht=Be.getAtPointOrZero(new jr(Le[0]/we.worldSize,Le[1]/we.worldSize),0),Nt=Be.getAtPointOrZero(new jr(Ft[0]/we.worldSize,Ft[1]/we.worldSize),0),Pt=(Et+Nt)/2,nt=(tt+Ht)/2;return Pt>nt?tt<Ht?e_(ge,Ke,Ft,Je,tt,Nt,Et,We):e_(ge,Le,Je,Ft,Ht,Et,Nt,We):Et<Nt?e_(ge,Je,Ke,Le,Et,tt,Ht,We):e_(ge,Ft,Le,Ke,Nt,Ht,tt,We),Math.max(Pt,nt)}(ue,n,e.aabb,t,a);let ne=r.a9.fromQuat([],ue),de=r.a9.multiply([],ne,J);r.a9.multiply(t,j,de)}else X=n.elevation.getAtPointOrZero(new jr(A.x/z,A.y/z),0);X!==0&&(t[14]+=X)}}function Wp(t,e,n=!1){t.uploaded||(t.gfxTexture=new Gx(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function oN(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,YB.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,eN.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,JB.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?XB:KB).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,nN.members,!0)),t.segments=er.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let a=t.material;a.pbrMetallicRoughness.baseColorTexture&&Wp(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Wp(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Wp(a.normalTexture,e),a.occlusionTexture&&Wp(a.occlusionTexture,e,n),a.emissionTexture&&Wp(a.emissionTexture,e)}function Wx(t,e,n){if(t.meshes)for(let a of t.meshes)oN(a,e,n);if(t.children)for(let a of t.children)Wx(a,e,n)}function n_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)n_(e)}function Zx(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Zx(n)}class sN{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class aN{constructor(){this.tasks={},this.taskQueue=[],Pf(["process"],this),this.invoker=new sN(this.process),this.nextId=0}add(e,n){let a=this.nextId++,c=function({type:h,isSymbolTile:m,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||m?h!=="parseTile"||m?h==="parseTile"&&m?300-y:h==="maybePrepare"&&m?400-y:500:200-y:100-y}(n);if(c===0){Ps();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ps();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){let h=this.tasks[this.taskQueue[c]];h.priority<n&&(n=h.priority,e=c)}if(e===null)return null;let a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class XA{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Pf(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new aN}send(e,n,a,c,h=!1,m){let y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[y]=a);let x=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:cu(n,x)},x),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){let n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||Ps()){let c=this.callbacks[a],h=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});h&&(this.cancelCallbacks[a]=h)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(d(n.error)):a(null,d(n.data)))}else{let a=new Set,c=n.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?cu(m):null,data:cu(y,a)},a)}:m=>{},h=d(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,c);else if(this.parent.getWorkerSource){let m=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,m[0],h.source,h.scope)[m[1]](h,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Qx=(()=>{class t{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=qn();let c=this.workerPool.acquire(this.id);for(let h=0;h<c.length;h++){let m=new t.Actor(c[h],a,this.id);m.name=`Worker ${h}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,c){Mf(this.actors,(h,m)=>{h.send(n,a,m)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=XA,t})();var Zp={workerUrl:"",workerClass:null,workerParams:void 0};function lN(){return Zp.workerClass!=null?new Zp.workerClass:new self.Worker(Zp.workerUrl,Zp.workerParams)}let Yx="mapboxgl_preloaded_worker_pool";class Qp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qp.workerCount;)this.workers.push(new lN);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yx]}numActive(){return Object.keys(this.active).length}}let Yp;function i_(){return Yp||(Yp=new Qp),Yp}Qp.workerCount=2;let r_,Xx,Vs,gd,Kx,_d=null;function KA(){return Ps()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Xx||O.DRACO_URL}function JA(){if(Ps()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gd)return gd;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gd=WebAssembly.validate(t)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,gd}let o_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cN={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Xp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function eT(t,e,n){let a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:t.byteLength},n.buffers[c]=t}let Jx="KHR_draco_mesh_compression";function uN(t,e){let n=t.extensions&&t.extensions[Jx];if(!n)return;let a=new Vs.Decoder,c=rT(e,n.bufferView),h=new Vs.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,h))throw new Error("Failed to decode Draco mesh");let m=e.json.accessors[t.indices],y=o_[m.componentType],x=m.count*y.BYTES_PER_ELEMENT,w=Vs._malloc(x);y===Uint16Array?a.GetTrianglesUInt16Array(h,x,w):a.GetTrianglesUInt32Array(h,x,w),eT(Vs.memory.buffer.slice(w,w+x),m,e),Vs._free(w);for(let C of Object.keys(n.attributes)){let A=a.GetAttributeByUniqueId(h,n.attributes[C]),S=e.json.accessors[t.attributes[C]],F=cN[S.componentType],R=S.count*Xp[S.type]*o_[S.componentType].BYTES_PER_ELEMENT,B=Vs._malloc(R);a.GetAttributeDataArrayForAllPoints(h,A,Vs[F],R,B),eT(Vs.memory.buffer.slice(B,B+R),S,e),Vs._free(B)}a.destroy(),h.destroy(),delete t.extensions[Jx]}let s_="EXT_meshopt_compression";function hN(t,e){if(!t.extensions||!t.extensions[s_])return;let n=t.extensions[s_],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);Kx.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=c.buffer,delete t.extensions[s_]}let tT=1179937895,nT=new TextDecoder("utf8");function iT(t,e){return new URL(t,e).href}function dN(t,e,n,a){return fetch(iT(t.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function rT(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function fN(t,e,n,a){if(t.uri){let c=iT(t.uri,a);return fetch(c).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[n]=h})}if(t.bufferView!==void 0){let c=rT(e,t.bufferView),h=new Blob([c],{type:t.mimeType});return createImageBitmap(h).then(m=>{e.images[n]=m})}}function oT(t,e=0,n){let a={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===tT){let C=new Uint32Array(t,e),A=2,S=(C[A++]>>2)-3,F=C[A++]>>2;if(A++,a.json=JSON.parse(nT.decode(C.subarray(A,A+F))),A+=F,A<S){let R=C[A++];A++;let B=e+(A<<2);a.buffers[0]=t.slice(B,B+R)}}else a.json=JSON.parse(nT.decode(new Uint8Array(t,e)));let{buffers:c,images:h,meshes:m,extensionsUsed:y,bufferViews:x}=a.json,w=Promise.resolve();if(c){let C=[];for(let A=0;A<c.length;A++){let S=c[A];S.uri?C.push(dN(S,a,A,n)):a.buffers[A]||(a.buffers[A]=null)}w=Promise.all(C)}return w.then(()=>{let C=[],A=y&&y.includes(Jx),S=y&&y.includes(s_);if(A&&C.push(function(){if(!Vs)return r_||(r_=function(F){let R,B=null;function z(){R=new Uint8Array(B.buffer)}function j(){throw new Error("Unexpected Draco error.")}let Q={a:{a:j,d:function(J,X,ue){return R.copyWithin(J,X,X+ue)},c:function(J){let X=R.length,ue=Math.max(J>>>0,Math.ceil(1.2*X)),ne=Math.ceil((ue-X)/65536);try{return B.grow(ne),z(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,Q):F.then(J=>J.arrayBuffer()).then(J=>WebAssembly.instantiate(J,Q))).then(J=>{let{Rb:X,Qb:ue,P:ne,T:de,X:ge,Ja:we,La:Oe,Qa:Ee,Va:Ne,Wa:Be,eb:Re,jb:We,f:Ge,e:Je,yb:Ke,zb:Le,Ab:Ft,Bb:Et,Db:tt,Gb:Ht}=J.instance.exports;B=Je;let Nt=(()=>{let Pt=0,nt=0,Vt=0,ln=0;return Xt=>{Vt&&(X(ln),X(Pt),nt+=Vt,Vt=Pt=0),Pt||(nt+=128,Pt=ue(nt));let fn=Xt.length+7&-8,cn=Pt;fn>=nt&&(Vt=fn,cn=ln=ue(fn));for(let bn=0;bn<Xt.length;bn++)R[cn+bn]=Xt[bn];return cn}})();return z(),Ge(),{memory:Je,_free:X,_malloc:ue,Mesh:class{constructor(){this.ptr=ne()}destroy(){de(this.ptr)}},Decoder:class{constructor(){this.ptr=we()}destroy(){We(this.ptr)}DecodeArrayToMesh(Pt,nt,Vt){let ln=Nt(Pt),Xt=Oe(this.ptr,ln,nt,Vt.ptr);return!!ge(Xt)}GetAttributeByUniqueId(Pt,nt){return{ptr:Ee(this.ptr,Pt.ptr,nt)}}GetTrianglesUInt16Array(Pt,nt,Vt){Ne(this.ptr,Pt.ptr,nt,Vt)}GetTrianglesUInt32Array(Pt,nt,Vt){Be(this.ptr,Pt.ptr,nt,Vt)}GetAttributeDataArrayForAllPoints(Pt,nt,Vt,ln,Xt){Re(this.ptr,Pt.ptr,nt.ptr,Vt,ln,Xt)}},DT_INT8:Ke(),DT_UINT8:Le(),DT_INT16:Ft(),DT_UINT16:Et(),DT_UINT32:tt(),DT_FLOAT32:Ht()}})}(fetch(KA())),r_.then(F=>{Vs=F,r_=void 0}))}()),S&&C.push(function(){if(Kx)return;let F=function(R){let B,z=WebAssembly.instantiateStreaming(R,{}).then(J=>{B=J.instance,B.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(J,X,ue,ne,de,ge){(function(we,Oe,Ee,Ne,Be,Re,We){let Ge=we.exports.sbrk,Je=Ne+3&-4,Ke=Ge(Je*Be),Le=Ge(Re.length),Ft=new Uint8Array(we.exports.memory.buffer);Ft.set(Re,Le);let Et=Oe(Ke,Ne,Be,Le,Re.length);if(Et===0&&We&&We(Ke,Je,Be),Ee.set(Ft.subarray(Ke,Ke+Ne*Be)),Ge(Ke-Ge(0)),Et!==0)throw new Error(`Malformed buffer data: ${Et}`)})(B,B.exports[Q[de]],J,X,ue,ne,B.exports[j[ge]])}}}(fetch(JA()));return F.ready.then(()=>{Kx=F})}()),h)for(let F=0;F<h.length;F++)C.push(fN(h[F],a,F,n));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(A&&m)for(let{primitives:F}of m)for(let R of F)uN(R,a);if(S&&m&&x)for(let F of x)hN(F,a);return a})})}class sT{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new ft(0,0),this.max=new ft(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[h,m]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){let S=e[A];h.x=Math.min(h.x,S.x),h.y=Math.min(h.y,S.y),m.x=Math.max(m.x,S.x),m.y=Math.max(m.y,S.y)}if(c){let A=Math.ceil(Math.max(m.x-h.x,m.y-h.y)/c);a=Math.max(a,A)}if(a===0)return;this.min=h,this.max=m;let y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);let x=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/x)),this.cellsY=Math.max(1,Math.ceil(y.y/x)),this.xScale=1/x,this.yScale=1/x;let w=[];for(let A=0;A<this.triangleCount;A++){let S=e[n[3*A+0]].sub(this.min),F=e[n[3*A+1]].sub(this.min),R=e[n[3*A+2]].sub(this.min),B=Ql(Math.floor(Math.min(S.x,F.x,R.x)),this.xScale,this.cellsX),z=Ql(Math.floor(Math.max(S.x,F.x,R.x)),this.xScale,this.cellsX),j=Ql(Math.floor(Math.min(S.y,F.y,R.y)),this.yScale,this.cellsY),Q=Ql(Math.floor(Math.max(S.y,F.y,R.y)),this.yScale,this.cellsY),J=new ft(0,0),X=new ft(0,0),ue=new ft(0,0),ne=new ft(0,0);for(let de=j;de<=Q;++de){J.y=X.y=de*x,ue.y=ne.y=(de+1)*x;for(let ge=B;ge<=z;++ge)J.x=ue.x=ge*x,X.x=ne.x=(ge+1)*x,(lx(S,F,R,J,X,ne)||lx(S,F,R,J,ne,ue))&&w.push({cellIdx:de*this.cellsX+ge,triIdx:A})}}if(w.length===0)return;w.sort((A,S)=>A.cellIdx-S.cellIdx||A.triIdx-S.triIdx);let C=0;for(;C<w.length;){let A=w[C].cellIdx,S={start:this.payload.length,len:0};for(;C<w.length&&w[C].cellIdx===A;)++S.len,this.payload.push(w[C++].triIdx);this.cells[A]=S}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let x=0;x<this.lookup.length;x++)this.lookup[x]=0;let c=Ql(e.x-this.min.x,this.xScale,this.cellsX),h=Ql(n.x-this.min.x,this.xScale,this.cellsX),m=Ql(e.y-this.min.y,this.yScale,this.cellsY),y=Ql(n.y-this.min.y,this.yScale,this.cellsY);for(let x=m;x<=y;x++)for(let w=c;w<=h;w++){let C=this.cells[x*this.cellsX+w];if(C)for(let A=0;A<C.len;A++){let S=this.payload[C.start+A],F=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[F]&R)&&(this.lookup[F]|=R,a.push(S),a.length===this.triangleCount))return}}}}function Ql(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function wu(t,e){let n=t.json.bufferViews[e.bufferView],a=o_[e.componentType];return new a(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Xp[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:Xp[e.type]))}function eb(t,e,n,a){let c=o_[e.componentType],h=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),m=t.json.bufferViews[e.bufferView],y=m.byteStride?m.byteStride/c.BYTES_PER_ELEMENT:Xp[e.type],x=n.float32,w=x.length/n.capacity;for(let C=0,A=0;C<e.count*y;C+=y,A+=w)for(let S=0;S<w;S++)x[A+S]=a[C+S]*h;n._trim()}function pN(t,e,n){let a=t.indices,c=t.attributes,h={};h.indexArray=new yr;let m=e.json.accessors[a],y=m.count/3;h.indexArray.reserve(y);let x=wu(e,m);for(let S=0;S<y;S++)h.indexArray.emplaceBack(x[3*S],x[3*S+1],x[3*S+2]);h.indexArray._trim(),h.vertexArray=new pu;let w=e.json.accessors[c.POSITION];h.vertexArray.reserve(w.count);let C=wu(e,w);for(let S=0;S<w.count;S++)h.vertexArray.emplaceBack(C[3*S],C[3*S+1],C[3*S+2]);if(h.vertexArray._trim(),h.aabb=new Oi(w.min,w.max),h.centroid=function(S,F){let R=[0,0,0],B=S.length;if(B>0){for(let z=0;z<B;z++){let j=3*S[z];R[0]+=F[j],R[1]+=F[j+1],R[2]+=F[j+2]}R[0]/=B,R[1]/=B,R[2]/=B}return R}(x,C),c.COLOR_0!==void 0){let S=e.json.accessors[c.COLOR_0],F=Xp[S.type],R=wu(e,S);h.colorArray=F===3?new pu:new _r,h.colorArray.resize(S.count),eb(e,S,h.colorArray,R)}if(c.NORMAL!==void 0){h.normalArray=new pu;let S=e.json.accessors[c.NORMAL];h.normalArray.resize(S.count);let F=wu(e,S);eb(e,S,h.normalArray,F)}if(c.TEXCOORD_0!==void 0&&n.length>0){h.texcoordArray=new Cr;let S=e.json.accessors[c.TEXCOORD_0];h.texcoordArray.resize(S.count);let F=wu(e,S);eb(e,S,h.texcoordArray,F)}if(c._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=wu(e,S))}c._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(wu(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));let A=t.material;return h.material=function(S,F){let{emissiveFactor:R=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:z=.5,normalTexture:j,occlusionTexture:Q,emissiveTexture:J,doubleSided:X}=S,{baseColorFactor:ue=[1,1,1,1],metallicFactor:ne=1,roughnessFactor:de=1,baseColorTexture:ge,metallicRoughnessTexture:we}=S.pbrMetallicRoughness||{},Oe=Q?F[Q.index]:void 0;if(Q&&Q.extensions&&Q.extensions.KHR_texture_transform&&Oe){let Ee=Q.extensions.KHR_texture_transform;Oe.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Jn(...ue),metallicFactor:ne,roughnessFactor:de,baseColorTexture:ge?F[ge.index]:void 0,metallicRoughnessTexture:we?F[we.index]:void 0},doubleSided:X,emissiveFactor:R,alphaMode:B,alphaCutoff:z,normalTexture:j?F[j.index]:void 0,occlusionTexture:Oe,emissionTexture:J?F[J.index]:void 0,defined:S.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},n),h}function aT(t,e,n){let{matrix:a,rotation:c,translation:h,scale:m,mesh:y,extras:x,children:w}=t,C={};if(C.matrix=a||r.a9.fromRotationTranslationScale([],c||[0,0,0,1],h||[0,0,0],m||[1,1,1]),y!==void 0){C.meshes=n[y];let A=C.anchor=[0,0];for(let S of C.meshes){let{min:F,max:R}=S.aabb;A[0]+=F[0]+R[0],A[1]+=F[1]+R[1]}A[0]=Math.floor(A[0]/C.meshes.length/2),A[1]=Math.floor(A[1]/C.meshes.length/2)}if(x&&(x.id&&(C.id=x.id),x.lights&&(C.lights=function(A){if(!A.length)return[];let S=function(j){let Q=atob(j),J=new Uint8Array(Q.length);for(let X=0;X<Q.length;X++)J[X]=Q.codePointAt(X);return J}(A),F=[],R=S.length/24,B=new Uint16Array(S.buffer),z=new Float32Array(S.buffer);for(let j=0;j<R;j++){let Q=B[2*j*6]/30,J=B[2*j*6+1]/30,X=B[2*j*6+10]/100,ue=z[6*j+1],ne=z[6*j+2],de=z[6*j+3],ge=z[6*j+4],we=de-ue,Oe=ge-ne,Ee=Math.hypot(we,Oe);F.push({pos:[ue+.5*we,ne+.5*Oe,J],normal:[Oe/Ee,-we/Ee,0],width:Ee,height:Q,depth:X,points:[ue,ne,de,ge]})}return F}(x.lights))),w){let A=[];for(let S of w)A.push(aT(e.json.nodes[S],e,n));C.children=A}return C}function mN(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new sT(t.vertices,t.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:a}}function gN(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let a=[];for(let m of n){if(!Array.isArray(m)||m.length!==2)continue;let y=m[0],x=m[1];typeof y=="number"&&typeof x=="number"&&a.push(new ft(y,x))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let m=0;m<a.length;m++){let y=a[m],x=a[(m+1)%a.length],w=a[(m+2)%a.length];c+=(y.x-x.x)*(w.y-x.y)-(w.x-x.x)*(y.y-x.y)}c>0&&a.reverse();let h=Ag(a.flatMap(m=>[m.x,m.y]),[]);return h.length===0?null:{vertices:a,indices:h}}function _N(t,e){let n=[],a=[],c=0,h=[];for(let m of t){c=n.length;let y=m.vertexArray.float32,x=m.indexArray.uint16;for(let w=0;w<m.vertexArray.length;w++)h[0]=y[3*w+0],h[1]=y[3*w+1],h[2]=y[3*w+2],r.Q.transformMat4(h,h,e),n.push(new ft(h[0],h[1]));for(let w=0;w<3*m.indexArray.length;w++)a.push(x[w]+c)}if(a.length%3!=0)return null;for(let m=0;m<a.length;m+=3){let y=n[a[m+0]],x=n[a[m+1]],w=n[a[m+2]];(y.x-x.x)*(w.y-x.y)-(w.x-x.x)*(y.y-x.y)>0&&([a[m+1],a[m+2]]=[a[m+2],a[m+1]])}return{vertices:n,indices:a}}function lT(t){let e=function(x,w){let C=[],A=WebGL2RenderingContext;if(x.json.textures)for(let S of x.json.textures){let F={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};S.sampler!==void 0&&Object.assign(F,x.json.samplers[S.sampler]),C.push({image:w[S.source],sampler:F,uploaded:!1})}return C}(t,t.images),n=function(x,w){let C=[];for(let A of x.json.meshes){let S=[];for(let F of A.primitives)S.push(pN(F,x,w));C.push(S)}return C}(t,e),{scenes:a,scene:c,nodes:h}=t.json,m=a?a[c||0].nodes:h,y=[];for(let x of m)y.push(aT(h[x],t,n));return function(x,w,C){let A={},S=new Set;for(let F=0;F<x.length;F++){let R=C[w[F]];if(!R.extras)continue;let B=R.extras["mapbox:footprint:version"],z=R.extras["mapbox:footprint:id"];(B||z)&&S.add(F),B==="1.0.0"&&z&&(A[z]=F)}for(let F=0;F<x.length;F++){if(S.has(F))continue;let R=x[F],B=C[w[F]];if(!B.extras)continue;let z=null;R.id in A&&(z=_N(x[A[R.id]].meshes,R.matrix)),z||(z=gN(B)),z&&(R.footprint=mN(z))}if(S.size>0){let F=Array.from(S.values()).sort((R,B)=>R-B);for(let R=F.length-1;R>=0;R--)x.splice(F[R],1)}}(y,m,t.json.nodes),y}function yN(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,a=t.aabb.min[1]-1,c=bu/(t.aabb.max[0]-n+2),h=bu/(t.aabb.max[1]-a+2);for(let m=0;m<e.length;m+=3){let y=e[m+2],x=(e[m+0]-n)*c|0,w=(e[m+1]-a)*h|0;y>t.heightmap[w*bu+x]&&(t.heightmap[w*bu+x]=y)}}function vN(t,e){let n={};n.indexArray=new yr,n.indexArray.reserve(4*t.length),n.vertexArray=new pu,n.vertexArray.reserve(10*t.length),n.colorArray=new _r,n.vertexArray.reserve(10*t.length);let a=0;for(let m of t){let y=Math.min(10,Math.max(4,1.3*m.height))*e,x=[-m.normal[1],m.normal[0],0],w=Math.min(.29,.1*m.width/m.depth),C=m.width-2*m.depth*e*(w+.01),A=r.Q.scaleAndAdd([],m.pos,x,C/2),S=r.Q.scaleAndAdd([],m.pos,x,-C/2),F=[A[0],A[1],A[2]+m.height],R=[S[0],S[1],S[2]+m.height],B=r.Q.scaleAndAdd([],m.normal,x,w);r.Q.scale(B,B,y);let z=r.Q.scaleAndAdd([],m.normal,x,-w);r.Q.scale(z,z,y),r.Q.add(B,A,B),r.Q.add(z,S,z),A[2]+=.1,S[2]+=.1,n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(F[0],F[1],F[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]);let j=C/y/2;n.colorArray.emplaceBack(-j-w,-1,j,.8),n.colorArray.emplaceBack(j+w,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+w,-.8,j,.7),n.colorArray.emplaceBack(j+w,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+w,-1.2,j,.8),n.colorArray.emplaceBack(j+w,-1.2,j,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}let c={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Jn.white,c.pbrMetallicRoughness=h,n.material=c,n.aabb=new Oi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}It(sT,"TriangleGridIndex");class cT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let xN=["tile","layer","source","sourceLayer","state"];class uT{constructor(e,n,a,c,h){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of xN)this[n]!==void 0&&(e[n]=this[n]);return e}}class hT{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(pt,16,0),this.featureIndexArray=new AC,this.promoteId=n,this.is3DTile=!1}insert(e,n,a,c,h,m=0,y=0){let x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,h,m);let w=this.grid;for(let C=0;C<n.length;C++){let A=n[C],S=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){let R=A[F];S[0]=Math.min(S[0],R.x),S[1]=Math.min(S[1],R.y),S[2]=Math.max(S[2],R.x),S[3]=Math.max(S[3],R.y)}y!==0&&(S[0]-=y,S[1]-=y,S[2]+=y,S[3]+=y),S[0]<pt&&S[1]<pt&&S[2]>=0&&S[3]>=0&&w.insert(x,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ax(new ud(this.rawTileData)).layers,this.sourceLayerCoder=new cT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,a,c){this.loadVTLayers();let h=e.params||{},m=yt(h.filter),y=e.tileResult,x=e.transform,w=y.bufferedTilespaceBounds,C=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,B,z,j)=>HC(y.bufferedTilespaceGeometry,R,B,z,j));C.sort(bN);let A=null;x.elevation&&C.length>0&&(A=od.create(x.elevation,this.tileID));let S={},F;for(let R=0;R<C.length;R++){let B=C[R];if(B===F)continue;F=B;let z=this.featureIndexArray.get(B),j=null;if(this.is3DTile){let Q=this.bucketLayerIDs[0][0],J=n[Q];if(J.type!=="model")continue;let{queryFeature:X,intersectionZ:ue}=J.queryIntersectsMatchingFeature(y,z.featureIndex,m,x);X&&this.appendToResult(S,Q,z.featureIndex,X,ue)}else this.loadMatchingFeature(S,z,m,h.layers,h.availableImages,n,a,c,(Q,J,X,ue=0)=>(j||(j=Wa(Q,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(y,Q,X,j,this.z,e.transform,e.pixelPosMatrix,A,ue)))}return S}loadMatchingFeature(e,n,a,c,h,m,y,x,w){let{featureIndex:C,bucketIndex:A,sourceLayerIndex:S,layoutVertexArrayOffset:F}=n,R=this.bucketLayerIDs[A];if(c&&!function(Q,J){for(let X=0;X<Q.length;X++)if(J.indexOf(Q[X])>=0)return!0;return!1}(c,R))return;let B=this.sourceLayerCoder.decode(S),z=this.vtLayers[B].feature(C);if(a.needGeometry){let Q=zl(z,!0);if(!a.filter(new W(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!a.filter(new W(this.tileID.overscaledZ),z))return;let j=this.getId(z,B);for(let Q=0;Q<R.length;Q++){let J=R[Q];if(c&&c.indexOf(J)<0)continue;let X=m[J];if(!X)continue;let ue={};j!==void 0&&x&&(ue=x.getState(X.sourceLayer||"_geojsonTileLayer",j));let ne=!w||w(z,X,ue,F);if(!ne)continue;let de=new uT(z,this.z,this.x,this.y,j),ge=Oo({},y[J]);ge.paint=dT(ge.paint,X.paint,z,ue,h),ge.layout=dT(ge.layout,X.layout,z,ue,h),de.layer=ge,this.appendToResult(e,J,C,de,ne)}}appendToResult(e,n,a,c,h){let m=e[n];m===void 0&&(m=e[n]=[]),m.push({featureIndex:a,feature:c,intersectionZ:h})}lookupSymbolFeatures(e,n,a,c,h,m,y,x){let w={};this.loadVTLayers();let C=yt(h);for(let A of e)this.loadMatchingFeature(w,{bucketIndex:a,sourceLayerIndex:c,featureIndex:A,layoutVertexArrayOffset:0},C,m,y,x,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();let c=this.sourceLayerCoder.decode(a),h=this.vtFeatures[c];if(h[n])return h[n];let m=this.vtLayers[c].feature(n);return h[n]=m,m}hasLayer(e){for(let n of this.bucketLayerIDs)for(let a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){let c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];c!=null&&(a=e.properties[c]),typeof a=="boolean"&&(a=Number(a))}return a}}function dT(t,e,n,a,c){return hl(t,(h,m)=>{let y=e instanceof Fe?e.get(m):null;return y&&y.evaluate?y.evaluate(n,a,c):y})}function bN(t,e){return e-t}It(hT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let tb=new Float32Array(262144),Du=new Uint8Array(262144);function fT(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,fT(n));return e}function pT(t,e,n){if(t.meshes)for(let a of t.meshes)a.aabb.min[0]!==1/0&&n.insert(e,a.aabb.min[0],a.aabb.min[1],a.aabb.max[0],a.aabb.max[1]);if(t.children)for(let a of t.children)pT(a,e,n)}let mT=["","wall","door","roof","window","lamp","logo"];class gT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:fT(e)}}}getLocalBounds(){if(!this.node.meshes)return new Oi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new Oi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let a of this.node.meshes)this.node.lightMeshIndex!==e&&n.encapsulate(a.aabb),e++;this.aabb=Oi.applyTransform(n,this.node.matrix)}return this.aabb}}class a_{constructor(e,n,a,c,h,m){this.id=n,this.modelTraits|=md.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=md.HasMapboxMeshFeatures),c&&(this.modelTraits|=md.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let y of e)this.nodesInfo.push(new gT(y)),pT(y,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let a of n){let c=a.node;this.uploaded?this.updatePbrBuffer(c):Wx(c,e,!0)}for(let a of n)n_(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){let c=e.transform.projectionOptions,h=e.style.getBrightness(),m=this.brightness!==h;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||Kp(a.paint.get("model-color").value,m)||Kp(a.paint.get("model-color-mix-intensity").value,m)||Kp(a.paint.get("model-roughness").value,m)||Kp(a.paint.get("model-emissive-strength").value,m)||Kp(a.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=c,this.brightness=h,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let a=this.getNodesInfo(),c=this.id.canonical;for(let h of a){let m=h.feature;h.evaluatedScale=n.paint.get("model-scale").evaluate(m,{},c)}}evaluate(e){let n=this.getNodesInfo();for(let a of n){if(!a.node.meshes)continue;let c=a.feature,h=a.node.meshes&&a.node.meshes[0].featureData,m=a.evaluatedColor[2],y=a.evaluatedRMEA[2],x=this.id.canonical;if(a.hasTranslucentParts=!1,h){for(let w=0;w<mT.length;w++){let C=mT[w];C.length&&(c.properties.part=C);let A=e.paint.get("model-color").evaluate(c,{},x),S=e.paint.get("model-color-mix-intensity").evaluate(c,{},x);a.evaluatedColor[w]=[A.r,A.g,A.b,S],a.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,{},x),a.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x),a.evaluatedRMEA[w][3]=A.a,a.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},x),!a.hasTranslucentParts&&A.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,DN(a,m!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},x);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},x),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){let h=e.findDEMTileFor(a);if(h&&(h.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;let m=od.create(e,a,h);if(!m)return;this.modelTraits&md.HasMapboxMeshFeatures&&this.updateDEM(e,m,a,c);for(let y of this.getNodesInfo()){let x=y.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;let w=x.footprint.vertices,C=m.getElevationAt(w[0].x,w[0].y,!0,!0);for(let A=1;A<w.length;A++)C=Math.min(C,m.getElevationAt(w[A].x,w[A].y,!0,!0));x.elevation=C}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let h=n._dem._modifiedForSources[c];if(h===void 0&&(n._dem._modifiedForSources[c]=[],h=n._dem._modifiedForSources[c]),h.includes(a.canonical))return;let m=n._dem.dim;h.push(a.canonical);let y=!1;for(let x of this.getNodesInfo()){let w=x.node;if(!w.footprint||!w.footprint.grid)continue;let C=w.footprint.grid,A=n.tileCoordToPixel(C.min.x,C.min.y),S=n.tileCoordToPixel(C.max.x,C.max.y),F=Math.min(Math.min(m-S.y,A.x),Math.min(A.y,m-S.x));if(F<0)continue;let R=Cn(F,2,5),B=Math.max(0,A.x-R),z=Math.max(0,A.y-R),j=Math.min(S.x+R,m-1),Q=Math.min(S.y+R,m-1);for(let ne=z;ne<=Q;++ne)for(let de=B;de<=j;++de)Du[ne*m+de]=255;let J=0,X=0;for(let ne=0;ne<C.cellsY;++ne)for(let de=0;de<C.cellsX;++de){if(!C.cells[ne*C.cellsX+de])continue;let ge=n.tileCoordToPixel(C.min.x+de/C.xScale,C.min.y+ne/C.yScale),we=n.tileCoordToPixel(C.min.x+(de+1)/C.xScale,C.min.y+(ne+1)/C.yScale);for(let Oe=ge.y;Oe<=Math.min(we.y+1,m-1);++Oe)for(let Ee=ge.x;Ee<=Math.min(we.x+1,m-1);++Ee)Du[Oe*m+Ee]===255&&(Du[Oe*m+Ee]=0,J+=n.getElevationAtPixel(Ee,Oe),X++)}let ue=J/X;B=Math.max(1,A.x-R),z=Math.max(1,A.y-R),j=Math.min(S.x+R,m-2),Q=Math.min(S.y+R,m-2),y=!0;for(let ne=z;ne<=Q;++ne)for(let de=B;de<=j;++de)Du[ne*m+de]===0&&(tb[ne*m+de]=n._dem.set(de,ne,ue));for(let ne=1;ne<R;++ne){B=Math.max(1,A.x-ne),z=Math.max(1,A.y-ne),j=Math.min(S.x+ne,m-2),Q=Math.min(S.y+ne,m-2);for(let de=z;de<=Q;++de)for(let ge=B;ge<=j;++ge){let we=de*m+ge;if(Du[we]===255){let Oe=0,Ee=0,Ne=-1,Be=-1;for(let Re=-1;Re<=1;++Re)for(let We=-1;We<=1;++We){let Ge=(de+Re)*m+ge+We;if(Du[Ge]>=ne)continue;let Je=tb[Ge],Ke=Math.abs(Je);Ke>Ee&&(Oe=Je,Ee=Ke,Ne=We,Be=Re)}if(Ee>.1){let Re=1-(ne+.5*Math.abs(Ne*Be))/R,We=n._dem.get(ge,de)+Oe*Re,Ge=n._dem.get(ge+Ne,de+Be),Je=n._dem.get(ge-Ne,de-Be,!0);(We-Ge)*(We-Je)>0&&(We=(Ge+Je)/2),tb[we]=n._dem.set(ge,de,We),Du[we]=ne}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=fs.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)n_(n.node),Zx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let a=n.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){let m=c[h].node;c[h].hiddenByReplacement=!!m.footprint&&!a.find(y=>y.footprint===m.footprint)}}getHeightAtTileCoord(e,n){let a=this.getNodesInfo(),c=[],h=[0,0,0];for(let m=0;m<this.nodesInfo.length;m++){let y=a[m],x=y.node.meshes[0],w=Oi.applyTransform(x.aabb,y.node.matrix);if(e<w.min[0]||n<w.min[1]||e>w.max[0]||n>w.max[1])continue;let C=(e-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*bu|0,A=Math.min(63,(n-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*bu|0)*bu+Math.min(63,C);if(h[2]=x.heightmap[A],r.Q.transformMat4(h,h,y.node.matrix),!(x.heightmap[A]<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:h[2],maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new ft(e,n),new ft(e,n),c),c.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Kp(t,e){return!t.isLightConstant&&e}function wN(t,e,n,a,c,h,m,y){let x=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;n[3]>0&&(x=gn(x,255*n[0],n[3]),w=gn(w,255*n[1],n[3]),C=gn(C,255*n[2],n[3]));let A=x<<8|w,S=C<<8|Math.floor(255*a[3]),F=function(ne){let de=Cn(ne,0,2);return Math.min(Math.round(.5*de*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=Cn(c[0],0,1),B=Cn(c[1],0,1),z=Cn(c[2],0,1),j=Cn(c[3],0,1),Q,J,X,ue;if(R!==B&&m!==h&&B!==R){let ne=m-h;J=1/(ne*(B-R)),X=-(h+ne*R)/(ne*(B-R));let de=Cn(c[4],-1,1);ue=Math.pow(10,de),Q=255*z<<8|255*j}else Q=65535,J=0,X=1,ue=1;if(t.emplaceBack(A,S,F,Q,J,X,ue),y){let ne=y.length;y.clear();for(let de=0;de<ne;de++)y.emplaceBack(A,S,F,Q,J,X,ue)}}function DN(t,e,n){let a=t.node,c=0,h=n&md.HasMeshoptCompression;for(let m of a.meshes){if(a.lights&&a.lightMeshIndex===c||!m.featureData)continue;m.featureArray=new ug,m.featureArray.reserve(m.featureData.length);let y=e;for(let x of m.featureData){let w=h?65535&x:x>>16&65535,C=h?x>>16&65535:65535&x,A=(15&C)<8?15&C:0,S=t.evaluatedRMEA[A],F=t.evaluatedColor[A],R=t.emissionHeightBasedParams[A],B;if(y&&A===2&&a.lights&&(B=new ug,B.resize(10*a.lights.length)),wN(m.featureArray,w,F,S,R,m.aabb.min[2],m.aabb.max[2],B),B&&y){y=!1;let z=a.meshes[a.lightMeshIndex];z.featureArray=B,z.featureArray._trim()}}m.featureArray._trim(),c++}}function _T(t,e,n,a){let c=1<<t.z;e.lat=kr((a/pt+t.y)/c),e.lng=Bo((n/pt+t.x)/c)}It(a_,"Tiled3dModelBucket",{omit:["layers"]}),It(gT,"Tiled3dModelFeature");let CN={circle:class extends pn{constructor(t,e,n){super(t,P3,e,n)}createBucket(t){return new rx(t)}queryRadius(t){let e=t;return nd("circle-radius",this,e)+nd("circle-stroke-width",this,e)+gg(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,a,c,h,m,y){let x=qC(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return sE(t,a,h,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=oE(this);return{config:new mu(this,e),defines:n,overrideFog:!1}}},heatmap:class extends pn{createBucket(t){return new lE(t)}constructor(t,e,n){super(t,H3,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return nd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,a,c,h,m,y){let x=this.paint.get("heatmap-radius").evaluate(e,n);return sE(t,a,h,m,y,!0,!0,new ft(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new mu(this,e),overrideFog:!1}:{}}},hillshade:class extends pn{constructor(t,e,n){super(t,q3,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends pn{constructor(t,e,n){super(t,sk,e,n)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new mu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ex(t)}queryRadius(){return gg(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,a,c,h){return!t.queryGeometry.isAboveHorizon&&VC($C(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends pn{constructor(t,e,n){super(t,Rk,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Og(t)}queryRadius(){return gg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,a,c,h,m,y,x){let w=qC(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,n),A=this.paint.get("fill-extrusion-base").evaluate(e,n),S=[0,0],F=y&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=t.tile.getBucket(this);if(F&&B instanceof Og){let X=B.centroidVertexArray,ue=x+1;ue<X.length&&(S[0]=X.geta_centroid_pos0(ue),S[1]=X.geta_centroid_pos1(ue))}if(S[0]===0&&S[1]===1)return!1;h.projection.name==="globe"&&(a=GE([a],[new ft(0,0),new ft(pt,pt)],t.tileID.canonical).map(X=>X.polygon).flat());let z=F?y:null,[j,Q]=function(X,ue,ne,de,ge,we,Oe,Ee,Ne,Be,Re){return X.projection.name==="globe"?function(We,Ge,Je,Ke,Le,Ft,Et,tt,Ht,Nt,Pt){let nt=[],Vt=[],ln=We.projection.upVectorScale(Pt,We.center.lat,We.worldSize).metersToTile,Xt=[0,0,0,1],fn=[0,0,0,1],cn=(Qt,di,li,jn)=>{Qt[0]=di,Qt[1]=li,Qt[2]=jn,Qt[3]=1},bn=jE();Je>0&&(Je+=bn),Ke+=bn;for(let Qt of Ge){let di=[],li=[];for(let jn of Qt){let On=jn.x+Le.x,Gn=jn.y+Le.y,Ei=We.projection.projectTilePoint(On,Gn,Pt),yi=We.projection.upVector(Pt,jn.x,jn.y),Hi=Je,Ni=Ke;if(Et){let Gr=$E(On,Gn,Je,Ke,Et,tt,Ht,Nt);Hi+=Gr.base,Ni+=Gr.top}Je!==0?cn(Xt,Ei.x+yi[0]*ln*Hi,Ei.y+yi[1]*ln*Hi,Ei.z+yi[2]*ln*Hi):cn(Xt,Ei.x,Ei.y,Ei.z),cn(fn,Ei.x+yi[0]*ln*Ni,Ei.y+yi[1]*ln*Ni,Ei.z+yi[2]*ln*Ni),r.Q.transformMat4(Xt,Xt,Ft),r.Q.transformMat4(fn,fn,Ft),di.push(new sd(Xt[0],Xt[1],Xt[2])),li.push(new sd(fn[0],fn[1],fn[2]))}nt.push(di),Vt.push(li)}return[nt,Vt]}(X,ue,ne,de,ge,we,Oe,Ee,Ne,Be,Re):Oe?function(We,Ge,Je,Ke,Le,Ft,Et,tt,Ht){let Nt=[],Pt=[],nt=[0,0,0,1];for(let Vt of We){let ln=[],Xt=[];for(let fn of Vt){let cn=fn.x+Ke.x,bn=fn.y+Ke.y,Qt=$E(cn,bn,Ge,Je,Ft,Et,tt,Ht);nt[0]=cn,nt[1]=bn,nt[2]=Qt.base,nt[3]=1,r.aa.transformMat4(nt,nt,Le),nt[3]=Math.max(nt[3],1e-5);let di=new sd(nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]);nt[0]=cn,nt[1]=bn,nt[2]=Qt.top,nt[3]=1,r.aa.transformMat4(nt,nt,Le),nt[3]=Math.max(nt[3],1e-5);let li=new sd(nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]);ln.push(di),Xt.push(li)}Nt.push(ln),Pt.push(Xt)}return[Nt,Pt]}(ue,ne,de,ge,we,Oe,Ee,Ne,Be):function(We,Ge,Je,Ke,Le){let Ft=[],Et=[],tt=Le[8]*Ge,Ht=Le[9]*Ge,Nt=Le[10]*Ge,Pt=Le[11]*Ge,nt=Le[8]*Je,Vt=Le[9]*Je,ln=Le[10]*Je,Xt=Le[11]*Je;for(let fn of We){let cn=[],bn=[];for(let Qt of fn){let di=Qt.x+Ke.x,li=Qt.y+Ke.y,jn=Le[0]*di+Le[4]*li+Le[12],On=Le[1]*di+Le[5]*li+Le[13],Gn=Le[2]*di+Le[6]*li+Le[14],Ei=Le[3]*di+Le[7]*li+Le[15],yi=jn+tt,Hi=On+Ht,Ni=Gn+Nt,Gr=Math.max(Ei+Pt,1e-5),Zi=jn+nt,ki=On+Vt,ar=Gn+ln,Ar=Math.max(Ei+Xt,1e-5);cn.push(new sd(yi/Gr,Hi/Gr,Ni/Gr)),bn.push(new sd(Zi/Ar,ki/Ar,ar/Ar))}Ft.push(cn),Et.push(bn)}return[Ft,Et]}(ue,ne,de,ge,we)}(h,a,A,C,w,m,z,S,R,h.center.lat,t.tileID.canonical),J=t.queryGeometry;return function(X,ue,ne){let de=1/0;VC(ne,ue)&&(de=HE(ne,ue[0]));for(let ge=0;ge<ue.length;ge++){let we=ue[ge],Oe=X[ge];for(let Ee=0;Ee<we.length-1;Ee++){let Ne=we[Ee],Be=[Ne,we[Ee+1],Oe[Ee+1],Oe[Ee],Ne];ox(ne,Be)&&(de=Math.min(de,HE(ne,Be)))}}return de!==1/0&&de}(j,Q,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends pn{constructor(t,e,n){super(t,WE,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof eu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=JE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Sx(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=XE(this);return{config:new mu(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=eA(nd("line-width",this,e),nd("line-gap-width",this,e)),a=nd("line-offset",this,e);return n/2+Math.abs(a)+gg(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,a,c,h){if(t.queryGeometry.isAboveHorizon)return!1;let m=$C(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*eA(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(a=function(w,C){let A=[],S=new ft(0,0);for(let F=0;F<w.length;F++){let R=w[F],B=[];for(let z=0;z<R.length;z++){let j=R[z],Q=R[z+1],J=z===0?S:j.sub(R[z-1])._unit()._perp(),X=z===R.length-1?S:Q.sub(j)._unit()._perp(),ue=J._add(X)._unit();ue._mult(1/(ue.x*X.x+ue.y*X.y)),B.push(ue._mult(C)._add(j))}A.push(B)}return A}(a,x*t.pixelToTileUnitsFactor)),function(w,C,A){for(let S=0;S<C.length;S++){let F=C[S];if(w.length>=3){for(let R=0;R<F.length;R++)if(vu(w,F[R]))return!0}if(S3(w,F,A))return!0}return!1}(m,a,y)}isTileClipped(){return!0}},symbol:Qg,background:class extends pn{constructor(t,e,n){super(t,zB,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:UA,"raster-particle":zA,sky:class extends pn{constructor(t,e,n){super(t,ZB,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let a=this.paint.get("sky-atmosphere-sun"),c=!a,h=t.style.light,m=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&Gi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Hx(m.azimuthal,90-m.polar,e):Hx(a[0],90-a[1],e)}let n=this.paint.get("sky-gradient-center");return Hx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends pn{constructor(t,e,n){super(t,QB,e)}},model:class extends pn{constructor(t,e,n){super(t,rN,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new qx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof a_?pt-1:0}queryIntersectsFeature(t,e,n,a,c,h){if(!this.modelManager)return!1;let m=this.modelManager,y=t.tile.getBucket(this);if(!(y&&y instanceof qx))return!1;let x=y;for(let w in x.instancesPerModel){let C=x.instancesPerModel[w],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(A)){let S=C.features[C.idToFeaturesIndex[A]],F=m.getModel(w,this.scope);if(!F)return!1;let R=r.a9.create(),B=new Un(0,0),z=x.canonical,j=Number.MAX_VALUE;for(let Q=0;Q<S.instancedDataCount;++Q){let J=16*(S.instancedDataOffset+Q),X=C.instancedDataArray.float32,ue=[X[J+4],X[J+5],X[J+6]];_T(z,B,X[J],0|X[J+1]),YA(R,F,h,B,S.rotation,S.scale,ue,!1,!1,!1),h.projection.name==="globe"&&(R=$x(R,h));let ne=r.a9.multiply([],h.projMatrix,R),de=t.queryGeometry,ge=qA(de.isPointQuery()?de.screenBounds:de.screenGeometry,h,ne,F.aabb);ge!=null&&(j=Math.min(ge,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof au}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,a){let c=t.tile,h=c.getBucket(this),m=null,y=Number.MAX_VALUE;if(!(h&&h instanceof a_))return{queryFeature:m,intersectionZ:y};let x=h.getNodesInfo()[e];if(x.hiddenByReplacement||!x.node.meshes||!n.filter(new W(c.tileID.overscaledZ),x.feature,c.tileID.canonical))return{queryFeature:m,intersectionZ:y};let w=x.node,C=a.calculatePosMatrix(c.tileID.toUnwrapped(),a.worldSize),A=x.evaluatedScale,S=0;a.elevation&&w.elevation&&(S=w.elevation*a.elevation.exaggeration()),r.a9.translate(C,C,[(w.anchor?w.anchor[0]:0)*(A[0]-1),(w.anchor?w.anchor[1]:0)*(A[1]-1),S]),r.a9.scale(C,C,A),r.a9.multiply(C,C,w.matrix);let F=t.queryGeometry,R=F.isPointQuery()?F.screenBounds:F.screenGeometry,B=function(j){let Q=r.a9.multiply([],C,j.matrix),J=r.a9.multiply(Q,a.expandedFarZProjMatrix,Q);for(let X=0;X<j.meshes.length;++X){let ue=j.meshes[X];if(X===j.lightMeshIndex)continue;let ne=qA(R,a,J,ue.aabb);ne!=null&&(y=Math.min(ne,y))}if(j.children)for(let X of j.children)B(X)};if(B(w),y===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:y};let z=new Un(0,0);return _T(c.tileID.canonical,z,x.node.anchor[0],x.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[z.lng,z.lat]},properties:x.feature.properties,id:x.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:y}}}},sn={read:function(t,e){return t.readFields(sn._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(sn.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};sn.Filter.read=function(t,e){return t.readFields(sn.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},sn.Filter._readField=function(t,e,n){t===1?(e.delta_filter=sn.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=sn.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=sn.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=sn.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},sn.Filter.Delta={},sn.Filter.Delta.read=function(t,e){return t.readFields(sn.Filter.Delta._readField,{block_size:0},e)},sn.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},sn.Filter.Zigzag={},sn.Filter.Zigzag.read=function(t,e){return t.readFields(sn.Filter.Zigzag._readField,{},e)},sn.Filter.Zigzag._readField=function(t,e,n){},sn.Filter.BitShuffle={},sn.Filter.BitShuffle.read=function(t,e){return t.readFields(sn.Filter.BitShuffle._readField,{},e)},sn.Filter.BitShuffle._readField=function(t,e,n){},sn.Filter.ByteShuffle={},sn.Filter.ByteShuffle.read=function(t,e){return t.readFields(sn.Filter.ByteShuffle._readField,{},e)},sn.Filter.ByteShuffle._readField=function(t,e,n){},sn.Codec={},sn.Codec.read=function(t,e){return t.readFields(sn.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},sn.Codec._readField=function(t,e,n){t===1?(e.gzip_data=sn.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=sn.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=sn.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=sn.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},sn.Codec.GzipData={},sn.Codec.GzipData.read=function(t,e){return t.readFields(sn.Codec.GzipData._readField,{},e)},sn.Codec.GzipData._readField=function(t,e,n){},sn.Codec.JpegImage={},sn.Codec.JpegImage.read=function(t,e){return t.readFields(sn.Codec.JpegImage._readField,{},e)},sn.Codec.JpegImage._readField=function(t,e,n){},sn.Codec.WebpImage={},sn.Codec.WebpImage.read=function(t,e){return t.readFields(sn.Codec.WebpImage._readField,{},e)},sn.Codec.WebpImage._readField=function(t,e,n){},sn.Codec.PngImage={},sn.Codec.PngImage.read=function(t,e){return t.readFields(sn.Codec.PngImage._readField,{},e)},sn.Codec.PngImage._readField=function(t,e,n){},sn.DataIndexEntry={},sn.DataIndexEntry.read=function(t,e){return t.readFields(sn.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},sn.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(sn.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=sn.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},sn.Layer={},sn.Layer.read=function(t,e){return t.readFields(sn.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},sn.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(sn.DataIndexEntry.read(n,n.readVarint()+n.pos))};let js={read:function(t,e){return t.readFields(js._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=js.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=js.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};js.Uint32Values.read=function(t,e){return t.readFields(js.Uint32Values._readField,{values:[]},e)},js.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(a){if(a.type!==2)throw new Error(`Unsupported pbf type "${a.type}"`);let c=function(m){return m.type===2?m.readVarint()+m.pos:m.pos+1}(a),h=a.pos;return a.pos=c,function(m){a.pos=h;let y=0;for(;a.pos<c;){let x=a.readVarint();m[y++]=x}return m}}(n))},js.Fixed32Values={},js.Fixed32Values.read=function(t,e){return t.readFields(js.Fixed32Values._readField,{values:[]},e)},js.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class EN{constructor(e=0,n=0,a=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=a,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let a=this.items[e];this.ttl>0&&a.expiry<=Date.now()?this.delete(e):(n=a.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,a=!1,c=this.resetTtl){let h;if(a||this.has(e)){if(h=this.items[e],h.value=n,a===!1&&c&&(h.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==h){let m=this.last,y=h.next,x=h.prev;this.first===h&&(this.first=h.next),h.next=null,h.prev=this.last,m.next=h,x!==null&&(x.next=y),y!==null&&(y.prev=x)}}else this.max>0&&this.size===this.max&&this.evict(!0),h=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=h:this.last.next=h;return this.last=h,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function AN(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){let c=a===1?1:0,h=a===2?1:0;for(let m=0;m<e[0];m++){let y=e[1]*m;for(let x=c;x<e[1];x++){let w=e[2]*(x+y);for(let C=h;C<e[2];C++){let A=e[3]*(C+w);for(let S=0;S<e[3];S++){let F=A+S;t[F]+=t[F-n]}}}}n*=e[a]}return t}function TN(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function SN(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let a=t[n],c=t[n+1];t[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,t[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let a=t[n],c=t[n+1],h=t[n+2],m=t[n+3];t[n+0]=(192&a)>>6|(192&c)>>4|(192&h)>>2|192&m,t[n+1]=(48&a)>>4|(48&c)>>2|48&h|(48&m)<<2,t[n+2]=(12&a)>>2|12&c|(12&h)<<2|(12&m)<<4,t[n+3]=3&a|(3&c)<<2|(3&h)<<4|(3&m)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Yl extends Error{constructor(e){super(e),this.name="MRTError"}}var ss=Uint8Array,yd=Uint16Array,IN=Int32Array,yT=new ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vT=new ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),MN=new ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xT=function(t,e){for(var n=new yd(31),a=0;a<31;++a)n[a]=e+=1<<t[a-1];var c=new IN(n[30]);for(a=1;a<30;++a)for(var h=n[a];h<n[a+1];++h)c[h]=h-n[a]<<5|a;return{b:n,r:c}},bT=xT(yT,2),wT=bT.b,FN=bT.r;wT[28]=258,FN[258]=28;for(var PN=xT(vT,0).b,nb=new yd(32768),ir=0;ir<32768;++ir){var vd=(43690&ir)>>1|(21845&ir)<<1;nb[ir]=((65280&(vd=(61680&(vd=(52428&vd)>>2|(13107&vd)<<2))>>4|(3855&vd)<<4))>>8|(255&vd)<<8)>>1}var Jp=function(t,e,n){for(var a=t.length,c=0,h=new yd(e);c<a;++c)t[c]&&++h[t[c]-1];var m,y=new yd(e);for(c=1;c<e;++c)y[c]=y[c-1]+h[c-1]<<1;if(n){m=new yd(1<<e);var x=15-e;for(c=0;c<a;++c)if(t[c])for(var w=c<<4|t[c],C=e-t[c],A=y[t[c]-1]++<<C,S=A|(1<<C)-1;A<=S;++A)m[nb[A]>>x]=w}else for(m=new yd(a),c=0;c<a;++c)t[c]&&(m[c]=nb[y[t[c]-1]++]>>15-t[c]);return m},em=new ss(288);for(ir=0;ir<144;++ir)em[ir]=8;for(ir=144;ir<256;++ir)em[ir]=9;for(ir=256;ir<280;++ir)em[ir]=7;for(ir=280;ir<288;++ir)em[ir]=8;var DT=new ss(32);for(ir=0;ir<32;++ir)DT[ir]=5;var ON=Jp(em,9,1),RN=Jp(DT,5,1),ib=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Gs=function(t,e,n){var a=e/8|0;return(t[a]|t[a+1]<<8)>>(7&e)&n},rb=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},kN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hs=function(t,e,n){var a=new Error(e||kN[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,Hs),!n)throw a;return a},BN=new ss(0),NN=typeof TextDecoder<"u"&&new TextDecoder;try{NN.decode(BN,{stream:!0})}catch{}let LN={gzip_data:"gzip"},UN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},zN={uint32:1,uint16:2,uint8:4},VN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class CT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new Yl("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new Yl(`Expected header with length >= ${a} but got buffer of length ${n.length}`);let c=new ud(n.subarray(0,a)),h=sn.read(c);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Yl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(let m of h.layers)this.layers[m.name]=new jN(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],a=this.getLayer(e.layerName);for(let c=0;c<a.dataIndex.length;c++){let h=a.dataIndex[c],m=h.first_byte-e.firstByte,y=h.last_byte+1-e.firstByte;if(c<e.firstBlock||c>e.lastBlock||a._blocksInProgress.has(c))continue;let x={layerName:a.name,firstByte:m,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[h.bands.length].concat(a.bandShape),buffer:a.buffer,codec:h.codec.codec,filters:h.filters.map(w=>w.filter)};a._blocksInProgress.add(c),n.push(x)}return new ET(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,h)=>{if(n.forEach(m=>a._blocksInProgress.delete(m.blockIndex)),c)throw c;h.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class jN{constructor({version:e,name:n,units:a,tilesize:c,pixel_format:h,buffer:m,data_index:y},x){if(this.version=e,this.version!==1)throw new Yl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=m,this.pixelFormat=UN[h],this.dataIndex=y,this.bandShape=[c+2*m,c+2*m,zN[this.pixelFormat]],this._decodedBlocks=function(w=1e3,C=0,A=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(C)||C<0)throw new TypeError("Invalid ttl value");if(typeof A!="boolean")throw new TypeError("Invalid resetTtl value");return new EN(w,C,A)}(x?x.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[a,c]of this.dataIndex.entries()){for(let[h,m]of c.bands.entries())if(m===e)return{bandIndex:n+h,blockIndex:a,blockBandIndex:h};n+=c.bands.length}break;case"number":for(let[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new Yl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Yl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0,c=1/0,h=-1/0;for(let m of e){let{blockIndex:y}=this.getBlockForBand(m);if(y<0)throw new Yl(`Invalid band: ${JSON.stringify(m)}`);let x=this.dataIndex[y];c=Math.min(c,y),h=Math.max(h,y),n=Math.min(n,x.first_byte),a=Math.max(a,x.last_byte)}return{layerName:this.name,firstByte:n,lastByte:a,firstBlock:c,lastBlock:h}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),c=this._decodedBlocks.get(n.toString());if(!c)throw new Yl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let h=this.dataIndex[n],m=this.bandShape.reduce((w,C)=>w*C,1),y=a*m,x=c.subarray(y,y+m);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:h.offset,scale:h.scale}}}class ET{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}CT.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:a,firstByte:c,lastByte:h,pixelFormat:m,blockShape:y,blockIndex:x,filters:w,codec:C}=n,A=new Uint8Array(t).subarray(c,h+1),S=new Uint32Array(y[0]*y[1]*y[2]),F;if(C!=="gzip_data")throw new Error(`Unhandled codec: ${C}`);return F=function(R,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((J=function(ne){ne[0]==31&&ne[1]==139&&ne[2]==8||Hs(6,"invalid gzip data");var de=ne[3],ge=10;4&de&&(ge+=2+(ne[10]|ne[11]<<8));for(var we=(de>>3&1)+(de>>4&1);we>0;we-=!ne[ge++]);return ge+(2&de)}(Q=R))+8>Q.length&&Hs(6,"invalid gzip data"),function(ne,de,ge,we){var Oe=ne.length;if(!Oe||de.f&&!de.l)return ge||new ss(0);var Ee=!ge,Ne=Ee||de.i!=2,Be=de.i;Ee&&(ge=new ss(3*Oe));var Re,We,Ge=function(Xl){var Kl=ge.length;if(Xl>Kl){var Cu=new ss(Math.max(2*Kl,Xl));Cu.set(ge),ge=Cu}},Je=de.f||0,Ke=de.p||0,Le=de.b||0,Ft=de.l,Et=de.d,tt=de.m,Ht=de.n,Nt=8*Oe;do{if(!Ft){Je=Gs(ne,Ke,1);var Pt=Gs(ne,Ke+1,3);if(Ke+=3,!Pt){var nt=ne[(On=4+((Ke+7)/8|0))-4]|ne[On-3]<<8,Vt=On+nt;if(Vt>Oe){Be&&Hs(0);break}Ne&&Ge(Le+nt),ge.set(ne.subarray(On,Vt),Le),de.b=Le+=nt,de.p=Ke=8*Vt,de.f=Je;continue}if(Pt==1)Ft=ON,Et=RN,tt=9,Ht=5;else if(Pt==2){var ln=Gs(ne,Ke,31)+257,Xt=Gs(ne,Ke+10,15)+4,fn=ln+Gs(ne,Ke+5,31)+1;Ke+=14;for(var cn=new ss(fn),bn=new ss(19),Qt=0;Qt<Xt;++Qt)bn[MN[Qt]]=Gs(ne,Ke+3*Qt,7);Ke+=3*Xt;var di=ib(bn),li=(1<<di)-1,jn=Jp(bn,di,1);for(Qt=0;Qt<fn;){var On,Gn=jn[Gs(ne,Ke,li)];if(Ke+=15&Gn,(On=Gn>>4)<16)cn[Qt++]=On;else{var Ei=0,yi=0;for(On==16?(yi=3+Gs(ne,Ke,3),Ke+=2,Ei=cn[Qt-1]):On==17?(yi=3+Gs(ne,Ke,7),Ke+=3):On==18&&(yi=11+Gs(ne,Ke,127),Ke+=7);yi--;)cn[Qt++]=Ei}}var Hi=cn.subarray(0,ln),Ni=cn.subarray(ln);tt=ib(Hi),Ht=ib(Ni),Ft=Jp(Hi,tt,1),Et=Jp(Ni,Ht,1)}else Hs(1);if(Ke>Nt){Be&&Hs(0);break}}Ne&&Ge(Le+131072);for(var Gr=(1<<tt)-1,Zi=(1<<Ht)-1,ki=Ke;;ki=Ke){var ar=(Ei=Ft[rb(ne,Ke)&Gr])>>4;if((Ke+=15&Ei)>Nt){Be&&Hs(0);break}if(Ei||Hs(2),ar<256)ge[Le++]=ar;else{if(ar==256){ki=Ke,Ft=null;break}var Ar=ar-254;ar>264&&(Ar=Gs(ne,Ke,(1<<(po=yT[Qt=ar-257]))-1)+wT[Qt],Ke+=po);var Tr=Et[rb(ne,Ke)&Zi],wi=Tr>>4;if(Tr||Hs(3),Ke+=15&Tr,Ni=PN[wi],wi>3){var po=vT[wi];Ni+=rb(ne,Ke)&(1<<po)-1,Ke+=po}if(Ke>Nt){Be&&Hs(0);break}Ne&&Ge(Le+131072);var Xa=Le+Ar;if(Le<Ni){var ws=0-Ni,$s=Math.min(Ni,Xa);for(ws+Le<0&&Hs(3);Le<$s;++Le)ge[Le]=(void 0)[ws+Le]}for(;Le<Xa;++Le)ge[Le]=ge[Le-Ni]}}de.l=Ft,de.p=ki,de.b=Le,de.f=Je,Ft&&(Je=1,de.m=tt,de.d=Et,de.n=Ht)}while(!Je);return Le!=ge.length&&Ee?(Re=ge,((We=Le)==null||We>Re.length)&&(We=Re.length),new ss(Re.subarray(0,We))):ge.subarray(0,Le)}(Q.subarray(J,-8),{i:2},new ss(((z=Q)[(j=z.length)-4]|z[j-3]<<8|z[j-2]<<16|z[j-1]<<24)>>>0))));var z,j,Q,J;let X=LN[B];if(!X)throw new Error(`Unhandled codec: ${B}`);let ue=new globalThis.DecompressionStream(X);return new Response(new Blob([R]).stream().pipeThrough(ue)).arrayBuffer().then(ne=>new Uint8Array(ne))}(A,C).then(R=>{let B=js.read(new ud(R));if(B.values==="uint32_values")return B.uint32_values.readValuesInto(S),new VN[m](S.buffer);throw new Error(`Unhandled numeric data "${B.values}"`)}),F.then(R=>{for(let B=w.length-1;B>=0;B--)switch(w[B]){case"delta_filter":AN(R,y);break;case"zigzag_filter":TN(R);break;case"bitshuffle_filter":SN(R,m);break;default:throw new Error(`Unhandled filter "${w[B]}"`)}return{layerName:a,blockIndex:x,data:R}}).catch(R=>{throw R})}))},It(ET,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let AT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ob{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let h=AT[15&a];if(!h)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new ob(y,m,h,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let h=AT.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return sb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:m,nodeSize:y}=this,x=[0,h.length-1,0],w=[];for(;x.length;){let C=x.pop()||0,A=x.pop()||0,S=x.pop()||0;if(A-S<=y){for(let z=S;z<=A;z++){let j=m[2*z],Q=m[2*z+1];j>=e&&j<=a&&Q>=n&&Q<=c&&w.push(h[z])}continue}let F=S+A>>1,R=m[2*F],B=m[2*F+1];R>=e&&R<=a&&B>=n&&B<=c&&w.push(h[F]),(C===0?e<=R:n<=B)&&(x.push(S),x.push(F-1),x.push(1-C)),(C===0?a>=R:c>=B)&&(x.push(F+1),x.push(A),x.push(1-C))}return w}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:h,nodeSize:m}=this,y=[0,c.length-1,0],x=[],w=a*a;for(;y.length;){let C=y.pop()||0,A=y.pop()||0,S=y.pop()||0;if(A-S<=m){for(let z=S;z<=A;z++)ST(h[2*z],h[2*z+1],e,n)<=w&&x.push(c[z]);continue}let F=S+A>>1,R=h[2*F],B=h[2*F+1];ST(R,B,e,n)<=w&&x.push(c[F]),(C===0?e-a<=R:n-a<=B)&&(y.push(S),y.push(F-1),y.push(1-C)),(C===0?e+a>=R:n+a>=B)&&(y.push(F+1),y.push(A),y.push(1-C))}return x}}function sb(t,e,n,a,c,h){if(c-a<=n)return;let m=a+c>>1;TT(t,e,m,a,c,h),sb(t,e,n,a,m-1,1-h),sb(t,e,n,m+1,c,1-h)}function TT(t,e,n,a,c,h){for(;c>a;){if(c-a>600){let w=c-a+1,C=n-a+1,A=Math.log(w),S=.5*Math.exp(2*A/3),F=.5*Math.sqrt(A*S*(w-S)/w)*(C-w/2<0?-1:1);TT(t,e,n,Math.max(a,Math.floor(n-C*S/w+F)),Math.min(c,Math.floor(n+(w-C)*S/w+F)),h)}let m=e[2*n+h],y=a,x=c;for(tm(t,e,a,n),e[2*c+h]>m&&tm(t,e,a,c);y<x;){for(tm(t,e,y,x),y++,x--;e[2*y+h]<m;)y++;for(;e[2*x+h]>m;)x--}e[2*a+h]===m?tm(t,e,a,x):(x++,tm(t,e,x,c)),x<=n&&(a=x+1),n<=x&&(c=x-1)}}function tm(t,e,n,a){ab(t,n,a),ab(e,2*n,2*a),ab(e,2*n+1,2*a+1)}function ab(t,e,n){let a=t[e];t[e]=t[n],t[n]=a}function ST(t,e,n,a){let c=t-n,h=e-a;return c*c+h*h}r.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,a]){let c=Sc([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:gn(t.x,e.x,n),y:gn(t.y,e.y,n),z:gn(t.z,e.z,n)}}},r.A=Ve,r.B=wp,r.C=co,r.D=ng,r.E=Oa,r.F=function(t){let e=t.value,n=[];if(!e)return n;let a=ra(e);return a!=="string"?(n=n.concat([new t_(t.key,e,`string expected, "${a}" found`)]),n):(WA(e,!0)||(n=n.concat([new t_(t.key,e,`invalid url "${e}"`)])),n)},r.G=oe,r.H=be,r.I=Rx,r.J=_e,r.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Sc(t.expression.evaluate(e))}interpolate(t,e,n){return{x:gn(t.x,e.x,n),y:gn(t.y,e.y,n),z:gn(t.z,e.z,n),azimuthal:gn(t.azimuthal,e.azimuthal,n),polar:gn(t.polar,e.polar,n)}}},r.L=he,r.M=class{constructor(t,e,n,a){this.id=t,this.position=e!=null?new Un(e[0],e[1]):new Un(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Oi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let a=Oi.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.a9.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,a,c,h,m=!1){YA(this.matrix,this,t.transform,this.position,e,n,a,c,h,m)}upload(t){if(!this.uploaded){for(let e of this.nodes)Wx(e,t);for(let e of this.nodes)n_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Zx(t)}},r.N=W,r.O=jr,r.P=ft,r.R=mh,r.S=Ec,r.T=Gx,r.U=Fe,r.V=t_,r.W=Vl,r.X=gn,r.Y=pt,r.Z=au,r._=Uc,r.a=Ch,r.a$=Pf,r.a0=function(t,e,n=0,a=!0){let c=new ft(n,n),h=t.sub(c),m=e.add(c),y=[h,new ft(m.x,h.y),m,new ft(h.x,m.y)];return a&&y.push(h.clone()),y},r.a1=function(t,e){let n=[];for(let a=0;a<t.length;a++){let c=Ms(a-1,-1,t.length-1),h=Ms(a+1,-1,t.length-1),m=t[a],y=t[h],x=t[c].sub(m).unit(),w=y.sub(m).unit(),C=w.angleWithSep(x.x,x.y),A=x.add(w).unit().mult(-1*e/Math.sin(C/2));n.push(m.add(A))}return n},r.a2=MA,r.a3=HC,r.a4=function(t,e,n=0){return r.Q.fromValues(((e.x-n)*t.scale-t.x)*pt,(e.y*t.scale-t.y)*pt,BC(e.z,e.y))},r.a5=cx,r.a6=ZE,r.a7=function(t){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(let h of t)e=Math.min(e,h.x),n=Math.min(n,h.y),a=Math.max(a,h.x),c=Math.max(c,h.y);return{min:new ft(e,n),max:new ft(a,c)}},r.a8=Ul,r.aA=Jn,r.aB=an,r.aC=X0,r.aD=$v,r.aE=er,r.aF=qn,r.aG=yC,r.aH=Zg,r.aI=function(){ae.isLoading()||ae.isLoaded()||re()!=="deferred"||ie()},r.aJ=yt,r.aK=zl,r.aL=uT,r.aM=xo,r.aN=Sx,r.aO=Ex,r.aP=Wa,r.aQ=Or,r.aR=Gv,r.aS=YC,r.aT=Ag,r.aU=jx,r.aV=function(t,e){let n=Vl(e.zoom);if(n===0)return ha(t);let a=vg(t),c=fx(a),h=Ul(a.getWest())*e.worldSize,m=Ul(a.getEast())*e.worldSize,y=qa(a.getNorth())*e.worldSize,x=qa(a.getSouth())*e.worldSize,w=[h,y,0],C=[m,y,0],A=[h,x,0],S=[m,x,0],F=r.a9.invert([],e.globeMatrix);return r.Q.transformMat4(w,w,F),r.Q.transformMat4(C,C,F),r.Q.transformMat4(A,A,F),r.Q.transformMat4(S,S,F),c[0]=Za(c[0],A,n),c[1]=Za(c[1],S,n),c[2]=Za(c[2],C,n),c[3]=Za(c[3],w,n),Oi.fromPoints(c)},r.aW=bg,r.aX=Mp,r.aY=Za,r.aZ=gr,r.a_=R3,r.ab=vu,r.ac=UC,r.ad=Cn,r.ae=ho,r.af=function(t,e){let n={};for(let a=0;a<e.length;a++){let c=e[a];c in t&&(n[c]=t[c])}return n},r.ag=Ll,r.ah=qa,r.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,a){let c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){let[h,m]=c.result;return this.scheduler?this.scheduler.add(()=>{a(h,m)},e):a(h,m),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((h,m)=>{c.result=[h,m];for(let y of c.callbacks)this.scheduler?this.scheduler.add(()=>{y(h,m)},e):y(h,m);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(h=>h!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}},r.aj=gi,r.ak=function(t,e,n){let a=JSON.stringify(t.request);return t.data&&(this.deduped.entries[a]={result:[null,t.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{let h=Pc(t.request,(m,y,x,w)=>{m?c(m):y&&c(null,{vectorTile:n?void 0:new Ax(new ud(y)),rawData:y,cacheControl:x,expires:w})});return()=>{h.cancel(),c()}},e)},r.al=function(t){Nf++,Nf>b0&&(t.getActor().send("enforceCacheSizeLimit",fh),Nf=0)},r.am=ao,r.an=uh,r.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.ap=Vr,r.aq=UA,r.ar=zA,r.as=LA,r.at=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<t.length;a++){let c=document.createElement("source");Uf(t[a])||(n.crossOrigin="Anonymous"),c.src=t[a],n.appendChild(c)}return{cancel:()=>{}}},r.au=Yg,r.av=jp,r.aw=Bo,r.ax=kr,r.ay=Rr,r.az=yr,r.b=na,r.b$=dd,r.b0=CT,r.b1=Pc,r.b2=function(t){let e=[];for(let n in t)e.push(t[n]);return e},r.b3=function(t,e){let n=[];for(let a in t)a in e||n.push(a);return n},r.b4=Mf,r.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b6=function(t,e){let{x:n,y:a}=t.point,c=nE(n,a,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a9.multiply(c,c,px(ha(e)))},r.b8=ad,r.b9=os,r.bA=OC,r.bB=function(t){let e=r.a9.identity(new Float64Array(16));r.a9.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,xs,0],a=[0,bs,0];return r.Q.transformMat4(n,n,e),r.Q.transformMat4(a,a,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!gx(t,new Un(t.center.lat,90)),a[0]>0&&a[0]<=t.width&&a[1]>0&&a[1]<=t.height&&!gx(t,new Un(t.center.lat,-90))]},r.bC=function(t,e){let{scale:n}=t.tileTransform,a=n*pt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.bD=Jg,r.bE=VA,r.bF=function(t){let e=VA(t,!0);return r.b7.invert([],[e[0],e[1],e[4],e[5]])},r.bG=ux,r.bH=function(t){let{x:e,y:n}=t.point,{lng:a,lat:c}=t._center;return nE(e,n,t.worldSize,a,c)},r.bI=Zr,r.bJ=Xv,r.bK=function(t){let e=Math.round((t+45+360)%360/90)%4;return g0[e]},r.bL=45,r.bM=ex,r.bN=Ap,r.bO=kl,r.bP=Zv,r.bQ=uo,r.bR=dg,r.bS=MC,r.bT=function(t,e,n){let a=Math.sqrt(t*t+e*e+n*n),c=a>0?Math.acos(n/a)*If:0,h=t!==0||e!==0?Math.atan2(-e,-t)*If+90:0;return h<0&&(h+=360),[a,h,c]},r.bU=fg,r.bV=Oi,r.bW=Sc,r.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bY=function(t){return t({pluginStatus:H,pluginURL:G}),Y.on("pluginStateChange",t),t},r.bZ=Qx,r.b_=i_,r.ba=Rg,r.bb=function(t,e,n,a,c){let h=5*e+2;t.float32[h+0]=n,t.float32[h+1]=a,t.float32[h+2]=c},r.bc=Wg,r.bd=vA,r.be=ox,r.bf=Br,r.bg=Nx,r.bh=AA,r.bi=Ox,r.bj=ob,r.bk=Ms,r.bm=kn,r.bn=Ma,r.bo=fo,r.bp=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.bq=Un,r.br=kA,r.bs=kC,r.bt=hx,r.bu=jA,r.bv=_u,r.bw=JC,r.bx=function(t,e,n,a,c,h,m,y,x){if(x.name==="globe")return JC(t,e,new _u(n,a,c),!1);let w=jp({z:n,x:a,y:c},x);return new Oi([(h+w.x/w.scale)*e,e*(w.y/w.scale),m],[(h+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},r.by=function(t,e,n){let a=0;for(let c=0;c<2;++c)t[c]>0&&(a+=(t[c]-0)*(t[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},r.bz=tr,r.c=lT,r.c$=[1,1,1],r.c0=kx,r.c1=gl,r.c2=$,r.c3=V,r.c4=dh,r.c5=Bc,r.c6=Fs,r.c7=function(t,e,n){return t.type==="custom"?new qB(t,e):new CN[t.type](t,e,n)},r.c8=function(t){let e=t.indexOf(Ji);return e>=0?t.slice(0,e):t},r.c9=function(t){return t.indexOf(Ji)>=0},r.cA=t=>({u_matrix:new Ap(t),u_pixels_to_tile_units:new Qv(t),u_device_pixel_ratio:new uo(t),u_units_to_pixels:new kl(t),u_dash_image:new dg(t),u_gradient_image:new dg(t),u_image_height:new uo(t),u_texsize:new kl(t),u_tile_units_to_pixels:new uo(t),u_alpha_discard_threshold:new uo(t),u_trim_offset:new kl(t),u_emissive_strength:new uo(t)}),r.cB=t=>({u_matrix:new Ap(t),u_texsize:new kl(t),u_pixels_to_tile_units:new Qv(t),u_device_pixel_ratio:new uo(t),u_image:new dg(t),u_units_to_pixels:new kl(t),u_tile_units_to_pixels:new uo(t),u_alpha_discard_threshold:new uo(t),u_trim_offset:new kl(t)}),r.cC=hu,r.cD=Kk,r.cE=Jk,r.cF=oE,r.cG=(t,e,n,a,c,h)=>{let m=t.transform,y=m.projection.name==="globe",x;if(h.paint.get("circle-pitch-alignment")==="map")if(y){let C=tE(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;x=Float32Array.from([C,0,0,C])}else x=m.calculatePixelsToTileUnitsMatrix(n);else x=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(m.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:fs.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:U3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(y){w.u_inv_rot_matrix=a,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Vl(m.zoom);let C=c[0]*pt,A=c[1]*pt;w.u_up_dir=m.projection.upVector(new _u(0,0,0),C,A)}return w},r.cH=XE,r.cI=(t,e,n,a,c,h)=>{let m=t.transform;return{u_matrix:YE(t,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:QE(e,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},r.cJ=(t,e,n,a,c,h,m)=>{let y=t.transform,x=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:YE(t,e,n,a),u_pixels_to_tile_units:x,u_device_pixel_ratio:h,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:KE(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:QE(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_emissive_strength:n.paint.get("line-emissive-strength")}},r.cK=Ff,r.cL=Fp,r.cM=jE,r.cN=w3,r.cO=Og,r.cP=Hl,r.cQ=450,r.cR=7,r.cS=GB,r.cT=256,r.cU=px,r.cV=pu,r.cW=fu,r.cX=Vv,r.cY=function(t,e,n,a,c){return Cn((t-e)/(n-e)*(c-a)+a,a,c)},r.cZ=yu,r.c_=$x,r.ca=function(t){let e=t.indexOf(Ji);return e>=0?t.slice(e+1):""},r.cb=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cc=Ac,r.cd=Y,r.ce=Fc,r.cf=FC,r.cg=class extends Ha{constructor(t){super(t),this.current=p3}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.ch=rh,r.ci=function(t,e,n){let a=Vl(n.zoom),c=t.style.map._antialias,h=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return a===0&&!c&&!h},r.cj=function(t){let e=t.pixelsPerMeter,n=e/fo(1,t.center.lat),a=r.a9.identity(new Float64Array(16));return r.a9.translate(a,a,[t.point.x,t.point.y,0]),r.a9.scale(a,a,[n,n,e]),Float32Array.from(a)},r.ck=vg,r.cl=function(t){let e=tr-5;t=Cn(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(kn(t))),3);return Math.round(n*(Kv.length-1))},r.cm=function(t,e,n,a){let c=e.getNorth(),h=e.getSouth(),m=e.getWest(),y=e.getEast(),x=1<<t.z,w=y-m,C=c-h,A=w/Kh,S=-C/Kv[n],F=[0,A,0,S,0,0,c,m,0];if(t.z>0){let R=180/a;r.ct.multiply(F,F,[R/w+1,0,0,0,R/C+1,0,-.5*R/A,.5*R/S,1])}return F[2]=x,F[5]=t.x,F[8]=t.y,F},r.cn=ha,r.co=function(t,e,n){let a=r.a9.identity(new Float64Array(16)),c=(e/(1<<t)-.5)*Math.PI*2;return r.a9.rotateY(a,n.globeMatrix,c),Float32Array.from(a)},r.cp=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,a=1<<n,c=Math.floor(t.x),h=Math.floor((t.x-c)*a),m=Math.floor(t.y*a),y=this.findDEMTileFor(new Vr(n,c,n,h,m));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let a=this._source();if(!a||t.y<0||t.y>1)return e;let c=a.getSource().maxzoom,h=1<<c,m=Math.floor(t.x),y=t.x-m,x=new Vr(c,m,c,Math.floor(y*h),Math.floor(t.y*h)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;let C=w.dem,A=1<<w.tileID.canonical.z,S=(y*A-w.tileID.canonical.x)*C.dim,F=(t.y*A-w.tileID.canonical.y)*C.dim,R=Math.floor(S),B=Math.floor(F);return(n?this.exaggeration():1)*gn(gn(C.get(R,B),C.get(R,B+1),F-B),gn(C.get(R+1,B),C.get(R+1,B+1),F-B),S-R)}getAtTileOffset(t,e,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new jr(t.wrap+(t.canonical.x+e/pt)/a,(t.canonical.y+n/pt)/a))}getAtTileOffsetFunc(t,e,n,a){return c=>{let h=this.getAtTileOffset(t,c.x,c.y),m=a.upVector(t.canonical,c.x,c.y),y=a.upVectorScale(t.canonical,e,n).metersToTile;return r.Q.scale(m,m,h*y),m}}getForTilePoints(t,e,n,a){if(this.isUsingMockSource())return!1;let c=od.create(this,t,a);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,a=e.tileID,c=1<<t.canonical.z-a.canonical.z,h=t.canonical.x/c-a.canonical.x,m=t.canonical.y/c-a.canonical.y,y=0;for(let x=0;x<t.canonical.z-a.canonical.z&&!n.leaves[y];x++){h*=2,m*=2;let w=2*Math.floor(m)+Math.floor(h);y=n.childOffsets[y]+w,h%=1,m%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let c of t){let h=this.getMinMaxForTile(c.tileID);h&&(n=Math.min(n,h.min),a=Math.max(a,h.max),e=!0)}return e?{min:n,max:a}:null}},r.cq=yg,r.cr=hE,r.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cu=tE,r.cv=x0,r.cw=Xo,r.cx=256,r.cy=function(t,e){let n=[0,0,0],a=bg(ha(e.canonical));return r.Q.transformMat4(n,n,a),r.Q.transformMat4(n,n,t),n},r.cz=t=>({u_camera_to_center_distance:new uo(t),u_extrude_scale:new Qv(t),u_device_pixel_ratio:new uo(t),u_matrix:new Ap(t),u_inv_rot_matrix:new Ap(t),u_merc_center:new kl(t),u_tile_id:new Zv(t),u_zoom_transition:new uo(t),u_up_dir:new Zv(t),u_emissive_strength:new uo(t)}),r.d=zf,r.d$=XA,r.d0=od,r.d1=md,r.d2=ko,r.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=bE(new ft(0,0),new ft(pt,pt),t),n=[];for(let a of this._activeRegions){if(a.hiddenByOverlap||!xE(e,a))continue;let c=xk(a.min,a.max,t);n.push({min:c.min,max:c.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let a of e.cache.getVisibleCoordinates()){let c=e.cache.getTile(a).buckets[e.layer];if(c)for(let h of c.getNodesInfo()){let m=h.node;m.footprint&&n.push({footprint:m.footprint,id:a.toUnwrapped()})}}return n}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let n of e){if(!n.footprint)continue;let a=bE(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Mg(e.min,n.min)||Mg(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){let a=this._activeRegions[e],c=this._prevRegions[n];t=a.priority!==c.priority||!vE(a,c),++e,++n}}if(t){++this._updateTime;let e=n=>{let a=this._activeRegions;if(n>=a.length)return n;let c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n,h=n;for(;c!==a;){let m=this._activeRegions[c];m.hiddenByOverlap=!1;for(let y=0;y<h;y++){let x=this._activeRegions[y];if(!x.hiddenByOverlap&&xE(m,x)&&(m.hiddenByOverlap=DE(m.footprint,m.tileId,x.footprint,x.tileId),m.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Or,a=new yr,c=[],h=t+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),x=(w,C,A)=>{let S=w===h-1?w-2:w===0?w:w-1;return S+=A?24575:0,[S,C]};for(let w=0;w<h;++w)n.emplaceBack(...x(w,0,!0));for(let w=0;w<m;++w)for(let C=0;C<h;++C)n.emplaceBack(...x(C,w,(C===0||C===h-1)&&!0));for(let w=0;w<e.length;++w){let C=e[w];for(let A=0;A<h;++A)n.emplaceBack(...x(A,C,!0))}for(let w=0;w<e.length;++w){let C=a.length,A=e[w]+1+2,S=new yr;for(let B=0;B<A-1;B++){let z=B===A-2,j=z?h*(y-e.length+w-B):h;for(let Q=0;Q<h-1;Q++){let J=B*h+Q;B===0||z||Q===0||Q===h-2?(S.emplaceBack(J+1,J,J+j),S.emplaceBack(J+j,J+j+1,J+1)):(a.emplaceBack(J+1,J,J+j),a.emplaceBack(J+j,J+j+1,J+1))}}let F=er.simpleSegment(0,C,n.length,a.length-C);for(let B=0;B<S.uint16.length;B+=3)a.emplaceBack(S.uint16[B],S.uint16[B+1],S.uint16[B+2]);let R=er.simpleSegment(0,C,n.length,a.length-C);c.push({withoutSkirts:F,withSkirts:R})}return{vertices:n,indices:a,segments:c}}_createGrid(t){let e=this._fillGridMeshWithLods(Kh,Kv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,YC.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new yr;for(let m=0;m<=Kh;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new fu,a=new fu,c=new fu,h=new fu;this._poleSegments=[];for(let m=0,y=0;m<Xv;m++){let x=360/(1<<m);n.emplaceBack(0,-ho,0,.5,0),a.emplaceBack(0,-ho,0,.5,1),c.emplaceBack(0,-ho,0,.5,.5),h.emplaceBack(0,-ho,0,.5,.5);for(let w=0;w<=Kh;w++){let C=w/Kh,A=0,S=gn(0,x,C),[F,R,B]=Jh(N3,L3,S,ho);n.emplaceBack(F,R,B,C,A),a.emplaceBack(F,R,B,C,1-A);let z=kn(S);C=.5+.5*Math.sin(z),A=.5+.5*Math.cos(z),c.emplaceBack(F,R,B,C,A),h.emplaceBack(F,R,B,C,1-A)}this._poleSegments.push(er.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,_g,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,_g,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,_g,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,_g,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.d5=function(t){return wh.has(t)},r.d6=_0,r.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d8=Yo,r.d9=LC,r.dA=Qp,r.dB=function(t){let e=Bf();if(!e)return;let n=e.delete(fl);t&&n.catch(t).then(()=>t())},r.dC=Zp,r.dD=KA,r.dE=function(t){Xx=fs.resolveURL(t),_d||(_d=new Qx(i_(),new Oa)),_d.broadcast("setDracoUrl",Xx)},r.dF=JA,r.dG=function(t){gd=fs.resolveURL(t),_d||(_d=new Qx(i_(),new Oa)),_d.broadcast("setMeshoptUrl",gd)},r.dH=It,r.dI=jl,r.dJ=zs,r.dK=cT,r.dL=hT,r.dM=qE,r.dN=hl,r.dO=bA,r.dP=function(t,e,n,a,c,h,m,y,x,w,C){t.createArrays(),t.tilePixelRatio=pt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let A=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,F={};if(t.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:Q}=t.textSizeData;F.compositeTextSizes=[S["text-size"].possiblyEvaluate(new W(j),y),S["text-size"].possiblyEvaluate(new W(Q),y)]}if(t.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:Q}=t.iconSizeData;F.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new W(j),y),S["icon-size"].possiblyEvaluate(new W(Q),y)]}F.layoutTextSize=S["text-size"].possiblyEvaluate(new W(x+1),y),F.layoutIconSize=S["icon-size"].possiblyEvaluate(new W(x+1),y),F.textMaxSize=S["text-size"].possiblyEvaluate(new W(18),y);let R=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size"),z=!1;for(let j of t.features)if(j.icon&&j.icon.nameSecondary){z=!0;break}for(let j of t.features){let Q=A.get("text-font").evaluate(j,{},y).join(","),J=B.evaluate(j,{},y),X=F.layoutTextSize.evaluate(j,{},y),ue=(F.layoutIconSize.evaluate(j,{},y),{horizontal:{},vertical:void 0}),ne=j.text,de,ge=[0,0];if(ne){let Ee=ne.toString(),Ne=A.get("text-letter-spacing").evaluate(j,{},y)*Br,Be=A.get("text-line-height").evaluate(j,{},y)*Br,Re=p(Ee)?Ne:0,We=A.get("text-anchor").evaluate(j,{},y),Ge=A.get("text-variable-anchor");if(!Ge){let Et=A.get("text-radial-offset").evaluate(j,{},y);ge=Et?AA(We,[Et*Br,Bx]):A.get("text-offset").evaluate(j,{},y).map(tt=>tt*Br)}let Je=R?"center":A.get("text-justify").evaluate(j,{},y),Ke=A.get("symbol-placement")==="point",Le=Ke?A.get("text-max-width").evaluate(j,{},y)*Br:1/0,Ft=Et=>{t.allowVerticalPlacement&&l(Ee)&&(ue.vertical=Px(ne,e,n,c,Q,Le,Be,We,Et,Re,ge,os.vertical,!0,X,J))};if(!R&&Ge){let Et=Je==="auto"?Ge.map(Ht=>Nx(Ht)):[Je],tt=!1;for(let Ht=0;Ht<Et.length;Ht++){let Nt=Et[Ht];if(!ue.horizontal[Nt])if(tt)ue.horizontal[Nt]=ue.horizontal[0];else{let Pt=Px(ne,e,n,c,Q,Le,Be,"center",Nt,Re,ge,os.horizontal,!1,X,J);Pt&&(ue.horizontal[Nt]=Pt,tt=Pt.positionedLines.length===1)}}Ft("left")}else{if(Je==="auto"&&(Je=Nx(We)),Ke||A.get("text-writing-mode").indexOf("horizontal")>=0||!l(Ee)){let Et=Px(ne,e,n,c,Q,Le,Be,We,Je,Re,ge,os.horizontal,!1,X,J);Et&&(ue.horizontal[Je]=Et)}Ft(Ke?"left":Je)}}let we=!1;if(j.icon&&j.icon.namePrimary){let Ee=a[j.icon.namePrimary];Ee&&(de=yB(c[j.icon.namePrimary],j.icon.nameSecondary?c[j.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(j,{},y),A.get("icon-anchor").evaluate(j,{},y)),we=Ee.sdf,t.sdfIcons===void 0?t.sdfIcons=Ee.sdf:t.sdfIcons!==Ee.sdf&&Gi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Oe=SA(ue.horizontal)||ue.vertical;t.iconsInText||(t.iconsInText=!!Oe&&Oe.iconsInText),(Oe||de)&&EB(t,j,ue,de,a,F,X,0,ge,we,m,y,w,C,z)}h&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)},r.dQ=Ax,r.dR=ud,r.dS=Fg,r.dT=Sg,r.dU=Tg,r.dV=ih,r.dW=nA,r.dX=Te,r.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==tT){let n=new Uint32Array(t,0,7),[,,a,c,h,m]=n;e=n.byteLength+c+h+m+h,(a!==t.byteLength||e>=t.byteLength)&&Gi("Invalid b3dm header information.")}return oT(t,e)},r.dZ=function(t,e){let n=lT(t);for(let a of n){for(let c of a.meshes)yN(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(vN(a.lights,e)))}return n},r.d_=a_,r.da=gu,r.db=function([t,e,n]){let a=Math.hypot(t,e,n),c=Math.atan2(t,n),h=.5*Math.PI-Math.acos(-e/a);return new Un(Zr(c),Zr(h))},r.dc=ed,r.dd=O,r.de=gx,r.df=iE,r.dg=function(t){let e=[0,0,0],n=r.a9.identity(new Float64Array(16));return r.a9.multiply(n,t.pixelMatrix,t.globeMatrix),r.Q.transformMat4(e,e,n),new ft(e[0],e[1])},r.dh=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(ch==null){let a=n.navigator?n.navigator.userAgent:null;ch=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ch}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.di=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Rc,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!V(t))return t;let n=Ko(t);return n.params.push(`sdk=js-${E}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!V(t))return t;let n=Ko(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!V(t))return t;let n=Ko(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,a){if(!V(t))return t;let c=Ko(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,a){let c=Ko(t);return V(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${n}`,_l(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!V(t))return t;let a=Ko(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&a.authority!=="raster"&&n===512?"@2x":""}${Pa.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${O.RASTER_URL_PREFIX}${a.path}`:a.authority==="rasterarrays"?a.path=`/${O.RASTERARRAYS_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${O.TILE_URL_VERSION}${a.path}`);let c=this._customAccessToken||function(h){for(let m of h){let y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(t,e){let n=Ko(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+=`raster/${n.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?a+=`rasterarrays/${n.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:a+=`tiles/${n.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(t,e){let n=!!e&&V(e),a=[];for(let c of t.tiles||[])U(c)?a.push(this.canonicalizeTileURL(c,n)):a.push(c);return a}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=Ko(O.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(a.path!=="/"&&(t.path=`${a.path}${t.path}`),!O.REQUIRE_ACCESS_TOKEN)return _l(t);if(e=e||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),_l(t)}},r.dj=function(t,e){e?wh.add(t):wh.delete(t)},r.dk=Pa,r.dl=xh,r.dm=Gf,r.dn=yh,r.dp=lo,r.dq=wv,r.dr=function(t){wh.delete(t)},r.ds=bh,r.dt=ta,r.du=E,r.dv=function(t,e){fh=t,b0=e},r.dw=function(t,e,n=!1){if(H===P||H===k||H===N)throw new Error("setRTLTextPlugin cannot be called multiple times.");G=fs.resolveURL(t),H=P,L=e,q(),n||ie()},r.dx=re,r.dy=function(){i_().acquire(Yx)},r.dz=function(){let t=Yp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Yx),Yp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e=Oo,r.e0=ae,r.e1=function(t){pl(),Os&&Os.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-t;a++)e.delete(n[a])})})},r.f=fs,r.g=function(t,e){return Fc(Oo(t,{type:"json"}),e)},r.h=rs,r.i=class extends t_{},r.j=ra,r.k=Th,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>oT(e,0,t))},r.m=qh,r.n=ig,r.o=Zh,r.p=xA,r.q=Me,r.r=sg,r.s=Fl,r.t=Pl,r.u=Se,r.v=Xc,r.w=Gi,r.x=Jc,r.y=aa}),u(["./shared"],function(r){"use strict";function E(Ye){let ee=Ye?Ye.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function I(Ye){if(typeof Ye=="number"||typeof Ye=="boolean"||typeof Ye=="string"||Ye==null)return JSON.stringify(Ye);if(Array.isArray(Ye)){let le="[";for(let xe of Ye)le+=`${I(xe)},`;return`${le}]`}let ee="{";for(let le of Object.keys(Ye).sort())ee+=`${le}:${I(Ye[le])},`;return`${ee}}`}function O(Ye){let ee="";for(let le of r.b5)ee+=`/${I(Ye[le])}`;return ee}class U{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,le){this._layerConfigs={},this._layers={},this.update(ee,[],le)}update(ee,le,xe){this._options=xe;for(let Qe of ee)this._layerConfigs[Qe.id]=Qe,(this._layers[Qe.id]=r.c7(Qe,this.scope,this._options)).compileFilter(),this.keyCache[Qe.id]&&delete this.keyCache[Qe.id];for(let Qe of le)delete this.keyCache[Qe],delete this._layerConfigs[Qe],delete this._layers[Qe];this.familiesBySource={};let He=function(Qe,at){let kt={};for(let vt=0;vt<Qe.length;vt++){let St=at&&at[Qe[vt].id]||O(Qe[vt]);at&&(at[Qe[vt].id]=St);let Lt=kt[St];Lt||(Lt=kt[St]=[]),Lt.push(Qe[vt])}let je=[];for(let vt in kt)je.push(kt[vt]);return je}(r.b2(this._layerConfigs),this.keyCache);for(let Qe of He){let at=Qe.map(gt=>this._layers[gt.id]),kt=at[0];if(kt.visibility==="none")continue;let je=kt.source||"",vt=this.familiesBySource[je];vt||(vt=this.familiesBySource[je]={});let St=kt.sourceLayer||"_geojsonTileLayer",Lt=vt[St];Lt||(Lt=vt[St]=[]),Lt.push(at)}}}let V=1*r.dJ;class Z{constructor(ee){let le={},xe=[];for(let kt in ee){let je=ee[kt],vt=le[kt]={};for(let St in je.glyphs){let Lt=je.glyphs[+St];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;let gt=Lt.metrics.localGlyph?V:1,ri={x:0,y:0,w:Lt.bitmap.width+2*gt,h:Lt.bitmap.height+2*gt};xe.push(ri),vt[St]=ri}}let{w:He,h:Qe}=r.p(xe),at=new r.dI({width:He||1,height:Qe||1});for(let kt in ee){let je=ee[kt];for(let vt in je.glyphs){let St=je.glyphs[+vt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;let Lt=le[kt][vt],gt=St.metrics.localGlyph?V:1;r.dI.copy(St.bitmap,at,{x:0,y:0},{x:Lt.x+gt,y:Lt.y+gt},St.bitmap)}}this.image=at,this.positions=le}}r.dH(Z,"GlyphAtlas");class te{constructor(ee){this.tileID=new r.ap(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=r.av(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster}parse(ee,le,xe,He,Qe){this.status="parsing",this.data=ee,this.collisionBoxArray=new r.aG;let at=new r.dK(Object.keys(ee.layers).sort()),kt=new r.dL(this.tileID,this.promoteId);kt.bucketLayerIDs=[];let je={},vt=new r.dM(256,256),St={featureIndex:kt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:vt,availableImages:xe,brightness:this.brightness},Lt=le.familiesBySource[this.source];for(let si in Lt){let Mi=ee.layers[si];if(!Mi)continue;let rr=!1,bi=!1,Mr=!1;for(let Xi of Lt[si])Xi[0].type==="symbol"?rr=!0:bi=!0,Xi[0].is3D()&&Xi[0].type!=="model"&&(Mr=!0);if(this.extraShadowCaster&&!Mr||this.isSymbolTile===!0&&!rr||this.isSymbolTile===!1&&!bi)continue;Mi.version===1&&r.w(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let wr=at.encode(si),so=[];for(let Xi=0;Xi<Mi.length;Xi++){let Pi=Mi.feature(Xi),Ue=kt.getId(Pi,si);so.push({feature:Pi,id:Ue,index:Xi,sourceLayerIndex:wr})}for(let Xi of Lt[si]){let Pi=Xi[0];(!this.extraShadowCaster||Pi.is3D()&&Pi.type!=="model")&&(this.isSymbolTile!==void 0&&Pi.type==="symbol"!==this.isSymbolTile||Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(se(Xi,this.zoom,St.brightness,xe),(je[Pi.id]=Pi.createBucket({index:kt.bucketLayerIDs.length,layers:Xi,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wr,sourceID:this.source,projection:this.projection.spec})).populate(so,St,this.tileID.canonical,this.tileTransform),kt.bucketLayerIDs.push(Xi.map(Ue=>Ue.id))))}}let gt,ri,Hn,oi;vt.trim();let Vn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$n=()=>{if(gt)return this.status="done",Qe(gt);if(this.extraShadowCaster)this.status="done",Qe(null,{buckets:r.b2(je).filter(si=>!si.isEmpty()),featureIndex:kt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ri&&Hn&&oi){let si=new Z(ri),Mi=new r.dO(Hn,oi);for(let rr in je){let bi=je[rr];bi instanceof r.aH?(se(bi.layers,this.zoom,St.brightness,xe),r.dP(bi,ri,si.positions,Hn,Mi.iconPositions,this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):bi.hasPattern&&(bi instanceof r.aN||bi instanceof r.aO||bi instanceof r.cO)&&(se(bi.layers,this.zoom,St.brightness,xe),bi.addFeatures(St,this.tileID.canonical,Mi.patternPositions,xe,this.tileTransform,this.brightness))}this.status="done",Qe(null,{buckets:r.b2(je).filter(rr=>!rr.isEmpty()),featureIndex:kt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:si.image,lineAtlas:vt,imageAtlas:Mi,brightness:St.brightness})}};if(!this.extraShadowCaster){let si=r.dN(St.glyphDependencies,bi=>Object.keys(bi).map(Number));Object.keys(si).length?He.send("getGlyphs",{uid:this.uid,stacks:si,scope:this.scope},(bi,Mr)=>{gt||(gt=bi,ri=Mr,$n())},void 0,!1,Vn):ri={};let Mi=Object.keys(St.iconDependencies);Mi.length?He.send("getImages",{icons:Mi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(bi,Mr)=>{gt||(gt=bi,Hn=Mr,$n())},void 0,!1,Vn):Hn={};let rr=Object.keys(St.patternDependencies);rr.length?He.send("getImages",{icons:rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(bi,Mr)=>{gt||(gt=bi,oi=Mr,$n())},void 0,!1,Vn):oi={}}$n()}}function se(Ye,ee,le,xe){let He=new r.N(ee,{brightness:le});for(let Qe of Ye)Qe.recalculate(He,xe)}class pe extends r.E{constructor(ee,le,xe,He,Qe,at){super(),this.actor=ee,this.layerIndex=le,this.availableImages=xe,this.loadVectorData=Qe||r.ak,this.loading={},this.loaded={},this.deduped=new r.ai(ee.scheduler),this.isSpriteLoaded=He,this.scheduler=ee.scheduler,this.brightness=at}loadTile(ee,le){let xe=ee.uid,He=ee&&ee.request,Qe=He&&He.collectResourceTiming,at=this.loading[xe]=new te(ee);at.abort=this.loadVectorData(ee,(kt,je)=>{let vt=!this.loading[xe];if(delete this.loading[xe],vt||kt||!je)return at.status="done",vt||(this.loaded[xe]=at),le(kt);let St=je.rawData,Lt={};je.expires&&(Lt.expires=je.expires),je.cacheControl&&(Lt.cacheControl=je.cacheControl),at.vectorTile=je.vectorTile||new r.dQ(new r.dR(St));let gt=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,(ri,Hn)=>{if(ri||!Hn)return le(ri);let oi={};if(Qe){let Vn=E(He);Vn.length>0&&(oi.resourceTiming=JSON.parse(JSON.stringify(Vn)))}le(null,r.e({rawTileData:St.slice(0)},Hn,Lt,oi))})};this.isSpriteLoaded?gt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(gt,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):gt()}),this.loaded=this.loaded||{},this.loaded[xe]=at})}reloadTile(ee,le){let xe=this.loaded,He=ee.uid,Qe=this;if(xe&&xe[He]){let at=xe[He];at.showCollisionBoxes=ee.showCollisionBoxes,at.projection=ee.projection,at.brightness=ee.brightness,at.tileTransform=r.av(ee.tileID.canonical,ee.projection),at.extraShadowCaster=ee.extraShadowCaster;let kt=(je,vt)=>{let St=at.reloadCallback;St&&(delete at.reloadCallback,at.parse(at.vectorTile,Qe.layerIndex,this.availableImages,Qe.actor,St)),le(je,vt)};at.status==="parsing"?at.reloadCallback=kt:at.status==="done"&&(at.vectorTile?at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,kt):kt())}else le(null,void 0)}abortTile(ee,le){let xe=ee.uid,He=this.loading[xe];He&&(He.abort&&He.abort(),delete this.loading[xe]),le()}removeTile(ee,le){let xe=this.loaded,He=ee.uid;xe&&xe[He]&&delete xe[He],le()}}class Ce{loadTile(ee,le){let{uid:xe,encoding:He,rawImageData:Qe,padding:at}=ee,kt=ImageBitmap&&Qe instanceof ImageBitmap?this.getImageData(Qe,at):Qe;le(null,new r.dS(xe,kt,He,at<1))}getImageData(ee,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);let xe=this.offscreenCanvasContext.getImageData(-le,-le,ee.width+2*le,ee.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}class Te{decodeRasterArray({task:ee,buffer:le},xe){r.b0.performDecoding(le,ee).then(He=>{xe(null,He)},He=>{xe(He)})}}let ce=r.dT.prototype.toGeoJSON,me=class{constructor(Ye){this._feature=Ye,this.extent=r.Y,this.type=Ye.type,this.properties=Ye.tags,"id"in Ye&&!isNaN(Ye.id)&&(this.id=parseInt(Ye.id,10))}loadGeometry(){if(this._feature.type===1){let Ye=[];for(let ee of this._feature.geometry)Ye.push([new r.P(ee[0],ee[1])]);return Ye}{let Ye=[];for(let ee of this._feature.geometry){let le=[];for(let xe of ee)le.push(new r.P(xe[0],xe[1]));Ye.push(le)}return Ye}}toGeoJSON(Ye,ee,le){return ce.call(this,Ye,ee,le)}},ke=class{constructor(Ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.Y,this.length=Ye.length,this._features=Ye}feature(Ye){return new me(this._features[Ye])}};var Pe={exports:{}},Ze=r.dV,$e=r.dU.VectorTileFeature,ot=bt;function bt(Ye,ee){this.options=ee||{},this.features=Ye,this.length=Ye.length}function Tt(Ye,ee){this.id=typeof Ye.id=="number"?Ye.id:void 0,this.type=Ye.type,this.rawGeometry=Ye.type===1?[Ye.geometry]:Ye.geometry,this.properties=Ye.tags,this.extent=ee||4096}bt.prototype.feature=function(Ye){return new Tt(this.features[Ye],this.options.extent)},Tt.prototype.loadGeometry=function(){var Ye=this.rawGeometry;this.geometry=[];for(var ee=0;ee<Ye.length;ee++){for(var le=Ye[ee],xe=[],He=0;He<le.length;He++)xe.push(new Ze(le[He][0],le[He][1]));this.geometry.push(xe)}return this.geometry},Tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ye=this.geometry,ee=1/0,le=-1/0,xe=1/0,He=-1/0,Qe=0;Qe<Ye.length;Qe++)for(var at=Ye[Qe],kt=0;kt<at.length;kt++){var je=at[kt];ee=Math.min(ee,je.x),le=Math.max(le,je.x),xe=Math.min(xe,je.y),He=Math.max(He,je.y)}return[ee,xe,le,He]},Tt.prototype.toGeoJSON=$e.prototype.toGeoJSON;var qt=r.dW,st=ot;function _t(Ye){var ee=new qt;return function(le,xe){for(var He in le.layers)xe.writeMessage(3,wt,le.layers[He])}(Ye,ee),ee.finish()}function wt(Ye,ee){var le;ee.writeVarintField(15,Ye.version||1),ee.writeStringField(1,Ye.name||""),ee.writeVarintField(5,Ye.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ye.length;le++)xe.feature=Ye.feature(le),ee.writeMessage(2,Dt,xe);var He=xe.keys;for(le=0;le<He.length;le++)ee.writeStringField(3,He[le]);var Qe=xe.values;for(le=0;le<Qe.length;le++)ee.writeMessage(4,qe,Qe[le])}function Dt(Ye,ee){var le=Ye.feature;le.id!==void 0&&ee.writeVarintField(1,le.id),ee.writeMessage(2,tn,Ye),ee.writeVarintField(3,le.type),ee.writeMessage(4,zn,le)}function tn(Ye,ee){var le=Ye.feature,xe=Ye.keys,He=Ye.values,Qe=Ye.keycache,at=Ye.valuecache;for(var kt in le.properties){var je=le.properties[kt],vt=Qe[kt];if(je!==null){vt===void 0&&(xe.push(kt),Qe[kt]=vt=xe.length-1),ee.writeVarint(vt);var St=typeof je;St!=="string"&&St!=="boolean"&&St!=="number"&&(je=JSON.stringify(je));var Lt=St+":"+je,gt=at[Lt];gt===void 0&&(He.push(je),at[Lt]=gt=He.length-1),ee.writeVarint(gt)}}}function Yt(Ye,ee){return(ee<<3)+(7&Ye)}function In(Ye){return Ye<<1^Ye>>31}function zn(Ye,ee){for(var le=Ye.loadGeometry(),xe=Ye.type,He=0,Qe=0,at=le.length,kt=0;kt<at;kt++){var je=le[kt],vt=1;xe===1&&(vt=je.length),ee.writeVarint(Yt(1,vt));for(var St=xe===3?je.length-1:je.length,Lt=0;Lt<St;Lt++){Lt===1&&xe!==1&&ee.writeVarint(Yt(2,St-1));var gt=je[Lt].x-He,ri=je[Lt].y-Qe;ee.writeVarint(In(gt)),ee.writeVarint(In(ri)),He+=gt,Qe+=ri}xe===3&&ee.writeVarint(Yt(7,1))}}function qe(Ye,ee){var le=typeof Ye;le==="string"?ee.writeStringField(1,Ye):le==="boolean"?ee.writeBooleanField(7,Ye):le==="number"&&(Ye%1!=0?ee.writeDoubleField(3,Ye):Ye<0?ee.writeSVarintField(6,Ye):ee.writeVarintField(5,Ye))}Pe.exports=_t,Pe.exports.fromVectorTileJs=_t,Pe.exports.fromGeojsonVt=function(Ye,ee){ee=ee||{};var le={};for(var xe in Ye)le[xe]=new st(Ye[xe].features,ee),le[xe].name=xe,le[xe].version=ee.version,le[xe].extent=ee.extent;return _t({layers:le})},Pe.exports.GeoJSONWrapper=st;var xt=r.dX(Pe.exports);let ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ye=>Ye},mt=Math.fround||(Di=new Float32Array(1),Ye=>(Di[0]=+Ye,Di[0]));var Di;let Kn=3,Bt=5,Mn=6;class hi{constructor(ee){this.options=Object.assign(Object.create(ht),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){let{log:le,minZoom:xe,maxZoom:He}=this.options;le&&console.time("total time");let Qe=`prepare ${ee.length} points`;le&&console.time(Qe),this.points=ee;let at=[];for(let je=0;je<ee.length;je++){let vt=ee[je];if(!vt.geometry)continue;let[St,Lt]=vt.geometry.coordinates,gt=mt(oo(St)),ri=mt(pr(Lt));at.push(gt,ri,1/0,je,-1,1),this.options.reduce&&at.push(0)}let kt=this.trees[He+1]=this._createTree(at);le&&console.timeEnd(Qe);for(let je=He;je>=xe;je--){let vt=+Date.now();kt=this.trees[je]=this._createTree(this._cluster(kt,je)),le&&console.log("z%d: %d clusters in %dms",je,kt.numItems,+Date.now()-vt)}return le&&console.timeEnd("total time"),this}getClusters(ee,le){let xe=((ee[0]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,ee[1])),Qe=ee[2]===180?180:((ee[2]+180)%360+360)%360-180,at=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)xe=-180,Qe=180;else if(xe>Qe){let Lt=this.getClusters([xe,He,180,at],le),gt=this.getClusters([-180,He,Qe,at],le);return Lt.concat(gt)}let kt=this.trees[this._limitZoom(le)],je=kt.range(oo(xe),pr(at),oo(Qe),pr(He)),vt=kt.data,St=[];for(let Lt of je){let gt=this.stride*Lt;St.push(vt[gt+Bt]>1?Po(vt,gt,this.clusterProps):this.points[vt[gt+Kn]])}return St}getChildren(ee){let le=this._getOriginId(ee),xe=this._getOriginZoom(ee),He="No cluster with the specified id.",Qe=this.trees[xe];if(!Qe)throw new Error(He);let at=Qe.data;if(le*this.stride>=at.length)throw new Error(He);let kt=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),je=Qe.within(at[le*this.stride],at[le*this.stride+1],kt),vt=[];for(let St of je){let Lt=St*this.stride;at[Lt+4]===ee&&vt.push(at[Lt+Bt]>1?Po(at,Lt,this.clusterProps):this.points[at[Lt+Kn]])}if(vt.length===0)throw new Error(He);return vt}getLeaves(ee,le,xe){let He=[];return this._appendLeaves(He,ee,le=le||10,xe=xe||0,0),He}getTile(ee,le,xe){let He=this.trees[this._limitZoom(ee)],Qe=Math.pow(2,ee),{extent:at,radius:kt}=this.options,je=kt/at,vt=(xe-je)/Qe,St=(xe+1+je)/Qe,Lt={features:[]};return this._addTileFeatures(He.range((le-je)/Qe,vt,(le+1+je)/Qe,St),He.data,le,xe,Qe,Lt),le===0&&this._addTileFeatures(He.range(1-je/Qe,vt,1,St),He.data,Qe,xe,Qe,Lt),le===Qe-1&&this._addTileFeatures(He.range(0,vt,je/Qe,St),He.data,-1,xe,Qe,Lt),Lt.features.length?Lt:null}getClusterExpansionZoom(ee){let le=this._getOriginZoom(ee)-1;for(;le<=this.options.maxZoom;){let xe=this.getChildren(ee);if(le++,xe.length!==1)break;ee=xe[0].properties.cluster_id}return le}_appendLeaves(ee,le,xe,He,Qe){let at=this.getChildren(le);for(let kt of at){let je=kt.properties;if(je&&je.cluster?Qe+je.point_count<=He?Qe+=je.point_count:Qe=this._appendLeaves(ee,je.cluster_id,xe,He,Qe):Qe<He?Qe++:ee.push(kt),ee.length===xe)break}return Qe}_createTree(ee){let le=new r.bj(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<ee.length;xe+=this.stride)le.add(ee[xe],ee[xe+1]);return le.finish(),le.data=ee,le}_addTileFeatures(ee,le,xe,He,Qe,at){for(let kt of ee){let je=kt*this.stride,vt=le[je+Bt]>1,St,Lt,gt;if(vt)St=hs(le,je,this.clusterProps),Lt=le[je],gt=le[je+1];else{let oi=this.points[le[je+Kn]];St=oi.properties;let[Vn,$n]=oi.geometry.coordinates;Lt=oo(Vn),gt=pr($n)}let ri={type:1,geometry:[[Math.round(this.options.extent*(Lt*Qe-xe)),Math.round(this.options.extent*(gt*Qe-He))]],tags:St},Hn;Hn=vt||this.options.generateId?le[je+Kn]:this.points[le[je+Kn]].id,Hn!==void 0&&(ri.id=Hn),at.features.push(ri)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,le){let{radius:xe,extent:He,reduce:Qe,minPoints:at}=this.options,kt=xe/(He*Math.pow(2,le)),je=ee.data,vt=[],St=this.stride;for(let Lt=0;Lt<je.length;Lt+=St){if(je[Lt+2]<=le)continue;je[Lt+2]=le;let gt=je[Lt],ri=je[Lt+1],Hn=ee.within(je[Lt],je[Lt+1],kt),oi=je[Lt+Bt],Vn=oi;for(let $n of Hn){let si=$n*St;je[si+2]>le&&(Vn+=je[si+Bt])}if(Vn>oi&&Vn>=at){let $n,si=gt*oi,Mi=ri*oi,rr=-1,bi=(Lt/St<<5)+(le+1)+this.points.length;for(let Mr of Hn){let wr=Mr*St;if(je[wr+2]<=le)continue;je[wr+2]=le;let so=je[wr+Bt];si+=je[wr]*so,Mi+=je[wr+1]*so,je[wr+4]=bi,Qe&&($n||($n=this._map(je,Lt,!0),rr=this.clusterProps.length,this.clusterProps.push($n)),Qe($n,this._map(je,wr)))}je[Lt+4]=bi,vt.push(si/Vn,Mi/Vn,1/0,bi,-1,Vn),Qe&&vt.push(rr)}else{for(let $n=0;$n<St;$n++)vt.push(je[Lt+$n]);if(Vn>1)for(let $n of Hn){let si=$n*St;if(!(je[si+2]<=le)){je[si+2]=le;for(let Mi=0;Mi<St;Mi++)vt.push(je[si+Mi])}}}}return vt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,le,xe){if(ee[le+Bt]>1){let at=this.clusterProps[ee[le+Mn]];return xe?Object.assign({},at):at}let He=this.points[ee[le+Kn]].properties,Qe=this.options.map(He);return xe&&Qe===He?Object.assign({},Qe):Qe}}function Po(Ye,ee,le){return{type:"Feature",id:Ye[ee+Kn],properties:hs(Ye,ee,le),geometry:{type:"Point",coordinates:[(xe=Ye[ee],360*(xe-.5)),vr(Ye[ee+1])]}};var xe}function hs(Ye,ee,le){let xe=Ye[ee+Bt],He=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Qe=Ye[ee+Mn],at=Qe===-1?{}:Object.assign({},le[Qe]);return Object.assign(at,{cluster:!0,cluster_id:Ye[ee+Kn],point_count:xe,point_count_abbreviated:He})}function oo(Ye){return Ye/360+.5}function pr(Ye){let ee=Math.sin(Ye*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function vr(Ye){let ee=(180-360*Ye)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}var qo={exports:{}};qo.exports=function(){function Ye(Ue,ze,et,it){for(var rt,ut=it,dt=et-ze>>1,lt=et-ze,Ct=Ue[ze],ct=Ue[ze+1],en=Ue[et],Fn=Ue[et+1],Ut=ze+3;Ut<et;Ut+=3){var mi=ee(Ue[Ut],Ue[Ut+1],Ct,ct,en,Fn);if(mi>ut)rt=Ut,ut=mi;else if(mi===ut){var Vi=Math.abs(Ut-dt);Vi<lt&&(rt=Ut,lt=Vi)}}ut>it&&(rt-ze>3&&Ye(Ue,ze,rt,it),Ue[rt+2]=ut,et-rt>3&&Ye(Ue,rt,et,it))}function ee(Ue,ze,et,it,rt,ut){var dt=rt-et,lt=ut-it;if(dt!==0||lt!==0){var Ct=((Ue-et)*dt+(ze-it)*lt)/(dt*dt+lt*lt);Ct>1?(et=rt,it=ut):Ct>0&&(et+=dt*Ct,it+=lt*Ct)}return(dt=Ue-et)*dt+(lt=ze-it)*lt}function le(Ue,ze,et,it){var rt={id:Ue===void 0?null:Ue,type:ze,geometry:et,tags:it,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var dt=ut.geometry,lt=ut.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")xe(ut,dt);else if(lt==="Polygon"||lt==="MultiLineString")for(var Ct=0;Ct<dt.length;Ct++)xe(ut,dt[Ct]);else if(lt==="MultiPolygon")for(Ct=0;Ct<dt.length;Ct++)for(var ct=0;ct<dt[Ct].length;ct++)xe(ut,dt[Ct][ct])}(rt),rt}function xe(Ue,ze){for(var et=0;et<ze.length;et+=3)Ue.minX=Math.min(Ue.minX,ze[et]),Ue.minY=Math.min(Ue.minY,ze[et+1]),Ue.maxX=Math.max(Ue.maxX,ze[et]),Ue.maxY=Math.max(Ue.maxY,ze[et+1])}function He(Ue,ze,et,it){if(ze.geometry){var rt=ze.geometry.coordinates,ut=ze.geometry.type,dt=Math.pow(et.tolerance/((1<<et.maxZoom)*et.extent),2),lt=[],Ct=ze.id;if(et.promoteId?Ct=ze.properties[et.promoteId]:et.generateId&&(Ct=it||0),ut==="Point")Qe(rt,lt);else if(ut==="MultiPoint")for(var ct=0;ct<rt.length;ct++)Qe(rt[ct],lt);else if(ut==="LineString")at(rt,lt,dt,!1);else if(ut==="MultiLineString"){if(et.lineMetrics){for(ct=0;ct<rt.length;ct++)at(rt[ct],lt=[],dt,!1),Ue.push(le(Ct,"LineString",lt,ze.properties));return}kt(rt,lt,dt,!1)}else if(ut==="Polygon")kt(rt,lt,dt,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(ct=0;ct<ze.geometry.geometries.length;ct++)He(Ue,{id:Ct,geometry:ze.geometry.geometries[ct],properties:ze.properties},et,it);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<rt.length;ct++){var en=[];kt(rt[ct],en,dt,!0),lt.push(en)}}Ue.push(le(Ct,ut,lt,ze.properties))}}function Qe(Ue,ze){ze.push(je(Ue[0])),ze.push(vt(Ue[1])),ze.push(0)}function at(Ue,ze,et,it){for(var rt,ut,dt=0,lt=0;lt<Ue.length;lt++){var Ct=je(Ue[lt][0]),ct=vt(Ue[lt][1]);ze.push(Ct),ze.push(ct),ze.push(0),lt>0&&(dt+=it?(rt*ct-Ct*ut)/2:Math.sqrt(Math.pow(Ct-rt,2)+Math.pow(ct-ut,2))),rt=Ct,ut=ct}var en=ze.length-3;ze[2]=1,Ye(ze,0,en,et),ze[en+2]=1,ze.size=Math.abs(dt),ze.start=0,ze.end=ze.size}function kt(Ue,ze,et,it){for(var rt=0;rt<Ue.length;rt++){var ut=[];at(Ue[rt],ut,et,it),ze.push(ut)}}function je(Ue){return Ue/360+.5}function vt(Ue){var ze=Math.sin(Ue*Math.PI/180),et=.5-.25*Math.log((1+ze)/(1-ze))/Math.PI;return et<0?0:et>1?1:et}function St(Ue,ze,et,it,rt,ut,dt,lt){if(it/=ze,ut>=(et/=ze)&&dt<it)return Ue;if(dt<et||ut>=it)return null;for(var Ct=[],ct=0;ct<Ue.length;ct++){var en=Ue[ct],Fn=en.geometry,Ut=en.type,mi=rt===0?en.minX:en.minY,Vi=rt===0?en.maxX:en.maxY;if(mi>=et&&Vi<it)Ct.push(en);else if(!(Vi<et||mi>=it)){var ji=[];if(Ut==="Point"||Ut==="MultiPoint")Lt(Fn,ji,et,it,rt);else if(Ut==="LineString")gt(Fn,ji,et,it,rt,!1,lt.lineMetrics);else if(Ut==="MultiLineString")Hn(Fn,ji,et,it,rt,!1);else if(Ut==="Polygon")Hn(Fn,ji,et,it,rt,!0);else if(Ut==="MultiPolygon")for(var Ki=0;Ki<Fn.length;Ki++){var qi=[];Hn(Fn[Ki],qi,et,it,rt,!0),qi.length&&ji.push(qi)}if(ji.length){if(lt.lineMetrics&&Ut==="LineString"){for(Ki=0;Ki<ji.length;Ki++)Ct.push(le(en.id,Ut,ji[Ki],en.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(ji.length===1?(Ut="LineString",ji=ji[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=ji.length===3?"Point":"MultiPoint"),Ct.push(le(en.id,Ut,ji,en.tags))}}}return Ct.length?Ct:null}function Lt(Ue,ze,et,it,rt){for(var ut=0;ut<Ue.length;ut+=3){var dt=Ue[ut+rt];dt>=et&&dt<=it&&(ze.push(Ue[ut]),ze.push(Ue[ut+1]),ze.push(Ue[ut+2]))}}function gt(Ue,ze,et,it,rt,ut,dt){for(var lt,Ct,ct=ri(Ue),en=rt===0?Vn:$n,Fn=Ue.start,Ut=0;Ut<Ue.length-3;Ut+=3){var mi=Ue[Ut],Vi=Ue[Ut+1],ji=Ue[Ut+2],Ki=Ue[Ut+3],qi=Ue[Ut+4],Ln=rt===0?mi:Vi,vo=rt===0?Ki:qi,Zo=!1;dt&&(lt=Math.sqrt(Math.pow(mi-Ki,2)+Math.pow(Vi-qi,2))),Ln<et?vo>et&&(Ct=en(ct,mi,Vi,Ki,qi,et),dt&&(ct.start=Fn+lt*Ct)):Ln>it?vo<it&&(Ct=en(ct,mi,Vi,Ki,qi,it),dt&&(ct.start=Fn+lt*Ct)):oi(ct,mi,Vi,ji),vo<et&&Ln>=et&&(Ct=en(ct,mi,Vi,Ki,qi,et),Zo=!0),vo>it&&Ln<=it&&(Ct=en(ct,mi,Vi,Ki,qi,it),Zo=!0),!ut&&Zo&&(dt&&(ct.end=Fn+lt*Ct),ze.push(ct),ct=ri(Ue)),dt&&(Fn+=lt)}var Dr=Ue.length-3;mi=Ue[Dr],Vi=Ue[Dr+1],ji=Ue[Dr+2],(Ln=rt===0?mi:Vi)>=et&&Ln<=it&&oi(ct,mi,Vi,ji),Dr=ct.length-3,ut&&Dr>=3&&(ct[Dr]!==ct[0]||ct[Dr+1]!==ct[1])&&oi(ct,ct[0],ct[1],ct[2]),ct.length&&ze.push(ct)}function ri(Ue){var ze=[];return ze.size=Ue.size,ze.start=Ue.start,ze.end=Ue.end,ze}function Hn(Ue,ze,et,it,rt,ut){for(var dt=0;dt<Ue.length;dt++)gt(Ue[dt],ze,et,it,rt,ut,!1)}function oi(Ue,ze,et,it){Ue.push(ze),Ue.push(et),Ue.push(it)}function Vn(Ue,ze,et,it,rt,ut){var dt=(ut-ze)/(it-ze);return Ue.push(ut),Ue.push(et+(rt-et)*dt),Ue.push(1),dt}function $n(Ue,ze,et,it,rt,ut){var dt=(ut-et)/(rt-et);return Ue.push(ze+(it-ze)*dt),Ue.push(ut),Ue.push(1),dt}function si(Ue,ze){for(var et=[],it=0;it<Ue.length;it++){var rt,ut=Ue[it],dt=ut.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")rt=Mi(ut.geometry,ze);else if(dt==="MultiLineString"||dt==="Polygon"){rt=[];for(var lt=0;lt<ut.geometry.length;lt++)rt.push(Mi(ut.geometry[lt],ze))}else if(dt==="MultiPolygon")for(rt=[],lt=0;lt<ut.geometry.length;lt++){for(var Ct=[],ct=0;ct<ut.geometry[lt].length;ct++)Ct.push(Mi(ut.geometry[lt][ct],ze));rt.push(Ct)}et.push(le(ut.id,dt,rt,ut.tags))}return et}function Mi(Ue,ze){var et=[];et.size=Ue.size,Ue.start!==void 0&&(et.start=Ue.start,et.end=Ue.end);for(var it=0;it<Ue.length;it+=3)et.push(Ue[it]+ze,Ue[it+1],Ue[it+2]);return et}function rr(Ue,ze){if(Ue.transformed)return Ue;var et,it,rt,ut=1<<Ue.z,dt=Ue.x,lt=Ue.y;for(et=0;et<Ue.features.length;et++){var Ct=Ue.features[et],ct=Ct.geometry,en=Ct.type;if(Ct.geometry=[],en===1)for(it=0;it<ct.length;it+=2)Ct.geometry.push(bi(ct[it],ct[it+1],ze,ut,dt,lt));else for(it=0;it<ct.length;it++){var Fn=[];for(rt=0;rt<ct[it].length;rt+=2)Fn.push(bi(ct[it][rt],ct[it][rt+1],ze,ut,dt,lt));Ct.geometry.push(Fn)}}return Ue.transformed=!0,Ue}function bi(Ue,ze,et,it,rt,ut){return[Math.round(et*(Ue*it-rt)),Math.round(et*(ze*it-ut))]}function Mr(Ue,ze,et,it,rt){for(var ut=ze===rt.maxZoom?0:rt.tolerance/((1<<ze)*rt.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:et,y:it,z:ze,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},lt=0;lt<Ue.length;lt++){dt.numFeatures++,wr(dt,Ue[lt],ut,rt);var Ct=Ue[lt].minX,ct=Ue[lt].minY,en=Ue[lt].maxX,Fn=Ue[lt].maxY;Ct<dt.minX&&(dt.minX=Ct),ct<dt.minY&&(dt.minY=ct),en>dt.maxX&&(dt.maxX=en),Fn>dt.maxY&&(dt.maxY=Fn)}return dt}function wr(Ue,ze,et,it){var rt=ze.geometry,ut=ze.type,dt=[];if(ut==="Point"||ut==="MultiPoint")for(var lt=0;lt<rt.length;lt+=3)dt.push(rt[lt]),dt.push(rt[lt+1]),Ue.numPoints++,Ue.numSimplified++;else if(ut==="LineString")so(dt,rt,Ue,et,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(lt=0;lt<rt.length;lt++)so(dt,rt[lt],Ue,et,ut==="Polygon",lt===0);else if(ut==="MultiPolygon")for(var Ct=0;Ct<rt.length;Ct++){var ct=rt[Ct];for(lt=0;lt<ct.length;lt++)so(dt,ct[lt],Ue,et,!0,lt===0)}if(dt.length){var en=ze.tags||null;if(ut==="LineString"&&it.lineMetrics){for(var Fn in en={},ze.tags)en[Fn]=ze.tags[Fn];en.mapbox_clip_start=rt.start/rt.size,en.mapbox_clip_end=rt.end/rt.size}var Ut={geometry:dt,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:en};ze.id!==null&&(Ut.id=ze.id),Ue.features.push(Ut)}}function so(Ue,ze,et,it,rt,ut){var dt=it*it;if(it>0&&ze.size<(rt?dt:it))et.numPoints+=ze.length/3;else{for(var lt=[],Ct=0;Ct<ze.length;Ct+=3)(it===0||ze[Ct+2]>dt)&&(et.numSimplified++,lt.push(ze[Ct]),lt.push(ze[Ct+1])),et.numPoints++;rt&&function(ct,en){for(var Fn=0,Ut=0,mi=ct.length,Vi=mi-2;Ut<mi;Vi=Ut,Ut+=2)Fn+=(ct[Ut]-ct[Vi])*(ct[Ut+1]+ct[Vi+1]);if(Fn>0===en)for(Ut=0,mi=ct.length;Ut<mi/2;Ut+=2){var ji=ct[Ut],Ki=ct[Ut+1];ct[Ut]=ct[mi-2-Ut],ct[Ut+1]=ct[mi-1-Ut],ct[mi-2-Ut]=ji,ct[mi-1-Ut]=Ki}}(lt,ut),Ue.push(lt)}}function Xi(Ue,ze){var et=(ze=this.options=function(rt,ut){for(var dt in ut)rt[dt]=ut[dt];return rt}(Object.create(this.options),ze)).debug;if(et&&console.time("preprocess data"),ze.maxZoom<0||ze.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ze.promoteId&&ze.generateId)throw new Error("promoteId and generateId cannot be used together.");var it=function(rt,ut){var dt=[];if(rt.type==="FeatureCollection")for(var lt=0;lt<rt.features.length;lt++)He(dt,rt.features[lt],ut,lt);else He(dt,rt.type==="Feature"?rt:{geometry:rt},ut);return dt}(Ue,ze);this.tiles={},this.tileCoords=[],et&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ze.indexMaxZoom,ze.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(it=function(rt,ut){var dt=ut.buffer/ut.extent,lt=rt,Ct=St(rt,1,-1-dt,dt,0,-1,2,ut),ct=St(rt,1,1-dt,2+dt,0,-1,2,ut);return(Ct||ct)&&(lt=St(rt,1,-dt,1+dt,0,-1,2,ut)||[],Ct&&(lt=si(Ct,1).concat(lt)),ct&&(lt=lt.concat(si(ct,-1)))),lt}(it,ze)).length&&this.splitTile(it,0,0,0),et&&(it.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pi(Ue,ze,et){return 32*((1<<Ue)*et+ze)+Ue}return Xi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Xi.prototype.splitTile=function(Ue,ze,et,it,rt,ut,dt){for(var lt=[Ue,ze,et,it],Ct=this.options,ct=Ct.debug;lt.length;){it=lt.pop(),et=lt.pop(),ze=lt.pop(),Ue=lt.pop();var en=1<<ze,Fn=Pi(ze,et,it),Ut=this.tiles[Fn];if(!Ut&&(ct>1&&console.time("creation"),Ut=this.tiles[Fn]=Mr(Ue,ze,et,it,Ct),this.tileCoords.push({z:ze,x:et,y:it}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ze,et,it,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var mi="z"+ze;this.stats[mi]=(this.stats[mi]||0)+1,this.total++}if(Ut.source=Ue,rt){if(ze===Ct.maxZoom||ze===rt)continue;var Vi=1<<rt-ze;if(et!==Math.floor(ut/Vi)||it!==Math.floor(dt/Vi))continue}else if(ze===Ct.indexMaxZoom||Ut.numPoints<=Ct.indexMaxPoints)continue;if(Ut.source=null,Ue.length!==0){ct>1&&console.time("clipping");var ji,Ki,qi,Ln,vo,Zo,Dr=.5*Ct.buffer/Ct.extent,Aa=.5-Dr,Cc=.5+Dr,qr=1+Dr;ji=Ki=qi=Ln=null,vo=St(Ue,en,et-Dr,et+Cc,0,Ut.minX,Ut.maxX,Ct),Zo=St(Ue,en,et+Aa,et+qr,0,Ut.minX,Ut.maxX,Ct),Ue=null,vo&&(ji=St(vo,en,it-Dr,it+Cc,1,Ut.minY,Ut.maxY,Ct),Ki=St(vo,en,it+Aa,it+qr,1,Ut.minY,Ut.maxY,Ct),vo=null),Zo&&(qi=St(Zo,en,it-Dr,it+Cc,1,Ut.minY,Ut.maxY,Ct),Ln=St(Zo,en,it+Aa,it+qr,1,Ut.minY,Ut.maxY,Ct),Zo=null),ct>1&&console.timeEnd("clipping"),lt.push(ji||[],ze+1,2*et,2*it),lt.push(Ki||[],ze+1,2*et,2*it+1),lt.push(qi||[],ze+1,2*et+1,2*it),lt.push(Ln||[],ze+1,2*et+1,2*it+1)}}},Xi.prototype.getTile=function(Ue,ze,et){var it=this.options,rt=it.extent,ut=it.debug;if(Ue<0||Ue>24)return null;var dt=1<<Ue,lt=Pi(Ue,ze=(ze%dt+dt)%dt,et);if(this.tiles[lt])return rr(this.tiles[lt],rt);ut>1&&console.log("drilling down to z%d-%d-%d",Ue,ze,et);for(var Ct,ct=Ue,en=ze,Fn=et;!Ct&&ct>0;)ct--,en=Math.floor(en/2),Fn=Math.floor(Fn/2),Ct=this.tiles[Pi(ct,en,Fn)];return Ct&&Ct.source?(ut>1&&console.log("found parent tile z%d-%d-%d",ct,en,Fn),ut>1&&console.time("drilling down"),this.splitTile(Ct.source,ct,en,Fn,Ue,ze,et),ut>1&&console.timeEnd("drilling down"),this.tiles[lt]?rr(this.tiles[lt],rt):null):null},function(Ue,ze){return new Xi(Ue,ze)}}();var Bi=r.dX(qo.exports);function Ss(Ye,ee){let le=Ye.tileID.canonical;if(!this._geoJSONIndex)return ee(null,null);let xe=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!xe)return ee(null,null);let He=new ke(xe.features),Qe=xt(He);Qe.byteOffset===0&&Qe.byteLength===Qe.buffer.byteLength||(Qe=new Uint8Array(Qe)),ee(null,{vectorTile:He,rawData:Qe.buffer})}class Zt extends pe{constructor(ee,le,xe,He,Qe,at){super(ee,le,xe,He,Ss,at),Qe&&(this.loadGeoJSON=Qe),this._featureMap=new Map}loadData(ee,le){let xe=ee&&ee.request,He=xe&&xe.collectResourceTiming;this.loadGeoJSON(ee,(Qe,at)=>{if(Qe||!at)return le(Qe);if(typeof at!="object")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){let je=r.t(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));at.features=at.features.filter(vt=>je.value.evaluate({zoom:0},vt))}if(ee.dynamic){at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),ee.append||this._featureMap.clear();for(let je of at.features||[]){let vt=je.id;vt!==void 0&&(je.geometry?this._featureMap.set(vt,je):this._featureMap.delete(vt))}at.features=[...this._featureMap.values()]}this._geoJSONIndex=ee.cluster?new hi(function({superclusterOptions:je,clusterProperties:vt}){if(!vt||!je)return je;let St={},Lt={},gt={accumulated:null,zoom:0},ri={properties:null},Hn=Object.keys(vt);for(let oi of Hn){let[Vn,$n]=vt[oi],si=r.t($n),Mi=r.t(typeof Vn=="string"?[Vn,["accumulated"],["get",oi]]:Vn);St[oi]=si.value,Lt[oi]=Mi.value}return je.map=oi=>{ri.properties=oi;let Vn={};for(let $n of Hn)Vn[$n]=St[$n].evaluate(gt,ri);return Vn},je.reduce=(oi,Vn)=>{ri.properties=Vn;for(let $n of Hn)gt.accumulated=oi[$n],oi[$n]=Lt[$n].evaluate(gt,ri)},je}(ee)).load(at.features):Bi(at,ee.geojsonVtOptions)}catch(je){return le(je)}this.loaded={};let kt={};if(He){let je=E(xe);je&&(kt.resourceTiming={},kt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(je)))}le(null,kt)}})}reloadTile(ee,le){let xe=this.loaded;return xe&&xe[ee.uid]?super.reloadTile(ee,le):this.loadTile(ee,le)}loadGeoJSON(ee,le){if(ee.request)r.g(ee.request,le);else{if(typeof ee.data!="string")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(ee.data))}catch{return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(xe){le(xe)}}getClusterChildren(ee,le){try{le(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(xe){le(xe)}}getClusterLeaves(ee,le){try{le(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(xe){le(xe)}}}class Wt{constructor(ee,le){this.tileID=new r.ap(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=le}parse(ee,le,xe,He){this.status="parsing";let Qe=new r.ap(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),at={},kt=le.familiesBySource[xe.source],je=new r.dL(Qe,xe.promoteId);return je.bucketLayerIDs=[],je.is3DTile=!0,r.dY(ee).then(vt=>{if(!vt)return He(new Error("Could not parse tile"));let St=r.dZ(vt,1/r.bU(xe.tileID.canonical)),Lt=vt.json.extensionsUsed&&vt.json.extensionsUsed.includes("MAPBOX_mesh_features")||vt.json.asset.extras&&vt.json.asset.extras.MAPBOX_mesh_features,gt=vt.json.extensionsUsed&&vt.json.extensionsUsed.includes("EXT_meshopt_compression"),ri=new r.N(this.zoom,{brightness:this.brightness});for(let Hn in kt)for(let oi of kt[Hn]){let Vn=oi[0];je.bucketLayerIDs.push(oi.map(si=>si.id)),Vn.recalculate(ri,[]);let $n=new r.d_(St,Qe,Lt,gt,this.brightness,je);Lt||($n.needsUpload=!0),at[Vn.fqid]=$n,$n.evaluate(Vn)}this.status="done",He(null,{buckets:at,featureIndex:je})}).catch(vt=>He(new Error(vt.message)))}}class Wo{constructor(ee,le,xe,He,Qe,at){this.actor=ee,this.layerIndex=le,this.brightness=at,this.loading={},this.loaded={}}loadTile(ee,le){let xe=ee.uid,He=this.loading[xe]=new Wt(ee,this.brightness);r.b1(ee.request,(Qe,at)=>{let kt=!this.loading[xe];return delete this.loading[xe],kt||Qe?(He.status="done",kt||(this.loaded[xe]=He),le(Qe)):at&&at.byteLength!==0?void He.parse(at,this.layerIndex,ee,(je,vt)=>{He.status="done",this.loaded=this.loaded||{},this.loaded[xe]=He,je||!vt?le(je):le(null,vt)}):(He.status="done",this.loaded[xe]=He,le())})}reloadTile(ee,le){let xe=this.loaded,He=ee.uid;if(xe&&xe[He]){let Qe=xe[He];Qe.projection=ee.projection,Qe.brightness=ee.brightness;let at=(kt,je)=>{Qe.reloadCallback&&(delete Qe.reloadCallback,this.loadTile(ee,le)),le(kt,je)};Qe.status==="parsing"?Qe.reloadCallback=at:Qe.status==="done"&&this.loadTile(ee,le)}}abortTile(ee,le){let xe=ee.uid;this.loading[xe]&&delete this.loading[xe],le()}removeTile(ee,le){let xe=this.loaded,He=ee.uid;xe&&xe[He]&&delete xe[He],le()}}class Yi{constructor(ee){this.self=ee,this.actor=new r.d$(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.br({name:"mercator"}),this.workerSourceTypes={vector:pe,geojson:Zt,"batched-model":Wo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,xe)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=xe},this.self.registerRTLTextPlugin=le=>{if(r.e0.isParsed())throw new Error("RTL text plugin already registered.");r.e0.applyArabicShaping=le.applyArabicShaping,r.e0.processBidirectionalText=le.processBidirectionalText,r.e0.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(ee,le,xe){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],delete this.rasterArrayWorkerSource,xe()}checkIfReady(ee,le,xe){xe()}setReferrer(ee,le){this.referrer=le}spriteLoaded(ee,{scope:le,isLoaded:xe}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][le]=xe,this.workerSources[ee]&&this.workerSources[ee][le])for(let He in this.workerSources[ee][le]){let Qe=this.workerSources[ee][le][He];for(let at in Qe)Qe[at]instanceof pe&&(Qe[at].isSpriteLoaded=xe,Qe[at].fire(new r.b("isSpriteLoaded")))}}setImages(ee,{scope:le,images:xe},He){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][le]=xe,this.workerSources[ee]&&this.workerSources[ee][le]){for(let Qe in this.workerSources[ee][le]){let at=this.workerSources[ee][le][Qe];for(let kt in at)at[kt].availableImages=xe}He()}else He()}setProjection(ee,le){this.projections[ee]=r.br(le)}setBrightness(ee,le,xe){this.brightness=le,xe()}setLayers(ee,le,xe){this.getLayerIndex(ee,le.scope).replace(le.layers,le.options),xe()}updateLayers(ee,le,xe){this.getLayerIndex(ee,le.scope).update(le.layers,le.removedIds,le.options),xe()}loadTile(ee,le,xe){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).loadTile(le,xe)}loadDEMTile(ee,le,xe){this.getDEMWorkerSource(ee,le.source,le.scope).loadTile(le,xe)}decodeRasterArray(ee,le,xe){this.getRasterArrayWorkerSource().decodeRasterArray(le,xe)}reloadTile(ee,le,xe){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).reloadTile(le,xe)}abortTile(ee,le,xe){this.getWorkerSource(ee,le.type,le.source,le.scope).abortTile(le,xe)}removeTile(ee,le,xe){this.getWorkerSource(ee,le.type,le.source,le.scope).removeTile(le,xe)}removeSource(ee,le,xe){if(!(this.workerSources[ee]&&this.workerSources[ee][le.scope]&&this.workerSources[ee][le.scope][le.type]&&this.workerSources[ee][le.scope][le.type][le.source]))return;let He=this.workerSources[ee][le.scope][le.type][le.source];delete this.workerSources[ee][le.scope][le.type][le.source],He.removeSource!==void 0?He.removeSource(le,xe):xe()}loadWorkerSource(ee,le,xe){try{this.self.importScripts(le.url),xe()}catch(He){xe(He.toString())}}syncRTLPluginState(ee,le,xe){try{r.e0.setState(le);let He=r.e0.getPluginURL();if(r.e0.isLoaded()&&!r.e0.isParsed()&&He!=null){this.self.importScripts(He);let Qe=r.e0.isParsed();xe(Qe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${He}`),Qe)}}catch(He){xe(He.toString())}}setDracoUrl(ee,le){this.dracoUrl=le}getAvailableImages(ee,le){this.availableImages[ee]||(this.availableImages[ee]={});let xe=this.availableImages[ee][le];return xe||(xe=[]),xe}getLayerIndex(ee,le){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let xe=this.layerIndexes[ee][le];return xe||(xe=this.layerIndexes[ee][le]=new U,xe.scope=le),xe}getWorkerSource(ee,le,xe,He){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][He]||(this.workerSources[ee][He]={}),this.workerSources[ee][He][le]||(this.workerSources[ee][He][le]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),!this.workerSources[ee][He][le][xe]){let Qe={send:(at,kt,je,vt,St,Lt)=>{this.actor.send(at,kt,je,ee,St,Lt)},scheduler:this.actor.scheduler};this.workerSources[ee][He][le][xe]=new this.workerSourceTypes[le](Qe,this.getLayerIndex(ee,He),this.getAvailableImages(ee,He),this.isSpriteLoaded[ee][He],void 0,this.brightness)}return this.workerSources[ee][He][le][xe]}getDEMWorkerSource(ee,le,xe){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][xe]||(this.demWorkerSources[ee][xe]={}),this.demWorkerSources[ee][xe][le]||(this.demWorkerSources[ee][xe][le]=new Ce),this.demWorkerSources[ee][xe][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Te),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ee,le){r.e1(le)}getWorkerPerformanceMetrics(ee,le,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yi(self)),Yi}),u(["./shared"],function(r){"use strict";function E(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let l=0;l<d.length;l++)if(!E(d[l],i[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&i!==null){if(typeof i!="object"||Object.keys(d).length!==Object.keys(i).length)return!1;for(let l in d)if(!E(d[l],i[l]))return!1;return!0}return d===i}var I=O;function O(d){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(v);try{_=new Worker(b),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(b),p}()?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(U[l=i&&i.failIfMajorPerformanceCaveat]===void 0&&(U[l]=function(p){var _,v=function(b){var D=document.createElement("canvas"),T=Object.create(O.webGLContextAttributes);return T.failIfMajorPerformanceCaveat=b,D.getContext("webgl2",T)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(l)),U[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(d)}var U={};function V(d,i,l){let p=document.createElement(d);return i!=null&&(p.className=i),l&&l.appendChild(p),p}function Z(d,i,l){let p=document.createElementNS("http://www.w3.org/2000/svg",d);for(let _ of Object.keys(i))p.setAttributeNS(null,_,String(i[_]));return l&&l.appendChild(p),p}O.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let te=typeof document<"u"?document.documentElement&&document.documentElement.style:null,se=te&&te.userSelect!==void 0?"userSelect":"WebkitUserSelect",pe;function Ce(){te&&se&&(pe=te[se],te[se]="none")}function Te(){te&&se&&(te[se]=pe)}function ce(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",ce,!0)}function me(){window.addEventListener("click",ce,!0),window.setTimeout(()=>{window.removeEventListener("click",ce,!0)},0)}function ke(d,i){let l=d.getBoundingClientRect();return $e(d,l,i)}function Pe(d,i){let l=d.getBoundingClientRect(),p=[];for(let _=0;_<i.length;_++)p.push($e(d,l,i[_]));return p}function Ze(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function $e(d,i,l){let p=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new r.P((l.clientX-i.left)*p,(l.clientY-i.top)*p)}class ot{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,l){this._updatedSourceCaches[i]=l,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){let l=i.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(i.id),this.setDirty()}removeLayer(i){let l=i.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][i.id]=i,this._updatedLayers[l].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){let i={};for(let l in this._updatedLayers)i[l]=i[l]||{},i[l].updatedIds=Array.from(this._updatedLayers[l].values());for(let l in this._removedLayers)i[l]=i[l]||{},i[l].removedIds=Object.keys(this._removedLayers[l]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class bt extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,l){return r.l(this.requestManager.transformRequest(l,r.R.Model).url).then(p=>{if(!p)return;let _=r.c(p),v=new r.M(i,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.a(new Error(`Could not load model ${i} from ${l}: ${p.message}`)))})}load(i,l){this.models[l]||(this.models[l]={});let p=Object.keys(i);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;let _=[];for(let v of p)_.push(this.loadModel(v,i[v]));Promise.allSettled(_).then(v=>{for(let b=0;b<v.length;b++){let{status:D,value:T}=v[b];D==="fulfilled"&&T&&(this.models[l][p[b]]={model:T,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new r.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,l){return!!this.getModel(i,l)}getModel(i,l){return this.models[l]||(this.models[l]={}),this.models[l][i]?this.models[l][i].model:void 0}addModel(i,l,p){this.models[p]||(this.models[p]={}),this.hasModel(i,p)&&this.models[p][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(l)},p)}addModels(i,l){this.models[l]||(this.models[l]={});let p={};for(let _ in i)this.models[l][_]={},p[_]=this.requestManager.normalizeModelURL(i[_]);this.load(p,l)}addModelsFromBucket(i,l){this.models[l]||(this.models[l]={});let p={};for(let _ of i)this.hasModel(_,l)?this.models[l][_].numReferences++:p[_]=this.requestManager.normalizeModelURL(_);this.load(p,l)}removeModel(i,l){if(this.models[l]&&this.models[l][i]&&(this.models[l][i].numReferences--,this.models[l][i].numReferences===0)){let p=this.models[l][i].model;delete this.models[l][i],p.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,l){this.models[l]||(this.models[l]={});for(let p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(i.context)}}class Tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,p){let _=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][_]=this.stateChanges[i][_]||{},r.e(this.stateChanges[i][_],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(let v in this.state[i])v!==_&&(this.deletedStates[i][v]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][_]===null){this.deletedStates[i][_]={};for(let v in this.state[i][_])p[v]||(this.deletedStates[i][_][v]=null)}else for(let v in p)this.deletedStates[i]&&this.deletedStates[i][_]&&this.deletedStates[i][_][v]===null&&delete this.deletedStates[i][_][v]}removeFeatureState(i,l,p){if(this.deletedStates[i]===null)return;let _=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&l!==void 0)this.deletedStates[i][_]!==null&&(this.deletedStates[i][_]=this.deletedStates[i][_]||{},this.deletedStates[i][_][p]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][_])for(p in this.deletedStates[i][_]={},this.stateChanges[i][_])this.deletedStates[i][_][p]=null;else this.deletedStates[i][_]=null;else this.deletedStates[i]=null}getState(i,l){let p=String(l),_=r.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){let v=this.deletedStates[i][l];if(v===null)return{};for(let b in v)delete _[b]}return _}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){let p={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let v={};for(let b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),r.e(this.state[_][b],this.stateChanges[_][b]),v[b]=this.state[_][b];p[_]=v}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let v={};if(this.deletedStates[_]===null)for(let b in this.state[_])v[b]={},this.state[_][b]={};else for(let b in this.deletedStates[_]){if(this.deletedStates[_][b]===null)this.state[_][b]={};else if(this.state[_][b])for(let D of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][D];v[b]=this.state[_][b]}p[_]=p[_]||{},r.e(p[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(let _ in i)i[_].setFeatureState(p,l)}}function qt(d){let{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class st extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.h({width:1,height:1})}isLoaded(){for(let i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,l){if(this.loaded[l]!==i&&(this.loaded[l]=i,i)){for(let{ids:p,callback:_}of this.requestors)this._notify(p,l,_);this.requestors=[]}}hasImage(i,l){return!!this.getImage(i,l)}getImage(i,l){return this.images[l][i]}addImage(i,l,p){this._validate(i,p)&&(this.images[l][i]=p)}_validate(i,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new r.a(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new r.a(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new r.a(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,l){if(!i)return!0;let p=0;for(let _ of i){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(i,l){return!(i&&(i.length!==4||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l,p){p.version=this.images[l][i].version+1,this.images[l][i]=p,this.updatedImages[l][i]=!0}removeImage(i,l){let p=this.images[l][i];delete this.images[l][i],delete this.patterns[l][i],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,l,p){let _=!0,v=!!this.loaded[l];if(!v)for(let b of i)this.images[l][b]||(_=!1);v||_?this._notify(i,l,p):this.requestors.push({ids:i,scope:l,callback:p})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,l,p){let _={};for(let v of i){this.images[l][v]||this.fire(new r.b("styleimagemissing",{id:v}));let b=this.images[l][v];b?_[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,_)}getPixelSize(i){let{width:l,height:p}=this.atlasImage[i];return{width:l,height:p}}getPattern(i,l){let p=this.patterns[l][i],_=this.getImage(i,l);if(!_)return null;if(p&&p.position.version===_.version)return p.position;if(p)p.position.version=_.version;else{let v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new r.I(v,_);this.patterns[l][i]={bin:v,position:b}}return this._updatePatternAtlas(l),this.patterns[l][i].position}bind(i,l){let p=i.gl,_=this.atlasTexture[l];_?this.dirty&&(_.update(this.atlasImage[l]),this.dirty=!1):(_=new r.T(i,this.atlasImage[l],p.RGBA),this.atlasTexture[l]=_),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(i){let l=[];for(let b in this.patterns[i])l.push(this.patterns[i][b].bin);let{w:p,h:_}=r.p(l),v=this.atlasImage[i];v.resize({width:p||1,height:_||1});for(let b in this.patterns[i]){let{bin:D}=this.patterns[i][b],T=D.x+1,M=D.y+1,P=this.images[i][b].data,k=P.width,N=P.height;r.h.copy(P,v,{x:0,y:0},{x:T,y:M},{width:k,height:N}),r.h.copy(P,v,{x:0,y:N-1},{x:T,y:M-1},{width:k,height:1}),r.h.copy(P,v,{x:0,y:0},{x:T,y:M+N},{width:k,height:1}),r.h.copy(P,v,{x:k-1,y:0},{x:T-1,y:M},{width:1,height:N}),r.h.copy(P,v,{x:0,y:0},{x:T+k,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){for(let i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,l){for(let p of i){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;let _=this.images[l][p];qt(_)&&this.updateImage(p,l,_)}}}function _t(d){let i=d.key,l=d.value,p=d.valueSpec||{},_=d.objectElementValidators||{},v=d.style,b=d.styleSpec,D=[],T=r.j(l);if(T!=="object")return[new r.V(i,l,`object expected, ${T} found`)];for(let M in l){let P=M.split(".")[0],k;_[P]?k=_[P]:p[P]?k=Bi:_["*"]?k=_["*"]:p["*"]&&(k=Bi),k?D=D.concat(k({key:(i&&`${i}.`)+M,value:l[M],valueSpec:p[P]||p["*"],style:v,styleSpec:b,object:l,objectKey:M},l)):D.push(new r.i(i,l[M],`unknown property "${M}"`))}for(let M in p)_[M]||p[M].required&&p[M].default===void 0&&l[M]===void 0&&D.push(new r.V(i,l,`missing required property "${M}"`));return D}function wt(d){let i=d.value,l=d.valueSpec,p=d.style,_=d.styleSpec,v=d.key,b=d.arrayElementValidator||Bi;if(r.j(i)!=="array")return[new r.V(v,i,`array expected, ${r.j(i)} found`)];if(l.length&&i.length!==l.length)return[new r.V(v,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new r.V(v,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let D={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(D.function=l.function),r.j(l.value)==="object"&&(D=l.value);let T=[];for(let M=0;M<i.length;M++)T=T.concat(b({array:i,arrayIndex:M,value:i[M],valueSpec:D,style:p,styleSpec:_,key:`${v}[${M}]`},!0));return T}function Dt(d){let i=d.key,l=d.value,p=d.valueSpec,_=r.j(l);if(_==="number"&&l!=l&&(_="NaN"),_!=="number")return[new r.V(i,l,`number expected, ${_} found`)];if("minimum"in p){let v=p.minimum;if(r.j(p.minimum)==="array"&&(v=p.minimum[d.arrayIndex]),l<v)return[new r.V(i,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(r.j(p.maximum)==="array"&&(v=p.maximum[d.arrayIndex]),l>v)return[new r.V(i,l,`${l} is greater than the maximum value ${v}`)]}return[]}function tn(d){let i=d.valueSpec,l=r.u(d.value.type),p,_,v,b={},D=l!=="categorical"&&d.value.property===void 0,T=!D,M=r.j(d.value.stops)==="array"&&r.j(d.value.stops[0])==="array"&&r.j(d.value.stops[0][0])==="object",P=_t({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(L){if(l==="identity")return[new r.V(L.key,L.value,'identity function may not have a "stops" property')];let H=[],G=L.value;return H=H.concat(wt({key:L.key,value:G,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:k})),r.j(G)==="array"&&G.length===0&&H.push(new r.V(L.key,G,"array must have at least one stop")),H},default:function(L){return Bi({key:L.key,value:L.value,valueSpec:i,style:L.style,styleSpec:L.styleSpec})}}});return l==="identity"&&D&&P.push(new r.V(d.key,d.value,'missing required property "property"')),l==="identity"||d.value.stops||P.push(new r.V(d.key,d.value,'missing required property "stops"')),l==="exponential"&&d.valueSpec.expression&&!r.s(d.valueSpec)&&P.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(T&&!r.m(d.valueSpec)?P.push(new r.V(d.key,d.value,"property functions not supported")):D&&!r.n(d.valueSpec)&&P.push(new r.V(d.key,d.value,"zoom functions not supported"))),l!=="categorical"&&!M||d.value.property!==void 0||P.push(new r.V(d.key,d.value,'"property" property is required')),P;function k(L){let H=[],G=L.value,$=L.key;if(r.j(G)!=="array")return[new r.V($,G,`array expected, ${r.j(G)} found`)];if(G.length!==2)return[new r.V($,G,`array length 2 expected, length ${G.length} found`)];if(M){if(r.j(G[0])!=="object")return[new r.V($,G,`object expected, ${r.j(G[0])} found`)];if(G[0].zoom===void 0)return[new r.V($,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new r.V($,G,"object stop key must have value")];let q=r.u(G[0].zoom);if(typeof q!="number")return[new r.V($,G[0].zoom,"stop zoom values must be numbers")];if(v&&v>q)return[new r.V($,G[0].zoom,"stop zoom values must appear in ascending order")];q!==v&&(v=q,_=void 0,b={}),H=H.concat(_t({key:`${$}[0]`,value:G[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Dt,value:N}}))}else H=H.concat(N({key:`${$}[0]`,value:G[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},G));return r.o(r.q(G[1]))?H.concat([new r.V(`${$}[1]`,G[1],"expressions are not allowed in function stops.")]):H.concat(Bi({key:`${$}[1]`,value:G[1],valueSpec:i,style:L.style,styleSpec:L.styleSpec}))}function N(L,H){let G=r.j(L.value),$=r.u(L.value),q=L.value!==null?L.value:H;if(p){if(G!==p)return[new r.V(L.key,q,`${G} stop domain type must match previous stop domain type ${p}`)]}else p=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new r.V(L.key,q,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&l!=="categorical"){let Y=`number expected, ${G} found`;return r.m(i)&&l===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(L.key,q,Y)]}return l!=="categorical"||G!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?l!=="categorical"&&G==="number"&&typeof $=="number"&&typeof _=="number"&&_!==void 0&&$<_?[new r.V(L.key,q,"stop domain values must appear in ascending order")]:(_=$,l==="categorical"&&$ in b?[new r.V(L.key,q,"stop domain values must be unique")]:(b[$]=!0,[])):[new r.V(L.key,q,`integer expected, found ${String($)}`)]}}function Yt(d){let i=(d.expressionContext==="property"?r.r:r.t)(r.q(d.value),d.valueSpec);if(i.result==="error")return i.value.map(p=>new r.V(`${d.key}${p.key}`,d.value,p.message));let l=i.value.expression||i.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!l.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.v(l))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return In(l,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.x(l,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.y(l))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(d,i){let l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(let _ of i.valueSpec.expression.parameters)l.delete(_);if(l.size===0)return[];let p=[];return d instanceof r.C&&l.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(d.eachChild(_=>{p.push(...In(_,i))}),p)}function zn(d){let i=d.key,l=d.value,p=d.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(r.u(l))===-1&&_.push(new r.V(i,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(r.u(l))===-1&&_.push(new r.V(i,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function qe(d){return r.A(r.q(d.value))?Yt(r.k({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):xt(d)}function xt(d){let i=d.value,l=d.key;if(r.j(i)!=="array")return[new r.V(l,i,`array expected, ${r.j(i)} found`)];let p=d.styleSpec,_,v=[];if(i.length<1)return[new r.V(l,i,"filter array must have at least 1 element")];switch(v=v.concat(zn({key:`${l}[0]`,value:i[0],valueSpec:p.filter_operator,style:d.style,styleSpec:d.styleSpec})),r.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.u(i[1])==="$type"&&v.push(new r.V(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new r.V(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(_=r.j(i[1]),_!=="string"&&v.push(new r.V(`${l}[1]`,i[1],`string expected, ${_} found`)));for(let b=2;b<i.length;b++)_=r.j(i[b]),r.u(i[1])==="$type"?v=v.concat(zn({key:`${l}[${b}]`,value:i[b],valueSpec:p.geometry_type,style:d.style,styleSpec:d.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new r.V(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)v=v.concat(xt({key:`${l}[${b}]`,value:i[b],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":_=r.j(i[1]),i.length!==2?v.push(new r.V(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new r.V(`${l}[1]`,i[1],`string expected, ${_} found`))}return v}function ht(d,i){let l=d.key,p=d.style,_=d.layer,v=d.styleSpec,b=d.value,D=d.objectKey,T=v[`${i}_${d.layerType}`];if(!T)return[];let M=D.match(/^(.*)-transition$/);if(i==="paint"&&M&&T[M[1]]&&T[M[1]].transition)return Bi({key:l,value:b,valueSpec:v.transition,style:p,styleSpec:v});let P=d.valueSpec||T[D];if(!P)return[new r.i(l,b,`unknown property "${D}"`)];let k;if(r.j(b)==="string"&&r.m(P)&&!P.tokens&&(k=/^{([^}]+)}$/.exec(b))){let L=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new r.V(l,b,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${L}.`)]}let N=[];if(d.layerType==="symbol")D!=="text-field"||!p||p.glyphs||p.imports||N.push(new r.V(l,b,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&r.B(r.q(b))&&r.u(b.type)==="identity"&&N.push(new r.V(l,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&i==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.m(P)&&(r.D(P)||r.n(P))){let L=r.r(r.q(b),P),H=L.value.expression||L.value._styleExpression.expression;H&&!r.x(H,["measure-light"])&&(D==="model-emissive-strength"&&r.y(H)&&r.v(H)||N.push(new r.V(l,b,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(Bi({key:d.key,value:b,valueSpec:P,style:p,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:D}))}function mt(d){return ht(d,"paint")}function Di(d){return ht(d,"layout")}function Kn(d){let i=[],l=d.value,p=d.key,_=d.style,v=d.styleSpec;l.type||l.ref||i.push(new r.V(p,l,'either "type" or "ref" is required'));let b=r.u(l.type),D=r.u(l.ref);if(l.id){let T=r.u(l.id);for(let M=0;M<d.arrayIndex;M++){let P=_.layers[M];r.u(P.id)===T&&i.push(new r.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(M=>{M in l&&i.push(new r.V(p,l[M],`"${M}" is prohibited for ref layers`))}),_.layers.forEach(M=>{r.u(M.id)===D&&(T=M)}),T?T.ref?i.push(new r.V(p,l.ref,"ref cannot reference another ref layer")):b=r.u(T.type):typeof D=="string"&&i.push(new r.V(p,l.ref,`ref layer "${D}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(l.source){let T=_.sources&&_.sources[l.source],M=T&&r.u(T.type);T?M==="vector"&&b==="raster"?i.push(new r.V(p,l.source,`layer "${l.id}" requires a raster source`)):M==="raster"&&b!=="raster"?i.push(new r.V(p,l.source,`layer "${l.id}" requires a vector source`)):M!=="vector"||l["source-layer"]?M==="raster-dem"&&b!=="hillshade"?i.push(new r.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||M==="geojson"&&T.lineMetrics?b==="raster-particle"&&M!=="raster-array"&&i.push(new r.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):i.push(new r.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new r.V(p,l.source,`source "${l.source}" not found`))}else i.push(new r.V(p,l,'missing required property "source"'));return i=i.concat(_t({key:p,value:l,valueSpec:v.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bi({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:d.style,styleSpec:d.styleSpec,object:l,objectKey:"type"}),filter:T=>qe(r.k({layerType:b},T)),layout:T=>_t({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>Di(r.k({layerType:b},M))}}),paint:T=>_t({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>mt(r.k({layerType:b,layer:l},M))}})}})),i}function Bt(d){let i=d.value,l=d.key,p=r.j(i);return p!=="string"?[new r.V(l,i,`string expected, ${p} found`)]:[]}let Mn={promoteId:function({key:d,value:i}){if(r.j(i)==="string")return Bt({key:d,value:i});{let l=[];for(let p in i)l.push(...Bt({key:`${d}.${p}`,value:i[p]}));return l}}};function hi(d){let i=d.value,l=d.key,p=d.styleSpec,_=d.style;if(!i.type)return[new r.V(l,i,'"type" is required')];let v=r.u(i.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(i.url||i.tiles||b.push(new r.i(l,i,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(_t({key:l,value:i,valueSpec:p[`source_${v.replace("-","_")}`],style:d.style,styleSpec:p,objectElementValidators:Mn})),b;case"geojson":if(b=_t({key:l,value:i,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:Mn}),i.cluster)for(let D in i.clusterProperties){let[T,M]=i.clusterProperties[D],P=typeof T=="string"?[T,["accumulated"],["get",D]]:T;b.push(...Yt({key:`${l}.${D}.map`,value:M,expressionContext:"cluster-map"})),b.push(...Yt({key:`${l}.${D}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return b;case"video":return _t({key:l,value:i,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return _t({key:l,value:i,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new r.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zn({key:`${l}.type`,value:i.type,valueSpec:{values:Po(p)},style:_,styleSpec:p})}}function Po(d){return d.source.reduce((i,l)=>{let p=d[l];return p.type.type==="enum"&&(i=i.concat(Object.keys(p.type.values))),i},[])}function hs(d){let i=d.value,l=d.styleSpec,p=l.light,_=d.style,v=[],b=r.j(i);if(i===void 0)return v;if(b!=="object")return v=v.concat([new r.V("light",i,`object expected, ${b} found`)]),v;for(let D in i){let T=D.match(/^(.*)-transition$/);v=v.concat(T&&p[T[1]]&&p[T[1]].transition?Bi({key:D,value:i[D],valueSpec:l.transition,style:_,styleSpec:l}):p[D]?Bi({key:D,value:i[D],valueSpec:p[D],style:_,styleSpec:l}):[new r.V(D,i[D],`unknown property "${D}"`)])}return v}function oo(d){let i=d.value,l=[];if(!i)return l;let p=r.j(i);if(p!=="object")return l=l.concat([new r.V("light-3d",i,`object expected, ${p} found`)]),l;let _=d.styleSpec,v=_["light-3d"],b=d.key,D=d.style,T=d.style.lights;for(let k of["type","id"])if(!(k in i))return l=l.concat([new r.V("light-3d",i,`missing property ${k} on light`)]),l;if(i.type&&T)for(let k=0;k<d.arrayIndex;k++){let N=r.u(i.type),L=T[k];r.u(L.type)===N&&l.push(new r.V(b,i.id,`duplicate light type "${i.type}", previously defined at line ${L.id.__line__}`))}let M=`properties_light_${i.type}`;if(!(M in _))return l=l.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),l;let P=_[M];for(let k in i)if(k==="properties"){let N=i[k],L=r.j(N);if(L!=="object")return l=l.concat([new r.V("properties",N,`object expected, ${L} found`)]),l;for(let H in N)l=l.concat(P[H]?Bi({key:H,value:N[H],valueSpec:P[H],style:D,styleSpec:_}):[new r.i(d.key,N[H],`unknown property "${H}"`)])}else{let N=k.match(/^(.*)-transition$/);l=l.concat(N&&v[N[1]]&&v[N[1]].transition?Bi({key:k,value:i[k],valueSpec:_.transition,style:D,styleSpec:_}):v[k]?Bi({key:k,value:i[k],valueSpec:v[k],style:D,styleSpec:_}):[new r.i(k,i[k],`unknown property "${k}"`)])}return l}function pr(d){let i=d.value,l=d.key,p=d.style,_=d.styleSpec,v=_.terrain,b=[],D=r.j(i);if(i===void 0||D==="null")return b;if(D!=="object")return b=b.concat([new r.V("terrain",i,`object expected, ${D} found`)]),b;for(let T in i){let M=T.match(/^(.*)-transition$/);b=b.concat(M&&v[M[1]]&&v[M[1]].transition?Bi({key:T,value:i[T],valueSpec:_.transition,style:p,styleSpec:_}):v[T]?Bi({key:T,value:i[T],valueSpec:v[T],style:p,styleSpec:_}):[new r.i(T,i[T],`unknown property "${T}"`)])}if(i.source){let T=p.sources&&p.sources[i.source],M=T&&r.u(T.type);T?M!=="raster-dem"&&b.push(new r.V(l,i.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):b.push(new r.V(l,i.source,`source "${i.source}" not found`))}else b.push(new r.V(l,i,'terrain is missing required property "source"'));return b}function vr(d){let i=d.value,l=d.style,p=d.styleSpec,_=p.fog,v=[],b=r.j(i);if(i===void 0)return v;if(b!=="object")return v=v.concat([new r.V("fog",i,`object expected, ${b} found`)]),v;for(let D in i){let T=D.match(/^(.*)-transition$/);v=v.concat(T&&_[T[1]]&&_[T[1]].transition?Bi({key:D,value:i[D],valueSpec:p.transition,style:l,styleSpec:p}):_[D]?Bi({key:D,value:i[D],valueSpec:_[D],style:l,styleSpec:p}):[new r.i(D,i[D],`unknown property "${D}"`)])}return v}let qo={"*":()=>[],array:wt,boolean:function(d){let i=d.value,l=d.key,p=r.j(i);return p!=="boolean"?[new r.V(l,i,`boolean expected, ${p} found`)]:[]},number:Dt,color:function(d){let i=d.key,l=d.value,p=r.j(l);return p!=="string"?[new r.V(i,l,`color expected, ${p} found`)]:r.z(l)===null?[new r.V(i,l,`color expected, "${l}" found`)]:[]},enum:zn,filter:qe,function:tn,layer:Kn,object:_t,source:hi,model:r.F,light:hs,"light-3d":oo,terrain:pr,fog:vr,string:Bt,formatted:function(d){return Bt(d).length===0?[]:Yt(d)},resolvedImage:function(d){return Bt(d).length===0?[]:Yt(d)},projection:function(d){let i=d.value,l=d.styleSpec,p=l.projection,_=d.style,v=[],b=r.j(i);if(b==="object")for(let D in i)v=v.concat(Bi({key:D,value:i[D],valueSpec:p[D],style:_,styleSpec:l}));else b!=="string"&&(v=v.concat([new r.V("projection",i,`object or string expected, ${b} found`)]));return v},import:function(d){let{value:i,styleSpec:l}=d,b=i,{data:p}=b,_=VT(b,["data"]);Object.defineProperty(_,"__line__",{value:i.__line__,enumerable:!1});let v=_t(r.k({},d,{value:_,valueSpec:l.import}));return r.u(_.id)===""&&v.push(new r.V(`${d.key}.id`,_,"import id can't be an empty string")),p&&(v=v.concat(Zt(p,l,{key:`${d.key}.data`}))),v}};function Bi(d,i=!1){let l=d.value,p=d.valueSpec,_=d.styleSpec;if(p.expression&&r.B(r.u(l)))return tn(d);if(p.expression&&r.o(r.q(l)))return Yt(d);if(p.type&&qo[p.type]){let v=qo[p.type](d);return i===!0&&v.length>0&&r.j(d.value)==="array"?Yt(d):v}return _t(r.k({},d,{valueSpec:p.type?_[p.type]:p}))}function Ss(d){let i=d.value,l=d.key,p=Bt(d);return p.length||(i.indexOf("{fontstack}")===-1&&p.push(new r.V(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&p.push(new r.V(l,i,'"glyphs" url must include a "{range}" token'))),p}function Zt(d,i=r.G,l={}){return Bi({key:l.key||"",value:d,valueSpec:i.$root,styleSpec:i,style:d,objectElementValidators:{glyphs:Ss,"*":()=>[]}})}function Wt(d,i=r.G){return je(Zt(d,i))}let Wo=d=>je(hi(d)),Yi=d=>je(hs(d)),Ye=d=>je(oo(d)),ee=d=>je(pr(d)),le=d=>je(vr(d)),xe=d=>je(Kn(d)),He=d=>je(qe(d)),Qe=d=>je(mt(d)),at=d=>je(Di(d)),kt=d=>je(r.F(d));function je(d){return d.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function vt(d,i){let l=!1;if(i&&i.length)for(let p of i)p instanceof r.i?r.w(p.message):(d.fire(new r.a(new Error(p.message))),l=!0);return l}let St=new r.H({anchor:new r.J(r.G.light.anchor),position:new r.K(r.G.light.position),color:new r.J(r.G.light.color),intensity:new r.J(r.G.light.intensity)});class Lt extends r.E{constructor(i,l="flat"){super(),this._transitionable=new r.L(St),this.setLight(i,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l,p={}){this._validate(Yi,i,p)||(this._transitionable.setTransitionOrValue(i),this.id=l)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&vt(this,i.call(Wt,r.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}let gt=new r.H({source:new r.J(r.G.terrain.source),exaggeration:new r.J(r.G.terrain.exaggeration)}),ri=class extends r.E{constructor(d,i,l,p){super(),this.scope=l,this._transitionable=new r.L(gt,l,p),this._transitionable.setTransitionOrValue(d,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(d,i){this._transitionable.setTransitionOrValue(d,i)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.N(d)).get("exaggeration")}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.Z}},Hn=45,oi=65,Vn=.05;function $n(d,i,l,p){let _=r.S(Hn,oi,l),[v,b]=si(d,p),D=1-Math.min(1,Math.exp((i-v)/(b-v)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*_*d.alpha}function si(d,i){let l=.5/Math.tan(.5*i);return[d.range[0]+l,d.range[1]+l]}function Mi(d,i,l,p,_){let v=r.Q.transformMat4([],[i,l,p],_.mercatorFogMatrix);return $n(d,r.Q.length(v),_.pitch,_._fov)}function rr(d,i,l,p,_,v,b){let D=[[l,p,0],[_,p,0],[_,v,0],[l,v,0]],T=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let P of D){let k=r.Q.transformMat4([],P,i),N=r.Q.length(k);T=Math.min(T,N),M=Math.max(M,N)}return[$n(d,T,b.pitch,b._fov),$n(d,M,b.pitch,b._fov)]}let bi=new r.H({range:new r.J(r.G.fog.range),color:new r.J(r.G.fog.color),"high-color":new r.J(r.G.fog["high-color"]),"space-color":new r.J(r.G.fog["space-color"]),"horizon-blend":new r.J(r.G.fog["horizon-blend"]),"star-intensity":new r.J(r.G.fog["star-intensity"]),"vertical-range":new r.J(r.G.fog["vertical-range"])});class Mr extends r.E{constructor(i,l,p,_){super(),this._transitionable=new r.L(bi,p,new Map(_)),this.set(i,_),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new r.U(bi)}get state(){let i=this._transform,l=i.projection.name==="globe",p=r.W(i.zoom),_=this.properties.get("range"),v=[.5,3];return{range:l?[r.X(v[0],_[0],p),r.X(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l,p={}){if(this._validate(le,i,p))return;let _=r.e({},i);for(let v of Object.keys(r.G.fog))_[v]===void 0&&(_[v]=r.G.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.S(Hn,oi,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(p,_,v){let b=r.O.fromLngLat(_),D=v.elevation?v.elevation.getAtPointOrZero(b):0;return Mi(p,b.x,b.y,D,v)}(this.state,i,l):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];let l=this._transform.calculateFogTileMatrix(i.toUnwrapped());return rr(this.state,l,0,0,r.Y,r.Y,this._transform)}getOpacityForBounds(i,l,p,_,v){return this._transform.projection.supportsFog?rr(this.state,i,l,p,_,v,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?si(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;let l=[4,5,6,7];for(let p of l){let _=i.points[p],v;if(_[2]>=0)v=_;else{let b=i.points[p-4];v=r._(b,_,b[2]/(b[2]-_[2]))}if(Mi(this.state,v[0],v[1],0,this._transform)>=Vn)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&vt(this,i.call(Wt,r.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}class wr extends r.E{constructor(i,l,p,_){super(),this.scope=p,this._options=i,this.properties=new r.U(l),this._transitionable=new r.L(l,p,new Map(_)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,l){this._options=i,this._transitionable.setTransitionOrValue(i.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let so=new r.H({color:new r.J(r.G.properties_light_ambient.color),intensity:new r.J(r.G.properties_light_ambient.intensity)}),Xi=new r.H({direction:new r.$(r.G.properties_light_directional.direction),color:new r.J(r.G.properties_light_directional.color),intensity:new r.J(r.G.properties_light_directional.intensity),"cast-shadows":new r.J(r.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.J(r.G.properties_light_directional["shadow-intensity"])});class Pi{constructor(i,l,p,_){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(i,l){let p,_;if(i instanceof r.P||typeof i[0]=="number"){let v=r.P.convert(i);p=[v],_=l.isPointAboveHorizon(v)}else{let v=r.P.convert(i[0]),b=r.P.convert(i[1]);p=[v,b],_=r.a0(v,b).every(D=>l.isPointAboveHorizon(D))}return new Pi(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),r.a1(_,i)}bufferedCameraGeometryGlobe(i){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(l,p,i),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(i,l,p,_=0){let v=i.queryPadding/l._pixelsPerMercatorPixel+1,b=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l),D=i.tileID.wrap+(b.unwrapped?_:0),T=b.polygon.map($=>r.a2(i.tileTransform,$,D));if(!r.a3(T,0,0,r.Y,r.Y))return;D=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let M=this.screenGeometryMercator.polygon.map($=>r.a4(i.tileTransform,$,D)),P=M.map($=>new r.P($[0],$[1])),k=l.getFreeCameraOptions().position||new r.O(0,0,0),N=r.a4(i.tileTransform,k,D),L=M.map($=>{let q=r.Q.sub($,$,N);return r.Q.normalize(q,q),new r.a5(N,q)}),H=r.a6(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:L,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(G=r.a7(T),G.min.x=r.ad(G.min.x,0,r.Y),G.min.y=r.ad(G.min.y,0,r.Y),G.max.x=r.ad(G.max.x,0,r.Y),G.max.y=r.ad(G.max.y,0,r.Y),G),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:H};var G}_bufferedScreenMercator(i,l){let p=et(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(i,l){let p=et(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(i,l){let p=function(v,b){let D=r.a9.multiply([],b.pixelMatrix,b.globeMatrix),T=[0,-r.ae,0,1],M=[0,r.ae,0,1],P=[0,0,0,1];r.aa.transformMat4(T,T,D),r.aa.transformMat4(M,M,D),r.aa.transformMat4(P,P,D);let k=new r.P(T[0]/T[3],T[1]/T[3]),N=new r.P(M[0]/M[3],M[1]/M[3]),L=r.ab(v,k)&&T[3]<P[3],H=r.ab(v,N)&&M[3]<P[3];if(!L&&!H)return null;let G=function(K,fe,he){for(let ve=1;ve<K.length;ve++){let Ie=ze(fe.pointCoordinate3D(K[ve-1]).x),ye=ze(fe.pointCoordinate3D(K[ve]).x);if(he<0){if(Ie<ye)return{idx:ve,t:-Ie/(ye-1-Ie)}}else if(ye<Ie)return{idx:ve,t:(1-Ie)/(ye+1-Ie)}}return null}(v,b,L?-1:1);if(!G)return null;let{idx:$,t:q}=G,Y=$>1?Ue(v.slice(0,$),b):[],re=$<v.length?Ue(v.slice($),b):[];Y=Y.map(K=>new r.P(ze(K.x),K.y)),re=re.map(K=>new r.P(ze(K.x),K.y));let ie=[...Y];ie.length===0&&ie.push(re[re.length-1]);let ae=r.X(ie[ie.length-1].y,(re.length===0?Y[0]:re[0]).y,q),W;return W=L?[new r.P(0,ae),new r.P(0,0),new r.P(1,0),new r.P(1,ae)]:[new r.P(1,ae),new r.P(1,1),new r.P(0,1),new r.P(0,ae)],ie.push(...W),re.length===0?ie.push(Y[0]):ie.push(...re),{polygon:ie.map(K=>new r.O(K.x,K.y)),unwrapped:!1}}(i,l);if(p)return p;let _=function(v,b){let D=!1,T=-1/0,M=0;for(let k=0;k<v.length-1;k++)v[k].x>T&&(T=v[k].x,M=k);for(let k=0;k<v.length-1;k++){let N=(M+k)%(v.length-1),L=v[N],H=v[N+1];Math.abs(L.x-H.x)>.5&&(L.x<H.x?(L.x+=1,N===0&&(v[v.length-1].x+=1)):(H.x+=1,N+1===v.length-1&&(v[0].x+=1)),D=!0)}let P=r.a8(b.center.lng);return D&&P<Math.abs(P-1)&&v.forEach(k=>{k.x-=1}),{polygon:v,unwrapped:D}}(Ue(i,l).map(v=>new r.P(ze(v.x),v.y)),l);return{polygon:_.polygon.map(v=>new r.O(v.x,v.y)),unwrapped:_.unwrapped}}}function Ue(d,i){return r.ac(d,l=>{let p=i.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ze(d){return d<0?1+d%1:d%1}function et(d){return 100*d|0}function it(d,i,l,p,_){let v=function(b,D){if(b)return _(b);if(D){d.url&&D.tiles&&d.tiles&&delete d.tiles;let T=r.af(r.e(D,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(T.vectorLayers=D.vector_layers,T.vectorLayerIds=T.vectorLayers.map(M=>M.id)),D.raster_layers&&(T.rasterLayers=D.raster_layers,T.rasterLayerIds=T.rasterLayers.map(M=>M.id)),T.tiles=i.canonicalizeTileset(T,d.url),_(null,T)}};return d.url?r.g(i.transformRequest(i.normalizeSourceURL(d.url,null,l,p),r.R.Source),v):r.f.frame(()=>v(null,d))}class rt{constructor(i,l,p){this.bounds=r.ag.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){let l=Math.pow(2,i.z),p=Math.floor(r.a8(this.bounds.getWest())*l),_=Math.floor(r.ah(this.bounds.getNorth())*l),v=Math.ceil(r.a8(this.bounds.getEast())*l),b=Math.ceil(r.ah(this.bounds.getSouth())*l);return i.x>=p&&i.x<v&&i.y>=_&&i.y<b}}class ut extends r.E{constructor(i,l,p,_){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.af(l,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.ai}load(i){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=it(this._options,this.map._requestManager,l,p,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.a(_))):v&&(r.e(this,v),v.bounds&&(this.tileBounds=new rt(v.bounds,this.minzoom,this.maxzoom)),r.am(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(_)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(i,l){let p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(p,r.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster};if(_.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",_,v.bind(this));else if(i.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",_,v.bind(this),void 0,!0);else{let b=r.ak.call({deduped:this._deduped},_,(D,T)=>{D||!T?v.call(this,D):(_.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},i.actor&&i.actor.send("loadTile",_,v.bind(this),void 0,!0))},!0);i.request={cancel:b}}function v(b,D){return delete i.request,i.aborted?l(null):b&&b.status!==404?l(b):(D&&D.resourceTiming&&(i.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&i.setExpiryData(D),i.loadVectorData(D,this.map.painter),r.al(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dt extends r.E{constructor(i,l,p,_){super(),this.id=i,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},l),r.e(this,r.af(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=it(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new r.a(l)):p&&(r.e(this,p),p.bounds&&(this.tileBounds=new rt(p.bounds,this.minzoom,this.maxzoom)),r.am(p.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(l)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();let i=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){let p=r.f.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=r.d(this.map._requestManager.transformRequest(_,r.R.Tile),(v,b,D,T)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):v?(i.state="errored",l(v)):b?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:D,expires:T}),i.setTexture(b,this.map.painter),i.state="loaded",r.al(this.dispatcher),void l(null)):l(null)))}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class lt extends dt{constructor(i,l,p,_){super(i,l,p,_),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},l)}triggerRepaint(i){let l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,i.tileID),this.map.triggerRepaint()}loadTile(i,l){let p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,r.R.Tile);i.requestParams=_,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(v,b,D,T)=>{if(delete i.request,i.aborted)return i.state="unloaded",l(null);if(v)return v.code===20?void 0:(i.state="errored",l(v));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:D,expires:T}),i.state="empty",l(null)})}unloadTile(i){let l=i.texture;l&&l instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(l)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,l,p){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(l,p,(_,v)=>{if(_)return i.state="errored",this.fire(new r.a(_)),void this.triggerRepaint(i);v&&(i.setTexture(v,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;let l=this.rasterLayers.find(({id:v})=>v===i),p=l&&l.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(i,l,p){if(!i)return;let _=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;l instanceof r.aq?v=l.paint.get("raster-array-band"):l instanceof r.ar&&(v=l.paint.get("raster-particle-array-band"));let b=v||this.getInitialBand(_);if(b!=null)if(i.textureDescriptor){if(!i.updateNeeded(_,b)||p)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,_,b)}}let Ct=32,ct=33,en=new Uint16Array(8184);for(let d=0;d<2046;d++){let i=d+2,l=0,p=0,_=0,v=0,b=0,D=0;for(1&i?_=v=b=Ct:l=p=D=Ct;(i>>=1)>1;){let M=l+_>>1,P=p+v>>1;1&i?(_=l,v=p,l=b,p=D):(l=_,p=v,_=b,v=D),b=M,D=P}let T=4*d;en[T+0]=l,en[T+1]=p,en[T+2]=_,en[T+3]=v}let Fn=new Uint16Array(2178),Ut=new Uint8Array(1089),mi=new Uint16Array(1089);function Vi(d){return d===0?-.03125:d===32?.03125:0}let ji=(()=>{class d{constructor(l,p,_,v){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++,this.context=l;let b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++;let p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return d.uniqueIdxCounter=0,d})(),Ki={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qi{constructor(i,l,p,_,v,b){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.instanceCount=b,this.context=i;let D=i.gl;this.buffer=D.createBuffer(),i.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let p=0;p<this.attributes.length;p++){let _=l.attributes[this.attributes[p].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,l,p){for(let _=0;_<this.attributes.length;_++){let v=this.attributes[_],b=l.attributes[v.name];b!==void 0&&i.vertexAttribPointer(b,v.components,i[Ki[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(i,l,p){for(let _=0;_<this.attributes.length;_++){let v=l.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ln{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vo extends Ln{getDefault(){return r.aA.transparent}set(i){let l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Zo extends Ln{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Dr extends Ln{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Aa extends Ln{getDefault(){return[!0,!0,!0,!0]}set(i){let l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Cc extends Ln{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class qr extends Ln{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class gv extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){let l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Dn extends Ln{getDefault(){let i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){let l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class wf extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class Wr extends Ln{getDefault(){return[0,1]}set(i){let l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Is extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class e0 extends Ln{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class t0 extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class Df extends Ln{getDefault(){let i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){let l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class n0 extends Ln{getDefault(){return r.aA.transparent}set(i){let l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class i0 extends Ln{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class r0 extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class o0 extends Ln{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class s0 extends Ln{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Ju=class extends Ln{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class hn extends Ln{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Cf extends Ln{getDefault(){let i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){let l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ta extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class a0 extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class l0 extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class c0 extends Ln{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class u0 extends Ln{getDefault(){return null}set(i){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class h0 extends Ln{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class d0 extends Ln{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class f0 extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class p0 extends Ln{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class eh extends Ln{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class _v extends eh{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class th extends eh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class yv extends eh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class vv extends th{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class xv{constructor(i,l,p,_,v){this.context=i,this.width=l,this.height=p;let b=this.framebuffer=i.gl.createFramebuffer();_&&(this.colorAttachment=new _v(i,b)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new th(i,b):new yv(i,b))}destroy(){let i=this.context.gl;if(this.colorAttachment){let l=this.colorAttachment.get();l&&i.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let l=this.depthAttachment.get();l&&i.deleteRenderbuffer(l)}else{let l=this.depthAttachment.get();l&&i.deleteTexture(l)}i.deleteFramebuffer(this.framebuffer)}}class Gt{constructor(i,l,p){this.func=i,this.mask=l,this.range=p}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);let Ef=7680;class on{constructor(i,l,p,_,v,b){this.test=i,this.ref=l,this.mask=p,this.fail=_,this.depthFail=v,this.pass=b}}on.disabled=new on({func:519,mask:0},0,0,Ef,Ef,Ef);let nh=771;class _n{constructor(i,l,p,_){this.blendFunction=i,this.blendColor=l,this.mask=p,this.blendEquation=_}}_n.Replace=[1,0,1,0],_n.disabled=new _n(_n.Replace,r.aA.transparent,[!1,!1,!1,!1]),_n.unblended=new _n(_n.Replace,r.aA.transparent,[!0,!0,!0,!0]),_n.alphaBlended=new _n([1,nh,1,nh],r.aA.transparent,[!0,!0,!0,!0]),_n.multiply=new _n([774,0,774,0],r.aA.transparent,[!0,!0,!0,!0]);let Af=1029,Tf=2305;class Kt{constructor(i,l,p){this.enable=i,this.mode=l,this.frontFace=p}}Kt.disabled=new Kt(!1,Af,Tf),Kt.backCCW=new Kt(!0,Af,Tf),Kt.backCW=new Kt(!0,Af,2304),Kt.frontCW=new Kt(!0,1028,2304),Kt.frontCCW=new Kt(!0,1028,Tf);class ds{constructor(i,l){this.gl=i,this.clearColor=new vo(this),this.clearDepth=new Zo(this),this.clearStencil=new Dr(this),this.colorMask=new Aa(this),this.depthMask=new Cc(this),this.stencilMask=new qr(this),this.stencilFunc=new gv(this),this.stencilOp=new Dn(this),this.stencilTest=new wf(this),this.depthRange=new Wr(this),this.depthTest=new Is(this),this.depthFunc=new e0(this),this.blend=new t0(this),this.blendFunc=new Df(this),this.blendColor=new n0(this),this.blendEquation=new i0(this),this.cullFace=new r0(this),this.cullFaceSide=new o0(this),this.frontFace=new s0(this),this.program=new Ju(this),this.activeTexture=new hn(this),this.viewport=new Cf(this),this.bindFramebuffer=new Ta(this),this.bindRenderbuffer=new a0(this),this.bindTexture=new l0(this),this.bindVertexBuffer=new c0(this),this.bindElementBuffer=new u0(this),this.bindVertexArrayOES=new h0(this),this.pixelStoreUnpack=new d0(this),this.pixelStoreUnpackPremultiplyAlpha=new f0(this),this.pixelStoreUnpackFlipY=new p0(this),this.options=l?$t({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l,p){return new ji(this,i,l,p)}createVertexBuffer(i,l,p,_,v){return new qi(this,i,l,p,_,v)}createRenderbuffer(i,l,p){let _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,i,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(i,l,p,_){return new xv(this,i,l,p,_)}clear({color:i,depth:l,stencil:p,colorMask:_}){let v=this.gl,b=0;i&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(_||[!0,!0,!0,!0])),l!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(b)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){E(i.blendFunction,_n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var bv=r.aB([{name:"a_index",type:"Int16",components:1}]);let Sa=.15000000000000002;class m0{constructor(i,l,p,_){let v={width:p[0],height:p[1],data:null},b=i.gl;this.targetColorTexture=new r.T(i,v,b.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,v,b.RGBA,{useMipmap:!1}),this.context=i,this.setParticleTextureDimension(l,_),this.lastInvalidatedAt=0}setParticleTextureDimension(i,l){if(this.particleTextureDimension===l)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let p=this.context.gl,_=l*l,v=new Uint8Array(4*_),b=.7692307692307692,D=r.aC(i.key);for(let P=0;P<v.length;P+=4){let k=b*(D()+Sa),N=b*(D()+Sa),L=255*k%1,H=255*N%1,G=L,$=N-H/255,q=H;v[P+0]=Math.floor(255*(k-L/255)),v[P+1]=Math.floor(255*G),v[P+2]=Math.floor(255*$),v[P+3]=Math.floor(255*q)}let T=new r.h({width:l,height:l},v);this.particleTexture0=new r.T(this.context,T,p.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,T,p.RGBA,{premultiply:!1,useMipmap:!1});let M=new r.aD;M.reserve(_);for(let P=0;P<_;P++)M.emplaceBack(P);this.particleIndexBuffer=this.context.createVertexBuffer(M,bv.members,!0),this.particleSegment=r.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}let ih={type:2,extent:r.Y,loadGeometry:()=>[[new r.P(0,0),new r.P(r.Y+1,0),new r.P(r.Y+1,r.Y+1),new r.P(0,r.Y+1),new r.P(0,0)]]};class Qo{constructor(i,l,p,_,v){this.tileID=i,this.uid=r.aF(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(i){let l=i+this.timeAdded;l<r.f.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,p){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(_,v){let b={};if(!v)return b;for(let D of _){let T=D.layerIds.map(M=>v.getLayer(M)).filter(Boolean);if(T.length!==0){D.layers=T,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(M=>T.filter(P=>P.id===M)[0]));for(let M of T)b[M.fqid]=D}}return b}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let v=this.buckets[_];if(v instanceof r.aH){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let v=this.buckets[_];if(v instanceof r.aH&&v.hasRTLText){this.hasRTLText=!0,r.aI();break}}this.queryPadding=0;for(let _ in this.buckets){let v=this.buckets[_],b=l.style.getOwnLayer(_);if(!b)continue;let D=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,D)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.aG}unloadVectorData(){if(this.hasData()){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(let _ in this.buckets){let v=this.buckets[_];v.uploadPending()&&v.upload(i)}let l=i.gl,p=this.imageAtlas;if(p&&!p.uploaded){let _=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new r.T(i,p.image,l.RGBA,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(i,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=l.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(void 0,l)))}queryRenderedFeatures(i,l,p,_,v,b,D,T){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:D,transform:b,params:v,tileTransform:this.tileTransform},i,l,p):{}}querySourceFeatures(i,l){let p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;let _=p.loadVTLayers(),v=l?l.sourceLayer:"",b=_._geojsonTileLayer||_[v];if(!b)return;let D=r.aJ(l&&l.filter),{z:T,x:M,y:P}=this.tileID.canonical,k={z:T,x:M,y:P};for(let N=0;N<b.length;N++){let L=b.feature(N);if(D.needGeometry){let $=r.aK(L,!0);if(!D.filter(new r.N(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!D.filter(new r.N(this.tileID.overscaledZ),L))continue;let H=p.getId(L,v),G=new r.aL(L,T,M,P,H);G.tile=k,i.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let i in this.buckets)if(this.buckets[i].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){let l=this.expirationTime;if(i.cacheControl){let p=r.aM(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){let p=Date.now(),_=!1;if(this.expirationTime>p)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{let v=this.expirationTime-l;v?this.expirationTime=p+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&l&&this.updateBuckets(i,l)}updateBuckets(i,l){if(!this.latestFeatureIndex)return;let p=this.latestFeatureIndex.loadVTLayers(),_=l.style.listImages(),v=l.style.getBrightness();for(let b in this.buckets){if(!l.style.hasLayer(b))continue;let D=this.buckets[b],T=D.layers[0].sourceLayer||"_geojsonTileLayer",M=p[T],P={};if(i&&(P=i[T],!M||!P||Object.keys(P).length===0))continue;if(D.update(P,M,_,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),D instanceof r.aN||D instanceof r.aO){let N=l.style.getOwnSourceCache(D.layers[0].source);l._terrain&&l._terrain.enabled&&N&&D.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(N.id,this.tileID)}let k=l&&l.style&&l.style.getOwnLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.f.now()+i}setTexture(i,l){let p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{useMipmap:!0}):(this.texture=new r.T(p,i,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(i,l){let p={};for(let _ of l)p[_]=!0;this.dependencies[i]=p}hasDependency(i,l){for(let p of i){let _=this.dependencies[p];if(_){for(let v of l)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let p=r.aP(ih,this.tileID.canonical,this.tileTransform)[0],_=new r.aQ,v=new r.aR;for(let b=0;b<p.length;b++){let{x:D,y:T}=p[b];_.emplaceBack(D,T),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(v),this._tileDebugBuffer=i.createVertexBuffer(_,r.aS.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let p=r.aP(ih,this.tileID.canonical,this.tileTransform)[0],_,v;if(this.isRaster){let b=function(D,T){let M=r.av(D,T),P=Math.pow(2,D.z);for(let $=0;$<ct;$++)for(let q=0;q<ct;q++){let Y=r.aw((D.x+(q+Vi(q))/Ct)/P),re=r.ax((D.y+($+Vi($))/Ct)/P),ie=T.project(Y,re),ae=$*ct+q;Fn[2*ae+0]=Math.round((ie.x*M.scale-M.x)*r.Y),Fn[2*ae+1]=Math.round((ie.y*M.scale-M.y)*r.Y)}Ut.fill(0),mi.fill(0);for(let $=2045;$>=0;$--){let q=4*$,Y=en[q+0],re=en[q+1],ie=en[q+2],ae=en[q+3],W=Y+ie>>1,K=re+ae>>1,fe=W+K-re,he=K+Y-W,ve=re*ct+Y,Ie=ae*ct+ie,ye=K*ct+W,Ae=Math.hypot((Fn[2*ve+0]+Fn[2*Ie+0])/2-Fn[2*ye+0],(Fn[2*ve+1]+Fn[2*Ie+1])/2-Fn[2*ye+1])>=16;Ut[ye]=Ut[ye]||(Ae?1:0),$<1022&&(Ut[ye]=Ut[ye]||Ut[(re+he>>1)*ct+(Y+fe>>1)]||Ut[(ae+he>>1)*ct+(ie+fe>>1)])}let k=new r.ay,N=new r.az,L=0;function H($,q){let Y=q*ct+$;return mi[Y]===0&&(k.emplaceBack(Fn[2*Y+0],Fn[2*Y+1],$*r.Y/Ct,q*r.Y/Ct),mi[Y]=++L),mi[Y]-1}function G($,q,Y,re,ie,ae){let W=$+Y>>1,K=q+re>>1;if(Math.abs($-ie)+Math.abs(q-ae)>1&&Ut[K*ct+W])G(ie,ae,$,q,W,K),G(Y,re,ie,ae,W,K);else{let fe=H($,q),he=H(Y,re),ve=H(ie,ae);N.emplaceBack(fe,he,ve)}}return G(0,0,Ct,Ct,Ct,0),G(Ct,Ct,0,0,0,Ct),{vertices:k,indices:N}}(this.tileID.canonical,l);_=b.vertices,v=b.indices}else{_=new r.ay,v=new r.az;for(let{x:D,y:T}of p)_.emplaceBack(D,T,0,0);let b=r.aT(_.int16,void 0,4);for(let D=0;D<b.length;D+=3)v.emplaceBack(b[D],b[D+1],b[D+2])}this._tileBoundsBuffer=i.createVertexBuffer(_,r.aU.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(v),this._tileBoundsSegments=r.aE.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(i,l){let p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;let _=this.tileID.canonical,v=r.aV(_,l),b=r.aW(v),D=r.W(l.zoom),T;D>0&&(T=r.a9.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,_,l,b,T,D),this._makeGlobeTileDebugTextBuffer(i,_,l,b,T,D)}_globePoint(i,l,p,_,v,b,D){let T=r.aX(i,l,p);if(b){let M=1<<p.z,P=r.a8(_.center.lng),k=r.ah(_.center.lat),N=(p.x+.5)/M-P,L=0;N>.5?L=-1:N<-.5&&(L=1);let H=(i/r.Y+p.x)/M+L,G=(l/r.Y+p.y)/M;H=(H-P)*_._pixelsPerMercatorPixel+P,G=(G-k)*_._pixelsPerMercatorPixel+k;let $=[H*_.worldSize,G*_.worldSize,0];r.Q.transformMat4($,$,b),T=r.aY(T,$,D)}return r.Q.transformMat4(T,T,v)}_makeGlobeTileDebugBorderBuffer(i,l,p,_,v,b){let D=new r.aQ,T=new r.aR,M=new r.aZ,P=(N,L,H,G,$)=>{let q=(H-N)/($-1),Y=(G-L)/($-1),re=D.length;for(let ie=0;ie<$;ie++){let ae=N+ie*q,W=L+ie*Y;D.emplaceBack(ae,W);let K=this._globePoint(ae,W,l,p,_,v,b);M.emplaceBack(K[0],K[1],K[2]),T.emplaceBack(re+ie)}},k=r.Y;P(0,0,k,0,16),P(k,0,k,k,16),P(k,k,0,k,16),P(0,k,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(T),this._tileDebugBuffer=i.createVertexBuffer(D,r.aS.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(M,r.a_.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,D.length,T.length)}_makeGlobeTileDebugTextBuffer(i,l,p,_,v,b){let D=r.Y/4,T=new r.aQ,M=new r.az,P=new r.aZ,k=25;M.reserve(32),T.reserve(k),P.reserve(k);let N=(L,H)=>k*L+H;for(let L=0;L<k;L++){let H=L*D;for(let G=0;G<k;G++){let $=G*D;T.emplaceBack($,H);let q=this._globePoint($,H,l,p,_,v,b);P.emplaceBack(q[0],q[1],q[2])}}for(let L=0;L<4;L++)for(let H=0;H<4;H++){let G=N(L,H),$=N(L,H+1),q=N(L+1,H),Y=N(L+1,H+1);M.emplaceBack(G,$,q),M.emplaceBack(q,$,Y)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(M),this._tileDebugTextBuffer=i.createVertexBuffer(T,r.aS.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(P,r.a_.members),this._tileDebugTextSegments=r.aE.simpleSegment(0,0,k,32)}destroy(i=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let ft={vector:ut,raster:dt,"raster-dem":class extends dt{constructor(d,i,l,p){super(d,i,l,p),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){let l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(d.state="errored",i(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=r.d(this.map._requestManager.transformRequest(l,r.R.Tile),(function(_,v,b,D){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(_)d.state="errored",i(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:D});let T=ImageBitmap&&v instanceof ImageBitmap&&r.an(),M=1-(v.width-r.ao(v.width))/2;M<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let P=T?v:r.f.getImageData(v,M),k={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:M};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",k,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let i=d.canonical,l=Math.pow(2,i.z),p=(i.x-1+l)%l,_=i.x===0?d.wrap-1:d.wrap,v=(i.x+1+l)%l,b=i.x+1===l?d.wrap+1:d.wrap,D={};return D[new r.ap(d.overscaledZ,_,i.z,p,i.y).key]={backfilled:!1},D[new r.ap(d.overscaledZ,b,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(D[new r.ap(d.overscaledZ,_,i.z,p,i.y-1).key]={backfilled:!1},D[new r.ap(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},D[new r.ap(d.overscaledZ,b,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<l&&(D[new r.ap(d.overscaledZ,_,i.z,p,i.y+1).key]={backfilled:!1},D[new r.ap(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},D[new r.ap(d.overscaledZ,b,i.z,v,i.y+1).key]={backfilled:!1}),D}},"raster-array":lt,geojson:class extends r.E{constructor(d,i,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=i.data,this._options=r.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;let _=r.Y/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*_,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*_,extent:r.Y,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.Y,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*_,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){return this._options.dynamic?(this._data=d,this._updateWorkerData(!0),this):this.fire(new r.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterLeaves(d,i,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:i,offset:l},p),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;let i=r.e({append:d},this.workerOptions);i.scope=this.scope;let l=this._data;typeof l=="string"?(i.request=this.map._requestManager.transformRequest(r.f.resolveURL(l),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.a(p));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.b("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){let l=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let p={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};d.request=this.actor.send(l,p,(_,v)=>(delete d.request,d.destroy(),d.aborted?i(null):_?i(_):(d.loadVectorData(v,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.as{constructor(d,i,l,p){super(d,i,l,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.at(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new r.a(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new r.a(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.as,model:class extends r.E{constructor(d,i,l,p){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){let d=[];for(let i in this._options.models){let l=this._options.models[i],p=r.l(this.map._requestManager.transformRequest(l.uri,r.R.Model).url).then(_=>{if(!_)return;let v=r.c(_),b=new r.M(i,l.position,l.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(_=>{this.fire(new r.a(new Error(`Could not load model ${i} from ${l.uri}: ${_.message}`)))});d.push(p)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.a(new Error(`Could not load models: ${i.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(d,i,l,p){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=it(this._options,this.map._requestManager,i,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new r.a(p))):_&&(r.e(this,_),_.bounds&&(this.tileBounds=new rt(_.bounds,this.minzoom,this.maxzoom)),r.am(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),d&&d(p)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,i){let l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=i;else{if(d.buckets){let v=Object.values(d.buckets);for(let b of v)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",p,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(v,b){return d.aborted?i(null):v&&v.status!==404?i(v):(b&&(b.resourceTiming&&(d.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(b),d.buckets=$t($t({},d.buckets),b.buckets),b.featureIndex&&(d.latestFeatureIndex=b.featureIndex)),d.state="loaded",void i(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.as{constructor(d,i,l,p){super(d,i,l,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new r.a(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.a(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let i=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,i,l,p){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new rt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.af(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:i,y:l,z:p}=d.canonical;return this._implementation.hasTile({x:i,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){let{x:l,y:p,z:_}=d.tileID.canonical,v=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:v.signal})).then((function(b){return delete d.request,d.aborted?(d.state="unloaded",i(null)):b===void 0?(d.state="errored",i(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(b)?(this.loadTileData(d,b),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.code!==20&&(d.state="errored",i(b))}),d.request.cancel=()=>v.abort()}loadTileData(d,i){d.setTexture(i,this._map.painter)}unloadTile(d,i){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this._map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:l,y:p,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=r.aj(this.id,this.scope);this._map.style.clearSource(d)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},Sf=function(d,i,l,p){let _=new ft[i.type](d,i,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return r.a$(["load","abort","unload","serialize","prepare"],_),_};function If(d,i){let l=r.a9.identity([]);return r.a9.scale(l,l,[.5*d.width,.5*-d.height,1]),r.a9.translate(l,l,[1,-1,0]),r.a9.multiply(l,l,d.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(l)}function kn(d,i,l,p,_,v,b,D=!1){let T=d.tilesIn(p,b,D);T.sort(g0);let M=[];for(let k of T)M.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(i,l,d._state,k,_,v,If(d.transform,k.tile.tileID),D)});let P=function(k){let N={},L={};for(let H of k){let G=H.queryResults,$=H.wrappedTileID,q=L[$]=L[$]||{};for(let Y in G){let re=G[Y],ie=q[Y]=q[Y]||{},ae=N[Y]=N[Y]||[];for(let W of re)ie[W.featureIndex]||(ie[W.featureIndex]=!0,ae.push(W))}}return N}(M);for(let k in P)P[k].forEach(N=>{let L=N.feature,H=L.layer;H&&H.type!=="background"&&H.type!=="sky"&&H.type!=="slot"&&(L.source=H.source,H["source-layer"]&&(L.sourceLayer=H["source-layer"]),L.state=L.id!==void 0?d.getFeatureState(H["source-layer"],L.id):{})});return P}function Zr(d,i){let l=d.getRenderableIds().map(v=>d.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){let b=l[v],D=b.tileID.canonical.key;_[D]||(_[D]=!0,b.querySourceFeatures(p,i))}return p}function g0(d,i){let l=d.tileID,p=i.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}class rh extends Qo{constructor(i,l,p,_,v){super(i,l,p,_,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,l){let p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(p,i,_.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,l){let p=this._mrt=new r.b0(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.b1(_,(v,b,D,T)=>{if(v)l(v);else try{let M=p.getHeaderLength(b);if(M>i)return void(this.request=this.fetchHeader(M,l));p.parseHeader(b),this._isHeaderLoaded=!0;let P=0;for(let k of Object.values(p.layers))P=Math.max(P,k.dataIndex[k.dataIndex.length-1].last_byte);b.byteLength>=P&&(this.entireBuffer=b),l(null,this.entireBuffer||b,D,T)}catch(M){l(M)}}),this.request}fetchBand(i,l,p){let _=this._mrt;if(!this._isHeaderLoaded||!_)return void p(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void p(new Error("Can't fetch tile band without an actor"));let b,D=(k,N)=>{b.complete(k,N),k?p(k):(this.updateTextureDescriptor(i,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},T=(k,N)=>{if(k)return p(k);let L=v.send("decodeRasterArray",{buffer:N,task:b},D,void 0,!0);this._workQueue.push(()=>{L&&L.cancel(),b.cancel()})},M=_.getLayer(i);if(!M)return void p(new Error(`Unknown sourceLayer "${i}"`));if(M.hasDataForBand(l))return this.updateTextureDescriptor(i,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);let P=M.getDataRange([l]);if(b=_.createDecodingTask(P),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)T(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{let k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),N=r.b1(k,T);this._fetchQueue.push(()=>{N.cancel(),b.cancel()})}else p(null)}updateNeeded(i,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,l){if(!this._mrt)return;let p=this._mrt.getLayer(i);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;let{bytes:_,tileSize:v,buffer:b,offset:D,scale:T}=p.getBandView(l),M=v+2*b,P={data:_,width:M,height:M},k=this.texture;k&&k instanceof r.T&&k.update(P,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:l,img:P,buffer:b,offset:D,tileSize:v,format:p.pixelFormat,mix:[T,256*T,65536*T,16777216*T]}}}class _0{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(let i in this.data)for(let l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,p){let _=i.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let v={value:l,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(i,v)},p)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){let l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){let l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;let p=i.wrapped().key,_=l===void 0?0:this.data[p].indexOf(l),v=this.data[p][_];return this.data[p].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){let l=[];for(let p in this.data)for(let _ of this.data[p])i(_.value)||l.push(_);for(let p of l)this.remove(p.value.tileID,p)}}class Yo extends r.E{constructor(i,l,p){super(),this.id=i,this._onlySymbols=p,l.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new _0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Tt,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let i in this._tiles){let l=this._tiles[i];if(l.state!=="errored"&&(l.state!=="loaded"||!l.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let p=this._tiles[l];p.upload(i),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.b2(this._tiles).map(i=>i.tileID).sort(Cn).map(i=>i.key)}getRenderableIds(i,l){let p=[];for(let _ in this._tiles)this._isIdRenderable(+_,i,l)&&p.push(this._tiles[_]);return i?p.sort((_,v)=>{let b=_.tileID,D=v.tileID,T=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),M=new r.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-D.overscaledZ||M.y-T.y||M.x-T.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort(Cn).map(_=>_.key)}hasRenderableParent(i){let l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l,p){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())&&(p||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){let p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,i,l)))}_tileLoaded(i,l,p,_){if(_)if(i.state="errored",_.status!==404)this._source.fire(new r.a(_,{tile:i}));else{if(!(i.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.f.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){let l=this.getRenderableIds();for(let _=0;_<l.length;_++){let v=l[_];if(i.neighboringTiles&&i.neighboringTiles[v]){let b=this.getTileByID(v);p(i,b),p(b,i)}}function p(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-_.tileID.canonical.x,D=v.tileID.canonical.y-_.tileID.canonical.y,T=Math.pow(2,_.tileID.canonical.z),M=v.tileID.key;b===0&&D===0||Math.abs(D)>1||(Math.abs(b)>1&&(Math.abs(b+T)===1?b+=T:Math.abs(b-T)===1&&(b-=T)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,b,D),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,p,_){for(let v in this._tiles){let b=this._tiles[v];if(_[v]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>p)continue;let D=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){let M=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[M.key],b&&b.hasData()&&(D=M)}let T=D;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),i[T.key]){_[D.key]=D;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){let p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=i.overscaledZ-1;p>=l;p--){let _=i.scaledTo(p),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(i){let l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;let p=Math.ceil(i.width/l)+1,_=Math.ceil(i.height/l)+1,v=Math.floor(p*_*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(D)}handleWrapJump(i){let l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){let p={};for(let _ in this._tiles){let v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),p[v.tileID.key]=v}this._tiles=p;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(i,l,p,_){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;let v;if(this.updateCacheSize(i,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new r.ap(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y));else if(this.tileCoverLift!==0){let T=i.clone();T.tileCoverLift=this.tileCoverLift,v=T.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&i.projection.name==="globe"&&(v.push(new r.ap(1,0,1,0,0)),v.push(new r.ap(1,0,1,1,0)),v.push(new r.ap(1,0,1,0,1)),v.push(new r.ap(1,0,1,1,1)))}else v=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(T=>this._source.hasTile(T)));else v=[];if(v.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ec(this._source.type)){let T=i.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),M=Math.min(T,this._source.maxzoom),P=i.extendTileCoverForShadows(v,_,M);for(let k of P)this._shadowCasterTiles[k.key]=!0,v.push(k)}let b=this._updateRetainedTiles(v);if(Ec(this._source.type)&&v.length!==0){let T={},M={},P=Object.keys(b);for(let N of P){let L=b[N],H=this._tiles[N];if(!H||H.fadeEndTime&&H.fadeEndTime<=r.f.now())continue;let G=this.findLoadedParent(L,Math.max(L.overscaledZ-Yo.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),T[G.tileID.key]=G.tileID),M[N]=L}let k=v[v.length-1].overscaledZ;for(let N in this._tiles){let L=this._tiles[N];if(b[N]||!L.hasData())continue;let H=L.tileID;for(;H.overscaledZ>k;){H=H.scaledTo(H.overscaledZ-1);let G=this._tiles[H.key];if(G&&G.hasData()&&M[H.key]){b[N]=L.tileID;break}}}for(let N in T)b[N]||(this._coveredTiles[N]=!0,b[N]=T[N])}for(let T in b)this._tiles[T].clearFadeHold();let D=r.b3(this._tiles,b);for(let T of D){let M=this._tiles[T];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){let l={};if(i.length===0)return l;let p={},_=i.reduce((M,P)=>Math.min(M,P.overscaledZ),1/0),v=i[0].overscaledZ,b=Math.max(v-Yo.maxOverzooming,this._source.minzoom),D=Math.max(v+Yo.maxUnderzooming,this._source.minzoom),T={};for(let M of i){let P=this._addTile(M);l[M.key]=M,P.hasData()||_<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,_,D,l);for(let M of i){let P=this._tiles[M.key];if(P.hasData())continue;if(M.canonical.z>=this._source.maxzoom){let N=M.children(this._source.maxzoom)[0],L=this.getTile(N);if(L&&L.hasData()){l[N.key]=N;continue}}else{let N=M.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let k=P.wasRequested();for(let N=M.overscaledZ-1;N>=b;--N){let L=M.scaledTo(N);if(p[L.key]||(p[L.key]=!0,P=this.getTile(L),!P&&k&&(P=this._addTile(L)),P&&(l[L.key]=L,k=P.wasRequested(),P.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let i in this._tiles){let l=[],p,_=this._tiles[i].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}l.push(_.key);let v=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;_=v}for(let v of l)this._loadedParentTiles[v]=p}}_addTile(i){let l=this._tiles[i.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));let p=!!l;if(!p){let _=this.map?this.map.painter:null,v=this._source.tileSize*i.overscaleFactor();l=this._source.type==="raster-array"?new rh(i,v,this.transform.tileZoom,_,this._isRaster):new Qo(i,v,this.transform.tileZoom,_,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l?(l.uses++,this._tiles[i.key]=l,p||this._source.fire(new r.b("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);let p=l.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){let l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,p){let _=[],v=this.transform;if(!v)return _;let b=v.projection.name==="globe",D=r.a8(v.center.lng);for(let T in this._tiles){let M=this._tiles[T];if(p&&M.clearQueryDebugViz(),M.holdingForFade())continue;let P;if(b){let k=M.tileID.canonical;if(k.z===0){let N=[Math.abs(r.ad(D,...Ms(k,-1))-D),Math.abs(r.ad(D,...Ms(k,1))-D)];P=[0,2*N.indexOf(Math.min(...N))-1]}else{let N=[Math.abs(r.ad(D,...Ms(k,-1))-D),Math.abs(r.ad(D,...Ms(k,0))-D),Math.abs(r.ad(D,...Ms(k,1))-D)];P=[N.indexOf(Math.min(...N))-1]}}else P=[0];for(let k of P){let N=i.containsTile(M,v,l,k);N&&_.push(N)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,l){let p=this.getRenderableIds(i,l).map(v=>this._tiles[v].tileID),_=this.transform.projection.name==="globe";for(let v of p)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return p}sortCoordinatesByDistance(i){let l=i.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(let b of l){let D=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*D+b.wrap-p[0])*_[0]+((b.canonical.y+.5)*D-p[1])*_[1]-p[2]*_[2]}return l.sort((b,D)=>v[b.key]-v[D.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Ec(this._source.type))for(let i in this._tiles){let l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(i,l,p){this._state.updateState(i=i||"_geojsonTileLayer",l,p)}removeFeatureState(i,l,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,p)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,p){let _=this._tiles[i];_&&_.setDependencies(l,p)}reloadTilesForDependencies(i,l){for(let p in this._tiles)this._tiles[p].hasDependency(i,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(i,l))}_preloadTiles(i,l){if(!this._sourceLoaded){let T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(i,l))};return void this._source.on("data",T)}let p=new Map,_=Array.isArray(i)?i:[i],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let T of _){let M=T.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of M)p.set(P.key,P);this.usedForTerrain&&T.updateElevation(!1)}let D=Array.from(p.values());r.b4(D,(T,M)=>{let P=new Qo(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,k=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),M(k,P)})},l)}}function Cn(d,i){let l=Math.abs(2*d.wrap)-+(d.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return d.overscaledZ-i.overscaledZ||p-l||i.canonical.y-d.canonical.y||i.canonical.x-d.canonical.x}function Ec(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Ms(d,i){let l=1<<d.z;return[d.x/l+i,(d.x+1)/l+i]}Yo.maxOverzooming=10,Yo.maxUnderzooming=3;class Mf{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let i=!1,l=!1;for(let p in this.style._mergedLayers){let _=this.style._mergedLayers[p];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:i,visibilityChanged:l});else if(_.type==="model"){let v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:i,visibilityChanged:l})}}}onNewFrame(i){this.layersGotHidden=!1;for(let l of this.layers){let p=l.layer,_=!1;p.type==="fill-extrusion"?_=!p.isHidden(i)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(_=!p.isHidden(i)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&l.visible,l.visible=_}}updateZOffset(i,l){this.currentBuildingBuckets=[];for(let _ of this.layers){let v=_.layer,b=this.style.getLayerSourceCache(v),D=1;v.type==="fill-extrusion"&&(D=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let T=b?b.getTile(l):null;if(!T&&b&&l.canonical.z>b.getSource().minzoom){let M=l.scaledTo(Math.min(b.getSource().maxzoom,l.overscaledZ-1));for(;M.overscaledZ>=b.getSource().minzoom&&(T=b.getTile(M),!T&&M.overscaledZ!==0);)M=M.scaledTo(M.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:T?T.getBucket(v):null,tileID:T?T.tileID:l,verticalScale:D})}i.hasAnyZOffset=!1;let p=!1;for(let _=0;_<i.symbolInstances.length;_++){let v=i.symbolInstances.get(_),b=v.zOffset,D=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=D!==Number.NEGATIVE_INFINITY?D:b,p||b===v.zOffset||(p=!0),i.hasAnyZOffset||v.zOffset===0||(i.hasAnyZOffset=!0)}p&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,l,p,_){let v=l,b=p;if(i.canonical.z!==_.canonical.z){let D=_.canonical,T=1/(1<<i.canonical.z-D.z);v=(l+i.canonical.x*r.Y)*T-D.x*r.Y|0,b=(p+i.canonical.y*r.Y)*T-D.y*r.Y|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(i,l,p){let _,v;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:D,tileID:T,verticalScale:M}=this.currentBuildingBuckets[b];if(!D)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(i,l,p,T),N=D.getHeightAtTileCoord(P,k);N&&N.height!==void 0&&(N.hidden?_=N.height:v=Math.max(N.height*M,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){let D=this.layers[b];if(D.layer.type!=="model"||!D.visible)continue;let{bucket:T,tileID:M}=this.currentBuildingBuckets[b];if(!T)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(i,l,p,M),N=T.getHeightAtTileCoord(P,k);if(N&&!N.hidden)return N.height===void 0&&_!==void 0?Math.min(N.maxHeight,_)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Oo(d,i){let l={};for(let p in d)p!=="ref"&&(l[p]=d[p]);return r.b5.forEach(p=>{p in i&&(l[p]=i[p])}),l}function y0(d){d=d.slice();let i=Object.create(null);for(let l=0;l<d.length;l++)i[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Oo(d[l],i[d[l].ref]));return d}let qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function oh(d,i,l){l.push({command:qn.addSource,args:[d,i[d]]})}function Ff(d,i,l){i.push({command:qn.removeSource,args:[d]}),l[d]=!0}function v0(d,i,l,p){Ff(d,l,p),oh(d,i,l)}function Pf(d,i,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&p!=="data"&&!E(d[l][p],i[l][p]))return!1;for(p in i[l])if(i[l].hasOwnProperty(p)&&p!=="data"&&!E(d[l][p],i[l][p]))return!1;return!0}function Ia(d,i,l,p,_,v){let b;for(b in i=i||{},d=d||{})d.hasOwnProperty(b)&&(E(d[b],i[b])||l.push({command:v,args:[p,b,i[b],_]}));for(b in i)i.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(E(d[b],i[b])||l.push({command:v,args:[p,b,i[b],_]}))}function hl(d){return d.id}function Ac(d,i){return d[i.id]=i,d}class Fs{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.ad(i,0,1);let l=1,p=this._distances[l],_=i*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];let v=l-1,b=this._distances[v],D=p-b,T=D>0?(_-b)/D:0;return this.points[v].mult(1-T).add(this.points[l].mult(T))}}class Of{constructor(i,l,p){let _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(l/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(i,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(i,l,p,_,v,b){this.boxCells[v].push(b)}_insertCircleCell(i,l,p,_,v,b){this.circleCells[v].push(b)}_query(i,l,p,_,v,b){if(p<0||i>this.width||_<0||l>this.height)return!v&&[];let D=[];if(i<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let T=0;T<this.boxKeys.length;T++)D.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){let M=this.circles[3*T],P=this.circles[3*T+1],k=this.circles[3*T+2];D.push({key:this.circleKeys[T],x1:M-k,y1:P-k,x2:M+k,y2:P+k})}return b?D.filter(b):D}return this._forEachCell(i,l,p,_,this._queryCell,D,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?D.length>0:D}_queryCircle(i,l,p,_,v){let b=i-p,D=i+p,T=l-p,M=l+p;if(D<0||b>this.width||M<0||T>this.height)return!_&&[];let P=[];return this._forEachCell(b,T,D,M,this._queryCellCircle,P,{hitTest:_,circle:{x:i,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?P.length>0:P}query(i,l,p,_,v){return this._query(i,l,p,_,!1,v)}hitTest(i,l,p,_,v){return this._query(i,l,p,_,!0,v)}hitTestCircle(i,l,p,_){return this._queryCircle(i,l,p,!0,_)}_queryCell(i,l,p,_,v,b,D,T){let M=D.seenUids,P=this.boxCells[v];if(P!==null){let N=this.bboxes;for(let L of P)if(!M.box[L]){M.box[L]=!0;let H=4*L;if(i<=N[H+2]&&l<=N[H+3]&&p>=N[H+0]&&_>=N[H+1]&&(!T||T(this.boxKeys[L]))){if(D.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[L],x1:N[H],y1:N[H+1],x2:N[H+2],y2:N[H+3]})}}}let k=this.circleCells[v];if(k!==null){let N=this.circles;for(let L of k)if(!M.circle[L]){M.circle[L]=!0;let H=3*L;if(this._circleAndRectCollide(N[H],N[H+1],N[H+2],i,l,p,_)&&(!T||T(this.circleKeys[L]))){if(D.hitTest)return b.push(!0),!0;{let G=N[H],$=N[H+1],q=N[H+2];b.push({key:this.circleKeys[L],x1:G-q,y1:$-q,x2:G+q,y2:$+q})}}}}}_queryCellCircle(i,l,p,_,v,b,D,T){let M=D.circle,P=D.seenUids,k=this.boxCells[v];if(k!==null){let L=this.bboxes;for(let H of k)if(!P.box[H]){P.box[H]=!0;let G=4*H;if(this._circleAndRectCollide(M.x,M.y,M.radius,L[G+0],L[G+1],L[G+2],L[G+3])&&(!T||T(this.boxKeys[H])))return b.push(!0),!0}}let N=this.circleCells[v];if(N!==null){let L=this.circles;for(let H of N)if(!P.circle[H]){P.circle[H]=!0;let G=3*H;if(this._circlesCollide(L[G],L[G+1],L[G+2],M.x,M.y,M.radius)&&(!T||T(this.circleKeys[H])))return b.push(!0),!0}}}_forEachCell(i,l,p,_,v,b,D,T){let M=this._convertToXCellCoord(i),P=this._convertToYCellCoord(l),k=this._convertToXCellCoord(p),N=this._convertToYCellCoord(_);for(let L=M;L<=k;L++)for(let H=P;H<=N;H++)if(v.call(this,i,l,p,_,this.xCellCount*H+L,b,D,T))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,p,_,v,b){let D=_-i,T=v-l,M=p+b;return M*M>D*D+T*T}_circleAndRectCollide(i,l,p,_,v,b,D){let T=(b-_)/2,M=Math.abs(i-(_+T));if(M>T+p)return!1;let P=(D-v)/2,k=Math.abs(l-(v+P));if(k>P+p)return!1;if(M<=T||k<=P)return!0;let N=M-T,L=k-P;return N*N+L*L<=p*p}}let Gi={unknown:0,flipRequired:1,flipNotRequired:2},Js=Math.tan(85*Math.PI/180);function Tc(d,i,l,p,_,v,b){let D=r.a9.create();if(l)if(v.name==="globe"){let T=r.b6(_,i);r.a9.multiply(D,D,T)}else{let T=r.b7.invert([],b);D[0]=T[0],D[1]=T[1],D[4]=T[2],D[5]=T[3],p||r.a9.rotateZ(D,D,_.angle)}else r.a9.multiply(D,_.labelPlaneMatrix,d);return D}function Sc(d,i,l,p,_,v,b){let D=Tc(d,i,l,p,_,v,b);return v.name==="globe"&&l||(D[2]=D[6]=D[10]=D[14]=0),D}function Ps(d,i,l,p,_,v,b){if(l){if(v.name==="globe"){let D=Tc(d,i,l,p,_,v,b);return r.a9.invert(D,D),r.a9.multiply(D,d,D),D}{let D=r.a9.clone(d),T=r.a9.identity([]);return T[0]=b[0],T[1]=b[1],T[4]=b[2],T[5]=b[3],r.a9.multiply(D,D,T),p||r.a9.rotateZ(D,D,-_.angle),D}}return _.glCoordMatrix}function xo(d,i,l,p){let _=[d,i,l,1];l?r.aa.transformMat4(_,_,p):kf(_,_,p);let v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function sh(d,i){return Math.min(.5+d/i*.5,1.5)}function ah(d,i){let l=d[0]/d[3],p=d[1]/d[3];return l>=-i[0]&&l<=i[0]&&p>=-i[1]&&p<=i[1]}function lh(d,i,l,p,_,v,b,D,T,M){let P=l.transform,k=p?d.textSizeData:d.iconSizeData,N=r.b8(k,l.transform.zoom),L=P.projection.name==="globe",H=[256/l.width*2+1,256/l.height*2+1],G=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;G.clear();let $=null;L&&($=p?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let q=d.lineVertexArray,Y=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,re=l.transform.width/l.transform.height,ie,ae=!1;for(let W=0;W<Y.length;W++){let K=Y.get(W),{numGlyphs:fe,writingMode:he}=K;if(he!==r.b9.vertical||ae||ie===r.b9.horizontal||(ae=!0),ie=he,(K.hidden||he===r.b9.vertical)&&!ae){Fa(fe,G);continue}ae=!1;let ve=new r.P(K.tileAnchorX,K.tileAnchorY),{x:Ie,y:ye,z:Ae}=P.projection.projectTilePoint(ve.x,ve.y,M.canonical);if(T){let[yt,Mt,zt]=T(ve);Ie+=yt,ye+=Mt,Ae+=zt}let Fe=[Ie,ye,Ae,1];if(r.aa.transformMat4(Fe,Fe,i),!ah(Fe,H)){Fa(fe,G);continue}let _e=Fe[3],De=sh(l.transform.getCameraToCenterDistance(P.projection),_e),Xe=r.ba(k,N,K),be=b?Xe/De:Xe*De,Se=xo(Ie,ye,Ae,_);if(Se[3]<=0){Fa(fe,G);continue}let Me={},oe=b?null:T,Ve=dl(K,be,!1,D,i,_,v,d.glyphOffsetArray,q,G,$,Se,ve,Me,re,oe,P.projection,M,b);ae=Ve.useVertical,oe&&Ve.needsFlipping&&(Me={}),(Ve.notEnoughRoom||ae||Ve.needsFlipping&&dl(K,be,!0,D,i,_,v,d.glyphOffsetArray,q,G,$,Se,ve,Me,re,oe,P.projection,M,b).notEnoughRoom)&&Fa(fe,G)}p?(d.text.dynamicLayoutVertexBuffer.updateData(G),$&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData($)):(d.icon.dynamicLayoutVertexBuffer.updateData(G),$&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData($))}function Ic(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G){let{lineStartIndex:$,glyphStartIndex:q,segment:Y}=D,re=q+D.numGlyphs,ie=$+D.lineLength,ae=i.getoffsetX(q),W=i.getoffsetX(re-1),K=Ma(d*ae,l,p,_,v,b,Y,$,ie,T,M,P,k,N,!0,L,H,G);if(!K)return null;let fe=Ma(d*W,l,p,_,v,b,Y,$,ie,T,M,P,k,N,!0,L,H,G);return fe?{first:K,last:fe}:null}function ea(d,i,l,p){return d===r.b9.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:d===r.b9.vertical?p>0?{needsFlipping:!0}:null:i!==Gi.unknown&&function(_,v){return _===0||Math.abs(v/_)>Js}(l,p)?i===Gi.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function dl(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q,Y){let re=i/24,ie=d.lineOffsetX*re,ae=d.lineOffsetY*re,{lineStartIndex:W,glyphStartIndex:K,numGlyphs:fe,segment:he,writingMode:ve,flipState:Ie}=d,ye=W+d.lineLength,Ae=Fe=>{if(P){let[be,Se,Me]=Fe.up,oe=M.length;r.bb(P,oe+0,be,Se,Me),r.bb(P,oe+1,be,Se,Me),r.bb(P,oe+2,be,Se,Me),r.bb(P,oe+3,be,Se,Me)}let[_e,De,Xe]=Fe.point;r.bc(M,_e,De,Xe,Fe.angle)};if(fe>1){let Fe=Ic(re,D,ie,ae,l,k,N,d,T,v,L,G,!1,$,q,Y);if(!Fe)return{notEnoughRoom:!0};if(p&&!l){let[_e,De,Xe]=Fe.first.point,[be,Se,Me]=Fe.last.point;[_e,De]=xo(_e,De,Xe,b),[be,Se]=xo(be,Se,Me,b);let oe=ea(ve,Ie,(be-_e)*H,Se-De);if(d.flipState=oe&&oe.needsFlipping?Gi.flipRequired:Gi.flipNotRequired,oe)return oe}Ae(Fe.first);for(let _e=K+1;_e<K+fe-1;_e++){let De=Ma(re*D.getoffsetX(_e),ie,ae,l,k,N,he,W,ye,T,v,L,G,!1,!1,$,q,Y);if(!De)return M.length-=4*(_e-K),{notEnoughRoom:!0};Ae(De)}Ae(Fe.last)}else{if(p&&!l){let _e=xo(N.x,N.y,0,_),De=W+he+1,Xe=new r.P(T.getx(De),T.gety(De)),be=xo(Xe.x,Xe.y,0,_),Se=be[3]>0?be:Rf(N,Xe,_e,1,_,void 0,$,q.canonical),Me=ea(ve,Ie,(Se[0]-_e[0])*H,Se[1]-_e[1]);if(d.flipState=Me&&Me.needsFlipping?Gi.flipRequired:Gi.flipNotRequired,Me)return Me}let Fe=Ma(re*D.getoffsetX(K),ie,ae,l,k,N,he,W,ye,T,v,L,G,!1,!1,$,q,Y);if(!Fe)return{notEnoughRoom:!0};Ae(Fe)}return{}}function ch(d,i,l,p,_){let{x:v,y:b,z:D}=p.projectTilePoint(d.x,d.y,i);if(!_)return xo(v,b,D,l);let[T,M,P]=_(d);return xo(v+T,b+M,D+P,l)}function Rf(d,i,l,p,_,v,b,D){let T=ch(d.sub(i)._unit()._add(d),D,_,b,v);return r.Q.sub(T,l,T),r.Q.normalize(T,T),r.Q.scaleAndAdd(T,l,T,p)}function Ma(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q){let Y=p?d-i:d+i,re=Y>0?1:-1,ie=0;p&&(re*=-1,ie=Math.PI),re<0&&(ie+=Math.PI);let ae=D+b+(re>0?0:1)|0,W=_,K=_,fe=0,he=0,ve=Math.abs(Y),Ie=[],ye=[],Ae=v,Fe=Ae,_e=()=>Rf(Fe,Ae,K,ve-fe+1,P,N,G,$.canonical);for(;fe+he<=ve;){if(ae+=re,ae<D||ae>=T)return null;if(K=W,Fe=Ae,Ie.push(K),L&&ye.push(Fe),Ae=new r.P(M.getx(ae),M.gety(ae)),W=k[ae],!W){let Mt=ch(Ae,$.canonical,P,G,N);W=Mt[3]>0?k[ae]=Mt:_e()}fe+=he,he=r.Q.distance(K,W)}H&&N&&(k[ae]&&(W=_e(),he=r.Q.distance(K,W)),k[ae]=W);let De=(ve-fe)/he,Xe=Ae.sub(Fe)._mult(De)._add(Fe),be=r.Q.sub([],W,K),Se=r.Q.scaleAndAdd([],K,be,De),Me=[0,0,1],oe=be[0],Ve=be[1];if(q&&(Me=G.upVector($.canonical,Xe.x,Xe.y),Me[0]!==0||Me[1]!==0||Me[2]!==1)){let Mt=[Me[2],0,-Me[0]],zt=r.Q.cross([],Me,Mt);r.Q.normalize(Mt,Mt),r.Q.normalize(zt,zt),oe=r.Q.dot(be,Mt),Ve=r.Q.dot(be,zt)}if(l){let Mt=r.Q.cross([],Me,be);r.Q.normalize(Mt,Mt),r.Q.scaleAndAdd(Se,Se,Mt,l*re)}let yt=ie+Math.atan2(Ve,oe);return Ie.push(Se),L&&ye.push(Xe),{point:Se,angle:yt,path:Ie,tilePath:ye,up:Me}}function Fa(d,i){let l=i.length,p=l+4*d;i.resize(p),i.float32.fill(-1/0,4*l,4*p)}function kf(d,i,l){let p=i[0],_=i[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}let Xo=100;class x0{constructor(i,l,p=new Of(i.width+200,i.height+200,25),_=new Of(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Xo,this.screenBottomBoundary=i.height+Xo,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,p,_,v,b,D,T){let M=p.projectedAnchorX,P=p.projectedAnchorY,k=p.projectedAnchorZ,N=p.elevation,L=p.tileID,H=i.getProjection();if(N&&L){let[W,K,fe]=H.upVector(L.canonical,p.tileAnchorX,p.tileAnchorY),he=H.upVectorScale(L.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=W*N*he,P+=K*N*he,k+=fe*N*he}let G=this.projectAndGetPerspectiveRatio(D,M,P,k,p.tileID,H.name==="globe"||!!N||this.transform.pitch>0,H),$=b*G.perspectiveRatio,q=(p.x1*l+_.x-p.padding)*$+G.point.x,Y=(p.y1*l+_.y-p.padding)*$+G.point.y,re=(p.x2*l+_.x+p.padding)*$+G.point.x,ie=(p.y2*l+_.y+p.padding)*$+G.point.y,ae=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(q,Y,re,ie)||!v&&this.grid.hitTest(q,Y,re,ie,T)||ae?{box:[],offscreen:!1,occluded:G.occluded}:{box:[q,Y,re,ie],offscreen:this.isOffscreen(q,Y,re,ie),occluded:!1}}placeCollisionCircles(i,l,p,_,v,b,D,T,M,P,k,N,L,H,G){let $=[],q=this.transform.elevation,Y=i.getProjection(),re=q?q.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,Y):null,ie=new r.P(p.tileAnchorX,p.tileAnchorY),{x:ae,y:W,z:K}=Y.projectTilePoint(ie.x,ie.y,G.canonical);if(re){let[Xe,be,Se]=re(ie);ae+=Xe,W+=be,K+=Se}let fe=Y.name==="globe",he=this.projectAndGetPerspectiveRatio(D,ae,W,K,G,fe||!!q||this.transform.pitch>0,Y),{perspectiveRatio:ve}=he,Ie=(k?b/ve:b*ve)/r.bf,ye=xo(ae,W,K,T),Ae=he.signedDistanceFromCamera>0?Ic(Ie,v,p.lineOffsetX*Ie,p.lineOffsetY*Ie,!1,ye,ie,p,_,T,{},q&&!k?re:null,k&&!!q,Y,G,k):null,Fe=!1,_e=!1,De=!0;if(Ae&&!he.occluded){let Xe=.5*L*ve+H,be=new r.P(-100,-100),Se=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Me=new Fs,{first:oe,last:Ve}=Ae,yt=oe.path.length,Mt=[];for(let jt=yt-1;jt>=1;jt--)Mt.push(oe.path[jt]);for(let jt=1;jt<Ve.path.length;jt++)Mt.push(Ve.path[jt]);let zt=2.5*Xe;M&&(Mt=Mt.map(([jt,En,nn],Pn)=>(re&&!fe&&(nn=re(Pn<yt-1?oe.tilePath[yt-1-Pn]:Ve.tilePath[Pn-yt+2])[2]),xo(jt,En,nn,M))),Mt.some(jt=>jt[3]<=0)&&(Mt=[]));let Rt=[];if(Mt.length>0){let jt=1/0,En=-1/0,nn=1/0,Pn=-1/0;for(let An of Mt)jt=Math.min(jt,An[0]),nn=Math.min(nn,An[1]),En=Math.max(En,An[0]),Pn=Math.max(Pn,An[1]);En>=be.x&&jt<=Se.x&&Pn>=be.y&&nn<=Se.y&&(Rt=[Mt.map(An=>new r.P(An[0],An[1]))],(jt<be.x||En>Se.x||nn<be.y||Pn>Se.y)&&(Rt=r.bd(Rt,be.x,be.y,Se.x,Se.y)))}for(let jt of Rt){Me.reset(jt,.25*Xe);let En=0;En=Me.length<=.5*Xe?1:Math.ceil(Me.paddedLength/zt)+1;for(let nn=0;nn<En;nn++){let Pn=nn/Math.max(En-1,1),An=Me.lerp(Pn),Fi=An.x+Xo,ei=An.y+Xo;$.push(Fi,ei,Xe,0);let sr=Fi-Xe,Ji=ei-Xe,gi=Fi+Xe,ai=ei+Xe;if(De=De&&this.isOffscreen(sr,Ji,gi,ai),_e=_e||this.isInsideGrid(sr,Ji,gi,ai),!l&&this.grid.hitTestCircle(Fi,ei,Xe,N)&&(Fe=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!P&&Fe||!_e?[]:$,offscreen:De,collisionDetected:Fe,occluded:he.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],p=1/0,_=1/0,v=-1/0,b=-1/0;for(let P of i){let k=new r.P(P.x+Xo,P.y+Xo);p=Math.min(p,k.x),_=Math.min(_,k.y),v=Math.max(v,k.x),b=Math.max(b,k.y),l.push(k)}let D=this.grid.query(p,_,v,b).concat(this.ignoredGrid.query(p,_,v,b)),T={},M={};for(let P of D){let k=P.key;if(T[k.bucketInstanceId]===void 0&&(T[k.bucketInstanceId]={}),T[k.bucketInstanceId][k.featureIndex])continue;let N=[new r.P(P.x1,P.y1),new r.P(P.x2,P.y1),new r.P(P.x2,P.y2),new r.P(P.x1,P.y2)];r.be(l,N)&&(T[k.bucketInstanceId][k.featureIndex]=!0,M[k.bucketInstanceId]===void 0&&(M[k.bucketInstanceId]=[]),M[k.bucketInstanceId].push(k.featureIndex))}return M}insertCollisionBox(i,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,p,_,v){let b=l?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let T=0;T<i.length;T+=4)b.insertCircle(D,i[T],i[T+1],i[T+2])}projectAndGetPerspectiveRatio(i,l,p,_,v,b,D){let T=[l,p,_,1],M=!1;_||this.transform.pitch>0?(r.aa.transformMat4(T,T,i),this.fogState&&v&&D.name!=="globe"&&(M=function(N,L,H,G,$,q){let Y=q.calculateFogTileMatrix($),re=[L,H,G];return r.Q.transformMat4(re,re,Y),$n(N,r.Q.length(re),q.pitch,q._fov)}(this.fogState,l,p,_,v.toUnwrapped(),this.transform)>.9)):kf(T,T,i);let P=T[3];return{point:new r.P((T[0]/P+1)/2*this.transform.width+Xo,(-T[1]/P+1)/2*this.transform.height+Xo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/P*.5,1.5),signedDistanceFromCamera:P,occluded:b&&T[2]>P||M}}isOffscreen(i,l,p,_){return p<Xo||i>=this.screenRightBoundary||_<Xo||l>this.screenBottomBoundary}isInsideGrid(i,l,p,_){return p>=0&&i<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let i=r.a9.identity([]);return r.a9.translate(i,i,[-100,-100,0]),i}}function uh(d,i,l){let p=i.createTileMatrix(d,d.worldSize,l.toUnwrapped());return r.a9.multiply(new Float32Array(16),d.projMatrix,p)}function fs(d,i,l){if(i.projection.name===l.projection.name)return d.projMatrix;let p=l.clone();return p.setProjection(i.projection),uh(p,i.getProjection(),d)}function hh(d,i,l){return i.name===l.projection.name?d.projMatrix:uh(l,i,d)}class dh{constructor(i,l,p,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class fl{constructor(i,l,p,_,v,b=!1){this.text=new dh(i?i.text:null,l,p,v),this.icon=new dh(i?i.icon:null,l,_,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fh{constructor(i,l,p,_=!1){this.text=i,this.icon=l,this.skipFade=p,this.clipped=_}}class b0{constructor(){this.invProjMatrix=r.a9.create(),this.viewportMatrix=r.a9.create(),this.circles=[]}}class Os{constructor(i,l,p,_,v){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class ph{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){let l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[i]}}function Bf(d,i,l,p,_){let{horizontalAlign:v,verticalAlign:b}=r.bi(d),D=-(v-.5)*i,T=-(b-.5)*l,M=r.bh(d,p);return new r.P(D+M[0]*_,T+M[1]*_)}function pl(d,i,l,p,_){let v=new r.P(d,i);return l&&v._rotate(p?_:-_),v}class Nf{constructor(i,l,p,_,v,b){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new x0(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ph(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,p,_){let v=p.getBucket(l),b=p.latestFeatureIndex;if(!v||!b||l.fqid!==v.layerIds[0])return;let D=v.layers[0].layout,T=p.collisionBoxArray,M=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),P=p.tileSize/r.Y,k=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);let N=(L=p.tileID,H=v.getProjection(),G=this.transform,H.name===this.projection?G.calculateProjMatrix(L.toUnwrapped()):uh(G,H,L));var L,H,G;let $=D.get("text-pitch-alignment")==="map",q=D.get("text-rotation-alignment")==="map";l.compileFilter();let Y=l.dynamicFilter(),re=l.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(p),ae=Sc(N,p.tileID.canonical,$,q,this.transform,v.getProjection(),ie),W=null;if($){let he=Ps(N,p.tileID.canonical,$,q,this.transform,v.getProjection(),ie);W=r.a9.multiply([],this.transform.labelPlaneMatrix,he)}let K=null;Y&&p.latestFeatureIndex&&(K={unwrappedTileID:k,dynamicFilter:Y,dynamicFilterNeedsFeature:re,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Os(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,p.tileID);let fe={bucket:v,layout:D,posMatrix:N,textLabelPlaneMatrix:ae,labelToScreenMatrix:W,clippingData:K,scale:M,textPixelRatio:P,holdingForFade:p.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:r.b8(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b8(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(let he of v.sortKeyRanges){let{sortKey:ve,symbolInstanceStart:Ie,symbolInstanceEnd:ye}=he;i.push({sortKey:ve,symbolInstanceStart:Ie,symbolInstanceEnd:ye,parameters:fe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q,Y){let{textOffset0:re,textOffset1:ie,crossTileID:ae}=N,W=[re,ie],K=Bf(i,p,_,W,v),fe=this.collisionIndex.placeCollisionBox(H,v,l,pl(K.x,K.y,b,D,this.transform.angle),k,T,M,P.predicate);if($){let he=H.getSymbolInstanceIconSize(Y,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(H,he,$,pl(K.x,K.y,b,D,this.transform.angle),k,T,M,P.predicate).box.length===0)return}if(fe.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(he=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:W,width:p,height:_,anchor:i,textScale:v,prevAnchor:he},this.markUsedJustification(H,i,N,G),H.allowVerticalPlacement&&(this.markUsedOrientation(H,G,N),this.placedOrientations[ae]=G),{shift:K,placedGlyphBoxes:fe}}}placeLayerBucketPart(i,l,p,_){let{bucket:v,layout:b,posMatrix:D,textLabelPlaneMatrix:T,labelToScreenMatrix:M,clippingData:P,textPixelRatio:k,holdingForFade:N,collisionBoxArray:L,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:G,collisionGroup:$}=i.parameters,q=b.get("text-optional"),Y=b.get("icon-optional"),re=b.get("text-allow-overlap"),ie=b.get("icon-allow-overlap"),ae=b.get("text-rotation-alignment")==="map",W=b.get("text-pitch-alignment")==="map",K=b.get("symbol-z-order")==="viewport-y",fe=b.get("symbol-z-elevate");this.transform.setProjection(v.projection);let he=re&&(ie||!v.hasIconData()||Y),ve=ie&&(re||!v.hasTextData()||q);!v.collisionArrays&&L&&v.deserializeCollisionBoxes(L),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,L);let Ie=(ye,Ae,Fe)=>{let{crossTileID:_e,numVerticalGlyphVertices:De}=ye;if(P){let gi={zoom:this.transform.zoom,pitch:this.transform.pitch},ai=null;if(P.dynamicFilterNeedsFeature){let dn=this.retainedQueryData[v.bucketInstanceId];ai=P.featureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:dn.bucketIndex,sourceLayerIndex:dn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(gi,ai,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new r.P(ye.tileAnchorX,ye.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[_e]=new fh(!1,!1,!1,!0),void l.add(_e)}if(l.has(_e))return;if(N)return void(this.placements[_e]=new fh(!1,!1,!1));let Xe=!1,be=!1,Se=!0,Me=!1,oe=!1,Ve=null,yt={box:null,offscreen:null,occluded:null},Mt={box:null,offscreen:null,occluded:null},zt=null,Rt=null,jt=null,En=0,nn=0,Pn=0;Fe.textFeatureIndex?En=Fe.textFeatureIndex:ye.useRuntimeCollisionCircles&&(En=ye.featureIndex),Fe.verticalTextFeatureIndex&&(nn=Fe.verticalTextFeatureIndex);let An=gi=>{gi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let ai=this.transform.elevation;gi.elevation=ye.zOffset+(ai?ai.getAtTileOffset(gi.tileID,gi.tileAnchorX,gi.tileAnchorY):0)},Fi=Fe.textBox;if(Fi){An(Fi);let gi=dn=>{let pn=r.b9.horizontal;if(v.allowVerticalPlacement&&!dn&&this.prevPlacement){let Ci=this.prevPlacement.placedOrientations[_e];Ci&&(this.placedOrientations[_e]=Ci,pn=Ci,this.markUsedOrientation(v,pn,ye))}return pn},ai=(dn,pn)=>{if(v.allowVerticalPlacement&&De>0&&Fe.verticalTextBox){for(let Ci of v.writingModes)if(Ci===r.b9.vertical?(yt=pn(),Mt=yt):yt=dn(),yt&&yt.box&&yt.box.length)break}else yt=dn()};if(b.get("text-variable-anchor")){let dn=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e]){let _i=this.prevPlacement.variableOffsets[_e];dn.indexOf(_i.anchor)>0&&(dn=dn.filter(xn=>xn!==_i.anchor),dn.unshift(_i.anchor))}let pn=(_i,xn,an)=>{let Qr=v.getSymbolInstanceTextSize(H,ye,this.transform.zoom,Ae),Or=(_i.x2-_i.x1)*Qr+2*_i.padding,gr=(_i.y2-_i.y1)*Qr+2*_i.padding,Rr=ye.hasIconTextFit&&!ie?xn:null;Rr&&An(Rr);let Yr={box:[],offscreen:!1,occluded:!1},zr=re?2*dn.length:dn.length;for(let _r=0;_r<zr;++_r){let Cr=this.attemptAnchorPlacement(dn[_r%dn.length],_i,Or,gr,Qr,ae,W,k,D,$,_r>=dn.length,ye,Ae,v,an,Rr,H,G);if(Cr&&(Yr=Cr.placedGlyphBoxes,Yr&&Yr.box&&Yr.box.length)){Xe=!0,Ve=Cr.shift;break}}return Yr};ai(()=>pn(Fi,Fe.iconBox,r.b9.horizontal),()=>{let _i=Fe.verticalTextBox;return _i&&An(_i),v.allowVerticalPlacement&&!(yt&&yt.box&&yt.box.length)&&De>0&&_i?pn(_i,Fe.verticalIconBox,r.b9.vertical):{box:null,offscreen:null,occluded:null}}),yt&&(Xe=yt.box,Se=yt.offscreen,Me=yt.occluded);let Ci=gi(!(!yt||!yt.box));if(!Xe&&this.prevPlacement){let _i=this.prevPlacement.variableOffsets[_e];_i&&(this.variableOffsets[_e]=_i,this.markUsedJustification(v,_i.anchor,ye,Ci))}}else{let dn=(pn,Ci)=>{let _i=v.getSymbolInstanceTextSize(H,ye,this.transform.zoom,Ae),xn=this.collisionIndex.placeCollisionBox(v,_i,pn,new r.P(0,0),re,k,D,$.predicate);return xn&&xn.box&&xn.box.length&&(this.markUsedOrientation(v,Ci,ye),this.placedOrientations[_e]=Ci),xn};ai(()=>dn(Fi,r.b9.horizontal),()=>{let pn=Fe.verticalTextBox;return v.allowVerticalPlacement&&De>0&&pn?(An(pn),dn(pn,r.b9.vertical)):{box:null,offscreen:null,occluded:null}}),gi(!!(yt&&yt.box&&yt.box.length))}}if(zt=yt,Xe=zt&&zt.box&&zt.box.length>0,Se=zt&&zt.offscreen,Me=zt&&zt.occluded,ye.useRuntimeCollisionCircles){let gi=v.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex>=0?ye.centerJustifiedTextSymbolIndex:ye.verticalPlacedTextSymbolIndex),ai=r.ba(v.textSizeData,H,gi),dn=b.get("text-padding");Rt=this.collisionIndex.placeCollisionCircles(v,re,gi,v.lineVertexArray,v.glyphOffsetArray,ai,D,T,M,p,W,$.predicate,ye.collisionCircleDiameter*ai/r.bf,dn,this.retainedQueryData[v.bucketInstanceId].tileID),Xe=re||Rt.circles.length>0&&!Rt.collisionDetected,Se=Se&&Rt.offscreen,Me=Rt.occluded}if(Fe.iconFeatureIndex&&(Pn=Fe.iconFeatureIndex),Fe.iconBox){let gi=ai=>{An(ai);let dn=ye.hasIconTextFit&&Ve?pl(Ve.x,Ve.y,ae,W,this.transform.angle):new r.P(0,0),pn=v.getSymbolInstanceIconSize(G,this.transform.zoom,ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,pn,ai,dn,ie,k,D,$.predicate)};Mt&&Mt.box&&Mt.box.length&&Fe.verticalIconBox?(jt=gi(Fe.verticalIconBox),be=jt.box.length>0):(jt=gi(Fe.iconBox),be=jt.box.length>0),Se=Se&&jt.offscreen,oe=jt.occluded}let ei=q||ye.numHorizontalGlyphVertices===0&&De===0,sr=Y||ye.numIconVertices===0;if(ei||sr?sr?ei||(be=be&&Xe):Xe=be&&Xe:be=Xe=be&&Xe,Xe&&zt&&zt.box&&this.collisionIndex.insertCollisionBox(zt.box,b.get("text-ignore-placement"),v.bucketInstanceId,Mt&&Mt.box&&nn?nn:En,$.ID),be&&jt&&this.collisionIndex.insertCollisionBox(jt.box,b.get("icon-ignore-placement"),v.bucketInstanceId,Pn,$.ID),Rt&&(Xe&&this.collisionIndex.insertCollisionCircles(Rt.circles,b.get("text-ignore-placement"),v.bucketInstanceId,En,$.ID),p)){let gi=v.bucketInstanceId,ai=this.collisionCircleArrays[gi];ai===void 0&&(ai=this.collisionCircleArrays[gi]=new b0);for(let dn=0;dn<Rt.circles.length;dn+=4)ai.circles.push(Rt.circles[dn+0]),ai.circles.push(Rt.circles[dn+1]),ai.circles.push(Rt.circles[dn+2]),ai.circles.push(Rt.collisionDetected?1:0)}let Ji=v.projection.name!=="globe";he=he&&(Ji||!Me),ve=ve&&(Ji||!oe),this.placements[_e]=new fh(Xe||he,be||ve,Se||v.justReloaded),l.add(_e)};if(fe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),K){let ye=v.getSortedSymbolIndexes(this.transform.angle);for(let Ae=ye.length-1;Ae>=0;--Ae){let Fe=ye[Ae];Ie(v.symbolInstances.get(Fe),Fe,v.collisionArrays[Fe])}v.hasAnyZOffset&&r.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let ye=v.getSortedIndexesByZOffset();for(let Ae=0;Ae<ye.length;++Ae){let Fe=ye[Ae];Ie(v.symbolInstances.get(Fe),Fe,v.collisionArrays[Fe])}}else for(let ye=i.symbolInstanceStart;ye<i.symbolInstanceEnd;ye++)Ie(v.symbolInstances.get(ye),ye,v.collisionArrays[ye]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){let ye=this.collisionCircleArrays[v.bucketInstanceId];r.a9.invert(ye.invProjMatrix,D),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,l,p,_){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:T,crossTileID:M}=p,P=r.bg(l),k=_===r.b9.vertical?T:P==="left"?v:P==="center"?b:P==="right"?D:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=k>=0&&v!==k?0:M),b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=k>=0&&b!==k?0:M),D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=k>=0&&D!==k?0:M),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=k>=0&&T!==k?0:M)}markUsedOrientation(i,l,p){let _=l===r.b9.horizontal||l===r.b9.horizontalOnly?l:0,v=l===r.b9.vertical?l:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M}=p,P=i.text.placedSymbolArray;b>=0&&(P.get(b).placedOrientation=_),D>=0&&(P.get(D).placedOrientation=_),T>=0&&(P.get(T).placedOrientation=_),M>=0&&(P.get(M).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let _=l?l.symbolFadeChange(i):1,v=l?l.opacities:{},b=l?l.variableOffsets:{},D=l?l.placedOrientations:{};for(let T in this.placements){let M=this.placements[T],P=v[T];P?(this.opacities[T]=new fl(P,_,M.text,M.icon,null,M.clipped),p=p||M.text!==P.text.placed||M.icon!==P.icon.placed):(this.opacities[T]=new fl(null,_,M.text,M.icon,M.skipFade,M.clipped),p=p||M.text||M.icon)}for(let T in v){let M=v[T];if(!this.opacities[T]){let P=new fl(M,_,!1,!1);P.isHidden()||(this.opacities[T]=P,p=p||M.text.placed||M.icon.placed)}}for(let T in b)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=b[T]);for(let T in D)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=D[T]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){let p=new Set;for(let _ of l){let v=_.getBucket(i);v&&_.latestFeatureIndex&&i.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,p,_.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,_.tileID),v.updateZOffset()))}}updateBucketOpacities(i,l,p){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();let _=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),b=new fl(null,0,!1,!1,!0),D=_.get("text-allow-overlap"),T=_.get("icon-allow-overlap"),M=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",k=_.get("text-pitch-alignment")==="map",N=new fl(null,0,D&&(T||!i.hasIconData()||_.get("icon-optional")),T&&(D||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&p&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(p);let L=(G,$,q)=>{for(let Y=0;Y<$/4;Y++)G.opacityVertexArray.emplaceBack(q)},H=0;for(let G=0;G<i.symbolInstances.length;G++){let $=i.symbolInstances.get(G),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:Y,crossTileID:re,numIconVertices:ie}=$,ae=l.has(re),W=this.opacities[re];ae?W=b:W||(W=N,this.opacities[re]=W),l.add(re);let K=q>0||Y>0,fe=ie>0,he=this.placedOrientations[re],ve=he===r.b9.vertical,Ie=he===r.b9.horizontal||he===r.b9.horizontalOnly;if(!K&&!fe||W.isHidden()||H++,K){let ye=gh(W.text);L(i.text,q,ve?gl:ye),L(i.text,Y,Ie?gl:ye);let Ae=W.text.isHidden(),{leftJustifiedTextSymbolIndex:Fe,centerJustifiedTextSymbolIndex:_e,rightJustifiedTextSymbolIndex:De,verticalPlacedTextSymbolIndex:Xe}=$,be=i.text.placedSymbolArray,Se=Ae||ve?1:0;Fe>=0&&(be.get(Fe).hidden=Se),_e>=0&&(be.get(_e).hidden=Se),De>=0&&(be.get(De).hidden=Se),Xe>=0&&(be.get(Xe).hidden=Ae||Ie?1:0);let Me=this.variableOffsets[re];Me&&this.markUsedJustification(i,Me.anchor,$,he);let oe=this.placedOrientations[re];oe&&(this.markUsedJustification(i,"left",$,oe),this.markUsedOrientation(i,oe,$))}if(fe){let ye=gh(W.icon),{placedIconSymbolIndex:Ae,verticalPlacedIconSymbolIndex:Fe}=$,_e=i.icon.placedSymbolArray,De=W.icon.isHidden()?1:0;Ae>=0&&(L(i.icon,ie,ve?gl:ye),_e.get(Ae).hidden=De),Fe>=0&&(L(i.icon,$.numVerticalIconVertices,Ie?gl:ye),_e.get(Fe).hidden=De)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){let ye=i.collisionArrays[G];if(ye){let Ae=new r.P(0,0),Fe=!0;if(ye.textBox||ye.verticalTextBox){if(M){let De=this.variableOffsets[re];De?(Ae=Bf(De.anchor,De.width,De.height,De.textOffset,De.textScale),P&&Ae._rotate(k?this.transform.angle:-this.transform.angle)):Fe=!1}v&&(Fe=!W.clipped),ye.textBox&&Pa(i.textCollisionBox.collisionVertexArray,W.text.placed,!Fe||ve,Ae.x,Ae.y),ye.verticalTextBox&&Pa(i.textCollisionBox.collisionVertexArray,W.text.placed,!Fe||Ie,Ae.x,Ae.y)}let _e=Fe&&!!(!Ie&&ye.verticalIconBox);ye.iconBox&&Pa(i.iconCollisionBox.collisionVertexArray,W.icon.placed,_e,$.hasIconTextFit?Ae.x:0,$.hasIconTextFit?Ae.y:0),ye.verticalIconBox&&Pa(i.iconCollisionBox.collisionVertexArray,W.icon.placed,!_e,$.hasIconTextFit?Ae.x:0,$.hasIconTextFit?Ae.y:0)}}}if(i.fullyClipped=H===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=G.invProjMatrix,i.placementViewportMatrix=G.viewportMatrix,i.collisionCircleArray=G.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){let p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Pa(d,i,l,p,_){d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0)}let Mc=Math.pow(2,25),ml=Math.pow(2,24),Lf=Math.pow(2,17),w0=Math.pow(2,16),D0=Math.pow(2,9),C0=Math.pow(2,8),mh=Math.pow(2,1);function gh(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let i=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Mc+i*ml+l*Lf+i*w0+l*D0+i*C0+l*mh+i}let gl=0;class Fc{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,p,_,v){let b=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(b,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((D,T)=>D.sortKey-T.sortKey));this._currentPartIndex<b.length;){let D=b[this._currentPartIndex];if(l.placeLayerBucketPart(D,this._seenCrossTileIDs,p,D.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Pc{constructor(i,l,p,_,v,b,D,T,M){this.placement=new Nf(i,v,b,D,T,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,l,p,_){let v=r.f.now(),b=()=>{let D=r.f.now()-v;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){let D=l[i[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=T)&&(!D.maxzoom||D.maxzoom>T)){let M=D,P=M.layout.get("symbol-z-elevate"),k=this._inProgressLayer=this._inProgressLayer||new Fc(M),N=r.aj(D.source,D.scope);if(k.continuePlacement(P?_[N]:p[N],this.placement,this._showCollisionBoxes,D,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}let Uf=512/r.Y/2;class E0{constructor(i,l,p){this.tileID=i,this.bucketInstanceId=p,this.index=new r.bj(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=i.canonical.x*r.Y,v=i.canonical.y*r.Y;for(let b=0;b<l.length;b++){let{key:D,crossTileID:T,tileAnchorX:M,tileAnchorY:P}=l.get(b),k=Math.floor((_+M)*Uf),N=Math.floor((v+P)*Uf);this.index.add(k,N),this.keys.push(D),this.crossTileIDs.push(T)}this.index.finish()}findMatches(i,l,p){let _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=Uf/Math.pow(2,l.canonical.z-this.tileID.canonical.z),b=l.canonical.x*r.Y,D=l.canonical.y*r.Y;for(let T=0;T<i.length;T++){let M=i.get(T);if(M.crossTileID)continue;let{key:P,tileAnchorX:k,tileAnchorY:N}=M,L=Math.floor((b+k)*v),H=Math.floor((D+N)*v),G=this.index.range(L-_,H-_,L+_,H+_);for(let $ of G){let q=this.crossTileIDs[$];if(this.keys[$]===P&&!p.has(q)){p.add(q),M.crossTileID=q;break}}}}}class _h{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Oc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){let l=Math.round((i-this.lng)/360);if(l!==0)for(let p in this.indexes){let _=this.indexes[p],v={};for(let b in _){let D=_[b];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+l),v[D.tileID.key]=D}this.indexes[p]=v}this.lng=i}addBucket(i,l,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);let _=this.usedCrossTileIDs[i.overscaledZ];for(let v in this.indexes){let b=this.indexes[v];if(Number(v)>i.overscaledZ)for(let D in b){let T=b[D];T.tileID.isChildOf(i)&&T.findMatches(l.symbolInstances,i,_)}else{let D=b[i.scaledTo(Number(v)).key];D&&D.findMatches(l.symbolInstances,i,_)}}for(let v=0;v<l.symbolInstances.length;v++){let b=l.symbolInstances.get(v);b.crossTileID||(b.crossTileID=p.generate(),_.add(b.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new E0(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(let p of l.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let l=!1;for(let p in this.indexes){let _=this.indexes[p];for(let v in _)i[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class zf{constructor(){this.layerIndexes={},this.crossTileIDs=new _h,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,p,_){let v=this.layerIndexes[i.fqid];v===void 0&&(v=this.layerIndexes[i.fqid]=new Oc);let b=!1,D={};_.name!=="globe"&&v.handleWrapJump(p);for(let T of l){let M=T.getBucket(i);M&&i.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(T.tileID,M,this.crossTileIDs)&&(b=!0),D[M.bucketInstanceId]=!0)}return v.removeStaleBuckets(D)&&(b=!0),b}pruneUnusedLayers(i){let l={};i.forEach(p=>{l[p]=!0});for(let p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}class Rc{constructor(i=0,l=0,p=0,_=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=p,this.right=_}interpolate(i,l,p){return l.top!=null&&i.top!=null&&(this.top=r.X(i.top,l.top,p)),l.bottom!=null&&i.bottom!=null&&(this.bottom=r.X(i.bottom,l.bottom,p)),l.left!=null&&i.left!=null&&(this.left=r.X(i.left,l.left,p)),l.right!=null&&i.right!=null&&(this.right=r.X(i.right,l.right,p)),this}getCenter(i,l){let p=r.ad((this.left+i-this.right)/2,0,i),_=r.ad((this.top+l-this.bottom)/2,0,l);return new r.P(p,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Rc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yh(d,i){let l=r.bn(d,3);r.a9.fromQuat(d,i),r.bp(d,3,l)}function Vf(d,i){let l=r.bl.identity([]);return r.bl.rotateZ(l,l,-i),r.bl.rotateX(l,l,-d),l}function Ko(d,i){let l=[d[0],d[1],0],p=[i[0],i[1],0];if(r.Q.length(l)>=1e-15){let b=r.Q.normalize([],l);r.Q.scale(p,b,r.Q.dot(p,b)),i[0]=p[0],i[1]=p[1]}let _=r.Q.cross([],i,d);if(r.Q.len(_)<1e-15)return null;let v=Math.atan2(-_[1],_[0]);return Vf(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class _l{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){let l=i instanceof r.O?i:new r.O(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=r.bk(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;let p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r.O.fromLngLat(i)):0,v=r.O.fromLngLat(i,_),b=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Ko(b,l)}setPitchBearing(i,l){this.orientation=Vf(r.bm(i),r.bm(-l))}}class kc{constructor(i,l){this._transform=r.a9.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){let i=this.position;return new r.O(i[0],i[1],i[2])}get position(){let i=r.bn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&r.bp(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.bl.identity([]),i&&yh(this._transform,this._orientation)}getPitchBearing(){let i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=Vf(i,l),yh(this._transform,this._orientation)}forward(){let i=r.bn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){let i=r.bn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){let i=r.bn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){let p=new Float64Array(16);return r.a9.invert(p,this.getWorldToCamera(i,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,l,p){let _=this.position;r.Q.scale(_,_,-i);let v=new Float64Array(16);return r.a9.fromScaling(v,[p,p,p]),r.a9.translate(v,v,_),v[10]*=l,v}getWorldToCamera(i,l){let p=new Float64Array(16),_=new Float64Array(4),v=this.position;return r.bl.conjugate(_,this._orientation),r.Q.scale(v,v,-i),r.a9.fromQuat(p,_),r.a9.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(i,l,p,_){let v=new Float64Array(16);return r.a9.perspective(v,i,l,p,_),v}getCameraToClipOrthographic(i,l,p,_,v,b){let D=new Float64Array(16);return r.a9.ortho(D,i,l,p,_,v,b),D}getDistanceToElevation(i,l=!1){let p=i===0?0:r.bo(i,l?r.ax(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new kc([...this.position],[...this.orientation])}}let jf=(d,i,l)=>(1-l)*d+l*i,yl=d=>d*d*d*d*d;class vh{constructor(i,l,p,_,v,b,D){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(b),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new r.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Rc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new kc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let i=new vh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,l=!1){let p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return r.af(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=r.br(this.projectionOptions);let p=!E(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){let i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.br({name:"mercator"});let l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){let i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bk(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){let l=-i*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=r.b7.create(),r.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){let l=r.ad(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.bm(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){let l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){let i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),_=0,v=0;for(let b=0;b<l.length;b++){let D=new r.P(l[b][0]*this.width,p+l[b][1]*(this.height-p)),T=i.pointCoordinate(D);if(!T)continue;let M=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);_+=T[3]*M,v+=M}return v===0?NaN:_/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude())),p;p=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];let _=r.Q.length(r.Q.sub([],this._camera.position,p));return r.ad(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!r.bl.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){let p=[i.position.x,i.position.y,i.position.z];r.Q.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let i=this._camera.position,l=new _l;return l.position=new r.O(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!r.bl.length(i))return!1;r.bl.normalize(i,i);let l=r.Q.transformQuat([],[0,0,-1],i),p=r.Q.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;let _=Ko(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(i){let l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;i[2]=r.ad(i[2],_/p,_/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,p){this._unmodified=!1,this._edgeInsets.interpolate(i,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){let l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){let l=[new r.bs(0,i)];if(this.renderWorldCopies){let p=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),D=Math.floor(Math.min(p.x,_.x,v.x,b.x)),T=Math.floor(Math.max(p.x,_.x,v.x,b.x)),M=1;for(let P=D-M;P<=T+M;P++)P!==0&&l.push(new r.bs(P,i))}return l}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,l,p){let _=[];if(l[0]===0&&l[1]===0)return _;for(let b of i){let D=b.canonical,T=b.overscaledZ,M=b.wrap,P=1<<D.z,k=D.x+1<P,N=D.x>0,L=D.y+1<P,H=D.y>0,G=b.wrap-(N?0:1),$=b.wrap+(k?0:1),q=N?D.x-1:P-1,Y=k?D.x+1:0;l[0]<0?(_.push(new r.ap(T,$,D.z,Y,D.y)),l[1]<0&&L&&(_.push(new r.ap(T,M,D.z,D.x,D.y+1)),_.push(new r.ap(T,$,D.z,Y,D.y+1))),l[1]>0&&H&&(_.push(new r.ap(T,M,D.z,D.x,D.y-1)),_.push(new r.ap(T,$,D.z,Y,D.y-1)))):l[0]>0?(_.push(new r.ap(T,G,D.z,q,D.y)),l[1]<0&&L&&(_.push(new r.ap(T,M,D.z,D.x,D.y+1)),_.push(new r.ap(T,G,D.z,q,D.y+1))),l[1]>0&&H&&(_.push(new r.ap(T,M,D.z,D.x,D.y-1)),_.push(new r.ap(T,G,D.z,q,D.y-1)))):l[1]<0&&L?_.push(new r.ap(T,M,D.z,D.x,D.y+1)):H&&_.push(new r.ap(T,M,D.z,D.x,D.y-1))}if(_.length>1){_.sort((T,M)=>T.overscaledZ-M.overscaledZ||T.wrap-M.wrap||T.canonical.z-M.canonical.z||T.canonical.x-M.canonical.x||T.canonical.y-M.canonical.y);let b=0,D=0;for(;D<_.length;)_[D].equals(_[b])?++D:_[++b]=_[D++];_.length=b+1}let v=[];for(let b of _)_.some(D=>b.isChildOf(D))||v.push(b);return _=v.filter(b=>!i.some(D=>!!(b.overscaledZ<p&&D.isChildOf(b))||b.equals(D)||b.isChildOf(D))),_}coveringTiles(i){let l=this.coveringZoomLevel(i),p=l,_=this.elevation&&this.elevation.exaggeration(),v=_&&!i.isTerrainDEM,b=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);let D=this.locationCoordinate(this.center),T=this.center.lat,M=1<<l,P=[M*D.x,M*D.y,0],k=this.projection.name==="globe",N=!k,L=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,N),H=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=M*r.bo(1,this.center.lat),$=this._camera.position[2]/r.bo(1,this.center.lat),q=[M*H.x,M*H.y,$*(N?1:G)],Y=k||_,re=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),ie=this.isLODDisabled(!0)?l:0,ae;if(this._elevation&&i.isTerrainDEM)ae=1e4*this._elevation.exaggeration();else if(this._elevation){let be=this._elevation.getMinMaxForVisibleTiles();ae=be?be.max:this._centerAltitude}else ae=this._centerAltitude;let W=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,K=this.projection.isReprojectedInTileSpace?r.bu(this):1,fe=be=>{let Me=new r.O(be.x+25e-6,be.y,be.z),oe=new r.O(be.x,be.y+25e-6,be.z),Ve=be.toLngLat(),yt=Me.toLngLat(),Mt=oe.toLngLat(),zt=this.locationCoordinate(Ve),Rt=this.locationCoordinate(yt),jt=this.locationCoordinate(Mt),En=Math.hypot(Rt.x-zt.x,Rt.y-zt.y),nn=Math.hypot(jt.x-zt.x,jt.y-zt.y);return Math.sqrt(En*nn)*K/25e-6},he=be=>{let Se=ae,Me=W;return{aabb:r.bx(this,M,0,0,0,be,Me,Se,this.projection),zoom:0,x:0,y:0,minZ:Me,maxZ:Se,wrap:be,fullyVisible:!1}},ve=[],Ie=[],ye=l,Ae=i.reparseOverscaled?p:l,Fe=be=>be*be,_e=Fe(($-this._centerAltitude)*G),De=be=>{if(!this._elevation||!be.tileID||!b)return;let Se=this._elevation.getMinMaxForTile(be.tileID),Me=be.aabb;Se?(Me.min[2]=Se.min,Me.max[2]=Se.max,Me.center[2]=(Me.min[2]+Me.max[2])/2):(be.shouldSplit=Xe(be),be.shouldSplit||(Me.min[2]=Me.max[2]=Me.center[2]=this._centerAltitude))},Xe=be=>{if(be.zoom<ie)return!0;if(be.zoom===ye)return!1;if(be.shouldSplit!=null)return be.shouldSplit;let Se=be.aabb.distanceX(q),Me=be.aabb.distanceY(q),oe=_e,Ve=1;if(k){oe=Fe(be.aabb.distanceZ(q));let zt=Math.pow(2,be.zoom),Rt=r.ax((be.y+1)/zt),jt=r.ax(be.y/zt),En=Math.min(Math.max(T,Rt),jt),nn=r.bM(En)/r.bM(T);if(Ve=En===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,nn/this._mercatorScaleRatio),this.zoom<=r.bJ&&be.zoom===ye-1&&nn>=.9)return!0}else if(v&&(oe=Fe(be.aabb.distanceZ(q)*G)),this.projection.isReprojectedInTileSpace&&p<=5){let zt=Math.pow(2,be.zoom),Rt=fe(new r.O((be.x+.5)/zt,(be.y+.5)/zt));Ve=Rt>.85?1:Rt}let yt=Se*Se+Me*Me+oe,Mt=Fe((1<<ye-be.zoom)*re*Ve*((zt,Rt)=>{if(Rt*Fe(.707)<zt)return 1;let jt=Math.sqrt(Rt/zt);return jt/(1.4144271570014144+(Math.pow(1.1,jt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(oe,_e),yt));return yt<Mt};if(this.renderWorldCopies)for(let be=1;be<=3;be++)ve.push(he(-be)),ve.push(he(be));for(ve.push(he(0));ve.length>0;){let be=ve.pop(),Se=be.x,Me=be.y,oe=be.fullyVisible,Ve=()=>this.projection.name==="globe"&&(be.y===0||be.y===(1<<be.zoom)-1);if(!oe){let yt=Y?be.aabb.intersects(L):be.aabb.intersectsFlat(L);if(yt===0&&Ve()){let Mt=new r.bv(be.zoom,Se,Me);yt=r.bw(this,M,Mt,!0).intersects(L)}if(yt===0)continue;oe=yt===2}if(be.zoom!==ye&&Xe(be))for(let yt=0;yt<4;yt++){let Mt=(Se<<1)+yt%2,zt=(Me<<1)+(yt>>1),Rt={aabb:b?be.aabb.quadrant(yt):r.bx(this,M,be.zoom+1,Mt,zt,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:Mt,y:zt,wrap:be.wrap,fullyVisible:oe,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};v&&!k&&(Rt.tileID=new r.ap(be.zoom+1===ye?Ae:be.zoom+1,be.wrap,be.zoom+1,Mt,zt),De(Rt)),ve.push(Rt)}else{let yt=be.zoom===ye?Ae:be.zoom;if(i.minzoom&&i.minzoom>yt)continue;if(!oe){let jt=Y?be.aabb.intersectsPrecise(L):be.aabb.intersectsPreciseFlat(L);if(jt===0&&Ve()){let En=new r.bv(be.zoom,Se,Me);jt=r.bw(this,M,En,!0).intersectsPrecise(L)}if(jt===0)continue}let Mt=P[0]-(.5+Se+(be.wrap<<be.zoom))*(1<<l-be.zoom),zt=P[1]-.5-Me,Rt=be.tileID?be.tileID:new r.ap(yt,be.wrap,be.zoom,Se,Me);Ie.push({tileID:Rt,distanceSq:Mt*Mt+zt*zt})}}if(this.fogCullDistSq){let be=this.fogCullDistSq,Se=this.horizonLineFromTop();Ie=Ie.filter(Me=>{let oe=[0,0,0,1],Ve=[r.Y,r.Y,0,1],yt=this.calculateFogTileMatrix(Me.tileID.toUnwrapped());r.aa.transformMat4(oe,oe,yt),r.aa.transformMat4(Ve,Ve,yt);let Mt=r.aa.min([],oe,Ve),zt=r.aa.max([],oe,Ve),Rt=r.by(Mt,zt);if(Rt===0)return!0;let jt=!1,En=this._elevation;if(En&&Rt>be&&Se!==0){let nn=this.calculateProjMatrix(Me.tileID.toUnwrapped()),Pn;i.isTerrainDEM||(Pn=En.getMinMaxForTile(Me.tileID)),Pn||(Pn={min:W,max:ae});let An=r.bK(this.rotation),Fi=[An[0]*r.Y,An[1]*r.Y,Pn.max];r.Q.transformMat4(Fi,Fi,nn),jt=(1-Fi[1])*this.height*.5<Se}return Rt<be||jt})}return Ie.sort((be,Se)=>be.distanceSq-Se.distanceSq).map(be=>be.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){let l=r.ad(i.lat,-r.bz,r.bz),p=this.projection.project(i.lng,l);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let p,_,v=this.centerPoint;if(this.projection.name==="globe"){let D=this.worldSize;p=(l.x-v.x)/D,_=(l.y-v.y)/D}else{let D=this.pointCoordinate(l),T=this.pointCoordinate(v);p=D.x-T.x,_=D.y-T.y}let b=this.locationCoordinate(i);this.setLocation(new r.O(b.x-p,b.y-_))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){let p=l?r.bo(l,i.lat):void 0,_=this.projection.project(i.lng,i.lat);return new r.O(_.x,_.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){let p=l??this._centerAltitude,_=[i.x,i.y,0,1],v=[i.x,i.y,1,1];r.aa.transformMat4(_,_,this.pixelMatrixInverse),r.aa.transformMat4(v,v,this.pixelMatrixInverse);let b=v[3];r.aa.scale(_,_,1/_[3]),r.aa.scale(v,v,1/b);let D=_[2],T=v[2];return{p0:_,p1:v,t:D===T?0:(p-D)/(T-D)}}screenPointToMercatorRay(i){let l=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return r.aa.transformMat4(l,l,this.pixelMatrixInverse),r.aa.transformMat4(p,p,this.pixelMatrixInverse),r.aa.scale(l,l,1/l[3]),r.aa.scale(p,p,1/p[3]),l[2]=r.bo(l[2],this._center.lat)*this.worldSize,p[2]=r.bo(p[2],this._center.lat)*this.worldSize,r.aa.scale(l,l,1/this.worldSize),r.aa.scale(p,p,1/this.worldSize),new r.a5([l[0],l[1],l[2]],r.Q.normalize([],r.Q.sub([],p,l)))}rayIntersectionCoordinate(i){let{p0:l,p1:p,t:_}=i,v=r.bo(l[2],this._center.lat),b=r.bo(p[2],this._center.lat);return new r.O(r.X(l[0],p[0],_)/this.worldSize,r.X(l[1],p[1],_)/this.worldSize,r.X(v,b,_))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new r.O(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(i.y>_)return this.pointCoordinate(i);let v=.02*_,b=i.clone();for(let D=0;D<10&&_-p>v;D++){b.y=r.X(p,_,.66);let T=this.projection.pointCoordinate3D(this,b.x,b.y);T?(_=b.y,l=T):p=b.y}return l?new r.O(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.bA)return!this.isPointAboveHorizon(i);let l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){let p=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,_=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return r.aa.transformMat4(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:i,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(l,i)),b=this.pointLocation3D(new r.P(_,i)),D=this.pointLocation3D(new r.P(_,p)),T=this.pointLocation3D(new r.P(l,p)),M=Math.min(v.lng,b.lng,D.lng,T.lng),P=Math.max(v.lng,b.lng,D.lng,T.lng),k=Math.min(v.lat,b.lat,D.lat,T.lat),N=Math.max(v.lat,b.lat,D.lat,T.lat),L=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,G=($,q,Y,re,ie)=>{let ae=($+Y)/2,W=(q+re)/2,K=new r.P(ae,W),{lng:fe,lat:he}=this.pointLocation3D(K),ve=Math.max(0,M-fe,k-he,fe-P,he-N);M=Math.min(M,fe),P=Math.max(P,fe),k=Math.min(k,he),N=Math.max(N,he),(ie<H||ve>L)&&(G($,q,ae,W,ie+1),G(ae,W,Y,re,ie+1))};if(G(l,i,_,i,1),G(_,i,_,p,1),G(_,p,l,p,1),G(l,p,l,i,1),this.projection.name==="globe"){let[$,q]=r.bB(this);$?(N=90,P=180,M=-180):q&&(k=-90,P=180,M=-180)}return new r.ag(new r.bq(M,k),new r.bq(P,N))}_getBoundsRectangular(i,l){let{top:p,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,D=new r.P(_,p),T=new r.P(b,p),M=new r.P(b,v),P=new r.P(_,v),k=this.pointCoordinate(D,i),N=this.pointCoordinate(T,i),L=this.pointCoordinate(M,l),H=this.pointCoordinate(P,l),G=($,q)=>(q.y-$.y)/(q.x-$.x);return k.y>1&&N.y>=0?k=new r.O((1-H.y)/G(H,k)+H.x,1):k.y<0&&N.y<=1&&(k=new r.O(-H.y/G(H,k)+H.x,0)),N.y>1&&k.y>=0?N=new r.O((1-L.y)/G(L,N)+L.x,1):N.y<0&&k.y<=1&&(N=new r.O(-L.y/G(L,N)+L.x,0)),new r.ag().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(L))}_getBoundsRectangularTerrain(){let i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=i.visibleDemTiles.reduce((p,_)=>{if(_.dem){let v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.bz,this.maxLat=r.bz,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a8(this.minLng)*this.tileSize,this.worldMaxX=r.a8(this.maxLng)*this.tileSize,this.worldMinY=r.ah(this.maxLat)*this.tileSize,this.worldMaxY=r.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){let l=i.key,p=this._distanceTileDataCache;if(p[l])return p[l];let _=i.canonical,v=1/this.height,b=this.cameraWorldSize,D=b/this.zoomScale(_.z),T=(_.x+Math.pow(2,_.z)*i.wrap)*D,M=_.y*D,P=this.point;P.x*=b/this.worldSize,P.y*=b/this.worldSize;let k=this.angle,N=Math.sin(-k),L=-Math.cos(-k);return p[l]={bearing:[N,L],center:[(P.x-T)*v,(P.y-M)*v],scale:D/r.Y*v},p[l]}calculateFogTileMatrix(i){let l=i.key,p=this._fogTileMatrixCache;if(p[l])return p[l];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.a9.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(i,l=!1,p=!1){let _=i.key,v;if(v=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];let b=this.calculatePosMatrix(i,this.worldSize),D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,r.a9.multiply(b,D,b),v[_]=new Float32Array(b),v[_]}calculatePixelsToTileUnitsMatrix(i){let l=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];let _=r.bC(i,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let i=1/this.worldSize,l=r.a9.fromScaling([],[i,i,i]);return r.a9.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let i=this._elevation;this._updateCameraState();let l=r.bo(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=r.bo(1,this._center.lat);p[2]/=v,_[2]/=v,r.Q.normalize(_,_);let b=i.raycast(p,_,i.exaggeration());if(b){let D=r.Q.scaleAndAdd([],p,_,b),T=new r.O(D[0],D[1],r.bo(D[2],r.ax(D[1]))),M=(T.z+r.Q.length([T.x-p[0],T.y-p[1],T.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;let l=this._elevation,p=r.bo(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),v=l.getAtPointOrZero(new r.O(..._)),b=this.pixelsPerMeter/this.worldSize*v,D=this._minimumHeightOverTerrain(),T=_[2]-b;if(T<=D)if(T<0||i){let M=this.locationCoordinate(this._center,this._centerAltitude),P=[_[0],_[1],M.z-_[2]],k=r.Q.length(P);P[2]-=(D-T)/this._pixelsPerMercatorPixel;let N=r.Q.length(P);if(N===0)return;r.Q.scale(P,P,k/N*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],M.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){let N=this.center;return N.lat=r.ad(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(N.lng=r.ad(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}let l=this._unmodified,{x:p,y:_}=this.point,v=0,b=p,D=_,T=this.width/2,M=this.height/2,P=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(_-M<P&&(D=P+M),_+M>k&&(D=k-M),k-P<this.height&&(v=Math.max(v,this.height/(k-P)),D=(k+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let N=this.worldMinX*this.scale,L=this.worldMaxX*this.scale,H=this.worldSize/2-(N+L)/2;b=(p+H+this.worldSize)%this.worldSize-H,b-T<N&&(b=N+T),b+T>L&&(b=L-T),L-N<this.width&&(v=Math.max(v,this.width/(L-N)),b=(L+N)/2)}b===p&&D===_||(this.center=this.unproject(new r.P(b,D))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let i=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bo(1,this.center.lat)/r.bo(1,r.bL));let _=r.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?p:1,b=this._camera.getWorldToCamera(this.worldSize,v),D,T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(T[8]=2*-i.x/this.width,T[9]=2*i.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ve=he*this.aspect,Ie=-ve,ye=-he;ve-=i.x,Ie-=i.x,he+=i.y,ye+=i.y,D=this._camera.getCameraToClipOrthographic(Ie,ve,ye,he,this._nearZ,this._farZ),((Ae,Fe,_e,De)=>{for(let Xe=0;Xe<16;Xe++)Ae[Xe]=jf(Fe[Xe],_e[Xe],De)})(D,D,T,yl(this.pitch>=15?1:this.pitch/15))}else D=T;let M=r.a9.mul([],T,b),P=r.a9.mul([],D,b);if(this.projection.isReprojectedInTileSpace){let he=this.locationCoordinate(this.center),ve=r.a9.identity([]);r.a9.translate(ve,ve,[he.x*this.worldSize,he.y*this.worldSize,0]),r.a9.multiply(ve,ve,r.bE(this)),r.a9.translate(ve,ve,[-he.x*this.worldSize,-he.y*this.worldSize,0]),r.a9.multiply(P,P,ve),r.a9.multiply(M,M,ve),this.inverseAdjustmentMatrix=r.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a9.scale([],P,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=P,this.invProjMatrix=r.a9.invert(new Float64Array(16),this.projMatrix),l){let he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-i.x/this.width,he[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.a9.mul([],he,b)}else this.expandedFarZProjMatrix=this.projMatrix;let k=r.a9.invert([],D);this.frustumCorners=r.bG.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);let N=new Float32Array(16);r.a9.identity(N),r.a9.scale(N,N,[1,-1,1]),r.a9.rotateX(N,N,this._pitch),r.a9.rotateZ(N,N,this.angle);let L=r.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a9.clone(L);let H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-i.x/this.width,L[9]=2*(i.y+H)/this.height,this.skyboxMatrix=r.a9.multiply(N,L,N);let G=this.point,$=G.x,q=G.y,Y=this.width%2/2,re=this.height%2/2,ie=Math.cos(this.angle),ae=Math.sin(this.angle),W=$-Math.round($)+ie*Y+ae*re,K=q-Math.round(q)+ie*re+ae*Y,fe=new Float64Array(P);if(r.a9.translate(fe,fe,[W>.5?W-1:W,K>.5?K-1:K,0]),this.alignedProjMatrix=fe,P=r.a9.create(),r.a9.scale(P,P,[this.width/2,-this.height/2,1]),r.a9.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=r.a9.create(),r.a9.scale(P,P,[1,-1,1]),r.a9.translate(P,P,[-1,-1,0]),r.a9.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=r.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},P=r.a9.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bH(this);let he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.Q.transformMat4(he,he,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,l];r.Q.scale(v,v,_),r.Q.scale(p,p,-1),r.Q.multiply(p,p,v);let b=r.a9.create();r.a9.translate(b,b,p),r.a9.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,_)}_computeCameraPosition(i){let l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,i/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=i[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((l-p)/_,1)),this._camera.position=r.Q.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){let i=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=r.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bm(this._maxPitch)),D=Math.max((i[2]-v)/Math.cos(p),b),T=this._zoomFromMercatorZ(D);r.Q.scaleAndAdd(i,i,l,D),this._pitch=r.ad(p,r.bm(this.minPitch),r.bm(this.maxPitch)),this.angle=r.bk(_,-Math.PI,Math.PI),this._setZoom(r.ad(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.O(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){let i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,p=r.bA,_=0,v=1/0;for(;p-l>1e-6&&p>l;){let b=l+.5*(p-l),D=this.tileSize*Math.pow(2,b),T=this.getCameraToCenterDistance(this.projection,b,D),M=this.scaleZoom(T/(i*this.tileSize)),P=Math.abs(b-M);P<v&&(v=P,_=b),b<M?l=b:p=b}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){let p=Math.min(i.x,l.x),_=Math.max(i.x,l.x),v=Math.min(i.y,l.y),b=Math.max(i.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let D=[new r.P(p,v),new r.P(_,b),new r.P(p,b),new r.P(_,v)],T=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(let P of D){let k=this.pointRayIntersection(P);if(k.t<0)return!0;let N=this.rayIntersectionCoordinate(k);if(N.x<T||N.y<0||N.x>M||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,l){let p=r.Q.length(r.Q.sub([],this._camera.position,i)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let i=function([l,p,_],v){let b=[l,p,_,1];r.aa.transformMat4(b,b,v);let D=b[3]=Math.max(b[3],1e-6);return b[0]/=D,b[1]/=D,b[2]/=D,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{let i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,l=this.zoom,p=this.worldSize){let _=r.bD(i,l,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,p,_),b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=jf(1,b,yl(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a9.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}let ao={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ta=(d,i)=>{if(i>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let l=d.transform,p=Math.max(Math.abs(l._zoom-(d.minCutoffZoom-1)),1),_=l.isLODDisabled(!1)?r.S(60,45,l.pitch):r.S(30,15,l.pitch),v=l._farZ-l._nearZ,b=i*l.height,D=((1-(T=_))*l.cameraToCenterDistance+T*(l._farZ+b))*p;var T;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(D-l._nearZ)/v,(D-b-l._nearZ)/v]}}},lo={cascadeCount:2,shadowMapResolution:2048};class A0{constructor(i,l){this.aabb=i,this.lastCascade=l}}class wv{add(i,l){let p=this.receivers[i.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[i.key]=new A0(l,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,l,p){let _=r.bV.fromPoints(i.points),v=0;for(let b in this.receivers){let D=this.receivers[b];if(!D||!_.intersectsAabb(D.aabb))continue;D.aabb.min=_.closestPoint(D.aabb.min),D.aabb.max=_.closestPoint(D.aabb.max);let T=D.aabb.getCorners();for(let M=0;M<p.length;M++){let P=!0;for(let k of T){let N=[k[0]*l,k[1]*l,k[2]];if(r.Q.transformMat4(N,N,p[M].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){P=!1;break}}if(D.lastCascade=M,v=Math.max(v,M),P)break}}return v+1}}class T0{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new wv,this._depthMode=new Gt(i.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,l){let p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;let _=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((H,G)=>{let $=p.style._mergedLayers[G];return H+($.hasShadowPass()&&!$.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=p.context,b=lo.shadowMapResolution,D=lo.shadowMapResolution;if(this._cascades.length===0||lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<lo.cascadeCount;++H){let G=p._shadowMapDebug,$=v.gl,q=v.createFramebuffer(b,D,G,"texture"),Y=new r.T(v,{width:b,height:D,data:null},$.DEPTH_COMPONENT);if(q.depthAttachment.set(Y.texture),G){let re=new r.T(v,{width:b,height:D,data:null},$.RGBA);q.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:q,texture:Y,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bt,scale:0})}}this.shadowDirection=bh(l);let T=0;if(i.elevation){let H=i.elevation,G=[1e4,-1e4];H.visibleDemTiles.filter($=>$.dem).forEach($=>{let q=$.dem.tree;G[0]=Math.min(G[0],q.minimums[0]),G[1]=Math.max(G[1],q.maximums[0])}),G[0]!==1e4&&(T=(G[1]-G[0])*H.exaggeration())}let M=1.5*i.cameraToCenterDistance,P=3*M,k=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){let G=this._cascades[H],$=i.height/50,q=1;lo.cascadeCount===1?q=P:H===0?q=M:($=M,q=P);let[Y,re]=wh(i,this.shadowDirection,$,q,lo.shadowMapResolution,T);G.scale=i.scale,G.matrix=Y,G.boundingSphereRadius=re,r.a9.invert(k,G.matrix),G.frustum=r.bt.fromInvProjectionMatrix(k,1,0,!0),G.far=q}let N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=ao.ShadowMap0,this._uniformValues.u_shadowmap_1=ao.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let L=p.transform.elevation;for(let H of this._groundShadowTiles){let G={min:0,max:0};if(L){let $=L.getMinMaxForTile(H);$&&(G=$)}this.addShadowReceiver(H.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,l){if(!this.enabled)return;let p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,lo.shadowMapResolution,lo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:r.aA.white,depth:1});for(let b of i.order){let D=i._mergedLayers[b];if(!D.hasShadowPass()||D.isHidden(p.transform.zoom))continue;let T=i.getLayerSourceCache(D),M=T?l[T.id]:void 0;(D.type==="model"||M&&M.length)&&p.renderLayer(p,T,D,M)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let i=this.painter,l=i.style,p=i.context,_=l.directionalLight,v=l.ambientLight;if(!_||!v)return;let b=[],D=ta(i,i.longestCutoffRange);D.shouldRenderCutoff&&b.push("RENDER_CUTOFF");let T=Gf(_,v),M=new Gt(p.gl.LEQUAL,Gt.ReadOnly,i.depthRangeFor3D);for(let P of this._groundShadowTiles){let k=P.toUnwrapped(),N=i.isTileAffectedByFog(P),L=i.getOrCreateProgram("groundShadow",{defines:b,overrideFog:N});this.setupShadows(k,L),i.uploadCommonUniforms(p,L,k,null,D);let H={u_matrix:i.transform.calculateProjMatrix(k),u_ground_shadow_factor:T};L.draw(i,p.gl.TRIANGLES,M,on.disabled,_n.multiply,Kt.disabled,H,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?_n.unblended:_n.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){let l=this.painter.transform,p=l.calculatePosMatrix(i,l.worldSize);return r.a9.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(i){return r.a9.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,l,p,_=0){if(!this.enabled)return;let v=this.painter.transform,b=this.painter.context,D=b.gl,T=this._uniformValues,M=new Float64Array(16),P=v.calculatePosMatrix(i,v.worldSize);for(let k=0;k<this._cascades.length;k++)r.a9.multiply(M,this._cascades[k].matrix,P),T[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),b.activeTexture.set(D.TEXTURE0+ao.ShadowMap0+k),this._cascades[k].texture.bind(D.NEAREST,D.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){let k=r.bU(i.canonical),N=2/v.tileSize*r.Y/lo.shadowMapResolution,L=N*this._cascades[0].boundingSphereRadius,H=N*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(p==="vector-tile"?1:3)/Math.pow(2,_-i.canonical.z-(1-v.zoom+Math.floor(v.zoom)));T.u_shadow_normal_offset=[k,L*G,H*G],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(b,T)}setupShadowsFromMatrix(i,l,p=!1){if(!this.enabled)return;let _=this.painter.context,v=_.gl,b=this._uniformValues,D=new Float64Array(16);for(let T=0;T<lo.cascadeCount;T++)r.a9.multiply(D,this._cascades[T].matrix,i),b[T===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),_.activeTexture.set(v.TEXTURE0+ao.ShadowMap0+T),this._cascades[T].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=p,p?(b.u_shadow_normal_offset=[1,5,5],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(_,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,l,p,_){if(_[2]>=0)return{};let v=function(T,M,P){let k=P/(1<<T.canonical.z);return new r.bV([T.canonical.x*k+T.wrap*P,T.canonical.y*k+T.wrap*P,0],[(T.canonical.x+1)*k+T.wrap*P,(T.canonical.y+1)*k+T.wrap*P,M])}(i,l,p).getCorners(),b=l/-_[2];_[0]<0?(r.Q.add(v[0],v[0],[_[0]*b,0,0]),r.Q.add(v[3],v[3],[_[0]*b,0,0])):_[0]>0&&(r.Q.add(v[1],v[1],[_[0]*b,0,0]),r.Q.add(v[2],v[2],[_[0]*b,0,0])),_[1]<0?(r.Q.add(v[0],v[0],[0,_[1]*b,0]),r.Q.add(v[1],v[1],[0,_[1]*b,0])):_[1]>0&&(r.Q.add(v[2],v[2],[0,_[1]*b,0]),r.Q.add(v[3],v[3],[0,_[1]*b,0]));let D={};return D.vertices=v,D.planes=[xh(v[1],v[0],v[4]),xh(v[2],v[1],v[5]),xh(v[3],v[2],v[6]),xh(v[0],v[3],v[7])],D}addShadowReceiver(i,l,p){this._receivers.add(i,r.bV.fromTileIdAndHeight(i,l,p))}getMaxCascadeForTile(i){let l=this._receivers.get(i);return l&&l.lastCascade?l.lastCascade:0}}function xh(d,i,l){let p=r.Q.sub([],l,i),_=r.Q.sub([],d,i),v=r.Q.cross([],p,_),b=r.Q.length(v);return b===0?[0,0,1,0]:(r.Q.scale(v,v,1/b),[v[0],v[1],v[2],-r.Q.dot(v,i)])}function bh(d){let i=d.properties.get("direction"),l=r.bT(i.x,i.y,i.z);l[2]=r.ad(l[2],0,75);let p=r.bW([l[0],l[1],l[2]]);return r.Q.fromValues(p.x,p.y,p.z)}function Gf(d,i){let l=d.properties.get("color"),p=d.properties.get("intensity"),_=d.properties.get("direction"),v=[_.x,_.y,_.z],b=i.properties.get("color"),D=i.properties.get("intensity"),T=Math.max(r.Q.dot([0,0,1],v),0),M=[0,0,0];r.Q.scale(M,b.toArray01Linear().slice(0,3),D);let P=[0,0,0];return r.Q.scale(P,l.toArray01Linear().slice(0,3),T*p),r.bX([M[0]>0?M[0]/(M[0]+P[0]):0,M[1]>0?M[1]/(M[1]+P[1]):0,M[2]>0?M[2]/(M[2]+P[2]):0])}function wh(d,i,l,p,_,v){let b=d.zoom,D=d.scale,T=d.worldSize,M=1/T,P=d.aspect,k=Math.sqrt(1+P*P)*Math.tan(.5*d.fovX),N=k*k,L=p-l,H=p+l,G,$;N>L/H?(G=p,$=p*k):(G=.5*H*(1+N),$=.5*Math.sqrt(L*L+2*(p*p+l*l)*N+H*H*N*N));let q=d.projection.pixelsPerMeter(d.center.lat,T),Y=d._camera.getCameraToWorldMercator(),re=[0,0,-G*M];r.Q.transformMat4(re,re,Y);let ie=$*M,ae=d._edgeInsets;if(!(ae.left===0&&ae.top===0&&ae.right===0&&ae.bottom===0||ae.left===ae.right&&ae.top===ae.bottom)){let oe=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?q:1),Ve=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,l,p);Ve[8]=2*-d.centerOffset.x/d.width,Ve[9]=2*d.centerOffset.y/d.height;let yt=new Float64Array(16);r.a9.mul(yt,Ve,oe);let Mt=new Float64Array(16);r.a9.invert(Mt,yt);let zt=r.bt.fromInvProjectionMatrix(Mt,T,b,!0);for(let Rt of zt.points){let jt=((W=Rt)[0]/=D,W[1]/=D,W[2]=r.bo(W[2],d._center.lat),W);ie=Math.max(ie,r.Q.len(r.Q.subtract([],re,jt)))}}var W;ie*=_/(_-1);let K=Math.acos(i[2]),fe=Math.atan2(-i[0],-i[1]),he=new kc;he.position=re,he.setPitchBearing(K,fe);let ve=he.getWorldToCamera(T,q),Ie=ie*T,ye=Math.min(d._mercatorZfromZoom(17)*T*-2,-2*Ie),Ae=he.getCameraToClipOrthographic(-Ie,Ie,-Ie,Ie,ye,(Ie+v*q)/i[2]),Fe=new Float64Array(16);r.a9.multiply(Fe,Ae,ve);let _e=r.Q.fromValues(Math.floor(1e6*re[0])/1e6*T,Math.floor(1e6*re[1])/1e6*T,0),De=.5*_,Xe=[0,0,0];r.Q.transformMat4(Xe,_e,Fe),r.Q.scale(Xe,Xe,De);let be=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],Se=[0,0,0];r.Q.sub(Se,Xe,be),r.Q.scale(Se,Se,-1/De);let Me=new Float64Array(16);return r.a9.identity(Me),r.a9.translate(Me,Me,Se),r.a9.multiply(Fe,Me,Fe),[Fe,Ie]}let ps=(d,i)=>vt(d,i&&i.filter(l=>l.identifier!=="source.canvas")),S0=r.af(qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Dv=r.af(qn,["setCenter","setZoom","setBearing","setPitch"]),Hf={version:8,layers:[],sources:{}},$f={duration:300,delay:0};class Jo extends r.E{constructor(i,l={}){super(),this.map=i,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=r.e({},$f),this._buildingIndex=new Mf(this),this.crossTileSymbolIndex=new zf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new ot,this.dispatcher=l.dispatcher?l.dispatcher:new r.bZ(r.b_(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new st,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new r.b$(i._requestManager,l.localFontFamily?r.c0.all:l.localIdeographFontFamily?r.c0.ideographs:r.c0.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new bt(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",r.c1());let p=this;this._rtlTextPluginCallback=Jo.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,b)=>{if(r.c2(v),b&&b.every(D=>D))for(let D in p._sourceCaches){let T=p._sourceCaches[D],M=T.getSource().type;M!=="vector"&&M!=="geojson"||T.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(let b in this._layers){let D=this._layers[b];D.source===v.id&&this._validateLayer(D)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.c3(i))return i;let l=r.c4(i);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${r.c5(JSON.stringify(i))}`}_diffStyle(i,l,p){this.globalId=this._getGlobalId(i);let _=(v,b)=>{try{b(null,this.setState(v,p))}catch(D){b(D,!1)}};if(typeof i=="string"){let v=this.map._requestManager.normalizeStyleURL(i),b=this.map._requestManager.transformRequest(v,r.R.Style);r.g(b,(D,T)=>{D?this.fire(new r.a(D)):T&&_(T,l)})}else typeof i=="object"&&_(i,l)}loadURL(i,l={}){this.fire(new r.b("dataloading",{dataType:"style"}));let p=typeof l.validate=="boolean"?l.validate:!r.c3(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,l.accessToken),this.resolvedImports.add(i);let _=this.importsCache.get(i);if(_)return this._load(_,p);let v=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.g(v,(b,D)=>{if(this._request=null,b)this.fire(new r.a(b));else if(D)return this.importsCache.set(i,D),this._load(D,p)})}loadJSON(i,l={}){this.fire(new r.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.f.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load(Hf,!1)}_loadImports(i,l,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let v of i){let b=this._createFragmentStyle(v),D=new Promise(P=>{b.once("style.import.load",P),b.once("error",P)}).then(()=>this.mergeAll());if(_.push(D),this.resolvedImports.has(v.url)){b.loadEmpty();continue}let T=v.data||this.importsCache.get(v.url);T?(b.loadJSON(T,{validate:l}),this._isInternalStyle(T)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:l}):b.loadEmpty();let M={style:b,id:v.id,config:v.config};if(p){let P=this.fragments.findIndex(({id:k})=>k===p);this.fragments=this.fragments.slice(0,P).concat(M).concat(this.fragments.slice(P))}else this.fragments.push(M)}return Promise.allSettled(_)}getImportGlobalIds(i=this,l=new Set){for(let p of i.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(i){let l=this.scope?r.aj(i.id,this.scope):i.id,p,_=this._initialConfig&&this._initialConfig[l];(i.config||_)&&(p=r.e({},i.config,_));let v=new Jo(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,l){let p=i.schema;if(this._isInternalStyle(i)){let D=r.e({},Hf,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(D,l)}if(this.updateConfig(this._config,p),l&&ps(this,Wt(i)))return;this._loaded=!0,this.stylesheet=r.c6(i);for(let D in i.sources)this.addSource(D,i.sources[D],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);let _=y0(this.stylesheet.layers);if(this._order=_.map(D=>D.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let D=this.stylesheet.lights[0];this.light=new Lt(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Lt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let D of _){let T=r.c7(D,this.scope,this.options);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();let M=this.getOwnLayerSourceCache(T),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&T.canCastShadows()&&P&&(M.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let v=this.stylesheet.terrain;v&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"}));let b=this.isRootStyle();i.imports?this._loadImports(i.imports,l).then(()=>{this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.b(b?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let i,l,p,_,v,b,D,T;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(M=>{if(M.stylesheet){if(M.light!=null&&(i=M.light),M.stylesheet.lights)for(let P of M.stylesheet.lights)P.type==="ambient"&&M.ambientLight!=null&&(l=M.ambientLight),P.type==="directional"&&M.directionalLight!=null&&(p=M.directionalLight);_=this._prioritizeTerrain(_,M.terrain,M.stylesheet.terrain),M.stylesheet.fog&&M.fog!=null&&(v=M.fog),M.stylesheet.camera!=null&&(T=M.stylesheet.camera),M.stylesheet.projection!=null&&(b=M.stylesheet.projection),M.stylesheet.transition!=null&&(D=M.stylesheet.transition)}}),this.light=i,this.ambientLight=l,this.directionalLight=p,this.fog=v,_===null?delete this.terrain:this.terrain=_,this.camera=T||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=r.e({},$f,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){let l=p=>{for(let _ of p.fragments)l(_.style);i(p)};l(this)}_prioritizeTerrain(i,l,p){let _=i&&i.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:_?i:null:l!=null&&(!i||_||l&&l.drapeRenderMode===1)?l:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{i=this._prioritizeTerrain(i,l.terrain,l.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(i=l.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){let i={},l={},p={};this.forEachFragmentStyle(_=>{for(let v in _._sourceCaches){let b=r.aj(v,_.scope);i[b]=_._sourceCaches[v]}for(let v in _._otherSourceCaches){let b=r.aj(v,_.scope);l[b]=_._otherSourceCaches[v]}for(let v in _._symbolSourceCaches){let b=r.aj(v,_.scope);p[b]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){let i={},l=[],p={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let b of v._order){let D=v._layers[b];if(D.type==="slot"){let T=r.c8(b);if(i[T])continue;i[T]=[]}D.slot&&i[D.slot]?i[D.slot].push(D):l.push(D)}}),this._mergedOrder=[];let _=(v=[])=>{for(let b of v)if(b.type==="slot"){let D=r.c8(b.id);i[D]&&_(i[D])}else{let D=r.aj(b.id,b.scope);this._mergedOrder.push(D),p[D]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0)}};_(l),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.e({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(l,p,_){let v,b,D,T=r.f.devicePixelRatio>1?"@2x":"",M=r.g(p.transformRequest(p.normalizeSpriteURL(l,T,".json"),r.R.SpriteJSON),(N,L)=>{M=null,D||(D=N,v=L,k())}),P=r.d(p.transformRequest(p.normalizeSpriteURL(l,T,".png"),r.R.SpriteImage),(N,L)=>{P=null,D||(D=N,b=L,k())});function k(){if(D)_(D);else if(v&&b){let N=r.f.getImageData(b),L={};for(let H in v){let{width:G,height:$,x:q,y:Y,sdf:re,pixelRatio:ie,stretchX:ae,stretchY:W,content:K}=v[H],fe=new r.h({width:G,height:$});r.h.copy(N,fe,{x:q,y:Y},{x:0,y:0},{width:G,height:$}),L[H]={data:fe,pixelRatio:ie,sdf:re,stretchX:ae,stretchY:W,content:K}}_(null,L)}}return{cancel(){M&&(M.cancel(),M=null),P&&(P.cancel(),P=null)}}}(i,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new r.a(l));else if(p)for(let _ in p)this.imageManager.addImage(_,this.scope,p[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(i){let l=this.getOwnSource(i.source);if(!l)return;let p=i.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.a(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,l)=>{let p=this.fragments[l];return p&&p.style&&(i.data=p.style.serialize()),i})}_serializeSources(){let i={};for(let l in this._sourceCaches){let p=this._sourceCaches[l].getSource();i[p.id]||(i[p.id]=p.serialize())}return i}_serializeLayers(i){let l=[];for(let p of i){let _=this._layers[p];_&&_.type!=="custom"&&l.push(_.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(let i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){let l=this.getOwnLayer(i);if(l)return l;this.fire(new r.a(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){let l=this.getOwnSource(i);if(l)return l;this.fire(new r.a(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);let l=this.calculateLightsBrightness();i.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));let p=this._changes.isDirty();if(this._changes.isDirty()){let v=this._changes.getLayerUpdatesByScope();for(let b in v){let{updatedIds:D,removedIds:T}=v[b];(D||T)&&this._updateWorkerLayers(b,D,T)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}let _={};for(let v in this._mergedSourceCaches){let b=this._mergedSourceCaches[v];_[v]=b.used,b.used=!1,b.tileCoverLift=0}for(let v of this._mergedOrder){let b=this._mergedLayers[v];if(b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)){let D=this.getLayerSourceCache(b);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,b.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let D=b.minzoom||0;D<(b.maxzoom||25.5);D++){let T=this.map.painter;if(T){let M=b.getProgramIds();if(!M)continue;for(let P of M){let k=b.getDefaultProgramParams(P,i.zoom);k&&(T.style=this,this.fog&&(T._fogVisible=!0,k.overrideFog=!0,T.getOrCreateProgram(P,k)),T._fogVisible=!1,k.overrideFog=!1,T.getOrCreateProgram(P,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,T.getOrCreateProgram(P,k)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let v in _){let b=this._mergedSourceCaches[v];_[v]!==b.used&&b.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let i=this._changes.getUpdatedImages();if(i.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,l,p){let _=this.getFragmentStyle(i);_&&this.dispatcher.broadcast("updateLayers",{layers:l?_._serializeLayers(l):[],scope:i,removedIds:p||[],options:_.options})}setState(i,l){if(this._checkLoaded(),ps(this,Wt(i)))return!1;(i=r.c6(i)).layers=y0(i.layers);let p=function(b,D){if(!b)return[{command:qn.setStyle,args:[D]}];let T=[];try{if(!E(b.version,D.version))return[{command:qn.setStyle,args:[D]}];E(b.center,D.center)||T.push({command:qn.setCenter,args:[D.center]}),E(b.zoom,D.zoom)||T.push({command:qn.setZoom,args:[D.zoom]}),E(b.bearing,D.bearing)||T.push({command:qn.setBearing,args:[D.bearing]}),E(b.pitch,D.pitch)||T.push({command:qn.setPitch,args:[D.pitch]}),E(b.sprite,D.sprite)||T.push({command:qn.setSprite,args:[D.sprite]}),E(b.glyphs,D.glyphs)||T.push({command:qn.setGlyphs,args:[D.glyphs]}),E(b.imports,D.imports)||function(L=[],H=[],G){H=H||[];let $=(L=L||[]).map(hl),q=H.map(hl),Y=L.reduce(Ac,{}),re=H.reduce(Ac,{}),ie=$.slice(),ae,W,K,fe;for(ae=0,W=0;ae<$.length;ae++)K=$[ae],re.hasOwnProperty(K)?W++:(G.push({command:qn.removeImport,args:[K]}),ie.splice(ie.indexOf(K,W),1));for(ae=0,W=0;ae<q.length;ae++)K=q[q.length-1-ae],ie[ie.length-1-ae]!==K&&(Y.hasOwnProperty(K)?(G.push({command:qn.removeImport,args:[K]}),ie.splice(ie.lastIndexOf(K,ie.length-W),1)):W++,fe=ie[ie.length-ae],G.push({command:qn.addImport,args:[re[K],fe]}),ie.splice(ie.length-ae,0,K));for(let he of H){let ve=Y[he.id];ve&&!E(ve,he)&&G.push({command:qn.updateImport,args:[he.id,he]})}}(b.imports,D.imports,T),E(b.transition,D.transition)||T.push({command:qn.setTransition,args:[D.transition]}),E(b.light,D.light)||T.push({command:qn.setLight,args:[D.light]}),E(b.fog,D.fog)||T.push({command:qn.setFog,args:[D.fog]}),E(b.projection,D.projection)||T.push({command:qn.setProjection,args:[D.projection]}),E(b.lights,D.lights)||T.push({command:qn.setLights,args:[D.lights]}),E(b.camera,D.camera)||T.push({command:qn.setCamera,args:[D.camera]});let M={},P=[];(function(L,H,G,$){let q;for(q in H=H||{},L=L||{})L.hasOwnProperty(q)&&(H.hasOwnProperty(q)||Ff(q,G,$));for(q in H){if(!H.hasOwnProperty(q))continue;let Y=H[q];L.hasOwnProperty(q)?E(L[q],Y)||(L[q].type==="geojson"&&Y.type==="geojson"&&Pf(L,H,q)?G.push({command:qn.setGeoJSONSourceData,args:[q,Y.data]}):v0(q,H,G,$)):oh(q,H,G)}})(b.sources,D.sources,P,M);let k=[];b.layers&&b.layers.forEach(L=>{L.source&&M[L.source]?T.push({command:qn.removeLayer,args:[L.id]}):k.push(L)});let N=b.terrain;N&&M[N.source]&&(T.push({command:qn.setTerrain,args:[void 0]}),N=void 0),T=T.concat(P),E(N,D.terrain)||T.push({command:qn.setTerrain,args:[D.terrain]}),function(L,H,G){H=H||[];let $=(L=L||[]).map(hl),q=H.map(hl),Y=L.reduce(Ac,{}),re=H.reduce(Ac,{}),ie=$.slice(),ae=Object.create(null),W,K,fe,he,ve,Ie,ye;for(W=0,K=0;W<$.length;W++)fe=$[W],re.hasOwnProperty(fe)?K++:(G.push({command:qn.removeLayer,args:[fe]}),ie.splice(ie.indexOf(fe,K),1));for(W=0,K=0;W<q.length;W++)fe=q[q.length-1-W],ie[ie.length-1-W]!==fe&&(Y.hasOwnProperty(fe)?(G.push({command:qn.removeLayer,args:[fe]}),ie.splice(ie.lastIndexOf(fe,ie.length-K),1)):K++,Ie=ie[ie.length-W],G.push({command:qn.addLayer,args:[re[fe],Ie]}),ie.splice(ie.length-W,0,fe),ae[fe]=!0);for(W=0;W<q.length;W++)if(fe=q[W],he=Y[fe],ve=re[fe],!ae[fe]&&!E(he,ve))if(E(he.source,ve.source)&&E(he["source-layer"],ve["source-layer"])&&E(he.type,ve.type)){for(ye in Ia(he.layout,ve.layout,G,fe,null,qn.setLayoutProperty),Ia(he.paint,ve.paint,G,fe,null,qn.setPaintProperty),E(he.slot,ve.slot)||G.push({command:qn.setSlot,args:[fe,ve.slot]}),E(he.filter,ve.filter)||G.push({command:qn.setFilter,args:[fe,ve.filter]}),E(he.minzoom,ve.minzoom)&&E(he.maxzoom,ve.maxzoom)||G.push({command:qn.setLayerZoomRange,args:[fe,ve.minzoom,ve.maxzoom]}),he)he.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Ia(he[ye],ve[ye],G,fe,ye.slice(6),qn.setPaintProperty):E(he[ye],ve[ye])||G.push({command:qn.setLayerProperty,args:[fe,ye,ve[ye]]}));for(ye in ve)ve.hasOwnProperty(ye)&&!he.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Ia(he[ye],ve[ye],G,fe,ye.slice(6),qn.setPaintProperty):E(he[ye],ve[ye])||G.push({command:qn.setLayerProperty,args:[fe,ye,ve[ye]]}))}else G.push({command:qn.removeLayer,args:[fe]}),Ie=ie[ie.lastIndexOf(fe)+1],G.push({command:qn.addLayer,args:[ve,Ie]})}(k,D.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:qn.setStyle,args:[D]}]}return T}(this.serialize(),i).filter(b=>!(b.command in Dv));if(p.length===0)return!1;let _=p.filter(b=>!(b.command in S0));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);let v=[];return p.forEach(b=>{v.push(this[b.command].apply(this,b.args))}),l&&Promise.all(v).then(l),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,l){return this.getImage(i)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,l),this._afterImageUpdated(i),this)}updateImage(i,l){this.imageManager.updateImage(i,this.scope,l)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,l,p={}){return this._checkLoaded(),this._validate(kt,`models.${i}`,l,null,p)||(this.modelManager.addModel(i,l,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,l,p={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Wo,`sources.${i}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let _=Sf(i,l,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let v=b=>{let D=(b?"symbol:":"other:")+_.id,T=r.aj(D,this.scope),M=this._sourceCaches[D]=new Yo(T,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=M,M.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();let l=this.getOwnSource(i);if(!l)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===i)return this.fire(new r.a(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.a(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));let p=this.getOwnSourceCaches(i);for(let _ of p){let v=r.c8(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getOwnSource(i).setData(l),this._changes.setDirty()}getOwnSource(i){let l=this.getOwnSourceCache(i);return l&&l.getSource()}getOwnSources(){let i=[];for(let l in this._otherSourceCaches){let p=this.getOwnSourceCache(l);p&&i.push(p.getSource())}return i}areTilesLoaded(){let i=this._mergedSourceCaches;for(let l in i){let p=i[l]._tiles;for(let _ in p){let v=p[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;let l=this._getTransitionParameters();for(let _ of i){if(this._validate(Ye,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(_),v.updateTransitions(l)}else this.ambientLight=new wr(_,so,this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(_),v.updateTransitions(l)}else this.directionalLight=new wr(_,Xi,this.scope,this.options)}}let p=new r.N(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let i=this.directionalLight,l=this.ambientLight;if(!i||!l)return;let p=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),_=i.properties.get("color").toArray01(),v=i.properties.get("intensity"),b=i.properties.get("direction"),D=1-r.bT(b.x,b.y,b.z)[2]/90,T=p(_)*v*D,M=l.properties.get("color").toArray01(),P=l.properties.get("intensity");return(T+p(M)*P)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.c9(i)){let l=r.ca(i),p=this.fragments.find(({id:v})=>v===l);if(!p)throw new Error(`Style import not found: ${i}`);let _=r.c8(i);return p.style.getFragmentStyle(_)}{let l=this.fragments.find(({id:p})=>p===i);if(!l)throw new Error(`Style import not found: ${i}`);return l.style}}getConfigProperty(i,l){let p=this.getFragmentStyle(i);if(!p)return null;let _=r.aj(l,p.scope),v=p.options.get(_),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(i,l,p){let _=this.getFragmentStyle(i);if(!_)return;let v=_.stylesheet.schema;if(!v||!v[l])return;let b=r.t(p);if(b.result!=="success")return void ps(this,b.value);let D=b.value.expression,T=r.aj(l,_.scope),M=_.options.get(T);if(!M)return;let P,{minValue:k,maxValue:N,stepValue:L,type:H,values:G}=v[l],$=r.t(v[l].default);$.result==="success"&&(P=$.value.expression),P?(this.options.set(T,Li($t({},M),{value:D,default:P,minValue:k,maxValue:N,stepValue:L,type:H,values:G})),this.updateConfigDependencies()):this.fire(new r.a(new Error(`No schema defined for the config option "${l}" in the "${i}" fragment.`)))}getConfig(i){let l=this.getFragmentStyle(i);if(!l)return null;let p=l.stylesheet.schema;if(!p)return null;let _={};for(let v in p){let b=r.aj(v,l.scope),D=l.options.get(b),T=D?D.value||D.default:null;_[v]=T?T.serialize():null}return _}setConfig(i,l){let p=this.getFragmentStyle(i);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){let l=this.getFragmentStyle(i);return l?l.stylesheet.schema:null}setSchema(i,l){let p=this.getFragmentStyle(i);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(i,l){if(this._config=i,i||l)if(l)for(let p in l){let _,v,b=r.t(l[p].default);if(b.result==="success"&&(_=b.value.expression),i&&i[p]!==void 0){let N=r.t(i[p]);N.result==="success"&&(v=N.value.expression)}let{minValue:D,maxValue:T,stepValue:M,type:P,values:k}=l[p];if(_){let N=r.aj(p,this.scope);this.options.set(N,{default:_,value:v,minValue:D,maxValue:T,stepValue:M,type:P,values:k})}else this.fire(new r.a(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let i of this._configDependentLayers){let l=this.getLayer(i);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(i,l,p={}){this._checkLoaded();let _=i.id;if(this._layers[_])return void this.fire(new r.a(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(i.type==="custom"){if(ps(this,r.cb(i)))return;v=r.c7(i,this.scope,this.options)}else{if(typeof i.source=="object"&&(this.addSource(_,i.source),i=r.c6(i),i=r.e(i,{source:_})),this._validate(xe,`layers.${_}`,i,{arrayIndex:-1},p))return;v=r.c7(i,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(l){let P=this._order.indexOf(l);if(P===-1)return void this.fire(new r.a(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?b=P:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=v;let D=this.getOwnLayerSourceCache(v),T=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&v.canCastShadows()&&T&&(D.castsShadows=!0);let M=this._changes.getRemovedLayer(v);if(M&&v.source&&D&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let P=r.aj(v.source,v.scope);M.type!==v.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),D.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(i,l){this._checkLoaded();let p=this._checkLayer(i);if(!p||i===l)return;let _=this._order.indexOf(i);this._order.splice(_,1);let v=this._order.length;if(l){let b=this._order.indexOf(l);if(b===-1)return void this.fire(new r.a(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?v=b:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();let l=this._checkLayer(i);if(!l)return;l.setEventedParent(null);let p=this._order.indexOf(i);this._order.splice(p,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);let _=this.getOwnLayerSourceCache(l);if(_&&_.castsShadows){let v=!1;for(let b in this._layers)if(this._layers[b].source===l.source&&this._layers[b].canCastShadows()){v=!0;break}_.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(let l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,p){this._checkLoaded();let _=this._checkLayer(i);_&&(_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}setSlot(i,l){this._checkLoaded();let p=this._checkLayer(i);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(i,l,p={}){this._checkLoaded();let _=this._checkLayer(i);if(_&&!E(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(He,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=r.c6(l),this._updateLayer(_)))}getFilter(i){let l=this._checkLayer(i);if(l)return r.c6(l.filter)}setLayoutProperty(i,l,p,_={}){this._checkLoaded();let v=this._checkLayer(i);if(v&&!E(v.getLayoutProperty(l),p)){if(p!=null&&(!_||_.validate!==!1)&&ps(v,at.call(Wt,{key:`layers.${i}.layout.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.G,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,p),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(i,l){let p=this._checkLayer(i);if(p)return p.getLayoutProperty(l)}setPaintProperty(i,l,p,_={}){this._checkLoaded();let v=this._checkLayer(i);if(!v||E(v.getPaintProperty(l),p)||p!=null&&(!_||_.validate!==!1)&&ps(v,Qe.call(Wt,{key:`layers.${i}.paint.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.G})))return;let b=v.setPaintProperty(l,p);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(i,l){let p=this._checkLayer(i);if(p)return p.getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();let p=i.source,_=i.sourceLayer,v=this._checkSource(p);if(!v)return;let b=v.type;if(b==="geojson"&&_)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));let D=this.getOwnSourceCaches(p);for(let T of D)T.setFeatureState(_,i.id,l)}removeFeatureState(i,l){this._checkLoaded();let p=i.source,_=this._checkSource(p);if(!_)return;let v=_.type,b=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!b)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));let D=this.getOwnSourceCaches(p);for(let T of D)T.removeFeatureState(b,i.id,l)}getFeatureState(i){this._checkLoaded();let l=i.source,p=i.sourceLayer,_=this._checkSource(l);if(_){if(_.type!=="vector"||p)return i.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,i.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.e({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let i=this.getTerrain(),l=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(i){this._changes.updateLayer(i);let l=this.getLayerSourceCache(i),p=r.aj(i.source,i.scope),_=this._changes.getUpdatedSourceCaches();i.source&&!_[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){let l=D=>this._mergedLayers[D].type==="fill-extrusion"||this._mergedLayers[D].type==="model",p=this.order,_={},v=[];for(let D=p.length-1;D>=0;D--){let T=p[D];if(l(T)){_[T]=D;for(let M of i){let P=M[T];if(P)for(let k of P)v.push(k)}}}v.sort((D,T)=>T.intersectionZ-D.intersectionZ);let b=[];for(let D=p.length-1;D>=0;D--){let T=p[D];if(l(T))for(let M=v.length-1;M>=0;M--){let P=v[M].feature;if(_[P.layer.id]<D)break;b.push(P),v.pop()}else for(let M of i){let P=M[T];if(P)for(let k of P)b.push(k.feature)}}return b}queryRenderedFeatures(i,l,p){l&&l.filter&&this._validate(He,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;let _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(let M of l.layers){let P=this._mergedLayers[M];if(!P)return this.fire(new r.a(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[P.source]=!0}}let v=[],b=l.serializedLayers||{},D=l&&l.layers?l.layers.some(M=>{let P=this.getLayer(M);return P&&P.is3D()}):this.has3DLayers(),T=Pi.createFromScreenPoints(i,p);for(let M in this._mergedSourceCaches){let P=this._mergedSourceCaches[M].getSource();if(!P||P.scope!==l.scope)continue;let k=this._mergedSourceCaches[M].getSource().id;l.layers&&!_[k]||v.push(kn(this._mergedSourceCaches[M],this._mergedLayers,b,T,l,p,D,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(M,P,k,N,L,H,G){let $={},q=H.queryRenderedSymbols(N),Y=[];for(let re of Object.keys(q).map(Number))Y.push(G[re]);Y.sort(g0);for(let re of Y){let ie=re.featureIndex.lookupSymbolFeatures(q[re.bucketInstanceId],P,re.bucketIndex,re.sourceLayerIndex,L.filter,L.layers,L.availableImages,M);for(let ae in ie){let W=$[ae]=$[ae]||[],K=ie[ae];K.sort((fe,he)=>{let ve=re.featureSortOrder;if(ve){let Ie=ve.indexOf(fe.featureIndex);return ve.indexOf(he.featureIndex)-Ie}return he.featureIndex-fe.featureIndex});for(let fe of K)W.push(fe)}}for(let re in $)$[re].forEach(ie=>{let ae=ie.feature,W=k(M[re]);if(!W)return;let K=W.getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=K});return $}(this._mergedLayers,b,this.getLayerSourceCache.bind(this),T.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,l){l&&l.filter&&this._validate(He,"querySourceFeatures.filter",l.filter,null,l);let p=this.getOwnSourceCaches(i),_=[];for(let v of p)_=_.concat(Zr(v,l));return _}addSourceType(i,l,p){return Jo.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(Jo.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,l,p={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let D in i)if(!E(i[D],_[D])){v=!0;break}if(!v)return;let b=this._getTransitionParameters();this.light.setLight(i,l,p),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&l!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=i,_=i.source==null;if(l===1){if(typeof p.source=="object"){let D="terrain-dem-src";this.addSource(D,p.source),p=r.c6(p),p=r.e(p,{source:D})}let v=r.e({},p),b={};if(this.terrain&&_){v.source=this.terrain.get().source;let D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(b.style=D.serialize())}if(this._validate(ee,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new r.b("data",{dataType:"style"}))}else{let v=this.terrain,b=v.get();for(let D of Object.keys(r.G.terrain))!p.hasOwnProperty(D)&&r.G.terrain[D].default&&(p[D]=r.G.terrain[D].default);for(let D in i)if(!E(i[D],b[D])){v.set(i,this.options),this.stylesheet.terrain=i;let T=this._getTransitionParameters({duration:0});v.updateTransitions(T),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){let l=this.fog=new Mr(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog;if(!E(l.get(),i)){l.set(i,this.options),this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(i);this._markersNeedUpdate=!0}_getTransitionParameters(i){return{now:r.f.now(),transition:r.e(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;let i=[],l=[];for(let p in this._mergedLayers)this.isLayerDraped(this._mergedLayers[p])?i.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){let p=this.terrain=new ri(i,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(let i in this._layers){let l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let i in this._layers){let l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,p,_,v={}){if(v&&v.validate===!1)return!1;let b=r.e({},this.serialize());return ps(this,i.call(Wt,r.e({key:l,style:b,value:p,styleSpec:r.G},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(let i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){let l=this.getSourceCaches(i);for(let p of l)p.clearTiles()}clearSources(){for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){let l=this.getSourceCaches(i);for(let p of l)p.resume(),p.reload()}reloadSources(){for(let i of this.getSources())i.reload&&i.reload()}updateSources(i){let l;this.directionalLight&&(l=bh(this.directionalLight));for(let p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(i,void 0,void 0,l)}_generateCollisionBoxes(){for(let i in this._sourceCaches){let l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,p,_,v=!1){let b=!1,D=!1,T={},M={};for(let P of this._mergedOrder){let k=this._mergedLayers[P];if(k.type!=="symbol")continue;let N=r.aj(k.source,k.scope),L=T[N];if(!L){let G=this.getLayerSourceCache(k);if(!G)continue;let $=G.getRenderableIds(!0).map(q=>G.getTileByID(q));M[N]=$.slice(),L=T[N]=$.sort((q,Y)=>Y.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(Y.tileID)?-1:1))}let H=this.crossTileSymbolIndex.addLayer(k,L,i.center.lng,i.projection);b=b||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),i.zoom))&&(this.pauseablePlacement=new Pc(i,this._mergedOrder,v,l,p,_,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,T,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),D=!0),b&&this.pauseablePlacement.placement.setStale()),D||b){this._buildingIndex.onNewFrame(i.zoom);for(let P of this._mergedOrder){let k=this._mergedLayers[P];k.type==="symbol"&&this.placement.updateLayerOpacities(k,T[r.aj(k.source,k.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(let i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,l){this._checkLoaded();let p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:v})=>v===i.id)!==-1)return void this.fire(new r.a(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!l)return p.push(i),this._loadImports([i],!0);let _=p.findIndex(({id:v})=>v===l);return _===-1&&this.fire(new r.a(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(i).concat(p.slice(_)),this._loadImports([i],!0,l)}updateImport(i,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(i);return _===-1?this:typeof l=="string"?(this.setImportUrl(i,l),this):(l.url&&l.url!==p[_].url&&this.setImportUrl(i,l.url),E(l.config,p[_].config)||this.setImportConfig(i,l.config),E(l.data,p[_].data)||this.setImportData(i,l.data),this)}moveImport(i,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(i);if(_===-1)return this;let v=this.getImportIndex(l);if(v===-1)return this;let b=p[_],D=this.fragments[_];return p=p.filter(({id:T})=>T!==i),this.fragments=this.fragments.filter(({id:T})=>T!==i),this.stylesheet.imports=p.slice(0,v).concat(b).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(D).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(i,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(i);if(_===-1)return this;p[_].url=l;let v=this.fragments[_];return v.style=this._createFragmentStyle(p[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(i,l){this._checkLoaded();let p=this.getImportIndex(i),_=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(i,_[p].url))}setImportConfig(i,l){this._checkLoaded();let p=this.getImportIndex(i),_=this.stylesheet.imports||[];if(p===-1)return this;l?_[p].config=l:delete _[p].config;let v=this.fragments[p],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=l,v.style.updateConfig(l,b),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();let l=this.stylesheet.imports||[],p=this.getImportIndex(i);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(i){let l=(this.stylesheet.imports||[]).findIndex(p=>p.id===i);return l===-1&&this.fire(new r.a(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),l}getLayer(i){return this._mergedLayers[i]}getSources(){let i=[];for(let l in this._mergedOtherSourceCaches){let p=this._mergedOtherSourceCaches[l];p&&i.push(p.getSource())}return i}getSource(i,l){let p=this.getSourceCache(i,l);return p&&p.getSource()}getLayerSource(i){let l=this.getLayerSourceCache(i);return l&&l.getSource()}getSourceCache(i,l){let p=r.aj(i,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(i){let l=r.aj(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);let l=[];return this._mergedOtherSourceCaches[i]&&l.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&l.push(this._mergedSymbolSourceCaches[i]),l}updateSourceCaches(){let i=this._changes.getUpdatedSourceCaches();for(let l in i){let p=i[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(i){let l=this._changes.getUpdatedPaintProperties();for(let p of l){let _=this.getLayer(p);_&&_.updateTransitions(i)}}getImages(i,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();let _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(i,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(i,l,p){return r.ce(l,p)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){let l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){let l=this.getOwnSourceCaches(i);return l.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${i}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Jo.getSourceType=function(d){return ft[d]},Jo.setSourceType=function(d,i){ft[d]=i},Jo.registerForPluginStateChange=r.bY;var Bc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,qf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Dh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,na="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ch=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Oa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Eh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Lc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ah=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Jn=[];ia(Bc,Jn),ia(Dh,Jn),ia(qf,Jn);let gn={"_prelude_fog.vertex.glsl":Oa,"_prelude_terrain.vertex.glsl":Ch,"_prelude_shadow.vertex.glsl":Lc,"_prelude_fog.fragment.glsl":Wf,"_prelude_shadow.fragment.glsl":Ah,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Nc,"_prelude_raster_particle.glsl":Eh},Uc={};yn("",Ch),yn(Wf,Oa),yn(Ah,Lc),yn(Nc,""),yn(Eh,"");let zc=yn(qf,Dh),Th=Bc;var es={background:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:yn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:yn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:yn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:yn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:yn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:yn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:yn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:yn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:yn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:yn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:yn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:yn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:yn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:yn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,na),skyboxGradient:yn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,na),skyboxCapture:yn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:yn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:yn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:yn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ia(d,i){let l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let _=p.split(" ");for(let v of _)i.includes(v)||i.push(v)}}function yn(d,i){let l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(M=>{let P=M.split(" ");return P[P.length-1]}),_=[...new Set(_)]);let v={},b=[],D=[];if(d=d.replace(l,(M,P)=>(D.push(P),"")),(i=i.replace(l,(M,P)=>(b.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let T=[...Jn];ia(d,T),ia(i,T);for(let M of[...b,...D])gn[M]||console.error(`Undefined include: ${M}`),Uc[M]||(Uc[M]=[],ia(gn[M],Uc[M])),T=[...T,...Uc[M]];return{fragmentSource:d=d.replace(p,(M,P,k,N,L)=>(v[L]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${k} ${N} ${L};
#else
uniform ${k} ${N} u_${L};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${L}
    ${k} ${N} ${L} = u_${L};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${k} ${N} ${L};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(p,(M,P,k,N,L)=>{let H=N==="float"?"vec2":N,G=L.match(/color/)?"color":H;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${L}
in ${k} ${N} a_${L};
#endif
`:v[L]?P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${k} ${H} a_${L};
out ${k} ${N} ${L};
#else
uniform ${k} ${N} u_${L};
#endif
`:P==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${k} ${N} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${k} ${N} ${L} = u_${L};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${k} ${N} a_${L};
    out ${k} ${N} ${L};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${L} = a_${L};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${k} ${H} a_${L};
#else
uniform ${k} ${N} u_${L};
#endif
`:P==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${L}0;
in vec4 a_${L}1;
in vec4 a_${L}2;
in vec4 a_${L}3;
#else
uniform ${k} ${N} u_${L};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${H} a_${L};
#else
uniform ${k} ${N} u_${L};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${k} ${N} ${L} = a_${L};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${k} ${N} ${L} = a_${L};
#else
    ${k} ${N} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${k} ${N} ${L} = unpack_mix_${G}(a_${L}, u_${L}_t);
#else
    ${k} ${N} ${L} = u_${L};
#endif
`}),staticAttributes:_,usedDefines:T,vertexIncludes:b,fragmentIncludes:D}}class At{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,p,_,v,b,D,T){this.context=i;let M=this.boundPaintVertexBuffers.length!==_.length;for(let k=0;!M&&k<_.length;k++)this.boundPaintVertexBuffers[k]!==_[k]&&(M=!0);let P=this.boundDynamicVertexBuffers.length!==D.length;for(let k=0;!P&&k<D.length;k++)this.boundDynamicVertexBuffers[k]!==D[k]&&(P=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||M||P||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(l,p,_,v,b,D,T);else{i.bindVertexArrayOES.set(this.vao);for(let k of D)k&&(k.bind(),T&&k.instanceCount&&k.setVertexAttribDivisor(i.gl,l,T));v&&v.dynamicDraw&&v.bind()}}freshBind(i,l,p,_,v,b,D){let T=i.numAttributes,M=this.context,P=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,l.enableAttributes(P,i),l.bind(),l.setVertexAttribPointers(P,i,v);for(let k of p)k.enableAttributes(P,i),k.bind(),k.setVertexAttribPointers(P,i,v);for(let k of b)k&&(k.enableAttributes(P,i),k.bind(),k.setVertexAttribPointers(P,i,v),D&&k.instanceCount&&k.setVertexAttribDivisor(P,i,D));_&&_.bind(),M.currentNumAttributes=T}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Wn(d,i){let l=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new r.O(0,p/l).toLngLat().lat,new r.O(0,(p+1)/l).toLngLat().lat]}function Zn(d,i,l,p,_,v,b){let D=d.context,T=D.gl,M=l.hillshadeFBO;if(!M)return;d.prepareDrawTile();let P=d.isTileAffectedByFog(i),k=d.getOrCreateProgram("hillshade",{overrideFog:P});D.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get());let N=(($,q,Y,re)=>{let ie=Y.paint.get("hillshade-shadow-color"),ae=Y.paint.get("hillshade-highlight-color"),W=Y.paint.get("hillshade-accent-color"),K=Y.paint.get("hillshade-emissive-strength"),fe=r.bm(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")fe-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){let ve=$.style.directionalLight.properties.get("direction"),Ie=r.bT(ve.x,ve.y,ve.z);fe=r.bm(Ie[1])}let he=!$.options.moving;return{u_matrix:re||$.transform.calculateProjMatrix(q.tileID.toUnwrapped(),he),u_image:0,u_latrange:Wn(0,q.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),fe],u_shadow:ie,u_highlight:ae,u_emissive_strength:K,u_accent:W}})(d,l,p,d.terrain?i.projMatrix:null);d.uploadCommonUniforms(D,k,i.toUnwrapped());let{tileBoundsBuffer:L,tileBoundsIndexBuffer:H,tileBoundsSegments:G}=d.getTileBoundsBuffers(l);k.draw(d,T.TRIANGLES,_,v,b,Kt.disabled,N,p.id,L,H,G)}function bo(d,i,l){if(!i.needsDEMTextureUpload)return;let p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(l.stride);let v=l.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new r.T(p,v,_.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function vl(d,i,l){let p=d.context,_=p.gl;if(!i.dem)return;let v=i.dem;if(p.activeTexture.set(_.TEXTURE1),bo(d,i,v),!i.demTexture)return;i.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let b=v.dim;p.activeTexture.set(_.TEXTURE0);let D=i.hillshadeFBO;if(!D){let N=new r.T(p,{width:b,height:b,data:null},_.RGBA);N.bind(_.LINEAR,_.CLAMP_TO_EDGE),D=i.hillshadeFBO=p.createFramebuffer(b,b,!0,"renderbuffer"),D.colorAttachment.set(N.texture)}p.bindFramebuffer.set(D.framebuffer),p.viewport.set([0,0,b,b]);let{tileBoundsBuffer:T,tileBoundsIndexBuffer:M,tileBoundsSegments:P}=d.getMercatorTileBoundsBuffers(),k=[];d.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(d,_.TRIANGLES,Gt.disabled,on.disabled,_n.unblended,Kt.disabled,((N,L)=>{let H=L.stride,G=r.a9.create();return r.a9.ortho(G,0,r.Y,-r.Y,0,0,1),r.a9.translate(G,G,[0,-r.Y,0]),{u_matrix:G,u_image:1,u_dimension:[H,H],u_zoom:N.overscaledZ}})(i.tileID,v),l.id,T,M,P),i.needsHillshadePrepare=!1}let Bn=d=>({u_matrix:new r.bN(d),u_image0:new r.bR(d),u_skirt_height:new r.bQ(d),u_ground_shadow_factor:new r.bP(d)}),Vc=(d,i,l)=>({u_matrix:d,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:l}),xl=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:D,u_frustum_br:T,u_frustum_bl:M,u_globe_pos:P,u_globe_radius:k,u_viewport:N,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:L,u_far_z_cutoff:H});function bl(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}let xr=new class{constructor(){this.operations={}}newMorphing(d,i,l,p,_){if(d in this.operations){let v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:i,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(let i in this.operations){let l=this.operations[i];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Wi={0:null,1:"TERRAIN_VERTEX_MORPHING"};function I0(d,i,l){if(i===0)return 0;let p=i<1&&l===514?.25/i:1;return 6*Math.pow(1.5,22-d)*Math.max(i,1)*p}function jc(d,i){let l=1<<d.z;return!i&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}let Gc=d=>({u_matrix:d});function Ra(d,i,l,p,_){if(_>0){let v=r.f.now(),b=(v-d.timeAdded)/_,D=i?(v-i.timeAdded)/_:-1,T=l.getSource(),M=p.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),P=!i||Math.abs(i.tileID.overscaledZ-M)>Math.abs(d.tileID.overscaledZ-M),k=P&&d.refreshedUponExpiration?1:r.ad(P?b:1-D,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Zf extends Yo{constructor(i){let l={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new r.bZ(r.b_(),null),_=Sf("mock-dem",l,p,i.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class Sh extends Yo{constructor(i){let l=Sf("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.bZ(r.b_(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,p){if(i.freezeTileCoverage)return;this.transform=i;let _=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){let D=new Qo(b,this._source.tileSize*b.overscaleFactor(),i.tileZoom);D.state="loaded",this._tiles[b.key]=D}return v},{});for(let v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){let l=this.proxyCachedFBO[i];if(l!==void 0){let p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fr extends r.ap{constructor(i,l,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class wo extends r.cp{constructor(i,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,_,v]=function(T){let M=new r.aQ,P=new r.az,k=131;M.reserve(17161),P.reserve(33800);let N=r.Y/128,L=r.Y+N/2,H=L+N;for(let $=-N;$<H;$+=N)for(let q=-N;q<H;q+=N){let Y=q<0||q>L||$<0||$>L?24575:0,re=r.ad(Math.round(q),0,r.Y),ie=r.ad(Math.round($),0,r.Y);M.emplaceBack(re+Y,ie)}let G=($,q)=>{let Y=q*k+$;P.emplaceBack(Y+1,Y,Y+k),P.emplaceBack(Y+k,Y+k+1,Y+1)};for(let $=1;$<129;$++)for(let q=1;q<129;q++)G(q,$);return[0,129].forEach($=>{for(let q=0;q<130;q++)G(q,$),G($,q)}),[M,P,32768]}(),b=i.context;this.gridBuffer=b.createVertexBuffer(p,r.aS.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=r.aE.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=r.aE.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Sh(l.map),this.orthoMatrix=r.a9.create(),r.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.Y,0,r.Y,0,1);let D=b.gl;this._overlapStencilMode=new on({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zf(l.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,p){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);let _=i.terrain.properties,v=i.terrain.drapeRenderMode===0,b=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();let D=i.terrain&&i.terrain.scope,T=_.get("source"),M=v?this._mockSourceCache:i.getSourceCache(T,D);if(!M)return void r.w(`Couldn't find terrain source "${T}".`);if(this.sourceCache=M,this._exaggeration=b?this.calculateExaggeration(l):_.get("exaggeration"),!l.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let k=this.getScaledDemTileSize();this.sourceCache.update(l,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(i){let l=this._previousCameraAltitude,p=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=p;let _=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let v=i.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let D=v-this._previousZoom,T=this._previousUpdateTimestamp,M=v;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(v-M)>.5&&(D=.5*(v-M+D)),D*_<0&&(M+=D)),this._evaluationZoom=M;let P=b.getExaggeration(M),k=P===b.getExaggeration(Math.max(0,M-.1));if(k&&Math.abs(P-this._exaggeration)<.01)return P;let N=Math.min(.1,.00375*(this._updateTimestamp-T));return(k||P<.1||Math.abs(D)<1e-4)&&(N=Math.min(.2,4*N)),r.X(this._exaggeration,P,N)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.O.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=l.getIds().map(T=>{let M=l.getTileByID(T).tileID;return M.projMatrix=p.calculateProjMatrix(M.toUnwrapped()),M});(function(T,M){let P=M.transform.pointCoordinate(M.transform.getCameraPoint()),k=new r.P(P.x,P.y);T.sort((N,L)=>{if(L.overscaledZ-N.overscaledZ)return L.overscaledZ-N.overscaledZ;let H=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),G=new r.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),$=k.mult(1<<N.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(H)-$.distSqr(G)})})(_,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},_.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let T in b){let M=b[T];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,i[T],v),M.usedForTerrain))continue;let P=i[T];M.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[l.id]=_.map(T=>new Fr(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let D={};this._visibleDemTiles=[];for(let T of this.proxyCoords){let M=this.terrainTileForTile[T.key];if(!M)continue;let P=M.tileID.key;P in D||(this._visibleDemTiles.push(M),D[P]=P)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;let p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){let i=this.painter.context,l=i.gl;for(let p in this.terrainTileForTile){let _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),bo(this.painter,_,v))}}_prepareDemTileUniforms(i,l,p,_){if(!l||l.demTexture==null)return!1;let v=i.tileID.canonical,b=Math.pow(2,l.tileID.canonical.z-v.z),D=_||"";return p[`u_dem_tl${D}`]=[v.x*b%1,v.y*b%1],p[`u_dem_scale${D}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){let p=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(i,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0,l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;let v=_.dem.tree.minimums[0];return v>0&&i++,p+v},0);return i?l/i:0}_updateEmptyDEMTexture(){let i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);let p=this._getLoadedAreaMinimum(),[_,v]=(()=>{let D=new r.cr({width:1,height:1},new Float32Array([p]));return[l.R32F,D]})();this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(i,v,_,{premultiply:!1}),b}setupElevationDraw(i,l,p){let _=this.painter.context,v=_.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};b.u_exaggeration=this.exaggeration();let D=null,T=null,M=1;if(p&&p.morphing&&this._useVertexMorphing){let N=p.morphing.srcDemTile,L=p.morphing.dstDemTile;M=p.morphing.phase,N&&L&&(this._prepareDemTileUniforms(i,N,b,"_prev")&&(T=N),this._prepareDemTileUniforms(i,L,b)&&(D=L))}let P=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,k=N=>{b.u_dem_size=N.size[0]===1?1:N.size[0]-2};if(T&&D)_.activeTexture.set(v.TEXTURE2),D.demTexture.bind(P(D),v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE4),T.demTexture.bind(P(T),v.CLAMP_TO_EDGE),D.demTexture&&k(D.demTexture),b.u_dem_lerp=M;else{D=this.terrainTileForTile[i.tileID.key],_.activeTexture.set(v.TEXTURE2);let N=this._prepareDemTileUniforms(i,D,b)?D.demTexture:this.emptyDEMTexture;N.bind(P(D),v.CLAMP_TO_EDGE),k(N)}if(_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&D){let N=(1<<D.tileID.canonical.z)*r.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=N}if(p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,b),this.painter.transform.projection.name==="globe"){let N=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,N)}}globeUniformValues(i,l,p){let _=i.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,r.Y,0),u_tile_br_up:_.upVector(l,r.Y,r.Y),u_tile_bl_up:_.upVector(l,0,r.Y),u_tile_up_scale:p?r.cq(1):_.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){let l=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,b,D,T){if(_.transform.projection.name==="globe")(function(M,P,k,N,L){let H=M.context,G=H.gl,$,q,Y=M.transform,re=r.ci(M,H,Y),ie=(Ae,Fe)=>{if(q===Fe)return;let _e=[Wi[Fe],"PROJECTION_GLOBE_VIEW"];re&&_e.push("CUSTOM_ANTIALIASING");let De=M.isTileAffectedByFog(Ae);$=M.getOrCreateProgram("globeRaster",{defines:_e,overrideFog:De}),q=Fe},ae=M.colorModeForRenderPass(),W=new Gt(G.LEQUAL,Gt.ReadWrite,M.depthRangeFor3D);xr.update(L);let K=r.cj(Y),fe=[r.a8(Y.center.lng),r.ah(Y.center.lat)],he=M.globeSharedBuffers,ve=[Y.width*r.f.devicePixelRatio,Y.height*r.f.devicePixelRatio],Ie=Float32Array.from(Y.globeMatrix),ye={useDenormalizedUpVectorScale:!0};{let Ae=M.transform,Fe=I0(Ae.zoom,P.exaggeration(),P.sourceCache._source.tileSize);q=-1;let _e=G.TRIANGLES;for(let De of N){let Xe=k.getTile(De),be=on.disabled,Se=P.prevTerrainTileForTile[De.key],Me=P.terrainTileForTile[De.key];bl(Se,Me)&&xr.newMorphing(De.key,Se,Me,L,250),H.activeTexture.set(G.TEXTURE0),Xe.texture&&Xe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let oe=xr.getMorphValuesForProxy(De.key),Ve=oe?1:0;oe&&r.k(ye,{morphing:{srcDemTile:oe.from,dstDemTile:oe.to,phase:r.ch(oe.phase)}});let yt=r.ck(De.canonical),Mt=r.cl(yt.getCenter().lat),zt=r.cm(De.canonical,yt,Mt,Ae.worldSize/Ae._pixelsPerMercatorPixel),Rt=r.aW(r.cn(De.canonical)),jt=xl(Ae.expandedFarZProjMatrix,Ie,K,Rt,r.W(Ae.zoom),fe,Ae.frustumCorners.TL,Ae.frustumCorners.TR,Ae.frustumCorners.BR,Ae.frustumCorners.BL,Ae.globeCenterInViewSpace,Ae.globeRadius,ve,Fe,Ae._farZ,zt);if(ie(De,Ve),$&&(P.setupElevationDraw(Xe,$,ye),M.uploadCommonUniforms(H,$,De.toUnwrapped()),he)){let[En,nn,Pn]=he.getGridBuffers(Mt,Fe!==0);$.draw(M,_e,W,be,ae,Kt.backCCW,jt,"globe_raster",En,nn,Pn)}}}if(he&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){let Ae=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Ae.push("CUSTOM_ANTIALIASING"),$=M.getOrCreateProgram("globeRaster",{defines:Ae});for(let Fe of N){let{x:_e,y:De,z:Xe}=Fe.canonical,be=De===0,Se=De===(1<<Xe)-1,[Me,oe,Ve,yt]=he.getPoleBuffers(Xe,!1);if(yt&&(be||Se)){let Mt=k.getTile(Fe);H.activeTexture.set(G.TEXTURE0),Mt.texture&&Mt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let zt=r.co(Xe,_e,Y),Rt=r.aW(r.cn(Fe.canonical)),jt=(En,nn)=>En.draw(M,G.TRIANGLES,W,on.disabled,ae,Kt.disabled,xl(Y.expandedFarZProjMatrix,zt,zt,Rt,0,fe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,ve,0,Y._farZ),"globe_pole_raster",nn,Ve,yt);P.setupElevationDraw(Mt,$,ye),M.uploadCommonUniforms(H,$,Fe.toUnwrapped()),be&&M.renderDefaultNorthPole&&jt($,Me),Se&&M.renderDefaultSouthPole&&(zt=r.a9.scale(r.a9.create(),zt,[1,-1,1]),jt($,oe))}}}})(_,v,b,D,T);else{let M=_.context,P=M.gl,k,N,L=_.shadowRenderer,H=ta(_,_.longestCutoffRange),G=ae=>{if(N===ae)return;let W=[];W.push(Wi[ae]),H.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),k=_.getOrCreateProgram("terrainRaster",{defines:W}),N=ae},$=_.colorModeForRenderPass(),q=new Gt(P.LEQUAL,Gt.ReadWrite,_.depthRangeFor3D);xr.update(T);let Y=_.transform,re=I0(Y.zoom,v.exaggeration(),v.sourceCache._source.tileSize),ie=[0,0,0];if(L){let ae=_.style.directionalLight,W=_.style.ambientLight;ae&&W&&(ie=Gf(ae,W))}{N=-1;let ae=P.TRIANGLES,[W,K]=[v.gridIndexBuffer,v.gridSegments];for(let fe of D){let he=b.getTile(fe),ve=on.disabled,Ie=v.prevTerrainTileForTile[fe.key],ye=v.terrainTileForTile[fe.key];bl(Ie,ye)&&xr.newMorphing(fe.key,Ie,ye,T,250),M.activeTexture.set(P.TEXTURE0),he.texture&&he.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let Ae=xr.getMorphValuesForProxy(fe.key),Fe=Ae?1:0,_e;Ae&&(_e={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:r.ch(Ae.phase)}});let De=Vc(fe.projMatrix,jc(fe.canonical,Y.renderWorldCopies)?re/10:re,ie);if(G(Fe),!k)continue;v.setupElevationDraw(he,k,_e);let Xe=fe.toUnwrapped();L&&L.setupShadows(Xe,k),_.uploadCommonUniforms(M,k,Xe,null,H),k.draw(_,ae,q,ve,$,Kt.backCCW,De,"terrain_raster",v.gridBuffer,W,K)}}}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;let l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),D=l.style.order,T=[],M=0;for(let P of v){let k=_.getTileByID(P.proxyTileKey),N=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][i]:void 0,L=N!==void 0?_.renderCache[N]:this.pool[M++],H=N!==void 0;if(k.texture=L.tex,H&&!L.dirty){T.push(k.tileID);continue}let G;p.bindFramebuffer.set(L.fb.framebuffer),this.renderedToTile=!1,L.dirty&&(p.clear({color:r.aA.transparent,stencil:0}),L.dirty=!1);for(let $=b.start;$<=b.end;++$){let q=l.style._mergedLayers[D[$]];if(q.isHidden(l.transform.zoom))continue;let Y=l.style.getLayerSourceCache(q),re=Y?this.proxyToSource[P.key][Y.id]:[P];if(!re)continue;let ie=re;p.viewport.set([0,0,L.fb.width,L.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(L,re,q,Y),G=Y?Y.id:null),l.renderLayer(l,Y,q,ie)}if(this._drapedRenderBatches.length===0)for(let $ of this._pendingGroundEffectLayers){let q=l.style._mergedLayers[D[$]];if(q.isHidden(l.transform.zoom))continue;let Y=l.style.getLayerSourceCache(q),re=Y?this.proxyToSource[P.key][Y.id]:[P];if(!re)continue;let ie=re;p.viewport.set([0,0,L.fb.width,L.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(L,re,q,Y),G=Y?Y.id:null),l.renderLayer(l,Y,q,ie)}this.renderedToTile?(L.dirty=!0,T.push(k.tileID)):H||--M,M===5&&(M=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),b.end+1}postRender(){}isLayerOrderingCorrect(i){let l=i.order.length,p=-1,_=l;for(let v=0;v<l;++v)this._style.isLayerDraped(i._mergedLayers[i.order[v]])?p=Math.max(p,v):_=Math.min(_,v);return _>p}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,p){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let b=v.tileID,D=1<<b.overscaledZ,{x:T,y:M}=b.canonical,P=T/D,k=(T+1)/D,N=M/D,L=(M+1)/D;return{minx:P,miny:N,maxx:k,maxy:L,t:v.dem.tree.raycastRoot(P,N,k,L,i,l,p),tile:v}});_.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let v of _){if(v.t==null)return null;let b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,l,p);if(b!=null)return b}return null}_createFBO(){let i=this.painter.context,l=i.gl,p=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);let _=new r.T(i,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);let v=i.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new vv(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{let l=this._style._mergedLayers[i],p=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(let p of this._style.getSources())if(p instanceof ut){i=!0;break}if(!i)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(_);if(v&&!l[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.Z){l[v.id]=!0;for(let b of this.proxyCoords){let D=this.proxyToSource[b.key][v.id];if(D)for(let T of D)this._clearRenderCacheForTile(v.id,T)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(let p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof dt){i=!0;break}if(!i)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(_);if(!v||l[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let b=_.paint.get("raster-fade-duration");for(let D of this.proxyCoords){let T=this.proxyToSource[D.key][v.id];if(T)for(let M of T){let P=Ra(v.getTile(M),v.findLoadedParent(M,0),v,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,M)}}}}_setupDrapedRenderBatches(){let i=this._style.order,l=i.length;if(l===0)return;let p=[];this._pendingGroundEffectLayers=[];let _,v=0,b=this._style._mergedLayers[i[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<l;)b=this._style._mergedLayers[i[v]];for(;v<l;++v){let D=this._style._mergedLayers[i[v]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?_===void 0&&(_=v):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(p.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:v-1}),p.length!==0){let D=p[p.length-1];this._pendingGroundEffectLayers.every(T=>T>D.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(i){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let b=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let D=0;D<b.length;++D){let T=Object.values(b[D]);l.renderCachePool.push(...T)}}return}this._clearRasterLayersFromRenderCache();let p=this.proxyCoords,_=this._tilesDirty;for(let b=p.length-1;b>=0;b--){let D=p[b];if(l.getTileByID(D.key),l.proxyCachedFBO[D.key]!==void 0){let T=i[D.key],M=this.proxyToSource[D.key],P=0;for(let k in M){let N=M[k],L=T[k];if(!L||L.length!==N.length||N.some((H,G)=>H!==L[G]||_[k]&&_[k].hasOwnProperty(H.key))){P=-1;break}++P}for(let k in l.proxyCachedFBO[D.key])l.renderCache[l.proxyCachedFBO[D.key][k]].dirty=P<0||P!==Object.values(T).length}}let v=[...this._drapedRenderBatches];v.sort((b,D)=>D.end-D.start-(b.end-b.start));for(let b of v)for(let D of p){if(l.proxyCachedFBO[D.key])continue;let T=l.renderCachePool.pop();T===void 0&&l.renderCache.length<50&&(T=l.renderCache.length,l.renderCache.push(this._createFBO())),T!==void 0&&(l.proxyCachedFBO[D.key]={},l.proxyCachedFBO[D.key][b.start]=T,l.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,b=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let D;if(p.isTileClipped())D=l.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):on.disabled}_renderTileClippingMasks(i,l){let p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(_n.disabled),_.setDepthMode(Gt.disabled);let b=p.getOrCreateProgram("clippingMask");for(let D of i){let T=p._tileClippingMaskIDs[D.key]=--l;b.draw(p,v.TRIANGLES,Gt.disabled,new on({func:v.ALWAYS,mask:0},T,255,v.KEEP,v.KEEP,v.REPLACE),_n.disabled,Kt.disabled,Gc(D.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){let l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;let p=[i.x,i.y,1,1];r.aa.transformMat4(p,p,l.pixelMatrixInverse),r.aa.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;let _=l._camera.position,v=r.bo(1,l.center.lat),b=[_[0],_[1],_[2]/v,0],D=r.Q.subtract([],p.slice(0,3),b);r.Q.normalize(D,D);let T=this.raycast(b,D,this._exaggeration);return T!==null&&T?(r.Q.scaleAndAdd(b,b,D,T),b[3]=b[2],b[2]*=v,b):null}drawDepth(){let i=this.painter,l=i.context,p=this.proxySourceCache,_=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let b=l.gl,D=l.createFramebuffer(_,v,!0,"renderbuffer");l.activeTexture.set(b.TEXTURE0);let T=new r.T(l,{width:_,height:v,data:null},b.RGBA);T.bind(b.NEAREST,b.CLAMP_TO_EDGE),D.colorAttachment.set(T.texture);let M=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);D.depthAttachment.set(M),this._depthFBO=D,this._depthTexture=T}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(b,D,T,M){if(b.transform.projection.name==="globe")return;let P=b.context,k=P.gl;P.clear({depth:1});let N=b.getOrCreateProgram("terrainDepth"),L=new Gt(k.LESS,Gt.ReadWrite,b.depthRangeFor3D);for(let H of M){let G=T.getTile(H),$=Vc(H.projMatrix,0,[0,0,0]);D.setupElevationDraw(G,N),N.draw(b,k.TRIANGLES,L,on.disabled,_n.unblended,Kt.backCCW,$,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}}(i,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,p){if(i.getSource()instanceof r.as)return this._setupProxiedCoordsForImageSource(i,l,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};let _=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let T=0;T<v.length;T++){let M=v[T],P=this._findTileCoveringTileID(M,i);if(P){let k=this._createProxiedId(M,P,p[M.key]&&p[M.key][i.id]);_.push(k),this.proxyToSource[M.key][i.id]=[k]}}let b=!1,D=new Set;for(let T=0;T<l.length;T++){let M=i.getTile(l[T]);if(!M||!M.hasData())continue;let P=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==M.tileID.canonical.z){let k=this.proxyToSource[P.tileID.key][i.id],N=this._createProxiedId(P.tileID,M,p[P.tileID.key]&&p[P.tileID.key][i.id]);k?k.splice(k.length-1,0,N):this.proxyToSource[P.tileID.key][i.id]=[N];let L=this.proxyToSource[P.tileID.key][i.id];D.has(L)||D.add(L),_.push(N),b=!0}}if(this._sourceTilesOverlap[i.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let T of D)T.sort((M,P)=>P.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(i,l,p){if(!i.getSource().loaded())return;let _=this.proxiedCoords[i.id]=[],v=this.proxyCoords,b=i.getSource(),D=b.tileID;if(!D)return;let T=new r.P(D.x,D.y)._div(1<<D.z),M=b.coordinates.map(r.O.fromLngLat).reduce((k,N)=>(k.min.x=Math.min(k.min.x,N.x-T.x),k.min.y=Math.min(k.min.y,N.y-T.y),k.max.x=Math.max(k.max.x,N.x-T.x),k.max.y=Math.max(k.max.y,N.y-T.y),k),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(k,N)=>{let L=k.wrap+k.canonical.x/(1<<k.canonical.z),H=k.canonical.y/(1<<k.canonical.z),G=r.Y/(1<<k.canonical.z),$=N.wrap+N.canonical.x/(1<<N.canonical.z),q=N.canonical.y/(1<<N.canonical.z);return L+G<$+M.min.x||L>$+M.max.x||H+G<q+M.min.y||H>q+M.max.y};for(let k=0;k<v.length;k++){let N=v[k];for(let L=0;L<l.length;L++){let H=i.getTile(l[L]);if(!H||!H.hasData()||P(N,H.tileID))continue;let G=this._createProxiedId(N,H,p[N.key]&&p[N.key][i.id]),$=this.proxyToSource[N.key][i.id];$?$.push(G):this.proxyToSource[N.key][i.id]=[G],_.push(G)}}}_createProxiedId(i,l,p){let _=this.orthoMatrix;if(p){let v=p.find(b=>b.key===l.tileID.key);if(v)return v}if(l.tileID.key!==i.key){let v=i.canonical.z-l.tileID.canonical.z,b,D,T;_=r.a9.create();let M=l.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(b=r.Y>>v,D=b*((l.tileID.canonical.x<<v)-i.canonical.x+M),T=b*((l.tileID.canonical.y<<v)-i.canonical.y)):(b=r.Y<<-v,D=r.Y*(l.tileID.canonical.x-(i.canonical.x+M<<-v)),T=r.Y*(l.tileID.canonical.y-(i.canonical.y<<-v))),r.a9.ortho(_,0,b,0,b,0,1),r.a9.translate(_,_,[D,T,0])}return new Fr(l.tileID,i.key,_)}_findTileCoveringTileID(i,l){let p=l.getTile(i);if(p&&p.hasData())return p;let _=this._findCoveringTileCache[l.id],v=_[i.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let b=p?p.tileID:i,D=b.overscaledZ,T=l.getSource().minzoom,M=[];if(!v){let k=l.getSource().maxzoom;if(i.canonical.z>=k){let N=i.canonical.z-k;l.getSource().reparseOverscaled?(D=Math.max(i.canonical.z+2,l.transform.tileZoom),b=new r.ap(D,i.wrap,k,i.canonical.x>>N,i.canonical.y>>N)):N!==0&&(D=k,b=new r.ap(D,i.wrap,k,i.canonical.x>>N,i.canonical.y>>N))}b.key!==i.key&&(M.push(b.key),p=l.getTile(b))}let P=k=>{M.forEach(N=>{_[N]=k}),M.length=0};for(D-=1;D>=T&&(!p||!p.hasData());D--){p&&P(p.tileID.key);let k=b.calculateScaledKey(D);if(p=l.getTileByID(k),p&&p.hasData())break;let N=_[k];if(N===null)break;N===void 0?M.push(k):p=l.getTileByID(N)}return P(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[l.key]=!0}}function M0(d,i,l){let p=function(D,T,M){let P=r.Q.dot(T,D),k=r.Q.dot(M,[.2126,.7152,.0722]),N=(H,G,$)=>(1-$)*H+$*G,L=N(1-.3*Math.min(k,1),1,Math.min(P+1,1));return N(.92,1,Math.asin(r.ad(T[2],-1,1))/Math.PI+.5)*L}(d,[0,0,1],i),_=[0,0,0];r.Q.scale(_,l.slice(0,3),p);let v=[0,0,0];r.Q.scale(v,i.slice(0,3),d[2]);let b=[0,0,0];return r.Q.add(b,_,v),r.bX(b)}let wl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],or=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ro{static cacheKey(i,l,p,_){let v=`${l}${_?_.cacheKey:""}`;for(let b of p)i.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(i,l,p,_,v,b){let D=i.gl;this.program=D.createProgram(),this.configuration=_,this.name=l,this.fixedDefines=[...b];let T=_?_.getBinderAttributes():[],M=(p.staticAttributes||[]).concat(T),P=_?_.defines():[];P=P.concat(b.map($=>`#define ${$}`));let k=`#version 300 es
`,N=k+P.concat("precision mediump float;",Th,zc.fragmentSource).join(`
`);for(let $ of p.fragmentIncludes)N+=`
${gn[$]}`;N+=`
${p.fragmentSource}`;let L=k+P.concat("precision highp float;",Th,zc.vertexSource).join(`
`);for(let $ of p.vertexIncludes)L+=`
${gn[$]}`;L+=`
${p.vertexSource}`;let H=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(H,N),D.compileShader(H),D.attachShader(this.program,H);let G=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(G,L),D.compileShader(G),D.attachShader(this.program,G),this.attributes={},this.numAttributes=M.length;for(let $=0;$<this.numAttributes;$++)if(M[$]){let q=M[$].startsWith("a_")?M[$]:`a_${M[$]}`;D.bindAttribLocation(this.program,$,q),this.attributes[q]=$}D.linkProgram(this.program),D.deleteShader(G),D.deleteShader(H),this.fixedUniforms=v(i),this.binderUniforms=_?_.getUniforms(i):[],b.includes("TERRAIN")&&(this.terrainUniforms=($=>({u_dem:new r.bR($),u_dem_prev:new r.bR($),u_dem_tl:new r.bO($),u_dem_scale:new r.bQ($),u_dem_tl_prev:new r.bO($),u_dem_scale_prev:new r.bQ($),u_dem_size:new r.bQ($),u_dem_lerp:new r.bQ($),u_exaggeration:new r.bQ($),u_depth:new r.bR($),u_depth_size_inv:new r.bO($),u_meter_to_dem:new r.bQ($),u_label_plane_matrix_inv:new r.bN($)}))(i)),b.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new r.bP($),u_tile_tr_up:new r.bP($),u_tile_br_up:new r.bP($),u_tile_bl_up:new r.bP($),u_tile_up_scale:new r.bQ($)}))(i)),b.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new r.bN($),u_fog_range:new r.bO($),u_fog_color:new r.bS($),u_fog_horizon_blend:new r.bQ($),u_fog_vertical_limit:new r.bO($),u_fog_temporal_offset:new r.bQ($),u_frustum_tl:new r.bP($),u_frustum_tr:new r.bP($),u_frustum_br:new r.bP($),u_frustum_bl:new r.bP($),u_globe_pos:new r.bP($),u_globe_radius:new r.bQ($),u_globe_transition:new r.bQ($),u_is_globe:new r.bR($),u_viewport:new r.bO($)}))(i)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new r.bS($)}))(i)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new r.bP($),u_lighting_directional_dir:new r.bP($),u_lighting_directional_color:new r.bP($),u_ground_radiance:new r.bP($)}))(i)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new r.bN($),u_light_matrix_1:new r.bN($),u_fade_range:new r.bO($),u_shadow_normal_offset:new r.bP($),u_shadow_intensity:new r.bQ($),u_shadow_texel_size:new r.bQ($),u_shadow_map_resolution:new r.bQ($),u_shadow_direction:new r.bP($),u_shadow_bias:new r.bP($),u_shadowmap_0:new r.bR($),u_shadowmap_1:new r.bR($)}))(i))}}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;let p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setCutoffUniformValues(i,l){if(!this.cutoffUniforms)return;let p=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setLightsUniformValues(i,l){if(!this.lightsUniforms)return;let p=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setShadowUniformValues(i,l){if(this.failedToCreate||!this.shadowUniforms)return;let p=this.shadowUniforms;i.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}_drawDebugWireframe(i,l,p,_,v,b,D,T,M,P){let k=i.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;let N=i.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||i._terrain&&i._terrain.renderingToTexture||!wl.includes(this.name))||!(!k.layers3D||!or.includes(this.name))))return;let L=N.gl,H=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,v,N);if(!H)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let $=i.getOrCreateProgram(this.name,{config:this.configuration,defines:G});N.program.set($.program);let q=(ie,ae,W)=>{if(ae[ie]&&W[ie])for(let K in ae[ie])W[ie][K]&&W[ie][K].set(W.program,K,ae[ie][K].current)};M&&M.setUniforms($.program,N,$.binderUniforms,D,{zoom:T}),q("fixedUniforms",this,$),q("terrainUniforms",this,$),q("globeUniforms",this,$),q("fogUniforms",this,$),q("lightsUniforms",this,$),q("shadowUniforms",this,$),H.bind(),N.setColorMode(new _n([L.ONE,L.ONE_MINUS_SRC_ALPHA,L.ZERO,L.ONE],r.aA.transparent,[!0,!0,!0,!1])),N.setDepthMode(new Gt(l.func===L.LESS?L.LEQUAL:l.func,Gt.ReadOnly,l.range)),N.setStencilMode(on.disabled);let Y=3*b.primitiveLength*2,re=3*b.primitiveOffset*2*2;P&&P>1?L.drawElementsInstanced(L.LINES,Y,L.UNSIGNED_SHORT,re,P):L.drawElements(L.LINES,Y,L.UNSIGNED_SHORT,re),v.bind(),N.program.set(this.program),N.setDepthMode(l),N.setStencilMode(p),N.setColorMode(_)}draw(i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$){let q=i.context,Y=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(p),q.setStencilMode(_),q.setColorMode(v),q.setCullFace(b);for(let ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,D[ae]);H&&H.setUniforms(this.program,q,this.binderUniforms,N,{zoom:L});let re={[Y.POINTS]:1,[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[l],ie=$&&$>0?1:void 0;for(let ae of k.get()){let W=ae.vaos||(ae.vaos={});(W[T]||(W[T]=new At)).bind(q,this,M,H?H.getPaintVertexBuffers():[],P,ae.vertexOffset,G||[],ie),$&&$>1?Y.drawElementsInstanced(l,ae.primitiveLength*re,Y.UNSIGNED_SHORT,ae.primitiveOffset*re*2,$):P?Y.drawElements(l,ae.primitiveLength*re,Y.UNSIGNED_SHORT,ae.primitiveOffset*re*2):Y.drawArrays(l,ae.vertexOffset,ae.vertexLength),l===Y.TRIANGLES&&P&&this._drawDebugWireframe(i,p,_,v,P,ae,N,L,H,$)}}}function ms(d,i){let l=Math.pow(2,i.tileID.overscaledZ),p=i.tileSize*Math.pow(2,d.transform.tileZoom)/l,_=p*(i.tileID.canonical.x+i.tileID.wrap*l),v=p*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a6(i,1,d.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}let mr=r.a9.create(),Ih=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G)=>{let $=i.style.light,q=$.properties.get("position"),Y=[q.x,q.y,q.z],re=r.ct.create();$.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(re,-i.transform.angle),r.Q.transformMat3(Y,Y,re));let ie=$.properties.get("color"),ae=i.transform,W={u_matrix:d,u_lightpos:Y,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v,u_flood_light_color:k,u_vertical_scale:N,u_flood_light_intensity:L,u_ground_shadow_factor:H,u_emissive_strength:G};return ae.projection.name==="globe"&&(W.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],W.u_zoom_transition=T,W.u_inv_rot_matrix=P,W.u_merc_center=M,W.u_up_dir=ae.projection.upVector(new r.bv(0,0,0),M[0]*r.Y,M[1]*r.Y),W.u_height_lift=D),W},ts=(d,i,l)=>({u_matrix:d,u_edge_radius:i,u_vertical_scale:l}),Hc=(d,i,l,p,_,v,b,D,T,M,P,k,N,L)=>{let H=Ih(d,i,l,p,_,v,b,T,M,P,k,N,L,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,b.overscaledZ)/D.tileSize/8};return r.e(H,ms(i,D),G)},Dl=(d,i)=>({u_matrix:d,u_emissive_strength:i}),ra=(d,i,l,p)=>r.e(Dl(d,i),ms(l,p)),Cv=(d,i,l)=>({u_matrix:d,u_world:l,u_emissive_strength:i}),Rs=(d,i,l,p,_)=>r.e(ra(d,i,l,p),{u_world:_}),Ev=(d,i,l,p)=>{let _=r.Y/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/_,i.pixelsToGLUnits[1]/_]}},Qf=(d,i,l=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:l}),co=r.a9.create(),Av=(d,i,l,p,_,v,b)=>{let D=d.transform,T=D.projection.name==="globe",M=T?r.cu(D.zoom,i.canonical)*D._pixelsPerMercatorPixel:r.a6(l,1,v),P={u_matrix:i.projMatrix,u_extrude_scale:M,u_intensity:b,u_inv_rot_matrix:co,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){P.u_inv_rot_matrix=p,P.u_merc_center=_,P.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],P.u_zoom_transition=r.W(D.zoom);let k=_[0]*r.Y,N=_[1]*r.Y;P.u_up_dir=D.projection.upVector(new r.bv(0,0,0),k,N)}return P};function $c(d,[i,l,p,_],[v,b]){if(v===b)return[0,0,0,0];let D=255*(d-1)/(d*(b-v));return[i*D,l*D,p*D,_*D]}function Yf(d,i,[l,p]){return l===p?0:.5/d+(i-l)*(d-1)/(d*(p-l))}let F0=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q,Y,re,ie)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:r.cv(k.paint.get("raster-saturation")),u_contrast_factor:r.cw(k.paint.get("raster-contrast")),u_spin_weights:Tv(k.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:L,u_zoom_transition:b,u_merc_center:D,u_cutoff_params:T,u_colorization_mix:$c(r.cx,G,q),u_colorization_offset:Yf(r.cx,$,q),u_color_ramp:H,u_texture_offset:[re/(Y+2*re),Y/(Y+2*re)],u_texture_res:[Y+2*re,Y+2*re],u_emissive_strength:ie});function Tv(d){d*=Math.PI/180;let i=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}let qc=(d,i,l,p,_,v,b,D,T,M,P,k)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:b,u_merc_center:D,u_cutoff_params:T}),Wc=(d,i,l,p,_,v,b,D,T,M)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_tile_offset:l,u_velocity:p,u_color_ramp:v,u_velocity_res:_,u_max_speed:b,u_uv_offset:D,u_data_scale:T,u_data_offset:M,u_particle_pos_scale:1.3,u_particle_pos_offset:[Sa,Sa]}),Sv=(d,i,l,p,_,v,b,D,T,M)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_velocity:l,u_velocity_res:p,u_max_speed:_,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:T,u_data_offset:M,u_particle_pos_scale:1.3,u_particle_pos_offset:[Sa,Sa]}),ka=r.a9.create(),Xf=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q)=>{let Y=_.transform,re={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Y.getCameraToCenterDistance(G),u_rotate_symbol:+l,u_aspect_ratio:Y.width/Y.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:D,u_is_text:+T,u_pitch_with_map:+p,u_texsize:M,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ka,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ka,u_up_vector:[0,-1,0],u_color_adj_mat:$,u_icon_transition:q||0};return G.name==="globe"&&(re.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],re.u_zoom_transition=k,re.u_inv_rot_matrix=L,re.u_merc_center=N,re.u_camera_forward=Y._camera.forward(),re.u_ecef_origin=r.cy(Y.globeMatrix,P.toUnwrapped()),re.u_tile_matrix=Float32Array.from(Y.globeMatrix),re.u_up_vector=H),re},Cl=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$)=>r.e(Xf(d,i,l,p,_,v,b,D,T,M,k,N,L,H,G,$),{u_gamma_scale:p?_.transform.getCameraToCenterDistance($)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+P,undefined:void 0}),oa=(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G)=>r.e(Cl(d,i,l,p,_,v,b,D,!0,T,!0,P,k,N,L,H,G),{u_texsize_icon:M,u_texture_icon:1}),Iv=(d,i,l,p)=>({u_matrix:d,u_emissive_strength:i,u_opacity:l,u_color:p}),Mv=(d,i,l,p,_,v,b)=>r.e(function(D,T,M,P){let k=M.imageManager.getPattern(D.toString(),T),{width:N,height:L}=M.imageManager.getPixelSize(T),H=Math.pow(2,P.tileID.overscaledZ),G=P.tileSize*Math.pow(2,M.transform.tileZoom)/H,$=G*(P.tileID.canonical.x+P.tileID.wrap*H),q=G*P.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[N,L],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/r.a6(P,1,M.transform.tileZoom),u_pixel_coord_upper:[$>>16,q>>16],u_pixel_coord_lower:[65535&$,65535&q]}}(_,v,p,b),{u_matrix:d,u_emissive_strength:i,u_opacity:l}),Kf=new Float32Array(r.a9.identity([])),Mh=(d,i,l,p,_,v,b,D,T,M,P,k,N,L=[0,0,0],H)=>{let G=_.style.light,$=G.properties.get("position"),q=[-$.x,-$.y,$.z],Y=r.ct.create();G.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(Y,-_.transform.angle),r.Q.transformMat3(q,q,Y));let re=P.alphaMode==="MASK",ie=G.properties.get("color"),ae=N.paint.get("model-ambient-occlusion-intensity"),W=N.paint.get("model-color").constantOr(r.aA.white),K=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:i,u_normal_matrix:l,u_node_matrix:p||Kf,u_lightpos:q,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_camera_pos:L,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[D[0],D[1],D[2],1],u_metallicFactor:T,u_roughnessFactor:M,u_baseColorTexture:ao.BaseColor,u_metallicRoughnessTexture:ao.MetallicRoughness,u_normalTexture:ao.Normal,u_occlusionTexture:ao.Occlusion,u_emissionTexture:ao.Emission,u_color_mix:[W.r,W.g,W.b,K],u_aoIntensity:ae,u_emissive_strength:k,u_occlusionTextureTransform:H||[0,0,0,0]}},P0=(d,i=Kf,l=Kf)=>({u_matrix:d,u_instance:i,u_node_matrix:l}),Jf={fillExtrusion:d=>({u_matrix:new r.bN(d),u_lightpos:new r.bP(d),u_lightintensity:new r.bQ(d),u_lightcolor:new r.bP(d),u_vertical_gradient:new r.bQ(d),u_opacity:new r.bQ(d),u_edge_radius:new r.bQ(d),u_ao:new r.bO(d),u_tile_id:new r.bP(d),u_zoom_transition:new r.bQ(d),u_inv_rot_matrix:new r.bN(d),u_merc_center:new r.bO(d),u_up_dir:new r.bP(d),u_height_lift:new r.bQ(d),u_flood_light_color:new r.bP(d),u_vertical_scale:new r.bQ(d),u_flood_light_intensity:new r.bQ(d),u_ground_shadow_factor:new r.bP(d),u_emissive_strength:new r.bQ(d)}),fillExtrusionDepth:d=>({u_matrix:new r.bN(d),u_edge_radius:new r.bQ(d),u_vertical_scale:new r.bQ(d)}),fillExtrusionPattern:d=>({u_matrix:new r.bN(d),u_lightpos:new r.bP(d),u_lightintensity:new r.bQ(d),u_lightcolor:new r.bP(d),u_vertical_gradient:new r.bQ(d),u_height_factor:new r.bQ(d),u_edge_radius:new r.bQ(d),u_ao:new r.bO(d),u_tile_id:new r.bP(d),u_zoom_transition:new r.bQ(d),u_inv_rot_matrix:new r.bN(d),u_merc_center:new r.bO(d),u_up_dir:new r.bP(d),u_height_lift:new r.bQ(d),u_image:new r.bR(d),u_texsize:new r.bO(d),u_pixel_coord_upper:new r.bO(d),u_pixel_coord_lower:new r.bO(d),u_tile_units_to_pixels:new r.bQ(d),u_opacity:new r.bQ(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.bN(d),u_opacity:new r.bQ(d),u_ao_pass:new r.bQ(d),u_meter_to_tile:new r.bQ(d),u_ao:new r.bO(d),u_flood_light_intensity:new r.bQ(d),u_flood_light_color:new r.bP(d),u_attenuation:new r.bQ(d),u_edge_radius:new r.bQ(d),u_fb:new r.bR(d),u_fb_size:new r.bQ(d)}),fill:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d)}),fillPattern:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d),u_image:new r.bR(d),u_texsize:new r.bO(d),u_pixel_coord_upper:new r.bO(d),u_pixel_coord_lower:new r.bO(d),u_tile_units_to_pixels:new r.bQ(d)}),fillOutline:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d),u_world:new r.bO(d)}),fillOutlinePattern:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d),u_world:new r.bO(d),u_image:new r.bR(d),u_texsize:new r.bO(d),u_pixel_coord_upper:new r.bO(d),u_pixel_coord_lower:new r.bO(d),u_tile_units_to_pixels:new r.bQ(d)}),circle:r.cz,collisionBox:d=>({u_matrix:new r.bN(d),u_camera_to_center_distance:new r.bQ(d),u_extrude_scale:new r.bO(d)}),collisionCircle:d=>({u_matrix:new r.bN(d),u_inv_matrix:new r.bN(d),u_camera_to_center_distance:new r.bQ(d),u_viewport_size:new r.bO(d)}),debug:d=>({u_color:new r.cf(d),u_matrix:new r.bN(d),u_overlay:new r.bR(d),u_overlay_scale:new r.bQ(d)}),clippingMask:d=>({u_matrix:new r.bN(d)}),heatmap:d=>({u_extrude_scale:new r.bQ(d),u_intensity:new r.bQ(d),u_matrix:new r.bN(d),u_inv_rot_matrix:new r.bN(d),u_merc_center:new r.bO(d),u_tile_id:new r.bP(d),u_zoom_transition:new r.bQ(d),u_up_dir:new r.bP(d)}),heatmapTexture:d=>({u_image:new r.bR(d),u_color_ramp:new r.bR(d),u_opacity:new r.bQ(d)}),hillshade:d=>({u_matrix:new r.bN(d),u_image:new r.bR(d),u_latrange:new r.bO(d),u_light:new r.bO(d),u_shadow:new r.cf(d),u_highlight:new r.cf(d),u_emissive_strength:new r.bQ(d),u_accent:new r.cf(d)}),hillshadePrepare:d=>({u_matrix:new r.bN(d),u_image:new r.bR(d),u_dimension:new r.bO(d),u_zoom:new r.bQ(d)}),line:r.cA,linePattern:r.cB,raster:d=>({u_matrix:new r.bN(d),u_normalize_matrix:new r.bN(d),u_globe_matrix:new r.bN(d),u_merc_matrix:new r.bN(d),u_grid_matrix:new r.cg(d),u_tl_parent:new r.bO(d),u_scale_parent:new r.bQ(d),u_fade_t:new r.bQ(d),u_opacity:new r.bQ(d),u_image0:new r.bR(d),u_image1:new r.bR(d),u_brightness_low:new r.bQ(d),u_brightness_high:new r.bQ(d),u_saturation_factor:new r.bQ(d),u_contrast_factor:new r.bQ(d),u_spin_weights:new r.bP(d),u_perspective_transform:new r.bO(d),u_raster_elevation:new r.bQ(d),u_zoom_transition:new r.bQ(d),u_merc_center:new r.bO(d),u_cutoff_params:new r.bS(d),u_colorization_mix:new r.bS(d),u_colorization_offset:new r.bQ(d),u_color_ramp:new r.bR(d),u_texture_offset:new r.bO(d),u_texture_res:new r.bO(d),u_emissive_strength:new r.bQ(d)}),rasterParticle:d=>({u_matrix:new r.bN(d),u_normalize_matrix:new r.bN(d),u_globe_matrix:new r.bN(d),u_merc_matrix:new r.bN(d),u_grid_matrix:new r.cg(d),u_tl_parent:new r.bO(d),u_scale_parent:new r.bQ(d),u_fade_t:new r.bQ(d),u_opacity:new r.bQ(d),u_image0:new r.bR(d),u_image1:new r.bR(d),u_raster_elevation:new r.bQ(d),u_zoom_transition:new r.bQ(d),u_merc_center:new r.bO(d),u_cutoff_params:new r.bS(d)}),rasterParticleTexture:d=>({u_texture:new r.bR(d),u_opacity:new r.bQ(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.bR(d),u_particle_texture_side_len:new r.bQ(d),u_tile_offset:new r.bO(d),u_velocity:new r.bR(d),u_color_ramp:new r.bR(d),u_velocity_res:new r.bO(d),u_max_speed:new r.bQ(d),u_uv_offset:new r.bO(d),u_data_scale:new r.bS(d),u_data_offset:new r.bQ(d),u_particle_pos_scale:new r.bQ(d),u_particle_pos_offset:new r.bO(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.bR(d),u_particle_texture_side_len:new r.bQ(d),u_velocity:new r.bR(d),u_velocity_res:new r.bO(d),u_max_speed:new r.bQ(d),u_speed_factor:new r.bQ(d),u_reset_rate:new r.bQ(d),u_rand_seed:new r.bQ(d),u_uv_offset:new r.bO(d),u_data_scale:new r.bS(d),u_data_offset:new r.bQ(d),u_particle_pos_scale:new r.bQ(d),u_particle_pos_offset:new r.bO(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new r.bR(d),u_is_size_feature_constant:new r.bR(d),u_size_t:new r.bQ(d),u_size:new r.bQ(d),u_camera_to_center_distance:new r.bQ(d),u_rotate_symbol:new r.bR(d),u_aspect_ratio:new r.bQ(d),u_fade_change:new r.bQ(d),u_matrix:new r.bN(d),u_label_plane_matrix:new r.bN(d),u_coord_matrix:new r.bN(d),u_is_text:new r.bR(d),u_pitch_with_map:new r.bR(d),u_texsize:new r.bO(d),u_tile_id:new r.bP(d),u_zoom_transition:new r.bQ(d),u_inv_rot_matrix:new r.bN(d),u_merc_center:new r.bO(d),u_camera_forward:new r.bP(d),u_tile_matrix:new r.bN(d),u_up_vector:new r.bP(d),u_ecef_origin:new r.bP(d),u_texture:new r.bR(d),u_icon_transition:new r.bQ(d),u_color_adj_mat:new r.bN(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new r.bR(d),u_is_size_feature_constant:new r.bR(d),u_size_t:new r.bQ(d),u_size:new r.bQ(d),u_camera_to_center_distance:new r.bQ(d),u_rotate_symbol:new r.bR(d),u_aspect_ratio:new r.bQ(d),u_fade_change:new r.bQ(d),u_matrix:new r.bN(d),u_label_plane_matrix:new r.bN(d),u_coord_matrix:new r.bN(d),u_is_text:new r.bR(d),u_pitch_with_map:new r.bR(d),u_texsize:new r.bO(d),u_texture:new r.bR(d),u_gamma_scale:new r.bQ(d),u_device_pixel_ratio:new r.bQ(d),u_tile_id:new r.bP(d),u_zoom_transition:new r.bQ(d),u_inv_rot_matrix:new r.bN(d),u_merc_center:new r.bO(d),u_camera_forward:new r.bP(d),u_tile_matrix:new r.bN(d),u_up_vector:new r.bP(d),u_ecef_origin:new r.bP(d),u_is_halo:new r.bR(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new r.bR(d),u_is_size_feature_constant:new r.bR(d),u_size_t:new r.bQ(d),u_size:new r.bQ(d),u_camera_to_center_distance:new r.bQ(d),u_rotate_symbol:new r.bR(d),u_aspect_ratio:new r.bQ(d),u_fade_change:new r.bQ(d),u_matrix:new r.bN(d),u_label_plane_matrix:new r.bN(d),u_coord_matrix:new r.bN(d),u_is_text:new r.bR(d),u_pitch_with_map:new r.bR(d),u_texsize:new r.bO(d),u_texsize_icon:new r.bO(d),u_texture:new r.bR(d),u_texture_icon:new r.bR(d),u_gamma_scale:new r.bQ(d),u_device_pixel_ratio:new r.bQ(d),u_is_halo:new r.bR(d)}),background:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d),u_opacity:new r.bQ(d),u_color:new r.cf(d)}),backgroundPattern:d=>({u_matrix:new r.bN(d),u_emissive_strength:new r.bQ(d),u_opacity:new r.bQ(d),u_image:new r.bR(d),u_pattern_tl:new r.bO(d),u_pattern_br:new r.bO(d),u_texsize:new r.bO(d),u_pattern_size:new r.bO(d),u_pixel_coord_upper:new r.bO(d),u_pixel_coord_lower:new r.bO(d),u_tile_units_to_pixels:new r.bQ(d)}),terrainRaster:Bn,terrainDepth:Bn,skybox:d=>({u_matrix:new r.bN(d),u_sun_direction:new r.bP(d),u_cubemap:new r.bR(d),u_opacity:new r.bQ(d),u_temporal_offset:new r.bQ(d)}),skyboxGradient:d=>({u_matrix:new r.bN(d),u_color_ramp:new r.bR(d),u_center_direction:new r.bP(d),u_radius:new r.bQ(d),u_opacity:new r.bQ(d),u_temporal_offset:new r.bQ(d)}),skyboxCapture:d=>({u_matrix_3f:new r.cg(d),u_sun_direction:new r.bP(d),u_sun_intensity:new r.bQ(d),u_color_tint_r:new r.bS(d),u_color_tint_m:new r.bS(d),u_luminance:new r.bQ(d)}),globeRaster:d=>({u_proj_matrix:new r.bN(d),u_globe_matrix:new r.bN(d),u_normalize_matrix:new r.bN(d),u_merc_matrix:new r.bN(d),u_zoom_transition:new r.bQ(d),u_merc_center:new r.bO(d),u_image0:new r.bR(d),u_grid_matrix:new r.cg(d),u_skirt_height:new r.bQ(d),u_far_z_cutoff:new r.bQ(d),u_frustum_tl:new r.bP(d),u_frustum_tr:new r.bP(d),u_frustum_br:new r.bP(d),u_frustum_bl:new r.bP(d),u_globe_pos:new r.bP(d),u_globe_radius:new r.bQ(d),u_viewport:new r.bO(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.bP(d),u_frustum_tr:new r.bP(d),u_frustum_br:new r.bP(d),u_frustum_bl:new r.bP(d),u_horizon:new r.bQ(d),u_transition:new r.bQ(d),u_fadeout_range:new r.bQ(d),u_color:new r.bS(d),u_high_color:new r.bS(d),u_space_color:new r.bS(d),u_temporal_offset:new r.bQ(d),u_horizon_angle:new r.bQ(d)}),model:d=>({u_matrix:new r.bN(d),u_lighting_matrix:new r.bN(d),u_normal_matrix:new r.bN(d),u_node_matrix:new r.bN(d),u_lightpos:new r.bP(d),u_lightintensity:new r.bQ(d),u_lightcolor:new r.bP(d),u_camera_pos:new r.bP(d),u_opacity:new r.bQ(d),u_baseColorFactor:new r.bS(d),u_emissiveFactor:new r.bS(d),u_metallicFactor:new r.bQ(d),u_roughnessFactor:new r.bQ(d),u_baseTextureIsAlpha:new r.bR(d),u_alphaMask:new r.bR(d),u_alphaCutoff:new r.bQ(d),u_baseColorTexture:new r.bR(d),u_metallicRoughnessTexture:new r.bR(d),u_normalTexture:new r.bR(d),u_occlusionTexture:new r.bR(d),u_emissionTexture:new r.bR(d),u_color_mix:new r.bS(d),u_aoIntensity:new r.bQ(d),u_emissive_strength:new r.bQ(d),u_occlusionTextureTransform:new r.bS(d)}),modelDepth:d=>({u_matrix:new r.bN(d),u_instance:new r.bN(d),u_node_matrix:new r.bN(d)}),groundShadow:d=>({u_matrix:new r.bN(d),u_ground_shadow_factor:new r.bP(d)}),stars:d=>({u_matrix:new r.bN(d),u_up:new r.bP(d),u_right:new r.bP(d),u_intensity_multiplier:new r.bQ(d)})},Zc;function ep(d,i,l,p,_,v,b){let D=d.context,T=D.gl,M=d.transform,P=d.getOrCreateProgram("collisionBox"),k=[],N=0,L=0;for(let ie=0;ie<p.length;ie++){let ae=p[ie],W=i.getTile(ae),K=W.getBucket(l);if(!K)continue;let fe=fs(ae,K,M),he=fe;_[0]===0&&_[1]===0||(he=d.translatePosMatrix(fe,W,_,v));let ve=b?K.textCollisionBox:K.iconCollisionBox,Ie=K.collisionCircleArray;if(Ie.length>0){let ye=r.a9.create(),Ae=he;r.a9.mul(ye,K.placementInvProjMatrix,M.glCoordMatrix),r.a9.mul(ye,ye,K.placementViewportMatrix),k.push({circleArray:Ie,circleOffset:L,transform:Ae,invTransform:ye,projection:K.getProjection()}),N+=Ie.length/4,L=N}ve&&(d.terrain&&d.terrain.setupElevationDraw(W,P),P.draw(d,T.LINES,Gt.disabled,on.disabled,d.colorModeForRenderPass(),Kt.disabled,Ev(he,M,W,K.getProjection()),l.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,M.zoom,null,[ve.collisionVertexBuffer,ve.collisionVertexBufferExt]))}if(!b||!k.length)return;let H=d.getOrCreateProgram("collisionCircle"),G=new r.cC;G.resize(4*N),G._trim();let $=0;for(let ie of k)for(let ae=0;ae<ie.circleArray.length/4;ae++){let W=4*ae,K=ie.circleArray[W+0],fe=ie.circleArray[W+1],he=ie.circleArray[W+2],ve=ie.circleArray[W+3];G.emplace($++,K,fe,he,ve,0),G.emplace($++,K,fe,he,ve,1),G.emplace($++,K,fe,he,ve,2),G.emplace($++,K,fe,he,ve,3)}(!Zc||Zc.length<2*N)&&(Zc=function(ie){let ae=2*ie,W=new r.az;W.resize(ae),W._trim();for(let K=0;K<ae;K++){let fe=6*K;W.uint16[fe+0]=4*K+0,W.uint16[fe+1]=4*K+1,W.uint16[fe+2]=4*K+2,W.uint16[fe+3]=4*K+2,W.uint16[fe+4]=4*K+3,W.uint16[fe+5]=4*K+0}return W}(N));let q=D.createIndexBuffer(Zc,!0),Y=D.createVertexBuffer(G,r.cD.members,!0);for(let ie of k){let ae={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(re=M).getCameraToCenterDistance(ie.projection),u_viewport_size:[re.width,re.height]};H.draw(d,T.TRIANGLES,Gt.disabled,on.disabled,d.colorModeForRenderPass(),Kt.disabled,ae,l.id,Y,q,r.aE.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,M.zoom)}var re;Y.destroy(),q.destroy()}let Qc=r.a9.create();function tp(d){let i=d._camera.getWorldToCamera(d.worldSize,1),l=r.a9.multiply([],i,d.globeMatrix);r.a9.invert(l,l);let p=[0,0,0],_=[0,1,0,0];return r.aa.transformMat4(_,_,l),p[0]=_[0],p[1]=_[1],p[2]=_[2],r.Q.normalize(p,p),p}function Ba({width:d,height:i,anchor:l,textOffset:p,textScale:_},v){let{horizontalAlign:b,verticalAlign:D}=r.bi(l),T=-(b-.5)*d,M=-(D-.5)*i,P=r.bh(l,p);return new r.P((T/_+P[0])*v,(M/_+P[1])*v)}function O0(d,i,l,p,_,v,b,D,T,M,P){let k=d.text.placedSymbolArray,N=d.text.dynamicLayoutVertexArray,L=d.icon.dynamicLayoutVertexArray,H={},G=d.getProjection(),$=hh(D,G,v),q=v.elevation,Y=G.upVectorScale(D.canonical,v.center.lat,v.worldSize).metersToTile;N.clear();for(let re=0;re<k.length;re++){let ie=k.get(re),{tileAnchorX:ae,tileAnchorY:W,numGlyphs:K}=ie,fe=ie.hidden||!ie.crossTileID||d.allowVerticalPlacement&&!ie.placedOrientation?null:p[ie.crossTileID];if(fe){let he=0,ve=0,Ie=0;if(q){let Me=q?q.getAtTileOffset(D,ae,W):0,[oe,Ve,yt]=G.upVector(D.canonical,ae,W);he=Me*oe*Y,ve=Me*Ve*Y,Ie=Me*yt*Y}let[ye,Ae,Fe,_e]=xo(ie.projectedAnchorX+he,ie.projectedAnchorY+ve,ie.projectedAnchorZ+Ie,l?$:b),De=sh(v.getCameraToCenterDistance(G),_e),Xe=_.evaluateSizeForFeature(d.textSizeData,M,ie)*De/r.bf;l&&(Xe*=d.tilePixelRatio/T);let be=Ba(fe,Xe);l?({x:ye,y:Ae,z:Fe}=G.projectTilePoint(ae+be.x,W+be.y,D.canonical),[ye,Ae,Fe]=xo(ye+he,Ae+ve,Fe+Ie,b)):(i&&be._rotate(-v.angle),ye+=be.x,Ae+=be.y,Fe=0);let Se=d.allowVerticalPlacement&&ie.placedOrientation===r.b9.vertical?Math.PI/2:0;for(let Me=0;Me<K;Me++)r.bc(N,ye,Ae,Fe,Se);P&&ie.associatedIconIndex>=0&&(H[ie.associatedIconIndex]={x:ye,y:Ae,z:Fe,angle:Se})}else Fa(K,N)}if(P){L.clear();let re=d.icon.placedSymbolArray;for(let ie=0;ie<re.length;ie++){let ae=re.get(ie),{numGlyphs:W}=ae,K=H[ie];if(ae.hidden||!K)Fa(W,L);else{let{x:fe,y:he,z:ve,angle:Ie}=K;for(let ye=0;ye<W;ye++)r.bc(L,fe,he,ve,Ie)}}d.icon.dynamicLayoutVertexBuffer.updateData(L)}d.text.dynamicLayoutVertexBuffer.updateData(N)}function Yc(d,i,l,p,_,v,b={}){let D=l.paint.get("icon-translate"),T=l.paint.get("text-translate"),M=l.paint.get("icon-translate-anchor"),P=l.paint.get("text-translate-anchor"),k=l.layout.get("icon-rotation-alignment"),N=l.layout.get("text-rotation-alignment"),L=l.layout.get("icon-pitch-alignment"),H=l.layout.get("text-pitch-alignment"),G=l.layout.get("icon-keep-upright"),$=l.layout.get("text-keep-upright"),q=l.paint.get("icon-color-saturation"),Y=l.paint.get("icon-color-contrast"),re=l.paint.get("icon-color-brightness-min"),ie=l.paint.get("icon-color-brightness-max"),ae=d.context,W=ae.gl,K=d.transform,fe=k==="map",he=N==="map",ve=L==="map",Ie=H==="map",ye=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ae=!1,Fe=d.depthModeForSublayer(0,Gt.ReadOnly),_e=[r.a8(K.center.lng),r.ah(K.center.lat)],De=l.layout.get("text-variable-anchor"),Xe=K.projection.name==="globe",be=[],Se=[0,-1,0];for(let Me of p){let oe=i.getTile(Me),Ve=oe.getBucket(l);if(!Ve||Ve.projection.name==="mercator"&&Xe||Ve.fullyClipped)continue;let yt=Ve.projection.name==="globe",Mt=yt?r.W(K.zoom):0,zt=hh(Me,Ve.getProjection(),K),Rt=K.calculatePixelsToTileUnitsMatrix(oe),jt=De&&Ve.hasTextData(),En=Ve.hasIconTextFit()&&jt&&Ve.hasIconData(),nn=Ve.getProjection().createInversionMatrix(K,Me.canonical),Pn=()=>{let dn=fe&&l.layout.get("symbol-placement")!=="point",pn=[],Ci=dn||En,_i=l.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&ve&&pn.push("PITCH_WITH_MAP_TERRAIN"),yt&&(pn.push("PROJECTION_GLOBE_VIEW"),Ci&&pn.push("PROJECTED_POS_ON_VIEWPORT")),_i>0&&pn.push("ICON_TRANSITION"),Ve.icon.zOffsetVertexBuffer&&pn.push("Z_OFFSET"),q===0&&Y===0&&re===0&&ie===1||pn.push("COLOR_ADJUSTMENT");let xn=Ve.icon.programConfigurations.get(l.id),an=d.getOrCreateProgram(Ve.sdfIcons?"symbolSDF":"symbolIcon",{config:xn,defines:pn}),Qr,Or=oe.imageAtlasTexture?oe.imageAtlasTexture.size:[0,0],gr=Ve.iconSizeData,Rr=r.b8(gr,K.zoom),Yr=ve||K.pitch!==0,zr=Tc(zt,oe.tileID.canonical,ve,fe,K,Ve.getProjection(),Rt),_r=Ps(zt,oe.tileID.canonical,ve,fe,K,Ve.getProjection(),Rt),Cr=d.translatePosMatrix(_r,oe,D,M,!0),Er=d.translatePosMatrix(zt,oe,D,M),_s=Ci?Qc:zr,is=fe&&!ve&&!dn,ys=Se;!Xe&&!K.mercatorFromTransition||fe||(ys=tp(K));let vs=yt?ys:Se;if(Ve.sdfIcons&&!Ve.iconsInText)Qr=Cl(gr.kind,Rr,is,ve,d,Er,_s,Cr,!1,Or,!0,Me,Mt,_e,nn,vs,Ve.getProjection());else{let Ns=l.getColorAdjustmentMatrix(q,Y,re,ie);Qr=Xf(gr.kind,Rr,is,ve,d,Er,_s,Cr,!1,Or,Me,Mt,_e,nn,vs,Ve.getProjection(),Ns,_i)}let ua=oe.imageAtlasTexture?oe.imageAtlasTexture:null,ko=l.layout.get("icon-size").constantOr(0)!==1||Ve.iconsNeedLinear,uu=Ve.sdfIcons||d.options.rotating||d.options.zooming||ko||Yr?W.LINEAR:W.NEAREST,Rl=Ve.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,hu=d.terrain&&ve&&dn?r.a9.invert(r.a9.create(),zr):Qc;if(dn&&Ve.icon){let Ns=K.elevation,yr=Ns?Ns.getAtTileOffsetFunc(Me,K.center.lat,K.worldSize,Ve.getProjection()):null,du=Sc(zt,oe.tileID.canonical,ve,fe,K,Ve.getProjection(),Rt);lh(Ve,zt,d,!1,du,_r,ve,G,yr,Me)}return{program:an,buffers:Ve.icon,uniformValues:Qr,atlasTexture:ua,atlasTextureIcon:null,atlasInterpolation:uu,atlasInterpolationIcon:null,isSDF:Ve.sdfIcons,hasHalo:Rl,tile:oe,labelPlaneMatrixInv:hu}},An=()=>{let dn=he&&l.layout.get("symbol-placement")!=="point",pn=[],Ci=dn||De||En;d.terrainRenderModeElevated()&&Ie&&pn.push("PITCH_WITH_MAP_TERRAIN"),yt&&(pn.push("PROJECTION_GLOBE_VIEW"),Ci&&pn.push("PROJECTED_POS_ON_VIEWPORT")),Ve.text.zOffsetVertexBuffer&&pn.push("Z_OFFSET");let _i=Ve.text.programConfigurations.get(l.id),xn=d.getOrCreateProgram(Ve.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:_i,defines:pn}),an,Qr=[0,0],Or=null,gr=Ve.textSizeData;Ve.iconsInText&&(Qr=oe.imageAtlasTexture?oe.imageAtlasTexture.size:[0,0],Or=oe.imageAtlasTexture?oe.imageAtlasTexture:null,an=Ie||K.pitch!==0||d.options.rotating||d.options.zooming||gr.kind==="composite"||gr.kind==="camera"?W.LINEAR:W.NEAREST);let Rr=oe.glyphAtlasTexture?oe.glyphAtlasTexture.size:[0,0],Yr=r.b8(gr,K.zoom),zr=Tc(zt,oe.tileID.canonical,Ie,he,K,Ve.getProjection(),Rt),_r=Ps(zt,oe.tileID.canonical,Ie,he,K,Ve.getProjection(),Rt),Cr=d.translatePosMatrix(_r,oe,T,P,!0),Er=d.translatePosMatrix(zt,oe,T,P),_s=Ci?Qc:zr,is=he&&!Ie&&!dn,ys=Se;!Xe&&!K.mercatorFromTransition||he||(ys=tp(K));let vs=yt?ys:Se,ua;ua=Ve.iconsInText?oa(gr.kind,Yr,is,Ie,d,Er,_s,Cr,Rr,Qr,Me,Mt,_e,nn,vs,Ve.getProjection()):Cl(gr.kind,Yr,is,Ie,d,Er,_s,Cr,!0,Rr,!0,Me,Mt,_e,nn,vs,Ve.getProjection());let ko=oe.glyphAtlasTexture?oe.glyphAtlasTexture:null,uu=W.LINEAR,Rl=l.paint.get("text-halo-width").constantOr(1)!==0,hu=d.terrain&&Ie&&dn?r.a9.invert(r.a9.create(),zr):Qc;if(dn&&Ve.text){let Ns=K.elevation,yr=Ns?Ns.getAtTileOffsetFunc(Me,K.center.lat,K.worldSize,Ve.getProjection()):null,du=Sc(zt,oe.tileID.canonical,Ie,he,K,Ve.getProjection(),Rt);lh(Ve,zt,d,!0,du,_r,Ie,$,yr,Me)}return{program:xn,buffers:Ve.text,uniformValues:ua,atlasTexture:ko,atlasTextureIcon:Or,atlasInterpolation:uu,atlasInterpolationIcon:an,isSDF:!0,hasHalo:Rl,tile:oe,labelPlaneMatrixInv:hu}},Fi=Ve.icon.segments.get().length,ei=Ve.text.segments.get().length,sr=Fi&&!b.onlyText?Pn():null,Ji=ei&&!b.onlyIcons?An():null,gi=l.paint.get("icon-opacity").constantOr(1),ai=l.paint.get("text-opacity").constantOr(1);if(ye&&Ve.canOverlap){Ae=!0;let dn=gi&&!b.onlyText?Ve.icon.segments.get():[],pn=ai&&!b.onlyIcons?Ve.text.segments.get():[];for(let Ci of dn)be.push({segments:new r.aE([Ci]),sortKey:Ci.sortKey,state:sr});for(let Ci of pn)be.push({segments:new r.aE([Ci]),sortKey:Ci.sortKey,state:Ji})}else b.onlyText||be.push({segments:gi?Ve.icon.segments:new r.aE([]),sortKey:0,state:sr}),b.onlyIcons||be.push({segments:ai?Ve.text.segments:new r.aE([]),sortKey:0,state:Ji})}Ae&&be.sort((Me,oe)=>Me.sortKey-oe.sortKey);for(let Me of be){let oe=Me.state;if(oe)if(d.terrain&&d.terrain.setupElevationDraw(oe.tile,oe.program,{useDepthForOcclusion:K.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:oe.labelPlaneMatrixInv}),ae.activeTexture.set(W.TEXTURE0),oe.atlasTexture&&oe.atlasTexture.bind(oe.atlasInterpolation,W.CLAMP_TO_EDGE,!0),oe.atlasTextureIcon&&(ae.activeTexture.set(W.TEXTURE1),oe.atlasTextureIcon&&oe.atlasTextureIcon.bind(oe.atlasInterpolationIcon,W.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,oe.program),oe.hasHalo){let Ve=oe.uniformValues;Ve.u_is_halo=1,Fh(oe.buffers,Me.segments,l,d,oe.program,Fe,_,v,Ve,2),Ve.u_is_halo=0}else{if(oe.isSDF){let Ve=oe.uniformValues;oe.hasHalo&&(Ve.u_is_halo=1,Fh(oe.buffers,Me.segments,l,d,oe.program,Fe,_,v,Ve,1)),Ve.u_is_halo=0}Fh(oe.buffers,Me.segments,l,d,oe.program,Fe,_,v,oe.uniformValues,1)}}}function Fh(d,i,l,p,_,v,b,D,T,M){let P=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,v,b,D,Kt.disabled,T,l.id,d.layoutVertexBuffer,d.indexBuffer,i,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),P,M)}function Ph(d,i,l,p,_,v,b){let D=d.context.gl,T=l.paint.get("fill-pattern"),M=T&&T.constantOr(1),P,k,N,L,H;b?(k=M&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=D.LINES):(k=M?"fillPattern":"fill",P=D.TRIANGLES);for(let G of p){let $=i.getTile(G);if(M&&!$.patternsLoaded())continue;let q=$.getBucket(l);if(!q)continue;d.prepareDrawTile();let Y=q.programConfigurations.get(l.id),re=d.isTileAffectedByFog(G),ie=d.getOrCreateProgram(k,{config:Y,overrideFog:re});M&&(d.context.activeTexture.set(D.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Y.updatePaintBuffers());let ae=T.constantOr(null);if(ae&&$.imageAtlas){let fe=$.imageAtlas.patternPositions[ae.toString()];fe&&Y.setConstantPatternPositions(fe)}let W=d.translatePosMatrix(G.projMatrix,$,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),K=l.paint.get("fill-emissive-strength");if(b){L=q.indexBuffer2,H=q.segments2;let fe=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];N=k==="fillOutlinePattern"&&M?Rs(W,K,d,$,fe):Cv(W,K,fe)}else L=q.indexBuffer,H=q.segments,N=M?ra(W,K,d,$):Dl(W,K);d.uploadCommonUniforms(d.context,ie,G.toUnwrapped()),ie.draw(d,P,_,d.stencilModeForClipping(G),v,Kt.disabled,N,l.id,q.layoutVertexBuffer,L,H,l.paint,d.transform.zoom,Y,void 0)}}function pt(d,i,l,p,_,v,b,D){l.resetLayerRenderingStats(d);let T=d.context,M=T.gl,P=d.transform,k=l.paint.get("fill-extrusion-pattern"),N=k.constantOr(1),L=l.paint.get("fill-extrusion-opacity"),H=d.style.enable3dLights(),G=l.paint.get(H&&!N?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],q=l.layout.get("fill-extrusion-edge-radius"),Y=q>0&&!l.paint.get("fill-extrusion-rounded-roof"),re=Y?0:q,ie=P.projection.name==="globe"?r.cM():0,ae=P.projection.name==="globe",W=ae?r.W(P.zoom):0,K=[r.a8(P.center.lng),r.ah(P.center.lat)],fe=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),he=l.paint.get("fill-extrusion-flood-light-intensity"),ve=l.paint.get("fill-extrusion-vertical-scale"),Ie=ta(d,l.paint.get("fill-extrusion-cutoff-fade-range")),ye=l.paint.get("fill-extrusion-emissive-strength"),Ae=[],Fe;ae&&Ae.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&Ae.push("FAUX_AO"),Y&&Ae.push("ZERO_ROOF_RADIUS"),D&&Ae.push("HAS_CENTROID"),he>0&&Ae.push("FLOOD_LIGHT"),Ie.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");let _e=d.renderPass==="shadow",De=d.shadowRenderer,Xe=_e&&!!De;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let be=[0,0,0];if(De){let oe=d.style.directionalLight,Ve=d.style.ambientLight;oe&&Ve&&(be=Gf(oe,Ve)),Fe=Ae.concat(["SHADOWS_SINGLE_CASCADE"])}let Se=Xe?"fillExtrusionDepth":N?"fillExtrusionPattern":"fillExtrusion",Me=l.getLayerRenderingStats();for(let oe of p){let Ve=i.getTile(oe),yt=Ve.getBucket(l);if(!yt||yt.projection.name!==P.projection.name)continue;let Mt=!1;De&&(Mt=De.getMaxCascadeForTile(oe.toUnwrapped())===0);let zt=d.isTileAffectedByFog(oe),Rt=yt.programConfigurations.get(l.id),jt=d.getOrCreateProgram(Se,{config:Rt,defines:Mt?Fe:Ae,overrideFog:zt});if(d.terrain&&d.terrain.setupElevationDraw(Ve,jt,{useMeterToDem:!0}),!yt.centroidVertexBuffer){let ei=jt.attributes.a_centroid_pos;ei!==void 0&&M.vertexAttrib2f(ei,0,0)}!_e&&De&&De.setupShadows(Ve.tileID.toUnwrapped(),jt,"vector-tile",Ve.tileID.overscaledZ),N&&(d.context.activeTexture.set(M.TEXTURE0),Ve.imageAtlasTexture&&Ve.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Rt.updatePaintBuffers());let En=k.constantOr(null);if(En&&Ve.imageAtlas){let ei=Ve.imageAtlas.patternPositions[En.toString()];ei&&Rt.setConstantPatternPositions(ei)}let nn=l.paint.get("fill-extrusion-vertical-gradient"),Pn;if(_e&&De){if(ks(Ve.tileID,yt,d))continue;let ei=De.calculateShadowPassMatrixFromTile(Ve.tileID.toUnwrapped());Pn=ts(ei,re,ve)}else{let ei=d.translatePosMatrix(oe.expandedProjMatrix,Ve,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),sr=P.projection.createInversionMatrix(P,oe.canonical);Pn=N?Hc(ei,d,nn,L,$,re,oe,Ve,ie,W,K,sr,fe,ve):Ih(ei,d,nn,L,$,re,oe,ie,W,K,sr,fe,ve,he,be,ye)}d.uploadCommonUniforms(T,jt,oe.toUnwrapped(),null,Ie);let An=yt.segments;if(P.projection.name==="mercator"&&!_e&&(An=yt.getVisibleSegments(Ve.tileID,d.terrain,d.transform.getFrustum(0)),!An.get().length))continue;if(Me)if(_e)for(let ei of An.get())Me.numRenderedVerticesInShadowPass+=ei.primitiveLength;else for(let ei of An.get())Me.numRenderedVerticesInTransparentPass+=ei.primitiveLength;let Fi=[];(d.terrain||D)&&Fi.push(yt.centroidVertexBuffer),ae&&Fi.push(yt.layoutVertexExtBuffer),jt.draw(d,T.gl.TRIANGLES,_,v,b,Kt.backCCW,Pn,l.id,yt.layoutVertexBuffer,yt.indexBuffer,An,l.paint,d.transform.zoom,Rt,Fi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function Na(d,i,l,p,_,v,b,D,T,M,P,k,N,L,H,G,$,q,Y){let re=d.context,ie=re.gl,ae=d.transform,W=d.transform.zoom,K=[],fe=ta(d,l.paint.get("fill-extrusion-cutoff-fade-range"));M==="clear"?(K.push("CLEAR_SUBPASS"),Y&&(K.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ie.TEXTURE0),Y.bind(ie.LINEAR,ie.CLAMP_TO_EDGE))):M==="sdf"&&K.push("SDF_SUBPASS"),$&&K.push("HAS_CENTROID"),fe.shouldRenderCutoff&&K.push("RENDER_CUTOFF");let he=l.layout.get("fill-extrusion-edge-radius"),ve=(Ie,ye,Ae,Fe,_e)=>{let De=ye.programConfigurations.get(l.id),Xe=d.isTileAffectedByFog(Ie),be=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:De,defines:K,overrideFog:Xe}),Se=((oe,Ve,yt,Mt,zt,Rt,jt,En,nn,Pn,An)=>({u_matrix:Ve,u_opacity:yt,u_ao_pass:Mt?1:0,u_meter_to_tile:zt,u_ao:Rt,u_flood_light_intensity:jt,u_flood_light_color:En,u_attenuation:nn,u_edge_radius:Pn,u_fb:0,u_fb_size:An}))(0,Fe,P,T,_e,[k,N*_e],L,H,G,W>=17?0:he*_e,Y?Y.size[0]:0),Me=[];$&&Me.push(ye.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(re,be,Ie.toUnwrapped(),null,fe),be.draw(d,re.gl.TRIANGLES,_,v,b,D,Se,l.id,ye.vertexBuffer,ye.indexBuffer,Ae,l.paint,W,De,Me)};for(let Ie of p){let ye=i.getTile(Ie),Ae=ye.getBucket(l);if(!Ae||Ae.projection.name!==ae.projection.name||!Ae.groundEffect||Ae.groundEffect&&!Ae.groundEffect.hasData())continue;let Fe=Ae.groundEffect,_e=1/Ae.tileToMeter;{let De=d.translatePosMatrix(Ie.projMatrix,ye,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Xe=Fe.getDefaultSegment();ve(Ie,Fe,Xe,De,_e)}if(q)for(let De=0;De<4;De++){let Xe=r.cN[De](Ie),be=i.getTile(Xe);if(!be)continue;let Se=be.getBucket(l);if(!Se||Se.projection.name!==ae.projection.name||!Se.groundEffect||Se.groundEffect&&!Se.groundEffect.hasData())continue;let Me=Se.groundEffect,oe,Ve;De===0?(oe=[-r.Y,0,0],Ve=1):De===1?(oe=[r.Y,0,0],Ve=0):De===2?(oe=[0,-r.Y,0],Ve=3):(oe=[0,r.Y,0],Ve=2);let yt=Me.regionSegments[Ve];if(!yt)continue;let Mt=new Float32Array(16);r.a9.translate(Mt,Ie.projMatrix,oe),ve(Ie,Me,yt,d.translatePosMatrix(Mt,ye,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),_e)}}}function np(d,i,l,p,_,v,b){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();let D=v?v.findDEMTileFor(l):null;if(!(D&&D.dem||b))return;let T=q=>new r.P(Math.ceil((q+r.cQ)*r.cR),0),M=q=>{let Y=i.getSource().minzoom,re=ae=>{let W=i.getTileByID(ae);if(W&&W.hasData())return W.getBucket(_)},ie=[0,-1,1];for(let ae of ie){if(q.overscaledZ+ae<Y)continue;let W=re(q.calculateScaledKey(q.overscaledZ+ae));if(W)return W}},P=[0,0,0],k=(q,Y)=>(P[0]=Math.min(q.min.y,Y.min.y),P[1]=Math.max(q.max.y,Y.max.y),P[2]=r.Y-Y.min.x>q.max.x?Y.min.x-r.Y:q.max.x,P),N=(q,Y)=>(P[0]=Math.min(q.min.x,Y.min.x),P[1]=Math.max(q.max.x,Y.max.x),P[2]=r.Y-Y.min.y>q.max.y?Y.min.y-r.Y:q.max.y,P),L=[(q,Y)=>k(q,Y),(q,Y)=>k(Y,q),(q,Y)=>N(q,Y),(q,Y)=>N(Y,q)],H=(q,Y,re,ie,ae,W,K)=>{if(!v)return 0;let fe=[[W?re:q,W?q:re,0],[W?re:Y,W?Y:re,0]],he=K<0?r.Y+K:K,ve=[W?he:(q+Y)/2,W?(q+Y)/2:he,0];return re===0&&K<0||re!==0&&K>0?v.getForTilePoints(ae,[ve],!0,ie):fe.push(ve),v.getForTilePoints(l,fe,!0,D),Math.max(fe[0][2],fe[1][2],ve[2])/v.exaggeration()};for(let q=0;q<4;q++){let Y=p.borderFeatureIndices[q];if(Y.length===0)continue;let re=r.cN[q](l),ie=M(re);if(!(ie&&ie instanceof r.cO)||p.borderDoneWithNeighborZ[q]===ie.canonical.z)continue;ie.centroidVertexArray.length===0&&ie.createCentroidsBuffer();let ae=v?v.findDEMTileFor(re):null;if(!(ae&&ae.dem||b))continue;let W=(q<2?1:5)-q,K=ie.borderDoneWithNeighborZ[W]!==p.canonical.z,fe=ie.borderFeatureIndices[W],he=0;if(p.canonical.z!==ie.canonical.z){for(let ve of Y)p.showCentroid(p.featuresOnBorder[ve]);if(K)for(let ve of fe)ie.showCentroid(ie.featuresOnBorder[ve]);p.borderDoneWithNeighborZ[q]=ie.canonical.z,ie.borderDoneWithNeighborZ[W]=p.canonical.z}for(let ve of Y){let Ie=p.featuresOnBorder[ve],ye=p.centroidData[Ie.centroidDataIndex],Ae=Ie.borders[q],Fe;for(;he<fe.length;){Fe=ie.featuresOnBorder[fe[he]];let _e=Fe.borders[W];if(_e[1]>Ae[0]+3||_e[0]>Ae[0]-3)break;ie.showCentroid(Fe),he++}if(Fe&&he<fe.length){let _e=he,De=0;for(;!(Fe.borders[W][0]>Ae[1]-3)&&(De++,++he!==fe.length);)Fe=ie.featuresOnBorder[fe[he]];if(Fe=ie.featuresOnBorder[fe[_e]],De>1){let Se=Fe.borders[W];Math.abs(Ae[0]-Se[0])<3&&Math.abs(Ae[1]-Se[1])<3&&(De=1,he=_e+1)}else if(De===0){p.showCentroid(Ie);continue}let Xe=ie.centroidData[Fe.centroidDataIndex];b&&De===1&&(((G=ye).flags|($=Xe).flags)&r.cP?(G.flags|=r.cP,$.flags|=r.cP):(G.flags&=~r.cP,$.flags&=~r.cP));let be=Ie.intersectsCount()>1||Fe.intersectsCount()>1;if(De>1)he=_e,ye.centroidXY=Xe.centroidXY=new r.P(0,0);else if(ae&&ae.dem&&!be){let Se=L[q](ye,Xe),Me=q%2?r.Y-1:0,oe=H(Se[0],Math.min(r.Y-1,Se[1]),Me,ae,re,q<2,Se[2]);ye.centroidXY=Xe.centroidXY=T(oe)}else be?ye.centroidXY=Xe.centroidXY=new r.P(0,0):(ye.centroidXY=p.encodeBorderCentroid(Ie),Xe.centroidXY=ie.encodeBorderCentroid(Fe));p.writeCentroidToBuffer(ye),ie.writeCentroidToBuffer(Xe)}else p.showCentroid(Ie)}p.borderDoneWithNeighborZ[q]=ie.canonical.z,ie.borderDoneWithNeighborZ[W]=p.canonical.z}var G,$;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(d)}let ip=[1,0,0],R0=[0,1,0],Oh=[0,0,1];function ks(d,i,l){let p=l.transform,_=l.shadowRenderer;if(!_)return!0;let v=d.toUnwrapped(),b=p.tileSize*_._cascades[l.currentShadowCascade].scale,D=i.maxHeight;if(p.elevation){let G=p.elevation.getMinMaxForTile(d);G&&(D+=G.max)}let T=[..._.shadowDirection];T[2]=-T[2];let M=_.computeSimplifiedTileShadowVolume(v,D,b,T);if(!M)return!1;let P=[ip,R0,Oh,T,[T[0],0,T[2]],[0,T[1],T[2]]],k=p.projection.name==="globe",N=p.scaleZoom(b),L=r.bt.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,N,!k),H=_.getCurrentCascadeFrustum();return L.intersectsPrecise(M.vertices,M.planes,P)===0||H.intersectsPrecise(M.vertices,M.planes,P)===0}function Rh(d){return[d[0]*r.cS,d[1]*r.cS,d[2]*r.cS,0]}function Bs(d,i,l,p,_,v,b,D,T){let M=p.getSource(),P=l.globeSharedBuffers;if(!P)return;let k,N,L;if(i&&(k=p.getTile(i)),M instanceof r.as?(N=M.texture,L=r.co(0,0,l.transform)):k&&i&&(N=k.texture,L=r.co(i.canonical.z,i.canonical.x,l.transform)),!N||!L)return;d||(L=r.a9.scale(r.a9.create(),L,[1,-1,1]));let H=l.context,G=H.gl,$=_.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,q=l.colorModeForDrapableLayerRenderPass(v),Y=b.defines;Y.push("GLOBE_POLES");let re=new Gt(G.LEQUAL,Gt.ReadWrite,l.depthRangeFor3D),ie=Float32Array.from(l.transform.expandedFarZProjMatrix),ae=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),H.activeTexture.set(G.TEXTURE0),N.bind($,G.CLAMP_TO_EDGE),H.activeTexture.set(G.TEXTURE1),N.bind($,G.CLAMP_TO_EDGE),N.useMipmap&&H.extTextureFilterAnisotropic&&l.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);let[W,K,fe,he]=i?P.getPoleBuffers(i.canonical.z,!1):P.getPoleBuffers(0,!0),ve=_.paint.get("raster-elevation"),Ie;d?(Ie=W,l.renderDefaultNorthPole=ve!==0):(Ie=K,l.renderDefaultSouthPole=ve!==0);let ye=Rh(b.mix),Ae=((_e,De,Xe,be,Se,Me,oe,Ve,yt,Mt,zt,Rt,jt)=>F0(_e,De,Xe,new Float32Array(16),new Float32Array(9),[0,0],be,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Me,[0,0],Ve,2,Mt,zt,Rt,1,0,jt))(ie,ae,L,r.W(l.transform.zoom),0,_,0,ve,0,ye,b.offset,b.range,v),Fe=l.getOrCreateProgram("raster",{defines:Y});l.uploadCommonUniforms(H,Fe,null),Fe.draw(l,G.TRIANGLES,re,T,q,D,Ae,_.id,Ie,fe,he)}function kh(d){let i=d._nearZ,l=d.projection.farthestPixelDistance(d),p=l-i,_=.2*d.height,v=i+_;return[i,l,(v-_-i)/p,(v-i)/p]}function El(d,i,l,p){if(d)return i instanceof lt&&d instanceof rh?i.getTextureDescriptor(d,l,!0):{texture:d.texture,mix:Rh(p.mix),offset:p.offset,buffer:0,tileSize:1}}function Fv(d,i,l){if(!d)return null;let p=i.getTextureDescriptor(d,l,!0);if(!p)return null;let{texture:_,mix:v,offset:b,tileSize:D,buffer:T,format:M}=p;if(!_||!M)return null;let P=!1;return M==="uint32"&&(P=!0,v[3]=0,v=$c(r.cT,v,[0,l.paint.get("raster-particle-max-speed")]),b=Yf(r.cT,b,[0,l.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[T/(D+2*T),D/(D+2*T)],tileSize:D,scalarData:P,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Pv(d){let i=d._nearZ,l=d.projection.farthestPixelDistance(d),p=l-i,_=.2*d.height,v=i+_;return[i,l,(v-_-i)/p,(v-i)/p]}let rp=new r.aA(1,0,0,1),Ov=new r.aA(0,1,0,1),k0=new r.aA(0,0,1,1),B0=new r.aA(1,0,1,1),op=new r.aA(0,1,1,1);function Al(d,i,l,p,_,v,b){let D=d.context,T=d.transform,M=D.gl,P=T.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],N=r.a9.clone(l.projMatrix);if(P&&r.W(T.zoom)>0){let ye=r.aV(l.canonical,T),Ae=r.cU(ye);N=r.a9.multiply(new Float32Array(16),T.globeMatrix,Ae),r.a9.multiply(N,T.projMatrix,N)}let L=r.a9.create();L[12]+=2*_/(r.f.devicePixelRatio*T.width),L[13]+=2*v/(r.f.devicePixelRatio*T.height),r.a9.multiply(N,L,N);let H=d.getOrCreateProgram("debug",{defines:k}),G=i.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(G,H);let $=Gt.disabled,q=on.disabled,Y=d.colorModeForRenderPass(),re="$debug";D.activeTexture.set(M.TEXTURE0),d.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),P?G._makeGlobeTileDebugBuffers(d.context,T):G._makeDebugTileBoundsBuffers(d.context,T.projection);let ie=G._tileDebugBuffer||d.debugBuffer,ae=G._tileDebugIndexBuffer||d.debugIndexBuffer,W=G._tileDebugSegments||d.debugSegments;if(H.draw(d,M.LINE_STRIP,$,q,Y,Kt.disabled,Qf(N,p),re,ie,ae,W,null,null,null,[G._globeTileDebugBorderBuffer]),b){let ye=G.latestRawTileData,Ae=Math.floor((ye&&ye.byteLength||0)/1024),Fe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Fe+=` => ${l.overscaledZ}`),Fe+=` ${G.state}`,Fe+=` ${Ae}kb`,function(_e,De){_e.initDebugOverlayCanvas();let Xe=_e.debugOverlayCanvas,be=_e.context.gl,Se=_e.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,Xe.width,Xe.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(De,5,5),Se.strokeText(De,5,5),_e.debugOverlayTexture.update(Xe),_e.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(d,Fe)}let K=i.getTile(l).tileSize,fe=512/Math.min(K,512)*(l.overscaledZ/T.zoom)*.5,he=G._tileDebugTextBuffer||d.debugBuffer,ve=G._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ie=G._tileDebugTextSegments||d.debugSegments;H.draw(d,M.TRIANGLES,$,q,_n.alphaBlended,Kt.disabled,Qf(N,r.aA.transparent,fe),re,he,ve,Ie,null,null,null,[G._globeTileDebugTextBuffer])}function N0(d,i,l,p){Bh(d,0,i+l/2,d.transform.width,l,p)}function L0(d,i,l,p){Bh(d,i-l/2,0,l,d.transform.height,p)}function Bh(d,i,l,p,_,v){let b=d.context,D=b.gl;D.enable(D.SCISSOR_TEST),D.scissor(i*r.f.devicePixelRatio,l*r.f.devicePixelRatio,p*r.f.devicePixelRatio,_*r.f.devicePixelRatio),b.clear({color:v}),D.disable(D.SCISSOR_TEST)}let U0=r.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rv}=U0;function ns(d,i,l,p){d.emplaceBack(i,l,p)}class z0{constructor(i){this.vertexArray=new r.cV,this.indices=new r.az,ns(this.vertexArray,-1,-1,1),ns(this.vertexArray,1,-1,1),ns(this.vertexArray,-1,1,1),ns(this.vertexArray,1,1,1),ns(this.vertexArray,-1,-1,-1),ns(this.vertexArray,1,-1,-1),ns(this.vertexArray,-1,1,-1),ns(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Rv),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.aE.simpleSegment(0,0,36,12)}}function La(d,i,l,p,_,v){let b=d.context.gl,D=i.paint.get("sky-atmosphere-color"),T=i.paint.get("sky-atmosphere-halo-color"),M=i.paint.get("sky-atmosphere-sun-intensity"),P=((k,N,L,H,G)=>({u_matrix_3f:k,u_sun_direction:N,u_sun_intensity:L,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(r.ct.fromMat4(r.ct.create(),p),_,M,D,T);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),l.draw(d,b.TRIANGLES,Gt.disabled,on.disabled,_n.unblended,Kt.frontCW,P,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}let sp=r.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Nh{constructor(i){let l=new r.cW;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let p=new r.az;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,sp.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=r.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let ap=r.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ua{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class lp{constructor(i){this.colorModeAlphaBlendedWriteRGB=new _n([1,nh,1,nh],r.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new _n([1,0,1,0],r.aA.transparent,[!1,!1,!1,!0]),this.params=new Ua,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){let l=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Nh(l);let p=this.params.sizeRange,_=this.params.intensityRange,v=function(P){let k=r.aC(30),N=[];for(let L=0;L<P;++L){let H=2*Math.PI*k(),G=Math.acos(1-2*k())-.5*Math.PI;N.push(r.Q.fromValues(Math.cos(G)*Math.cos(H),Math.cos(G)*Math.sin(H),Math.sin(G)))}return N}(this.params.starsCount),b=r.aC(300),D=new r.cX,T=new r.az,M=0;for(let P=0;P<v.length;++P){let k=r.Q.scale([],v[P],200),N=Math.max(0,1+.01*p*(1*b()-.5)),L=Math.max(0,1+.01*_*(1*b()-.5));D.emplaceBack(k[0],k[1],k[2],-1,-1,N,L),D.emplaceBack(k[0],k[1],k[2],1,-1,N,L),D.emplaceBack(k[0],k[1],k[2],1,1,N,L),D.emplaceBack(k[0],k[1],k[2],-1,1,N,L),T.emplaceBack(M+0,M+1,M+2),T.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=l.createVertexBuffer(D,ap.members),this.starsIdx=l.createIndexBuffer(T),this.starsSegments=r.aE.simpleSegment(0,0,D.length,T.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,l){let p=i.context,_=p.gl,v=i.transform,b=new Gt(_.LEQUAL,Gt.ReadOnly,[0,1]),D=r.W(v.zoom),T=l.properties.get("color").toArray01(),M=l.properties.get("high-color").toArray01(),P=l.properties.get("space-color").toArray01PremultipliedAlpha(),k=5e-4,N=r.cY(l.properties.get("horizon-blend"),0,1,k,.25),L=r.ci(i,p,v)&&N===k?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,H=i.frameCounter/1e3%1,G=r.Q.length(v.globeCenterInViewSpace),$=Math.sqrt(Math.pow(G,2)-Math.pow(L,2)),q=Math.acos($/G),Y=re=>{let ie=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ie.push("ALPHA_PASS");let ae=i.getOrCreateProgram("globeAtmosphere",{defines:ie}),W=((fe,he,ve,Ie,ye,Ae,Fe,_e,De,Xe,be,Se)=>({u_frustum_tl:fe,u_frustum_tr:he,u_frustum_br:ve,u_frustum_bl:Ie,u_horizon:ye,u_transition:Ae,u_fadeout_range:Fe,u_color:_e,u_high_color:De,u_space_color:Xe,u_temporal_offset:be,u_horizon_angle:Se}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,D,N,T,M,P,H,q);i.uploadCommonUniforms(p,ae);let K=this.atmosphereBuffer;K&&ae.draw(i,_.TRIANGLES,b,on.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Kt.backCW,W,re?"atmosphere_glow_alpha":"atmosphere_glow",K.vertexBuffer,K.indexBuffer,K.segments)};Y(!1),Y(!0)}drawStars(i,l){let p=r.ad(l.properties.get("star-intensity"),0,1);if(p===0)return;let _=i.context,v=_.gl,b=i.transform,D=i.getOrCreateProgram("stars"),T=r.bl.identity([]);r.bl.rotateX(T,T,-b._pitch),r.bl.rotateZ(T,T,-b.angle),r.bl.rotateX(T,T,r.bm(b._center.lat)),r.bl.rotateY(T,T,-r.bm(b._center.lng));let M=r.a9.fromQuat(new Float32Array(16),T),P=r.a9.multiply([],b.starsProjMatrix,M),k=r.ct.fromMat4([],M),N=r.ct.invert([],k),L=[0,1,0];r.Q.transformMat3(L,L,N),r.Q.scale(L,L,this.params.sizeMultiplier);let H=[1,0,0];r.Q.transformMat3(H,H,N),r.Q.scale(H,H,this.params.sizeMultiplier);let G=($=L,q=H,Y=p,{u_matrix:Float32Array.from(P),u_up:$,u_right:q,u_intensity_multiplier:Y});var $,q,Y;i.uploadCommonUniforms(_,D),this.starsVx&&this.starsIdx&&D.draw(i,v.TRIANGLES,Gt.disabled,on.disabled,this.colorModeAlphaBlendedWriteRGB,Kt.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function cp(d,i){let l=[...d],p=i.cameraWorldSizeForFog/i.worldSize,_=r.a9.identity([]);return r.a9.scale(_,_,[p,p,1]),r.a9.multiply(l,_,l),r.a9.multiply(l,i.worldToFogMatrix,l),l}function sa(d,i,l,p){let _=l.material,v=p.context,{baseColorTexture:b,metallicRoughnessTexture:D}=_.pbrMetallicRoughness,{normalTexture:T,occlusionTexture:M,emissionTexture:P}=_;function k(N,L,H){if(N&&(d.push(L),v.activeTexture.set(v.gl.TEXTURE0+H),N.gfxTexture)){let{minFilter:G,magFilter:$,wrapS:q,wrapT:Y}=N.sampler;N.gfxTexture.bindExtraParam(G,$,q,Y)}}k(b,"HAS_TEXTURE_u_baseColorTexture",ao.BaseColor),k(D,"HAS_TEXTURE_u_metallicRoughnessTexture",ao.MetallicRoughness),k(T,"HAS_TEXTURE_u_normalTexture",ao.Normal),k(M,"HAS_TEXTURE_u_occlusionTexture",ao.Occlusion),k(P,"HAS_TEXTURE_u_emissionTexture",ao.Emission),l.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(l.texcoordBuffer)),l.colorBuffer&&(d.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(l.colorBuffer)),l.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(l.normalBuffer)),l.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(l.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function aa(d,i,l,p,_,v){let b=l.paint.get("model-opacity"),D=i.context,T=new Gt(i.context.gl.LEQUAL,Gt.ReadWrite,i.depthRangeFor3D),M=i.transform,P=d.mesh,k=P.material,N=k.pbrMetallicRoughness,L=i.style.fog,H;H=i.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.a9.multiply([],p.zScaleMatrix,d.nodeModelMatrix),r.a9.multiply(H,p.negCameraPosMatrix,H);let G=r.a9.invert([],H);r.a9.transpose(G,G);let $=l.paint.get("model-emissive-strength").constantOr(0),q=Mh(new Float32Array(d.worldViewProjection),new Float32Array(H),new Float32Array(G),null,i,b,N.baseColorFactor,k.emissiveFactor,N.metallicFactor,N.roughnessFactor,k,$,l),Y={defines:[]},re=[];sa(Y.defines,re,P,i);let ie=i.shadowRenderer;ie&&(ie.useNormalOffset=!1);let ae=null;if(L){let fe=cp(d.nodeModelMatrix,i.transform);if(ae=new Float32Array(fe),M.projection.name!=="globe"){let he=P.aabb.min,ve=P.aabb.max,[Ie,ye]=L.getOpacityForBounds(fe,he[0],he[1],ve[0],ve[1]);Y.overrideFog=Ie>=Vn||ye>=Vn}}let W=ta(i,l.paint.get("model-cutoff-fade-range"));W.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");let K=i.getOrCreateProgram("model",Y);i.uploadCommonUniforms(D,K,null,ae,W),i.renderPass!=="shadow"&&ie&&ie.setupShadowsFromMatrix(d.nodeModelMatrix,K),K.draw(i,D.gl.TRIANGLES,T,_,v,P.material.doubleSided?Kt.disabled:Kt.backCCW,q,l.id,P.vertexBuffer,P.indexBuffer,P.segments,l.paint,i.transform.zoom,void 0,re)}function Xc(d,i,l,p,_,v,b){let D;D=d.projection.name==="globe"?r.c_(l,d):[...l],r.a9.multiply(D,D,i.matrix);let T=r.a9.multiply([],p,D);if(i.meshes)for(let M of i.meshes){if(M.material.alphaMode!=="BLEND"){b.push({mesh:M,depth:0,modelIndex:_,worldViewProjection:T,nodeModelMatrix:D});continue}let P=r.Q.transformMat4([],M.centroid,T);P[2]>0&&v.push({mesh:M,depth:P[2],modelIndex:_,worldViewProjection:T,nodeModelMatrix:D})}if(i.children)for(let M of i.children)Xc(d,M,l,p,_,v,b)}function Kc(d,i,l,p){let _=l.shadowRenderer;if(!_)return;let v=_.getShadowPassDepthMode(),b=_.getShadowPassColorMode(),D=_.calculateShadowPassMatrixFromMatrix(i),T=P0(D);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,on.disabled,b,Kt.backCCW,T,p.id,d.vertexBuffer,d.indexBuffer,d.segments,p.paint,l.transform.zoom,void 0,void 0)}function Jc(d,i,l){let p=i.updateZoomBasedPaintProperties(),_=function(v,b,D){let T,M,P,k=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&k>0){let N=v.terrain,L=N.findDEMTileFor(D);L&&L.dem?T=r.d0.create(N,D,L):k=0}if(k===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),k===b.validForExaggeration&&(k===0||T&&T._demTile&&T._demTile.tileID===b.validForDEMTile.id&&T._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let N in b.instancesPerModel){let L=b.instancesPerModel[N];for(let H=0;H<L.instancedDataArray.length;++H){let G=(T?k*T.getElevationAt(0|L.instancedDataArray.float32[16*H],0|L.instancedDataArray.float32[16*H+1],!0,!0):0)+L.instancesEvaluatedElevation[H];L.instancedDataArray.float32[16*H+6]=G,M=M?Math.min(b.terrainElevationMin,G):G,P=P?Math.max(b.terrainElevationMax,G):G}}return b.terrainElevationMin=M||0,b.terrainElevationMax=P||0,b.validForExaggeration=k,b.validForDEMTile=T&&T._demTile?{id:T._demTile.tileID,timestamp:T._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,i,l);(p||_)&&(i.uploaded=!1,i.upload(d.context))}let Do={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bV([0,0,0],[r.Y,r.Y,0])};function Lh(d,i){let l=1<<d.canonical.z,p=i.getFreeCameraOptions().position,_=i.elevation,v=d.canonical.x/l,b=(d.canonical.x+1)/l,D=d.canonical.y/l,T=(d.canonical.y+1)/l,M=i._centerAltitude;if(_){let L=_.getMinMaxForTile(d);L&&L.max>M&&(M=L.max)}let P=r.ad(p.x,v,b)-p.x,k=r.ad(p.y,D,T)-p.y,N=r.bo(M,i.center.lat)-p.z;return i._zoomFromMercatorZ(Math.sqrt(P*P+k*k+N*N))}function Uh(d,i,l,p,_,v,b){let D=d.context,T=d.renderPass==="shadow",M=d.shadowRenderer,P=T&&M?M.getShadowPassDepthMode():new Gt(D.gl.LEQUAL,Gt.ReadWrite,d.depthRangeFor3D),k=d.isTileAffectedByFog(v);if(l.meshes)for(let N of l.meshes){let L=["MODEL_POSITION_ON_GPU"],H=[],G,$,q;p.instancedDataArray.length>20&&L.push("INSTANCED_ARRAYS");let Y=ta(d,i.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),T&&M)G=d.getOrCreateProgram("modelDepth",{defines:L}),$=P0(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(l.matrix)),q=M.getShadowPassColorMode();else{sa(L,H,N,d),G=d.getOrCreateProgram("model",{defines:L,overrideFog:k});let ie=N.material,ae=ie.pbrMetallicRoughness,W=i.paint.get("model-opacity"),K=i.paint.get("model-emissive-strength").constantOr(0);$=Mh(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,d,W,ae.baseColorFactor,ie.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,ie,K,i,_),M&&(b.shadowUniformsInitialized?G.setShadowUniformValues(D,M.getShadowUniformValues()):(M.setupShadows(v.toUnwrapped(),G,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),q=Y.shouldRenderCutoff||W<1||ie.alphaMode!=="OPAQUE"?_n.alphaBlended:_n.unblended}d.uploadCommonUniforms(D,G,v.toUnwrapped(),null,Y);let re=N.material.doubleSided?Kt.disabled:Kt.backCCW;if(p.instancedDataArray.length>20)H.push(p.instancedDataBuffer),G.draw(d,D.gl.TRIANGLES,P,on.disabled,q,re,$,i.id,N.vertexBuffer,N.indexBuffer,N.segments,i.paint,d.transform.zoom,void 0,H,p.instancedDataArray.length);else{let ie=T?"u_instance":"u_normal_matrix";for(let ae=0;ae<p.instancedDataArray.length;++ae)$[ie]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ae,16),G.draw(d,D.gl.TRIANGLES,P,on.disabled,q,re,$,i.id,N.vertexBuffer,N.indexBuffer,N.segments,i.paint,d.transform.zoom,void 0,H)}}if(l.children)for(let N of l.children)Uh(d,i,N,p,_,v,b)}let zh=[1,-1,1];function eu(d,i,l,p){if(!l.modelManager)return!0;let _=l.modelManager;if(!l.shadowRenderer)return!0;let v=l.shadowRenderer,b=i.aabb,D=!0,T=d.maxHeight;if(T===0){let P=0;for(let k in d.instancesPerModel){let N=_.getModel(k,p);N?P=Math.max(P,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):D=!1}T=d.maxScale*P*1.41+d.maxVerticalOffset,D&&(d.maxHeight=T)}b.max[2]=T,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,r.Q.transformMat4(b.min,b.min,i.tileMatrix),r.Q.transformMat4(b.max,b.max,i.tileMatrix);let M=b.intersects(v.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=M===2),M===0}class V0{}class j0{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,l,p){{let k=this._storage.get(l.id);if(k)return k.lastUsedFrameIdx=i,k.buf}let _=p.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),b=new ArrayBuffer(v),D=new Int16Array(b);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let T=new r.d2;for(let k=0;k<v/2;k+=3){let N=D[k],L=D[k+1],H=D[k+2];T.emplaceBack(N,L),T.emplaceBack(L,H),T.emplaceBack(H,N)}let M=p.bindVertexArrayOES.current,P=new V0;return P.buf=new ji(p,T),P.lastUsedFrameIdx=i,this._storage.set(l.id,P),p.bindVertexArrayOES.set(M),P.buf}update(i){for(let[l,p]of this._storage)i-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(let[i,l]of this._storage)l.buf.destroy(),this._storage.delete(i)}}let Vh={symbol:function(d,i,l,p,_){if(d.renderPass!=="translucent")return;let v=on.disabled,b=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(M,P,k,N,L,H,G){let $=P.transform,q=L==="map",Y=H==="map";for(let re of M){let ie=N.getTile(re),ae=ie.getBucket(k);if(!ae||!ae.text||!ae.text.segments.get().length)continue;let W=r.b8(ae.textSizeData,$.zoom),K=hh(re,ae.getProjection(),$),fe=$.calculatePixelsToTileUnitsMatrix(ie),he=Tc(K,ie.tileID.canonical,Y,q,$,ae.getProjection(),fe),ve=ae.hasIconTextFit()&&ae.hasIconData();if(W){let Ie=Math.pow(2,$.zoom-ie.tileID.overscaledZ);O0(ae,q,Y,G,r.cE,$,he,re,Ie,W,ve)}}}(p,d,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_);let D=l.paint.get("icon-opacity").constantOr(1)!==0,T=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||T)?Yc(d,i,l,p,v,b):(D&&Yc(d,i,l,p,v,b,{onlyIcons:!0}),T&&Yc(d,i,l,p,v,b,{onlyText:!0})),i.map.showCollisionBoxes&&(ep(d,i,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ep(d,i,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,l,p){if(d.renderPass!=="translucent")return;let _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),D=l.layout.get("circle-sort-key").constantOr(1)!==void 0,T=l.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;let M=d.context,P=M.gl,k=d.transform,N=d.depthModeForSublayer(0,Gt.ReadOnly),L=on.disabled,H=d.colorModeForDrapableLayerRenderPass(T),G=k.projection.name==="globe",$=[r.a8(k.center.lng),r.ah(k.center.lat)],q=[];for(let re=0;re<p.length;re++){let ie=p[re],ae=i.getTile(ie),W=ae.getBucket(l);if(!W||W.projection.name!==k.projection.name)continue;let K=W.programConfigurations.get(l.id),fe=r.cF(l),he=d.isTileAffectedByFog(ie);G&&fe.push("PROJECTION_GLOBE_VIEW");let ve=d.getOrCreateProgram("circle",{config:K,defines:fe,overrideFog:he}),Ie=W.layoutVertexBuffer,ye=W.globeExtVertexBuffer,Ae=W.indexBuffer,Fe=k.projection.createInversionMatrix(k,ie.canonical),_e={programConfiguration:K,program:ve,layoutVertexBuffer:Ie,globeExtVertexBuffer:ye,indexBuffer:Ae,uniformValues:r.cG(d,ie,ae,Fe,$,l),tile:ae};if(D){let De=W.segments.get();for(let Xe of De)q.push({segments:new r.aE([Xe]),sortKey:Xe.sortKey,state:_e})}else q.push({segments:W.segments,sortKey:0,state:_e})}D&&q.sort((re,ie)=>re.sortKey-ie.sortKey);let Y={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(let re of q){let{programConfiguration:ie,program:ae,layoutVertexBuffer:W,globeExtVertexBuffer:K,indexBuffer:fe,uniformValues:he,tile:ve}=re.state,Ie=re.segments;d.terrain&&d.terrain.setupElevationDraw(ve,ae,Y),d.uploadCommonUniforms(M,ae,ve.tileID.toUnwrapped()),ae.draw(d,P.TRIANGLES,N,L,H,Kt.disabled,he,l.id,W,fe,Ie,l.paint,k.zoom,ie,[K])}},heatmap:function(d,i,l,p){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let _=d.context,v=_.gl,b=on.disabled,D=new _n([v.ONE,v.ONE,v.ONE,v.ONE],r.aA.transparent,[!0,!0,!0,!0]);(function(L,H,G,$){let q=L.gl,Y=H.width*$,re=H.height*$;L.activeTexture.set(q.TEXTURE1),L.viewport.set([0,0,Y,re]);let ie=G.heatmapFbo;if(!ie||ie&&(ie.width!==Y||ie.height!==re)){ie&&ie.destroy();let ae=q.createTexture();q.bindTexture(q.TEXTURE_2D,ae),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ie=G.heatmapFbo=L.createFramebuffer(Y,re,!0,null),function(W,K,fe,he,ve,Ie){let ye=W.gl;ye.texImage2D(ye.TEXTURE_2D,0,W.extRenderToTextureHalfFloat?ye.RGBA16F:ye.RGBA,ve,Ie,0,ye.RGBA,W.extRenderToTextureHalfFloat?ye.HALF_FLOAT:ye.UNSIGNED_BYTE,null),he.colorAttachment.set(fe)}(L,0,ae,ie,Y,re)}else q.bindTexture(q.TEXTURE_2D,ie.colorAttachment.get()),L.bindFramebuffer.set(ie.framebuffer)})(_,d,l,d.transform.projection.name==="globe"?.5:.25),_.clear({color:r.aA.transparent});let T=d.transform,M=T.projection.name==="globe",P=M?["PROJECTION_GLOBE_VIEW"]:[],k=M?Kt.frontCCW:Kt.disabled,N=[r.a8(T.center.lng),r.ah(T.center.lat)];for(let L=0;L<p.length;L++){let H=p[L];if(i.hasRenderableParent(H))continue;let G=i.getTile(H),$=G.getBucket(l);if(!$||$.projection.name!==T.projection.name)continue;let q=d.isTileAffectedByFog(H),Y=$.programConfigurations.get(l.id),re=d.getOrCreateProgram("heatmap",{config:Y,defines:P,overrideFog:q}),{zoom:ie}=d.transform;d.terrain&&d.terrain.setupElevationDraw(G,re),d.uploadCommonUniforms(_,re,H.toUnwrapped());let ae=T.projection.createInversionMatrix(T,H.canonical);re.draw(d,v.TRIANGLES,Gt.disabled,b,D,k,Av(d,H,G,ae,N,ie,l.paint.get("heatmap-intensity")),l.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,l.paint,d.transform.zoom,Y,M?[$.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){let b=_.context,D=b.gl,T=v.heatmapFbo;if(!T)return;b.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,T.colorAttachment.get()),b.activeTexture.set(D.TEXTURE1);let M=v.colorRampTexture;M||(M=v.colorRampTexture=new r.T(b,v.colorRamp,D.RGBA)),M.bind(D.LINEAR,D.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,D.TRIANGLES,Gt.disabled,on.disabled,_.colorModeForRenderPass(),Kt.disabled,((P,k,N,L)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,l))},line:function(d,i,l,p){if(d.renderPass!=="translucent")return;let _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;let b=l.paint.get("line-emissive-strength"),D=d.depthModeForSublayer(0,Gt.ReadOnly),T=d.colorModeForDrapableLayerRenderPass(b),M=d.terrain&&d.terrain.renderingToTexture?1:r.f.devicePixelRatio,P=l.paint.get("line-dasharray"),k=P.constantOr(1),N=l.layout.get("line-cap"),L=l.paint.get("line-pattern"),H=L.constantOr(1),G=l.paint.get("line-opacity").constantOr(1)!==1,$=!H&&G,q=l.paint.get("line-gradient"),Y=H?"linePattern":"line",re=d.context,ie=re.gl,ae=r.cH(l);d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&($=!1);for(let W of p){let K=i.getTile(W);if(H&&!K.patternsLoaded())continue;let fe=K.getBucket(l);if(!fe)continue;d.prepareDrawTile();let he=fe.programConfigurations.get(l.id),ve=d.isTileAffectedByFog(W),Ie=d.getOrCreateProgram(Y,{config:he,defines:ae,overrideFog:ve}),ye=L.constantOr(null);if(ye&&K.imageAtlas){let Me=K.imageAtlas.patternPositions[ye.toString()];Me&&he.setConstantPatternPositions(Me)}let Ae=P.constantOr(null),Fe=N.constantOr(null);if(!H&&Ae&&Fe&&K.lineAtlas){let Me=K.lineAtlas.getDash(Ae,Fe);Me&&he.setConstantPatternPositions(Me)}let[_e,De]=l.paint.get("line-trim-offset");(Fe==="round"||Fe==="square")&&_e!==De&&(_e===0&&(_e-=1),De===1&&(De+=1));let Xe=d.terrain?W.projMatrix:null,be=H?r.cI(d,K,l,Xe,M,[_e,De]):r.cJ(d,K,l,Xe,fe.lineClipsArray.length,M,[_e,De]);if(q){let Me=fe.gradients[l.id],oe=Me.texture;if(l.gradientVersion!==Me.version){let Ve=256;if(l.stepInterpolant){let yt=i.getSource().maxzoom,Mt=W.canonical.z===yt?Math.ceil(1<<d.transform.maxZoom-W.canonical.z):1;Ve=r.ad(r.cK(fe.maxLineLength/r.Y*1024*Mt),256,re.maxTextureSize)}Me.gradient=r.cL({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ve,image:Me.gradient||void 0,clips:fe.lineClipsArray}),Me.texture?Me.texture.update(Me.gradient):Me.texture=new r.T(re,Me.gradient,ie.RGBA),Me.version=l.gradientVersion,oe=Me.texture}re.activeTexture.set(ie.TEXTURE1),oe.bind(l.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}k&&(re.activeTexture.set(ie.TEXTURE0),K.lineAtlasTexture&&K.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),he.updatePaintBuffers()),H&&(re.activeTexture.set(ie.TEXTURE0),K.imageAtlasTexture&&K.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),he.updatePaintBuffers()),d.uploadCommonUniforms(re,Ie,W.toUnwrapped());let Se=Me=>{Ie.draw(d,ie.TRIANGLES,D,Me,T,Kt.disabled,be,l.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,l.paint,d.transform.zoom,he,[fe.layoutVertexBuffer2,fe.patternVertexBuffer])};if($){let Me=d.stencilModeForClipping(W).ref;Me===0&&d.terrain&&re.clear({stencil:0});let oe={func:ie.EQUAL,mask:255};be.u_alpha_discard_threshold=.8,Se(new on(oe,Me,255,ie.KEEP,ie.KEEP,ie.INVERT)),be.u_alpha_discard_threshold=0,Se(new on(oe,Me,255,ie.KEEP,ie.KEEP,ie.KEEP))}else Se(d.stencilModeForClipping(W))}$&&(d.resetStencilClippingMasks(),d.terrain&&re.clear({stencil:0}))},fill:function(d,i,l,p){let _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let b=l.paint.get("fill-emissive-strength"),D=d.colorModeForDrapableLayerRenderPass(b),T=l.paint.get("fill-pattern"),M=d.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(r.aA.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===M){let P=d.depthModeForSublayer(1,d.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly);Ph(d,i,l,p,P,D,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){let P=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly);Ph(d,i,l,p,P,D,!0)}},"fill-extrusion":function(d,i,l,p){let _=l.paint.get("fill-extrusion-opacity"),v=d.context,b=v.gl,D=d.terrain,T=D&&D.renderingToTexture;if(_===0)return;let M=d.conflationActive&&d.layerUsedInConflation(l,i.getSource());if(M&&function(P,k,N,L){for(let H of L){let G=k.getTile(H).getBucket(N);G&&(G.updateReplacement(H,P.replacementSource),G.uploadCentroid(P.context))}}(d,i,l,p),D||M)for(let P of p){let k=i.getTile(P).getBucket(l);k&&np(d.context,i,P,k,l,D,M)}if(d.renderPass==="shadow"&&d.shadowRenderer){let P=d.shadowRenderer;if(D&&_<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let k=P.getShadowPassDepthMode(),N=P.getShadowPassColorMode();pt(d,i,l,p,k,on.disabled,N,M)}else if(d.renderPass==="translucent"){let P=!l.paint.get("fill-extrusion-pattern").constantOr(1),k=l.paint.get("fill-extrusion-color").constantOr(r.aA.white);if(!T&&k.a!==0){let N=new Gt(d.context.gl.LEQUAL,Gt.ReadWrite,d.depthRangeFor3D);_===1&&P?pt(d,i,l,p,N,on.disabled,_n.unblended,M):(pt(d,i,l,p,N,on.disabled,_n.disabled,M),pt(d,i,l,p,N,d.stencilModeFor3D(),d.colorModeForRenderPass(),M),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&P&&(!D&&d.transform.projection.name!=="globe"||T)){let N=l.paint.get("fill-extrusion-opacity"),L=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=l.paint.get("fill-extrusion-flood-light-intensity"),$=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),q=L>0&&H>0,Y=G>0,re=(ae,W,K)=>(1-K)*ae+K*W,ie=ae=>{let W=d.depthModeForSublayer(1,Gt.ReadOnly,b.LEQUAL,!0),K=l.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),fe=re(.1,3,K),he=d._showOverdrawInspector;if(!he){let ve=new on({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ie=new _n([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Na(d,i,l,p,W,ve,Ie,Kt.disabled,ae,"sdf",N,L,H,G,$,fe,M,!1)}{let ve=he?on.disabled:new on({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ie=he?d.colorModeForRenderPass():new _n([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.aA.transparent,[!0,!0,!0,!0]);Na(d,i,l,p,W,ve,Ie,Kt.disabled,ae,"color",N,L,H,G,$,fe,M,!1)}};if(T){let ae=(W,K,fe)=>{let he=d.depthModeForSublayer(1,Gt.ReadOnly,b.LEQUAL,!1),ve=l.paint.get(W?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ie=re(.1,3,ve);{let ye=new _n([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0]);Na(d,i,l,p,he,on.disabled,ye,Kt.disabled,W,"clear",N,L,H,G,$,Ie,M,K)}{let ye=new on({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ae=new _n([b.ONE,b.ONE,b.ONE,b.ONE],r.aA.transparent,[!1,!1,!1,!0],b.MIN);Na(d,i,l,p,he,ye,Ae,Kt.disabled,W,"sdf",N,L,H,G,$,Ie,M,K)}{let ye=W?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ae=new on({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Fe=new _n([ye,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.aA.transparent,[!0,!0,!0,!0]);Na(d,i,l,p,he,Ae,Fe,Kt.disabled,W,"color",N,L,H,G,$,Ie,M,K)}{let ye=new _n([b.ONE,b.ONE,b.ONE,W?b.ZERO:b.ONE],r.aA.transparent,[!1,!1,!1,!0],W?b.FUNC_ADD:b.MAX);Na(d,i,l,p,he,on.disabled,ye,Kt.disabled,W,"clear",N,L,H,G,$,Ie,M,K,fe)}};if(q||Y){let W;if(d.prepareDrawTile(),D){let K=D.drapeBufferSize[0],fe=D.drapeBufferSize[1];W=D.framebufferCopyTexture,W&&(!W||W.size[0]===K&&W.size[1]===fe)||(W&&W.destroy(),W=D.framebufferCopyTexture=new r.T(v,new r.h({width:K,height:fe}),b.RGBA)),W.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,0,0,K,fe,0)}q&&ae(!0,!1,W),Y&&ae(!1,!0,W)}}else q&&ie(!0),Y&&ie(!1)}}},hillshade:function(d,i,l,p){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let _=d.context,v=d.terrain&&d.terrain.renderingToTexture,[b,D]=d.renderPass!=="translucent"||v?[{},p]:d.stencilConfigForOverlap(p);for(let T of D){let M=i.getTile(T);if(M.needsHillshadePrepare&&d.renderPass==="offscreen")vl(d,M,l);else if(d.renderPass==="translucent"){let P=d.depthModeForSublayer(0,Gt.ReadOnly),k=l.paint.get("hillshade-emissive-strength"),N=d.colorModeForDrapableLayerRenderPass(k),L=v&&d.terrain?d.terrain.stencilModeForRTTOverlap(T):b[T.overscaledZ];Zn(d,T,M,l,P,L,N)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,l,p,_,v){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;let b=d.transform.projection.name==="globe",D=l.paint.get("raster-elevation")!==0,T=D&&b;if(d.renderElevatedRasterBackface&&!T)return;let M=d.context,P=M.gl,k=i.getSource(),N=function(W,K,fe,he){let ve=K.paint.get("raster-color"),Ie=W.type==="raster-array",ye=[],Ae=K.paint.get("raster-resampling"),Fe=K.paint.get("raster-color-mix"),_e=K.paint.get("raster-color-range"),De=[Fe[0],Fe[1],Fe[2],0],Xe=Fe[3],be=Ae==="nearest"?he.NEAREST:he.LINEAR;if(Ie&&(ye.push("RASTER_ARRAY"),ve||ye.push("RASTER_COLOR"),Ae==="linear"&&ye.push("RASTER_ARRAY_LINEAR"),be=he.NEAREST,!_e&&W.rasterLayers)){let Se=W.rasterLayers.find(({id:Me})=>Me===K.sourceLayer);Se&&Se.fields&&Se.fields.range&&(_e=Se.fields.range)}if(_e=_e||[0,1],ve){ye.push("RASTER_COLOR"),fe.activeTexture.set(he.TEXTURE2),K.updateColorRamp(_e);let Se=K.colorRampTexture;Se||(Se=K.colorRampTexture=new r.T(fe,K.colorRamp,he.RGBA)),Se.bind(he.LINEAR,he.CLAMP_TO_EDGE)}return{mix:De,range:_e,offset:Xe,defines:ye,resampling:be}}(k,l,M,P);if(k instanceof r.as&&!p.length&&!b)return;let L=l.paint.get("raster-emissive-strength"),H=d.colorModeForDrapableLayerRenderPass(L),G=d.terrain&&d.terrain.renderingToTexture,$=!d.options.moving,q=l.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(k instanceof r.as&&!p.length&&(k.onNorthPole||k.onSouthPole)){let W=D?d.stencilModeFor3D():on.disabled;return void Bs(!!k.onNorthPole,null,d,i,l,L,N,Kt.disabled,W)}if(!p.length)return;let[Y,re]=k instanceof r.as||G?[{},p]:d.stencilConfigForOverlap(p),ie=re[re.length-1].overscaledZ;T&&N.defines.push("PROJECTION_GLOBE_VIEW"),D&&N.defines.push("RENDER_CUTOFF");let ae=(W,K,fe)=>{for(let he of W){let ve=he.toUnwrapped(),Ie=i.getTile(he);if(G&&(!Ie||!Ie.hasData()))continue;M.activeTexture.set(P.TEXTURE0);let ye=El(Ie,k,l,N);if(!ye||!ye.texture)continue;let{texture:Ae,mix:Fe,offset:_e,tileSize:De,buffer:Xe}=ye,be,Se;G?(be=Gt.disabled,Se=he.projMatrix):D?(be=new Gt(P.LEQUAL,Gt.ReadWrite,d.depthRangeFor3D),Se=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(ve,$)):(be=d.depthModeForSublayer(he.overscaledZ-ie,l.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,P.LESS),Se=d.transform.calculateProjMatrix(ve,$));let Me=d.terrain&&G?d.terrain.stencilModeForRTTOverlap(he):Y[he.overscaledZ],oe=v?0:l.paint.get("raster-fade-duration");Ie.registerFadeDuration(oe);let Ve=i.findLoadedParent(he,0),yt=Ra(Ie,Ve,i,d.transform,oe),Mt,zt;d.terrain&&d.terrain.prepareDrawTile(),M.activeTexture.set(P.TEXTURE0),Ae.bind(q,P.CLAMP_TO_EDGE),M.activeTexture.set(P.TEXTURE1),Ve?(Ve.texture&&Ve.texture.bind(q,P.CLAMP_TO_EDGE),Mt=Math.pow(2,Ve.tileID.overscaledZ-Ie.tileID.overscaledZ),zt=[Ie.tileID.canonical.x*Mt%1,Ie.tileID.canonical.y*Mt%1]):Ae.bind(q,P.CLAMP_TO_EDGE),Ae.useMipmap&&M.extTextureFilterAnisotropic&&d.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);let Rt=d.transform,jt,En=D?kh(Rt):[0,0,0,0],nn,Pn,An,Fi,ei,sr=0;if(T&&k instanceof r.as&&k.coordinates.length>3)nn=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0)))),Pn=Float32Array.from(Rt.globeMatrix),An=Float32Array.from(r.cj(Rt)),Fi=[r.a8(Rt.center.lng),r.ah(Rt.center.lat)],jt=k.elevatedGlobePerspectiveTransform,ei=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(T){let dn=r.ck(he.canonical);sr=r.cl(dn.getCenter().lat),nn=Float32Array.from(r.aW(r.cn(he.canonical))),Pn=Float32Array.from(Rt.globeMatrix),An=Float32Array.from(r.cj(Rt)),Fi=[r.a8(Rt.center.lng),r.ah(Rt.center.lat)],jt=[0,0],ei=Float32Array.from(r.cm(he.canonical,dn,sr,Rt.worldSize/Rt._pixelsPerMercatorPixel))}else jt=k instanceof r.as?k.perspectiveTransform:[0,0],nn=new Float32Array(16),Pn=new Float32Array(9),An=new Float32Array(16),Fi=[0,0],ei=new Float32Array(9);let Ji=F0(Se,nn,Pn,An,ei,zt||[0,0],r.W(d.transform.zoom),Fi,En,Mt||1,yt,l,jt,D?l.paint.get("raster-elevation"):0,2,Fe,_e,N.range,De,Xe,L),gi=d.isTileAffectedByFog(he),ai=d.getOrCreateProgram("raster",{defines:N.defines,overrideFog:gi});if(d.uploadCommonUniforms(M,ai,ve),k instanceof r.as){let dn=k.elevatedGlobeVertexBuffer,pn=k.elevatedGlobeIndexBuffer;if(G||!b)k.boundsBuffer&&k.boundsSegments&&ai.draw(d,P.TRIANGLES,be,on.disabled,H,Kt.disabled,Ji,l.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments);else if(dn&&pn){let Ci=Rt.zoom<=r.bJ?k.elevatedGlobeSegments:k.getSegmentsForLongitude(Rt.center.lng);Ci&&ai.draw(d,P.TRIANGLES,be,on.disabled,H,K,Ji,l.id,dn,pn,Ci)}}else if(T){be=new Gt(P.LEQUAL,Gt.ReadOnly,d.depthRangeFor3D);let dn=d.globeSharedBuffers;if(dn){let[pn,Ci,_i]=dn.getGridBuffers(sr,!1);ai.draw(d,P.TRIANGLES,be,fe||Me,d.colorModeForRenderPass(),K,Ji,l.id,pn,Ci,_i)}}else{let{tileBoundsBuffer:dn,tileBoundsIndexBuffer:pn,tileBoundsSegments:Ci}=d.getTileBoundsBuffers(Ie);ai.draw(d,P.TRIANGLES,be,Me,H,Kt.disabled,Ji,l.id,dn,pn,Ci)}}if(!(k instanceof r.as)&&T)for(let he of W){let ve=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&Bs(!0,he,d,i,l,L,N,K,fe||on.disabled),ve&&Bs(!1,he,d,i,l,L,N,K===Kt.frontCW?Kt.backCW:Kt.frontCW,fe||on.disabled)}};T?ae(re,d.renderElevatedRasterBackface?Kt.backCW:Kt.frontCW,d.stencilModeFor3D()):ae(re,Kt.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,i,l,p,_,v){d.renderPass==="offscreen"&&function(b,D,T,M){if(!M.length)return;let P=b.context,k=P.gl,N=D.getSource();if(!(N instanceof lt))return;let L=Math.ceil(Math.sqrt(T.paint.get("raster-particle-count"))),H=T.particleFramebuffer;H?H.width!==L&&(H.destroy(),H=T.particleFramebuffer=P.createFramebuffer(L,L,!0,null)):H=T.particleFramebuffer=P.createFramebuffer(L,L,!0,null);let G=[];for(let Y of M){let re=D.getTile(Y);if(!(re instanceof rh))continue;let ie=Fv(re,N,T);if(!ie)continue;let ae=[re.tileSize,re.tileSize],W=T.tileFramebuffer;W||(W=T.tileFramebuffer=P.createFramebuffer(ae[0],ae[1],!0,null));let K=re.rasterParticleState;K||(K=re.rasterParticleState=new m0(P,Y,ae,L));let fe=K.update(T.lastInvalidatedAt);K.particleTextureDimension!==L&&K.setParticleTextureDimension(Y,L);let he=K.targetColorTexture;K.targetColorTexture=K.backgroundColorTexture,K.backgroundColorTexture=he;let ve=K.particleTexture0;K.particleTexture0=K.particleTexture1,K.particleTexture1=ve,G.push([Y,ie,K,fe])}if(G.length===0)return;let $=r.f.now(),q=T.previousDrawTimestamp?.001*($-T.previousDrawTimestamp):.0167;if(T.previousDrawTimestamp=$,T.hasColorMap()){P.activeTexture.set(k.TEXTURE0+2);let Y=T.colorRampTexture;Y||(Y=T.colorRampTexture=new r.T(P,T.colorRamp,k.RGBA)),Y.bind(k.LINEAR,k.CLAMP_TO_EDGE)}P.bindFramebuffer.set(T.tileFramebuffer.framebuffer),function(Y,re,ie){let ae=Y.context,W=ae.gl,K=re.tileFramebuffer;ae.activeTexture.set(W.TEXTURE0);let fe={u_texture:0,u_opacity:1.05*(ve=re.paint.get("raster-particle-fade-opacity-factor"))/(ve+.05)},he=Y.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ve;for(let Ie of ie){let[,,ye,Ae]=Ie;K.colorAttachment.set(ye.targetColorTexture.texture),ae.viewport.set([0,0,K.width,K.height]),ae.clear({color:r.aA.transparent}),Ae&&(ye.backgroundColorTexture.bind(W.NEAREST,W.CLAMP_TO_EDGE),he.draw(Y,W.TRIANGLES,Gt.disabled,on.disabled,_n.alphaBlended,Kt.disabled,fe,re.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments))}}(b,T,G),function(Y,re,ie,ae){let W=Y.context,K=W.gl,fe=ie.tileFramebuffer,he=Y.transform.projection.name==="globe",ve=ie.paint.get("raster-particle-max-speed");for(let Ie of ae){let[ye,Ae,Fe]=Ie;W.activeTexture.set(K.TEXTURE0+0),Ae.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE),fe.colorAttachment.set(Fe.targetColorTexture.texture);let _e=Y.getOrCreateProgram("rasterParticleDraw",{defines:Ae.defines,overrideFog:!1});W.activeTexture.set(K.TEXTURE0+1);let De=Ae.scalarData?[]:[0,1,2,3].map(Se=>r.cN[Se](ye));De.push(ye);let Xe=ye.canonical.x,be=ye.canonical.y;for(let Se of De){let Me=re.getTile(he?Se.wrapped():Se);if(!Me)continue;let oe=Me.rasterParticleState;if(!oe)continue;let Ve=Se.canonical.x+(1<<Se.canonical.z)*(Se.wrap-ye.wrap),yt=Se.canonical.y;oe.particleTexture0.bind(K.NEAREST,K.CLAMP_TO_EDGE);let Mt=Wc(1,oe.particleTexture0.size[0],[Ve-Xe,yt-be],0,Ae.texture.size,2,ve,Ae.textureOffset,Ae.scale,Ae.offset);_e.draw(Y,K.POINTS,Gt.disabled,on.disabled,_n.alphaBlended,Kt.disabled,Mt,ie.id,oe.particleIndexBuffer,void 0,oe.particleSegment)}}}(b,D,T,G),P.bindFramebuffer.set(T.particleFramebuffer.framebuffer),function(Y,re,ie,ae){let W=Y.context,K=W.gl,fe=re.paint.get("raster-particle-max-speed"),he=ae*re.paint.get("raster-particle-speed-factor")*.3,ve=function(ye){return Math.pow(ye,6)}(.01+1*re.paint.get("raster-particle-reset-rate-factor")),Ie=re.particleFramebuffer;W.viewport.set([0,0,Ie.width,Ie.height]);for(let ye of ie){let[,Ae,Fe]=ye;W.activeTexture.set(K.TEXTURE0+0),Ae.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE),W.activeTexture.set(K.TEXTURE0+1);let _e=Fe.particleTexture0;_e.bind(K.NEAREST,K.CLAMP_TO_EDGE);let De=Sv(1,_e.size[0],0,Ae.texture.size,fe,he,ve,Ae.textureOffset,Ae.scale,Ae.offset);Ie.colorAttachment.set(Fe.particleTexture1.texture),W.clear({color:r.aA.transparent}),Y.getOrCreateProgram("rasterParticleUpdate",{defines:Ae.defines}).draw(Y,K.TRIANGLES,Gt.disabled,on.disabled,_n.unblended,Kt.disabled,De,re.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments)}}(b,T,G,q)}(d,i,l,p),d.renderPass==="translucent"&&(function(b,D,T,M,P){let k=b.context,N=k.gl,L=!b.options.moving,H=b.transform.projection.name==="globe";if(!M.length)return;let[G,$]=b.stencilConfigForOverlap(M),q=[];H&&q.push("PROJECTION_GLOBE_VIEW");let Y=b.stencilModeFor3D();for(let re of $){let ie=re.toUnwrapped(),ae=D.getTile(re);if(!ae.rasterParticleState)continue;let W=ae.rasterParticleState,K=100;ae.registerFadeDuration(K);let fe=D.findLoadedParent(re,0),he=Ra(ae,fe,D,b.transform,K),ve,Ie;b.terrain&&b.terrain.prepareDrawTile(),k.activeTexture.set(N.TEXTURE0),W.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),k.activeTexture.set(N.TEXTURE1),fe&&fe.rasterParticleState?(fe.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ve=Math.pow(2,fe.tileID.overscaledZ-ae.tileID.overscaledZ),Ie=[ae.tileID.canonical.x*ve%1,ae.tileID.canonical.y*ve%1]):W.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let ye=H?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ie,L),Ae=b.transform,Fe=Pv(Ae),_e=r.ck(re.canonical),De=r.cl(_e.getCenter().lat),Xe,be,Se,Me,oe;H?(Xe=Float32Array.from(r.aW(r.cn(re.canonical))),be=Float32Array.from(Ae.globeMatrix),Se=Float32Array.from(r.cj(Ae)),Me=[r.a8(Ae.center.lng),r.ah(Ae.center.lat)],oe=Float32Array.from(r.cm(re.canonical,_e,De,Ae.worldSize/Ae._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),be=new Float32Array(9),Se=new Float32Array(16),Me=[0,0],oe=new Float32Array(9));let Ve=qc(ye,Xe,be,Se,oe,Ie||[0,0],r.W(b.transform.zoom),Me,Fe,ve||1,he,250),yt=b.isTileAffectedByFog(re),Mt=b.getOrCreateProgram("rasterParticle",{defines:q,overrideFog:yt});if(b.uploadCommonUniforms(k,Mt,ie),H){let zt=new Gt(N.LEQUAL,Gt.ReadWrite,b.depthRangeFor3D),Rt=0,jt=b.globeSharedBuffers;if(jt){let[En,nn,Pn]=jt.getGridBuffers(De,Rt!==0);Mt.draw(b,N.TRIANGLES,zt,Y,_n.alphaBlended,Kt.backCCW,Ve,T.id,En,nn,Pn)}}else{let zt=b.depthModeForSublayer(0,Gt.ReadOnly),Rt=G[re.overscaledZ],{tileBoundsBuffer:jt,tileBoundsIndexBuffer:En,tileBoundsSegments:nn}=b.getTileBoundsBuffers(ae);Mt.draw(b,N.TRIANGLES,zt,Rt,_n.alphaBlended,Kt.disabled,Ve,T.id,jt,En,nn)}}b.resetStencilClippingMasks()}(d,i,l,p),d.style.map.triggerRepaint())},background:function(d,i,l,p){let _=l.paint.get("background-color"),v=l.paint.get("background-opacity"),b=l.paint.get("background-emissive-strength");if(v===0)return;let D=d.context,T=D.gl,M=d.transform,P=M.tileSize,k=l.paint.get("background-pattern");if(d.isPatternMissing(k,l.scope))return;let N=!k&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;let L=on.disabled,H=d.depthModeForSublayer(0,N==="opaque"?Gt.ReadWrite:Gt.ReadOnly),G=d.colorModeForDrapableLayerRenderPass(b),$=k?"backgroundPattern":"background",q,Y=p;Y||(q=d.getBackgroundTiles(),Y=Object.values(q).map(re=>re.tileID)),k&&(D.activeTexture.set(T.TEXTURE0),d.imageManager.bind(d.context,l.scope));for(let re of Y){let ie=d.isTileAffectedByFog(re),ae=d.getOrCreateProgram($,{overrideFog:ie}),W=re.toUnwrapped(),K=p?re.projMatrix:d.transform.calculateProjMatrix(W);d.prepareDrawTile();let fe=i?i.getTile(re):q?q[re.key]:new Qo(re,P,M.zoom,d),he=k?Mv(K,b,v,d,k,l.scope,{tileID:re,tileSize:P}):Iv(K,b,v,_);d.uploadCommonUniforms(D,ae,W);let{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Ie,tileBoundsSegments:ye}=d.getTileBoundsBuffers(fe);ae.draw(d,T.TRIANGLES,H,L,G,Kt.disabled,he,l.id,ve,Ie,ye)}},sky:function(d,i,l){let p=d._atmosphere?r.W(d.transform.zoom):1,_=l.paint.get("sky-opacity")*p;if(_===0)return;let v=d.context,b=l.paint.get("sky-type"),D=new Gt(v.gl.LEQUAL,Gt.ReadOnly,[0,1]),T=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(M,P,k,N){let L=M.context,H=L.gl,G=P.skyboxFbo;if(!G){G=P.skyboxFbo=L.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new z0(L),P.skyboxTexture=L.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,P.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let re=0;re<6;++re)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}L.bindFramebuffer.set(G.framebuffer),L.viewport.set([0,0,32,32]);let $=P.getCenter(M,!0),q=M.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);r.a9.identity(Y),r.a9.rotateY(Y,Y,.5*-Math.PI),La(M,P,q,Y,$,0),r.a9.identity(Y),r.a9.rotateY(Y,Y,.5*Math.PI),La(M,P,q,Y,$,1),r.a9.identity(Y),r.a9.rotateX(Y,Y,.5*-Math.PI),La(M,P,q,Y,$,2),r.a9.identity(Y),r.a9.rotateX(Y,Y,.5*Math.PI),La(M,P,q,Y,$,3),r.a9.identity(Y),La(M,P,q,Y,$,4),r.a9.identity(Y),r.a9.rotateY(Y,Y,Math.PI),La(M,P,q,Y,$,5),L.viewport.set([0,0,M.width,M.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(M,P,k,N,L){let H=M.context,G=H.gl,$=M.transform,q=M.getOrCreateProgram("skybox");H.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,P.skyboxTexture);let Y=((re,ie,ae,W,K)=>({u_matrix:re,u_sun_direction:ie,u_cubemap:0,u_opacity:W,u_temporal_offset:K}))($.skyboxMatrix,P.getCenter(M,!1),0,N,L);M.uploadCommonUniforms(H,q),q.draw(M,G.TRIANGLES,k,on.disabled,M.colorModeForRenderPass(),Kt.backCW,Y,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,l,D,_,T):b==="gradient"&&d.renderPass==="sky"&&function(M,P,k,N,L){let H=M.context,G=H.gl,$=M.transform,q=M.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new z0(H)),H.activeTexture.set(G.TEXTURE0);let Y=P.colorRampTexture;Y||(Y=P.colorRampTexture=new r.T(H,P.colorRamp,G.RGBA)),Y.bind(G.LINEAR,G.CLAMP_TO_EDGE);let re=((ie,ae,W,K,fe)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:ae,u_radius:r.bm(W),u_opacity:K,u_temporal_offset:fe}))($.skyboxMatrix,P.getCenter(M,!1),P.paint.get("sky-gradient-radius"),N,L);M.uploadCommonUniforms(H,q),q.draw(M,G.TRIANGLES,k,on.disabled,M.colorModeForRenderPass(),Kt.backCW,re,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,l,D,_,T)},debug:function(d,i,l,p,_,v){for(let b=0;b<l.length;b++)if(_){let M=new r.aA(p.r*.8,p.g*.8,p.b*.8,1);Al(d,i,l[b],p,-1,-1,v),Al(d,i,l[b],p,-1,1,v),Al(d,i,l[b],p,1,1,v),Al(d,i,l[b],p,1,-1,v),Al(d,i,l[b],M,0,0,v)}else Al(d,i,l[b],p,0,0,v)},custom:function(d,i,l,p){let _=d.context,v=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isDraped(i)){if(d.renderPass==="offscreen"){let b=v.prerender;if(b){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let D=d.transform.pointMerc;b.call(v,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.W(d.transform.zoom),[D.x,D.y],d.transform.pixelsPerMeterRatio)}else b.call(v,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let D=v.renderToTile;if(D){let T=p[0].canonical,M=new r.O(T.x+p[0].wrap*(1<<T.z),T.y,T.z);_.setDepthMode(Gt.disabled),_.setStencilMode(on.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),D.call(v,_.gl,M),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(on.disabled);let b=v.renderingMode==="3d"?new Gt(d.context.gl.LEQUAL,Gt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Gt.ReadOnly);if(_.setDepthMode(b),d.transform.projection.name==="globe"){let D=d.transform.pointMerc;v.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.W(d.transform.zoom),[D.x,D.y],d.transform.pixelsPerMeterRatio)}else v.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,i,l,p){if(d.renderPass==="opaque")return;let _=l.paint.get("model-opacity");if(_===0)return;let v=l.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!v||d.terrain&&_<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let b=d.shadowRenderer,D=l.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,D||(b.enabled=!1));let T=()=>{b&&(b.useNormalOffset=!0,D||(b.enabled=!0))},M=i.getSource();if(d.renderPass==="light-beam"&&M.type!=="batched-model")return;if(M.type==="vector"||M.type==="geojson")return function(q,Y,re,ie,ae){let W=q.transform;if(W.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${W.projection.name} projection is not yet implemented`);let K=W.getFreeCameraOptions().position;if(!q.modelManager)return;let fe=q.modelManager;re.modelManager=fe;let he=q.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ve=re._unevaluatedLayout._values["model-id"],Ie=$t({},re.layout.get("model-id").parameters);for(let ye of ie){let Ae=Y.getTile(ye).getBucket(re);if(!Ae||Ae.projection.name!==W.projection.name)continue;let Fe=Ae.getModelUris();Fe&&!Ae.modelsRequested&&(fe.addModelsFromBucket(Fe,ae),Ae.modelsRequested=!0);let _e=Lh(ye,W);Ie.zoom=_e;let De=ve.possiblyEvaluate(Ie);if(Jc(q,Ae,ye),Do.shadowUniformsInitialized=!1,Do.useSingleShadowCascade=!!he&&he.getMaxCascadeForTile(ye.toUnwrapped())===0,q.renderPass==="shadow"&&he){if(q.currentShadowCascade===1&&Ae.isInsideFirstShadowMapFrustum)continue;let Se=W.calculatePosMatrix(ye.toUnwrapped(),W.worldSize);if(Do.tileMatrix.set(Se),Do.shadowTileMatrix=Float32Array.from(he.calculateShadowPassMatrixFromMatrix(Se)),Do.aabb.min.fill(0),Do.aabb.max[0]=Do.aabb.max[1]=r.Y,Do.aabb.max[2]=0,eu(Ae,Do,q,re.scope))continue}let Xe=1<<ye.canonical.z,be=[((K.x-ye.wrap)*Xe-ye.canonical.x)*r.Y,(K.y*Xe-ye.canonical.y)*r.Y,K.z*Xe*r.Y];for(let Se in Ae.instancesPerModel){let Me=Ae.instancesPerModel[Se];Me.features.length>0&&(Se=De.evaluate(Me.features[0].feature,{}));let oe=fe.getModel(Se,ae);if(oe&&oe.uploaded)for(let Ve of oe.nodes)Uh(q,re,Ve,Me,be,ye,Do)}}}(d,i,l,p,M.type==="vector"?l.scope:""),void T();if(!M.loaded())return;if(M.type==="batched-model")return function(q,Y,re,ie){re.resetLayerRenderingStats(q);let ae=q.context,W=q.transform,K=q.style.fog,fe=q.shadowRenderer;if(W.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${W.projection.name} projection is not yet implemented`);let he=q.transform.getFreeCameraOptions().position,ve=r.Q.scale([],[he.x,he.y,he.z],q.transform.worldSize);r.Q.negate(ve,ve);let Ie=r.a9.identity([]),ye=r.cZ(W.center.lat,W.zoom),Ae=r.a9.fromScaling([],[1,1,1/ye]);r.a9.translate(Ie,Ie,ve);let Fe=re.paint.get("model-opacity"),_e=new Gt(ae.gl.LEQUAL,Gt.ReadWrite,q.depthRangeFor3D),De=new Gt(ae.gl.LEQUAL,Gt.ReadOnly,q.depthRangeFor3D),Xe=new r.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),be=q.renderPass==="shadow",Se=be&&fe?fe.getCurrentCascadeFrustum():W.getFrustum(W.scaleZoom(W.worldSize)),Me=re.getLayerRenderingStats(),oe=function(Ve,yt){for(let Mt of ie){let zt=Y.getTile(Mt).getBucket(re);if(!zt||!zt.uploaded)continue;let Rt=!1;fe&&(Rt=fe.getMaxCascadeForTile(Mt.toUnwrapped())===0);let jt=W.calculatePosMatrix(Mt.toUnwrapped(),W.worldSize),En=zt.modelTraits;for(let nn of zt.getNodesInfo()){if(nn.hiddenByReplacement||!nn.node.meshes)continue;let Pn=nn.evaluatedScale,An=nn.node,Fi=0;if(q.terrain&&An.elevation&&(Fi=An.elevation*q.terrain.exaggeration()),Pn[0]<=1&&Pn[1]<=1&&Pn[2]<=1&&(()=>{let xn=nn.getLocalBounds();return Xe.min=[...xn.min],Xe.max=[...xn.max],Xe.min[2]+=Fi,Xe.max[2]+=Fi,r.Q.transformMat4(Xe.min,Xe.min,jt),r.Q.transformMat4(Xe.max,Xe.max,jt),Xe})().intersects(Se)===0)continue;let ei=[...jt];r.a9.translate(ei,ei,[(An.anchor?An.anchor[0]:0)*(Pn[0]-1),(An.anchor?An.anchor[1]:0)*(Pn[1]-1),Fi]),r.Q.exactEquals(Pn,r.c$)||r.a9.scale(ei,ei,Pn);let sr=r.a9.multiply([],ei,An.matrix),Ji=r.a9.multiply([],Ae,ei);r.a9.multiply(Ji,Ie,Ji);let gi=r.a9.invert([],Ji);r.a9.transpose(gi,gi),r.a9.scale(gi,gi,zh),Ji=r.a9.multiply(Ji,Ji,An.matrix);let ai=q.renderPass==="light-beam",dn=r.a9.multiply([],W.expandedFarZProjMatrix,sr),pn=r.a9.multiply([],W.expandedFarZProjMatrix,ei),Ci=En&r.d1.HasMapboxMeshFeatures,_i=Ci?0:nn.evaluatedRMEA[0][2];for(let xn=0;xn<An.meshes.length;++xn){let an=An.meshes[xn],Qr=xn===An.lightMeshIndex,Or=dn;if(Qr){if(!ai&&!q.terrain&&q.shadowRenderer){q.currentLayer<q.firstLightBeamLayer&&(q.firstLightBeamLayer=q.currentLayer);continue}Or=pn}else if(ai)continue;let gr={defines:[]},Rr=[];if(sa(gr.defines,Rr,an,q),Ci||gr.defines.push("DIFFUSE_SHADED"),Rt&&gr.defines.push("SHADOWS_SINGLE_CASCADE"),Me&&(be?Me.numRenderedVerticesInShadowPass+=an.vertexArray.length:Me.numRenderedVerticesInTransparentPass+=an.vertexArray.length),be){Kc(an,sr,q,re);continue}let Yr=null;if(K){let is=cp(sr,q.transform);if(Yr=new Float32Array(is),W.projection.name!=="globe"){let ys=an.aabb.min,vs=an.aabb.max,[ua,ko]=K.getOpacityForBounds(is,ys[0],ys[1],vs[0],vs[1]);gr.overrideFog=ua>=Vn||ko>=Vn}}let zr=an.material,_r;zr.occlusionTexture&&zr.occlusionTexture.offsetScale&&(_r=zr.occlusionTexture.offsetScale,gr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!be&&fe&&(fe.useNormalOffset=!!an.normalBuffer);let Cr=q.getOrCreateProgram("model",gr);!be&&fe&&fe.setupShadowsFromMatrix(ei,Cr,fe.useNormalOffset),q.uploadCommonUniforms(ae,Cr,null,Yr);let Er=zr.pbrMetallicRoughness;Er.metallicFactor=.9,Er.roughnessFactor=.5;let _s=Mh(new Float32Array(Or),new Float32Array(Ji),new Float32Array(gi),new Float32Array(An.matrix),q,Fe,Er.baseColorFactor,zr.emissiveFactor,Er.metallicFactor,Er.roughnessFactor,zr,_i,re,[0,0,0],_r);Cr.draw(q,ae.gl.TRIANGLES,yt&&!Qr?_e:De,on.disabled,Ve?Qr||Fe<1||nn.hasTranslucentParts?_n.alphaBlended:_n.unblended:_n.disabled,Kt.backCCW,_s,re.id,an.vertexBuffer,an.indexBuffer,an.segments,re.paint,q.transform.zoom,void 0,Rr)}}}};(function(Ve,yt,Mt,zt){let Rt=Ve.terrain?Ve.terrain.exaggeration():0,jt=Ve.transform.zoom;for(let En of zt){let nn=yt.getTile(En).getBucket(Mt);nn&&(Ve.conflationActive&&nn.updateReplacement(En,Ve.replacementSource),nn.evaluateScale(Ve,Mt),Ve.terrain&&Rt>0&&nn.elevationUpdate(Ve.terrain,Rt,En,Mt.source),nn.needsReEvaluation(Ve,jt,Mt)&&nn.evaluate(Mt))}})(q,Y,re,ie),Fe===1?oe(!0,!0):(oe(!1,!0),oe(!0,!1))}(d,i,l,p),void T();let P=M.getModels(),k=[],N=d.transform.getFreeCameraOptions().position,L=r.Q.scale([],[N.x,N.y,N.z],d.transform.worldSize);r.Q.negate(L,L);let H=[],G=[],$=0;for(let q of P){let Y=l.paint.get("model-rotation").constantOr(null),re=l.paint.get("model-scale").constantOr(null),ie=l.paint.get("model-translation").constantOr(null);q.computeModelMatrix(d,Y,re,ie,!0,!0,!1);let ae=r.a9.identity([]),W=r.cZ(q.position.lat,d.transform.zoom),K=r.a9.fromScaling([],[1,1,1/W]);r.a9.translate(ae,ae,L),k.push({zScaleMatrix:K,negCameraPosMatrix:ae});for(let fe of q.nodes)Xc(d.transform,fe,q.matrix,d.transform.expandedFarZProjMatrix,$,H,G);$++}if(H.sort((q,Y)=>Y.depth-q.depth),d.renderPass!=="shadow"){if(_===1)for(let q of G)aa(q,d,l,k[q.modelIndex],on.disabled,d.colorModeForRenderPass());else{for(let q of G)aa(q,d,l,k[q.modelIndex],on.disabled,_n.disabled);for(let q of G)aa(q,d,l,k[q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let q of H)aa(q,d,l,k[q.modelIndex],on.disabled,d.colorModeForRenderPass());T()}else{for(let q of G)Kc(q.mesh,q.nodeModelMatrix,d,l);for(let q of H)Kc(q.mesh,q.nodeModelMatrix,d,l);T()}}},za={model:function(d,i,l){let p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?d.scope:""));if(p.type==="batched-model")return;let _=p.getModels();for(let v of _)v.upload(l.context)},raster:function(d,i,l){let p=i.getSource();if(!(p instanceof lt&&p.loaded()))return;let _=d.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let v=d.paint.get("raster-array-band")||p.getInitialBand(_);if(v==null)return;let b=i.getIds().map(D=>i.getTileByID(D));for(let D of b)D.updateNeeded(_,v)&&p.prepareTile(D,_,v)},"raster-particle":function(d,i,l){let p=i.getSource();if(!(p instanceof lt&&p.loaded()))return;let _=d.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let v=d.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(v==null)return;let b=i.getIds().map(D=>i.getTileByID(D));for(let D of b)D.updateNeeded(_,v)&&p.prepareTile(D,_,v)}};class G0{constructor(i,l,p,_){this.context=new ds(i,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let b of v)this._debugParams.enabledLayers[b]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let b of v)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],b);this.setup(),this.numSublayers=Yo.maxUnderzooming+Yo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new T0(this),this._wireframeDebugCache=new j0,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(i,l){let p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wo(this,i));let _=this._terrain;this.transform.elevation=p?_:null,_.update(i,this.transform,l),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(i){let l=i.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);let v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,l){if(this.width=i*r.f.devicePixelRatio,this.height=l*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._mergedLayers[p].resize()}setup(){let i=this.context,l=new r.aQ;l.emplaceBack(0,0),l.emplaceBack(r.Y,0),l.emplaceBack(0,r.Y),l.emplaceBack(r.Y,r.Y),this.tileExtentBuffer=i.createVertexBuffer(l,r.aS.members),this.tileExtentSegments=r.aE.simpleSegment(0,0,4,2);let p=new r.aQ;p.emplaceBack(0,0),p.emplaceBack(r.Y,0),p.emplaceBack(0,r.Y),p.emplaceBack(r.Y,r.Y),this.debugBuffer=i.createVertexBuffer(p,r.aS.members),this.debugSegments=r.aE.simpleSegment(0,0,4,5);let _=new r.aQ;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,r.aS.members),this.viewportSegments=r.aE.simpleSegment(0,0,4,2);let v=new r.ay;v.emplaceBack(0,0,0,0),v.emplaceBack(r.Y,0,r.Y,0),v.emplaceBack(0,r.Y,0,r.Y),v.emplaceBack(r.Y,r.Y,r.Y,r.Y),this.mercatorBoundsBuffer=i.createVertexBuffer(v,r.aU.members),this.mercatorBoundsSegments=r.aE.simpleSegment(0,0,4,2);let b=new r.az;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(b);let D=new r.aR;for(let M of[0,1,3,2,0])D.emplaceBack(M);this.debugIndexBuffer=i.createIndexBuffer(D),this.emptyTexture=new r.T(i,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=r.a9.create();let T=this.context.gl;this.stencilClearMode=new on({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Gt.disabled,this.stencilClearMode,_n.disabled,Kt.disabled,Gc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,p){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(let T of p)if(this._tileClippingMaskIDs[T.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=l.id;let _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(_n.disabled),_.setDepthMode(Gt.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let D of p){let T=l.getTile(D),M=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:k,tileBoundsSegments:N}=this.getTileBoundsBuffers(T);b.draw(this,v.TRIANGLES,Gt.disabled,new on({func:v.ALWAYS,mask:0},M,255,v.KEEP,v.KEEP,v.REPLACE),_n.disabled,Kt.disabled,Gc(D.projMatrix),"$clipping",P,k,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let i=this.nextStencilID++,l=this.context.gl;return new on({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);let l=this.context.gl;return new on({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){let l=this.context.gl,p=i.sort((b,D)=>D.overscaledZ-b.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let b={};for(let D=0;D<v;D++)b[D+_]=new on({func:l.GEQUAL,mask:255},D+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[b,p]}return[{[_]:on.disabled},p]}colorModeForRenderPass(){let i=this.context.gl;return this._showOverdrawInspector?new _n([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_n.unblended:_n.alphaBlended}colorModeForDrapableLayerRenderPass(i){let l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new _n([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new r.aA(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,l,p,_=!1){if(!this.opaquePassEnabledForLayer()&&!_)return Gt.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Gt(p||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){let i=new Date().getTime(),l=i-this._timeStamp;this._timeStamp=i,this._fpsHistory.push(l===0?0:1e3/l),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((p,_)=>p+_/this._fpsHistory.length,0))}render(i,l){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=l;let p=this.style._mergedLayers,_=this.style.order.filter(W=>{let K=p[W];return!(K.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[K.type]}),v=_.map(W=>p[W]),b=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let D=0,T=!1;for(let W in b){let K=b[W];K.used&&(K.prepare(this.context),K.getSource().usedInConflation&&++D)}for(let W of v)W.isHidden(this.transform.zoom)||this.prepareLayer(W);let M={},P={},k={},N={},L={};for(let W in b){let K=b[W];M[W]=K.getVisibleCoordinates(),P[W]=M[W].slice().reverse(),k[W]=K.getVisibleCoordinates(!0).reverse(),N[W]=K.getShadowCasterCoordinates(),L[W]=K.sortCoordinatesByDistance(M[W])}let H=W=>{let K=this.style.getLayerSourceCache(W);return K&&K.used?K.getSource():null};if(D){let W=[];for(let K of v)this.layerUsedInConflation(K,H(K))&&W.push(K);if(W&&W.length>1){let K=[];for(let fe of W){let he=this.style.getLayerSourceCache(fe);he&&he.used&&he.getSource().usedInConflation&&K.push({layer:fe.fqid,cache:he})}this.replacementSource.setSources(K),T=!0}}T||this.replacementSource.clear(),this.conflationActive=T,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let W of v){let K=W.cutoffRange();if(this.longestCutoffRange=Math.max(K,this.longestCutoffRange),K>0){let fe=H(W);fe&&(this.minCutoffZoom=Math.max(fe.minzoom,this.minCutoffZoom)),W.minzoom&&(this.minCutoffZoom=Math.max(W.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let W=0;W<v.length;W++)if(v[W].is3D()){this.opaquePassCutoff=W;break}let G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0);let $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(let W in b)for(let K of M[W]){let fe={min:0,max:0};this.terrain&&(fe=this.terrain.getMinMaxForTile(K)||fe),$.addShadowReceiver(K.toUnwrapped(),fe.min,fe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new lp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.d5(this.context.gl))return;this.renderPass="offscreen";for(let W of v){let K=i.getLayerSourceCache(W);if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;let fe=K?P[K.id]:void 0;(W.type==="custom"||W.type==="raster"||W.type==="raster-particle"||W.isSky()||fe&&fe.length)&&this.renderLayer(this,K,W,fe)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];let q=this.terrain;q&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&q.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,N)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Y=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),re=(()=>{if(l.showOverdrawInspector)return r.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Y){let W=this.style.fog.properties.get("color").toArray01();return new r.aA(...W)}if(this.style.fog&&this.transform.projection.supportsFog&&Y){let W=this.style.fog.properties.get("space-color").toArray01();return new r.aA(...W)}return r.aA.transparent})();if(this.context.clear({color:re,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){let W=v[this.currentLayer],K=i.getLayerSourceCache(W);if(W.isSky())continue;let fe=K?(W.is3D()?L:P)[K.id]:void 0;this._renderTileClippingMasks(W,K,fe),this.renderLayer(this,K,W,fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){let W=v[this.currentLayer],K=i.getLayerSourceCache(W);W.isSky()&&this.renderLayer(this,K,W,K?P[K.id]:void 0)}function ie(W,K){let fe;return K&&(fe=(W.type==="symbol"?k:W.is3D()?L:P)[K.id]),fe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){let W=v[this.currentLayer];if(W.type==="raster"){let K=i.getLayerSourceCache(W);this.renderLayer(this,K,W,ie(W,K))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ae=0;for($&&(ae=$.getShadowCastingLayerCount());this.currentLayer<_.length;){let W=v[this.currentLayer],K=i.getLayerSourceCache(W);if(W.isSky())++this.currentLayer;else if(q&&this.style.isLayerDraped(W)){if(W.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=q.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(W,K,K?M[K.id]:void 0),this.renderLayer(this,K,W,ie(W,K)),!q&&$&&ae>0&&W.hasShadowPass()&&--ae==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=fe;this.currentLayer++){let he=v[this.currentLayer];if(!he.hasLightBeamPass())continue;let ve=i.getLayerSourceCache(he);this.renderLayer(this,ve,he,ve?P[ve.id]:void 0)}this.currentLayer=fe,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let W=null;v.forEach(K=>{let fe=i.getLayerSourceCache(K);fe&&!K.isHidden(this.transform.zoom)&&fe.getVisibleCoordinates().length&&(!W||W.getSource().maxzoom<fe.getSource().maxzoom)&&(W=fe)}),W&&this.options.showTileBoundaries&&Vh.debug(this,W,W.getVisibleCoordinates(),r.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Vh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(W){let K=W.transform.padding;N0(W,W.transform.height-(K.top||0),3,rp),N0(W,K.bottom||0,3,Ov),L0(W,K.left||0,3,k0),L0(W,W.transform.width-(K.right||0),3,B0);let fe=W.transform.centerPoint;(function(he,ve,Ie,ye){Bh(he,ve-1,Ie-10,2,20,ye),Bh(he,ve-10,Ie-1,20,2,ye)})(W,fe.x,W.transform.height-fe.y,op)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),T||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);let{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(i.type);if(za[i.type]&&(p||this.terrain&&i.type==="custom")){let _=this.style.getLayerSourceCache(i);za[i.type](i,_,this)}this.gpuTimingEnd()}renderLayer(i,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(p.type)||i.terrain&&p.type==="custom")&&Vh[p.type](i,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,p=this.context.gl,_=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let i=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(i.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){let i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){let l={};for(let p in i){let _=i[p],v=this.context.extTimerQuery,b=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),l[p]=b}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.extTimerQuery,p=this.context.gl,_=0;for(let v of i)_+=l.getQueryParameter(v,p.QUERY_RESULT)/1e6,l.deleteQueryEXT(v);return _}translatePosMatrix(i,l,p,_,v){if(!p[0]&&!p[1])return i;let b=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){let M=Math.sin(b),P=Math.cos(b);p=[p[0]*P-p[1]*M,p[0]*M+p[1]*P]}let D=[v?p[0]:r.a6(l,p[0],this.transform.zoom),v?p[1]:r.a6(l,p[1],this.transform.zoom),0],T=new Float32Array(16);return r.a9.translate(T,i,D),T}saveTileTexture(i){let l=i.size[0],p=this._tileTextures[l];p?p.push(i):this._tileTextures[l]=[i]}getTileTexture(i){let l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i,l){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString(),l)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,l,p){let _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,v=this.terrain&&this.terrain.exaggeration()===0,b=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||b.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?b.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):b.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&b.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||_||l!==void 0&&!l||b.push("FOG","FOG_DITHERING"),_&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(i,l){this.cache=this.cache||{};let p=l&&l.defines||[],_=l&&l.config,v=this.currentGlobalDefines(i,l&&l.overrideFog,l&&l.overrideRtt).concat(p),b=Ro.cacheKey(es[i],i,v,_);return this.cache[b]||(this.cache[b]=new Ro(this.context,i,es[i],_,Jf[i],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,l){if(this.style.enable3dLights()){let p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){let v=((b,D)=>{let T=b.properties.get("direction"),M=b.properties.get("color").toArray01(),P=b.properties.get("intensity"),k=D.properties.get("color").toArray01(),N=D.properties.get("intensity"),L=[T.x,T.y,T.z],H=r.cs(k,N),G=r.cs(M,P);return{u_lighting_ambient_color:H,u_lighting_directional_dir:L,u_lighting_directional_color:G,u_ground_radiance:M0(L,G,H)}})(p,_);l.setLightsUniformValues(i,v)}}}uploadCommonUniforms(i,l,p,_,v){if(this.uploadCommonLightUniforms(i,l),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let D=b.getOpacity(this.transform.pitch),T=((M,P,k,N,L,H,G,$,q,Y,re,ie)=>{let ae=M.transform,W=P.properties.get("color").toArray01();W[3]=N;let K=M.frameCounter/1e3%1,[fe,he]=P.properties.get("vertical-range");return{u_fog_matrix:k?ae.calculateFogTileMatrix(k):ie||M.identityMat,u_fog_range:P.getFovAdjustedRange(ae._fov),u_fog_color:W,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(fe,he),he],u_fog_temporal_offset:K,u_frustum_tl:L,u_frustum_tr:H,u_frustum_br:G,u_frustum_bl:$,u_globe_pos:q,u_globe_radius:Y,u_viewport:re,u_globe_transition:r.W(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,b,p,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],_);l.setFogUniformValues(i,T)}v&&l.setCutoffUniformValues(i,v.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){let i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){let i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let i=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let _ of p)l[_.key]=i[_.key]||new Qo(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(i,l){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||i.sourceLayer!=="building"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[i.key];return l||(this._cachedTileFogOpacities[i.key]=l=this.style.fog.getOpacityForTile(i)),l[0]>=Vn||l[1]>=Vn}}function H0(d,i){let l=!1,p=null,_=()=>{p=null,l&&(d(),p=setTimeout(_,i),l=!1)};return()=>(l=!0,p||_(),p)}class kv{constructor(i){this._hashName=i&&encodeURIComponent(i),r.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=H0(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let i=this._map;if(!i)return"";let l=$0(i);if(this._hashName){let p=this._hashName,_=!1,v=location.hash.slice(1).split("&").map(b=>{let D=b.split("=")[0];return D===p?(_=!0,`${D}=${l}`):b}).filter(b=>b);return _||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){let i=location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){let i=this._map;if(!i)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){let p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function $0(d,i){let l=d.getCenter(),p=Math.round(100*d.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),b=Math.round(l.lng*v)/v,D=Math.round(l.lat*v)/v,T=d.getBearing(),M=d.getPitch(),P=i?`/${b}/${D}/${p}`:`${p}/${D}/${b}`;return(T||M)&&(P+="/"+Math.round(10*T)/10),M&&(P+=`/${Math.round(M)}`),P}let Tl={linearity:.3,easing:r.d6(0,0,.3,1)},up=r.e({deceleration:2500,maxSpeed:1400},Tl),hp=r.e({deceleration:20,maxSpeed:1400},Tl),dp=r.e({deceleration:1e3,maxSpeed:360},Tl),q0=r.e({deceleration:1e3,maxSpeed:90},Tl);class W0{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:i})}_drainInertiaBuffer(){let i=this._inertiaBuffer,l=r.f.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){let v=la(l.pan.mag(),p,r.e({},up,i||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,jh(_,v)}if(l.zoom){let v=la(l.zoom,p,hp);_.zoom=this._map.transform.zoom+v.amount,jh(_,v)}if(l.bearing){let v=la(l.bearing,p,dp);_.bearing=this._map.transform.bearing+r.ad(v.amount,-179,179),jh(_,v)}if(l.pitch){let v=la(l.pitch,p,q0);_.pitch=this._map.transform.pitch+v.amount,jh(_,v)}if(_.zoom||_.bearing){let v=l.pinchAround===void 0?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function jh(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function la(d,i,l){let{maxSpeed:p,linearity:_,deceleration:v}=l,b=r.ad(d*_/(i/1e3),-p,p),D=Math.abs(b)/(v*_);return{easing:l.easing,duration:1e3*D,amount:b*(D/2)}}class Pr extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p,_={}){let v=ke(l.getCanvasContainer(),p),b=l.unproject(v);super(i,r.e({point:v,lngLat:b,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class tu extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){let _=i==="touchend"?p.changedTouches:p.touches,v=Pe(l.getCanvasContainer(),_),b=v.map(T=>l.unproject(T)),D=v.reduce((T,M,P,k)=>T.add(M.div(k.length)),new r.P(0,0));super(i,{points:v,point:D,lngLats:b,lngLat:l.unproject(D),originalEvent:p}),this._defaultPrevented=!1}}class Co extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class fp{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Co(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new Pr(i.type,this._map,i))}mouseup(i){this._map.fire(new Pr(i.type,this._map,i))}preclick(i){let l=r.e({},i);l.type="preclick",this._map.fire(new Pr(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Pr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Pr(i.type,this._map,i))}mouseover(i){this._map.fire(new Pr(i.type,this._map,i))}mouseout(i){this._map.fire(new Pr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new tu(i.type,this._map,i))}touchmove(i){this._map.fire(new tu(i.type,this._map,i))}touchend(i){this._map.fire(new tu(i.type,this._map,i))}touchcancel(i){this._map.fire(new tu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gh{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Pr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Pr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ce(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;let p=l,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=V("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));let b=Math.min(_.x,p.x),D=Math.max(_.x,p.x),T=Math.min(_.y,p.y),M=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${T}px)`,this._box.style.width=D-b+"px",this._box.style.height=M-T+"px")})}mouseupWindow(i,l){if(!this._active)return;let p=this._startPos,_=l;if(p&&i.button===0){if(this.reset(),me(),p.x!==_.x||p.y!==_.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Te(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new r.b(i,{originalEvent:l}))}}function nu(d,i){let l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=i[p];return l}class pp{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){let v=new r.P(0,0);for(let b of _)v._add(b);return v.div(_.length)}(l),this.touches=nu(p,l)))}touchmove(i,l,p){if(this.aborted||!this.centroid)return;let _=nu(p,l);for(let v in this.touches){let b=_[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,l,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Sl{constructor(i){this.singleTap=new pp(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,p){this.singleTap.touchstart(i,l,p)}touchmove(i,l,p){this.singleTap.touchmove(i,l,p)}touchend(i,l,p){let _=this.singleTap.touchend(i,l,p);if(_){let v=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(v&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class mp{constructor(){this._zoomIn=new Sl({numTouches:1,numTaps:2}),this._zoomOut=new Sl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,p){this._zoomIn.touchstart(i,l,p),this._zoomOut.touchstart(i,l,p)}touchmove(i,l,p){this._zoomIn.touchmove(i,l,p),this._zoomOut.touchmove(i,l,p)}touchend(i,l,p){let _=this._zoomIn.touchend(i,l,p),v=this._zoomOut.touchend(i,l,p);return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let gp={0:1,2:2};class Il{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;let p=Ze(i);this._correctButton(i,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(i,l){let p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&function(_,v){let b=gp[v];return _.buttons===void 0||(_.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(i){this._lastPoint&&Ze(i)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Z0 extends Il{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class _p extends Il{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){let p=.8*(l.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class Va extends Il{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){let p=-.5*(l.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class Bv{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),r.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,l,p){return this._calculateTransform(i,l,p)}touchmove(i,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,p)}}touchend(i,l,p){this._calculateTransform(i,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,p){p.length>0&&(this._active=!0);let _=nu(p,l),v=new r.P(0,0),b=new r.P(0,0),D=0;for(let M in _){let P=_[M],k=this._touches[M];k&&(v._add(P),b._add(P.sub(k)),D++,_[M]=P)}if(this._touches=_,D<this._minTouches||!b.mag())return;let T=b.div(D);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(D),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class yp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,p){return{}}touchstart(i,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,p){let _=this._firstTwoTouches;if(!_)return;i.preventDefault();let[v,b]=_,D=$h(p,l,v),T=$h(p,l,b);if(!D||!T)return;let M=this._aroundCenter?null:D.add(T).div(2);return this._move([D,T],M,i)}touchend(i,l,p){if(!this._firstTwoTouches)return;let[_,v]=this._firstTwoTouches,b=$h(p,l,_),D=$h(p,l,v);b&&D||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $h(d,i,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return i[p]}function Q0(d,i){return Math.log(d/i)/Math.LN2}class Nv extends yp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){let p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Q0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Q0(this._distance,p),pinchAround:l}}}function Y0(d,i){return 180*d.angleWith(i)/Math.PI}class vp extends yp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){let p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Y0(this._vector,p),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());let l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;let _=Y0(i,p);return Math.abs(_)<l}}function iu(d){return Math.abs(d.y)>Math.abs(d.x)}class X0 extends yp{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,iu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,p){let _=this._lastPoints;if(!_)return;let v=i[0].sub(_[0]),b=i[1].sub(_[1]);return this._map._cooperativeGestures&&!r.d7()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(i,l,p){if(this._valid!==void 0)return this._valid;let _=i.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let b=i.y>0==l.y>0;return iu(i)&&iu(l)&&b}}let Ml={panStep:100,bearingStep:15,pitchStep:10};class K0{constructor(){let i=Ml;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,p=0,_=0,v=0,b=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),b=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:D=>{let T=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:J0,zoom:l?Math.round(T)+l*(i.shiftKey?2:1):T,bearing:D.getBearing()+p*this._bearingStep,pitch:D.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:D.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function J0(d){return d*(2-d)}let xp=4.000244140625,bp=1/450;class ja{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bp,r.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,p=r.f.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%xp==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=ke(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){let M=this._type==="wheel"&&Math.abs(this._delta)>xp?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&P!==0&&(P=1/P);let k=l(),N=Math.pow(2,k),L=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(L*P))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,v=this._easing,b,D=!1;if(this._type==="wheel"&&_&&v){let M=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),P=v(M);b=r.X(_,p,P),M<1?this._frameId||(this._frameId=!0):D=!0}else b=p,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let T=b-l();return T*this._lastDelta<0&&(T=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:T,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=r.d8;if(this._prevEase){let p=this._prevEase,_=(r.f.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),b=.27/Math.sqrt(v*v+1e-4)*.01,D=Math.sqrt(.0729-b*b);l=r.d6(b,D,.25,1)}return this._prevEase={start:r.f.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class eg{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ga{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tg{constructor(){this._tap=new Sl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,l,p))}touchmove(i,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,l,p)}touchend(i,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,l,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qh{constructor(i,l,p){this._el=i,this._mousePan=l,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ng{constructor(i,l,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ig{constructor(i,l,p,_){this._el=i,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Fl=d=>d.zoom||d.drag||d.pitch||d.rotate;class wp extends r.b{}class Lv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){let p=r.Q.sub([],l,i);this.radius=r.Q.length(p[2]<0?r.Q.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){r.Q.div(i,i,this.constants),r.Q.normalize(i,i),r.Q.mul(i,i,this.constants);let l=r.Q.scale([],i,this.radius);if(l[2]>0){let p=r.Q.scale([],[0,0,1],r.Q.dot(l,[0,0,1])),_=r.Q.scale([],r.Q.normalize([],[l[0],l[1],0]),this.radius),v=r.Q.add([],l,r.Q.scale([],r.Q.sub([],r.Q.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function ru(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class ou{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new W0(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),r.a$(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,v,b]of this._listeners){let D=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,D,b)}}destroy(){for(let[i,l,p]of this._listeners){let _=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(l,_,p)}}_addDefaultHandlers(i){let l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new fp(l,i));let _=l.boxZoom=new Hh(l,i);this._add("boxZoom",_);let v=new mp,b=new Ga;l.doubleClickZoom=new eg(b,v),this._add("tapZoom",v),this._add("clickZoom",b);let D=new tg;this._add("tapDragZoom",D);let T=l.touchPitch=new X0(l);this._add("touchPitch",T);let M=new _p(i),P=new Va(i);l.dragRotate=new ng(i,M,P),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let k=new Z0(i),N=new Bv(l,i);l.dragPan=new qh(p,k,N),this._add("mousePan",k),this._add("touchPan",N,["touchZoom","touchRotate"]);let L=new vp,H=new Nv;l.touchZoomRotate=new ig(p,H,L,D),this._add("touchRotate",L,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Gh(l));let G=l.scrollZoom=new ja(l,this);this._add("scrollZoom",G,["mousePan"]);let $=l.keyboard=new K0;this._add("keyboard",$);for(let q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[q]&&l[q].enable(i[q])}_add(i,l,p){this._handlers.push({handlerName:i,handler:l,allowed:p}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,p){for(let _ in i)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){let l=[];for(let p of i)this._el.contains(p.target)&&l.push(p);return l}handleEvent(i,l){this._updatingCamera=!0;let p=i.type==="renderFrame",_=p?void 0:i,v={needsRenderFrame:!1},b={},D={},T=i.touches?this._getMapTouches(i.touches):void 0,M=T?Pe(this._el,T):p?void 0:ke(this._el,i);for(let{handlerName:N,handler:L,allowed:H}of this._handlers){if(!L.isEnabled())continue;let G;this._blockedByActive(D,H,N)?L.reset():L[l||i.type]&&(G=L[l||i.type](i,M,T),this.mergeHandlerResult(v,b,G,N,_),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||L.isActive())&&(D[N]=L)}let P={};for(let N in this._previousActiveHandlers)D[N]||(P[N]=_);this._previousActiveHandlers=D,(Object.keys(P).length||ru(v))&&(this._changes.push([v,b,P]),this._triggerRenderFrame()),(Object.keys(D).length||ru(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=v;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(i,l,p,_,v){if(!p)return;r.e(i,p);let b={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=b),p.panDelta!==void 0&&(l.drag=b),p.pitchDelta!==void 0&&(l.pitch=b),p.bearingDelta!==void 0&&(l.rotate=b)}_applyChanges(){let i={},l={},p={};for(let[_,v,b]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(i.around=_.around),_.aroundCoord!==void 0&&(i.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),r.e(l,v),r.e(p,b);this._updateMapTransform(i,l,p),this._changes=[]}_updateMapTransform(i,l,p){let _=this._map,v=_.transform,b=Y=>[Y.x,Y.y,Y.z];if((Y=>{let re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!ru(i)){let Y=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),Y!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!ru(i))return void this._fireEvents(l,p,!0);let{panDelta:D,zoomDelta:T,bearingDelta:M,pitchDelta:P,around:k,aroundCoord:N,pinchAround:L}=i;v._isCameraConstrained&&(T>0&&(T=0),v._isCameraConstrained=!1),L!==void 0&&(k=L),(T||(Y=>l[Y]&&!this._eventsInProgress[Y])("drag"))&&k&&(this._dragOrigin=b(v.pointCoordinate3D(k)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),k=k||_.transform.centerPoint,M&&(v.bearing+=M),P&&(v.pitch+=P),v._updateCameraState();let H=[0,0,0];if(D)if(v.projection.name==="mercator"){let Y=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(k).dir),re=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(k.sub(D)).dir);H[0]=re[0]-Y[0],H[1]=re[1]-Y[1]}else{let Y=v.pointCoordinate(k);if(v.projection.name==="globe"){D=D.rotate(-v.angle);let re=v._pixelsPerMercatorPixel/v.worldSize;H[0]=-D.x*r.d9(r.ax(Y.y))*re,H[1]=-D.y*r.d9(v.center.lat)*re}else{let re=v.pointCoordinate(k.sub(D));Y&&re&&(H[0]=re.x-Y.x,H[1]=re.y-Y.y)}}let G=v.zoom,$=[0,0,0];if(T){let Y=b(N||v.pointCoordinate3D(k)),re={dir:r.Q.normalize([],r.Q.sub([],Y,v._camera.position))};if(re.dir[2]<0){let ie=v.zoomDeltaToMovement(Y,T);r.Q.scale($,re.dir,ie)}}let q=r.Q.add(H,H,$);v._translateCameraConstrained(q),T&&Math.abs(v.zoom-G)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,p,!0)}_fireEvents(i,l,p){let _=Fl(this._eventsInProgress),v=Fl(i),b={};for(let P in i){let{originalEvent:k}=i[P];this._eventsInProgress[P]||(b[`${P}start`]=k),this._eventsInProgress[P]=i[P]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(let P in b)this._fireEvent(P,b[P]);v&&this._fireEvent("move",v.originalEvent);for(let P in i){let{originalEvent:k}=i[P];this._fireEvent(P,k)}let D={},T;for(let P in this._eventsInProgress){let{handlerName:k,originalEvent:N}=this._eventsInProgress[P];this._handlersById[k].isActive()||(delete this._eventsInProgress[P],T=l[k]||N,D[`${P}end`]=T)}for(let P in D)this._fireEvent(P,D[P]);let M=Fl(this._eventsInProgress);if(p&&(_||v)&&!M){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;P?(k(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:T})):(this._map.fire(new r.b("moveend",{originalEvent:T})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new r.b(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new wp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let rg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Uv extends r.E{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,r.a$(["_renderFrameCallback"],this)}getCenter(){return new r.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,p){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.e({offset:i},l),p)}panTo(i,l,p){return this.easeTo(r.e({center:i},l),p)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,p){return this.easeTo(r.e({zoom:i},l),p)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,p){return this.easeTo(r.e({bearing:i},l),p)}resetNorth(i,l){return this.rotateTo(0,r.e({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=r.ag.convert(i);let p=l&&l.bearing||0,_=l&&l.pitch||0,v=i.getNorthWest(),b=i.getSouthEast();return this._cameraForBounds(this.transform,v,b,p,_,l)}_extendPadding(i){let l={top:0,right:0,bottom:0,left:0};return i==null?r.e({},l,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.e({},l,i)}_extendCameraOptions(i){return(i=r.e({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,l){let p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):_/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,p,_,v,b){let D=i.clone(),T=this._extendCameraOptions(b);D.bearing=_,D.pitch=v;let M=r.bq.convert(l),P=r.bq.convert(p),k=.5*(M.lat+P.lat),N=.5*(M.lng+P.lng),L=r.da(k,N),H=r.Q.normalize([],L),G=r.Q.normalize([],r.Q.cross([],H,[0,1,0])),$=r.Q.cross([],G,H),q=[G[0],G[1],G[2],0,$[0],$[1],$[2],0,H[0],H[1],H[2],0,0,0,0,1],Y=[L,r.da(M.lat,M.lng),r.da(P.lat,M.lng),r.da(P.lat,P.lng),r.da(M.lat,P.lng),r.da(k,M.lng),r.da(k,P.lng),r.da(M.lat,N),r.da(P.lat,N)],re=r.bV.fromPoints(Y.map(Me=>[r.Q.dot(G,Me),r.Q.dot($,Me),r.Q.dot(H,Me)])),ie=r.Q.transformMat4([],re.center,q);r.Q.squaredLength(ie)===0&&r.Q.set(ie,0,0,1),r.Q.normalize(ie,ie),r.Q.scale(ie,ie,r.ae),D.center=r.db(ie);let ae=D.getWorldToCameraMatrix(),W=r.a9.invert(new Float64Array(16),ae);re=r.bV.applyTransform(re,r.a9.multiply([],ae,q));let K=this._extendAABB(re,D,T,_);if(!K)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=K,r.Q.transformMat4(ie,ie,ae);let fe=.5*(re.max[2]-re.min[2]),he=this._minimumAABBFrustumDistance(D,re),ve=r.Q.scale([],[0,0,1],fe),Ie=r.Q.add(ve,ie,ve),ye=he+(D.pitch===0?0:r.Q.distance(ie,Ie)),Ae=D.globeCenterInViewSpace,Fe=r.Q.sub([],ie,[Ae[0],Ae[1],Ae[2]]);r.Q.normalize(Fe,Fe),r.Q.scale(Fe,Fe,ye);let _e=r.Q.add([],ie,Fe);r.Q.transformMat4(_e,_e,W);let De=r.dc/r.ae,Xe=r.Q.length(_e),be=r.bo(Math.max(Xe*De-r.dc,Number.EPSILON),0),Se=Math.min(D.zoomFromMercatorZAdjusted(be),T.maxZoom);return Se>.5*(r.bJ+r.bA)?(D.setProjection({name:"mercator"}),D.zoom=Se,this._cameraForBounds(D,l,p,_,v,b)):{center:D.center,zoom:Se,bearing:_,pitch:v}}_extendAABB(i,l,p,_){let v=.5*((p.padding.left||0)+(p.padding.right||0)),b=.5*((p.padding.top||0)+(p.padding.bottom||0)),D=b,T=v,M=v,P=b,k=l.width-(T+M),N=l.height-(D+P),L=r.Q.sub([],i.max,i.min),H=Math.min(k/L[0],N/L[1]),G=Math.min(l.scaleZoom(l.scale*H),p.maxZoom);if(isNaN(G))return null;let $=l.scale/l.zoomScale(G),q=new r.bV([i.min[0]-T*$,i.min[1]-P*$,i.min[2]],[i.max[0]+M*$,i.max[1]+D*$,i.max[2]]),Y=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.bm(_));return q.center[0]-=Y.x*$,q.center[1]+=Y.y*$,q}queryTerrainElevation(i,l){let p=this.transform.elevation;return p?(l=r.e({},{exaggerated:!0},l),p.getAtPoint(r.O.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,p,_,v,b){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,l,p,_,v,b);let D=i.clone(),T=this._extendCameraOptions(b);D.bearing=_,D.pitch=v;let M=r.bq.convert(l),P=r.bq.convert(p),k=new r.bq(M.lng,P.lat),N=new r.bq(P.lng,M.lat),L=D.project(M),H=D.project(P),G=this.queryTerrainElevation(M),$=this.queryTerrainElevation(P),q=this.queryTerrainElevation(k),Y=this.queryTerrainElevation(N),re=[[L.x,L.y,Math.min(G||0,$||0,q||0,Y||0)],[H.x,H.y,Math.max(G||0,$||0,q||0,Y||0)]],ie=r.bV.fromPoints(re),ae=D.getWorldToCameraMatrix(),W=r.a9.invert(new Float64Array(16),ae);ie=r.bV.applyTransform(ie,ae);let K=this._extendAABB(ie,D,T,_);if(!K)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=K;let fe=.5*r.Q.sub([],ie.max,ie.min)[2],he=this._minimumAABBFrustumDistance(D,ie),ve=[0,0,1,0];r.aa.transformMat4(ve,ve,ae),r.aa.normalize(ve,ve);let Ie=r.Q.scale([],ve,he+fe),ye=r.Q.add([],ie.center,Ie);r.Q.transformMat4(ie.center,ie.center,W),r.Q.transformMat4(ye,ye,W);let Ae=[ie.center[0],ie.center[1],ye[2]*D.pixelsPerMeter];r.Q.scale(Ae,Ae,1/D.worldSize);let Fe=r.aw(Ae[0]),_e=r.ax(Ae[1]),De=Math.min(D._zoomFromMercatorZ(Ae[2]),T.maxZoom),Xe=new r.bq(Fe,_e);return D.mercatorFromTransition&&De<.5*(r.bJ+r.bA)?(D.setProjection({name:"globe"}),D.zoom=De,this._cameraForBounds(D,l,p,_,v,b)):{center:Xe,zoom:De,bearing:_,pitch:v}}fitBounds(i,l,p){let _=this.cameraForBounds(i,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(i,l,p,_,v){let b=r.P.convert(i),D=r.P.convert(l),T=new r.P(Math.min(b.x,D.x),Math.min(b.y,D.y)),M=new r.P(Math.max(b.x,D.x),Math.max(b.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,D))return this;let P=this.transform.pointLocation3D(T),k=this.transform.pointLocation3D(M),N=this.transform.pointLocation3D(new r.P(T.x,M.y)),L=this.transform.pointLocation3D(new r.P(M.x,T.y)),H=[Math.min(P.lng,k.lng,N.lng,L.lng),Math.min(P.lat,k.lat,N.lat,L.lat)],G=[Math.max(P.lng,k.lng,N.lng,L.lng),Math.max(P.lat,k.lat,N.lat,L.lat)],$=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,H,G,p,$,_);return this._fitInternal(q,_,v)}_fitInternal(i,l,p){return i?(l=r.e(i,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(i,l){this.stop();let p=i.preloadOnly?this.transform.clone():this.transform,_=!1,v=!1,b=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(_=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=r.bq.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(v=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(b=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.b("movestart",l)).fire(new r.b("move",l)),_&&this.fire(new r.b("zoomstart",l)).fire(new r.b("zoom",l)).fire(new r.b("zoomend",l)),v&&this.fire(new r.b("rotatestart",l)).fire(new r.b("rotate",l)).fire(new r.b("rotateend",l)),b&&this.fire(new r.b("pitchstart",l)).fire(new r.b("pitch",l)).fire(new r.b("pitchend",l)),this.fire(new r.b("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(rg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){let p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(rg),this;this.stop();let _=p.zoom,v=p.pitch,b=p.bearing;p.setFreeCameraOptions(i);let D=_!==p.zoom,T=v!==p.pitch,M=b!==p.bearing;return this.fire(new r.b("movestart",l)).fire(new r.b("move",l)),D&&this.fire(new r.b("zoomstart",l)).fire(new r.b("zoom",l)).fire(new r.b("zoomend",l)),M&&this.fire(new r.b("rotatestart",l)).fire(new r.b("rotate",l)).fire(new r.b("rotateend",l)),T&&this.fire(new r.b("pitchstart",l)).fire(new r.b("pitch",l)).fire(new r.b("pitchend",l)),this.fire(new r.b("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=r.e({offset:[0,0],duration:500,easing:r.d8},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);let p=this.transform,_=this.getZoom(),v=this.getBearing(),b=this.getPitch(),D=this.getPadding(),T="zoom"in i?+i.zoom:_,M="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:b,k=this._extendPadding(i.padding),N=r.P.convert(i.offset),L,H,G;if(p.projection.name==="globe"){let he=r.O.fromLngLat(p.center),ve=N.rotate(-p.angle);he.x+=ve.x/p.worldSize,he.y+=ve.y/p.worldSize;let Ie=he.toLngLat(),ye=r.bq.convert(i.center||Ie);this._normalizeCenter(ye),L=p.centerPoint.add(ve),H=new r.P(he.x,he.y).mult(p.worldSize),G=new r.P(r.a8(ye.lng),r.ah(ye.lat)).mult(p.worldSize).sub(H)}else{L=p.centerPoint.add(N);let he=p.pointLocation(L),ve=r.bq.convert(i.center||he);this._normalizeCenter(ve),H=p.project(he),G=p.project(ve).sub(H)}let $=p.zoomScale(T-_),q,Y;i.around&&(q=r.bq.convert(i.around),Y=p.locationPoint(q));let re=this._zooming||T!==_,ie=this._rotating||v!==M,ae=this._pitching||P!==b,W=!p.isPaddingEqual(k),K=he=>ve=>{if(re&&(he.zoom=r.X(_,T,ve)),ie&&(he.bearing=r.X(v,M,ve)),ae&&(he.pitch=r.X(b,P,ve)),W&&(he.interpolatePadding(D,k,ve),L=he.centerPoint.add(N)),q)he.setLocationAtPoint(q,Y);else{let Ie=he.zoomScale(he.zoom-_),ye=T>_?Math.min(2,$):Math.max(.5,$),Ae=Math.pow(ye,1-ve),Fe=he.unproject(H.add(G.mult(ve*Ae)).mult(Ie));he.setLocationAtPoint(he.renderWorldCopies?Fe.wrap():Fe,L)}return i.preloadOnly||this._fireMoveEvents(l),he};if(i.preloadOnly){let he=this._emulate(K,i.duration,p);return this._preloadTiles(he),this}let fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ie,this._pitching=ae,this._padding=W,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,fe),this._ease(K(p),he=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,he)},i),this}_prepareEase(i,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new r.b("movestart",i)),this._zooming&&!p.zooming&&this.fire(new r.b("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new r.b("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new r.b("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.b("move",i)),this._zooming&&this.fire(new r.b("zoom",i)),this._rotating&&this.fire(new r.b("rotate",i)),this._pitching&&this.fire(new r.b("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.b("zoomend",i)),_&&this.fire(new r.b("rotateend",i)),v&&this.fire(new r.b("pitchend",i)),this.fire(new r.b("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){let Se=r.af(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Se,l)}this.stop(),i=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d8},i);let p=this.transform,_=this.getZoom(),v=this.getBearing(),b=this.getPitch(),D=this.getPadding(),T="zoom"in i?r.ad(+i.zoom,p.minZoom,p.maxZoom):_,M="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:b,k=this._extendPadding(i.padding),N=p.zoomScale(T-_),L=r.P.convert(i.offset),H=p.centerPoint.add(L),G=p.pointLocation(H),$=r.bq.convert(i.center||G);this._normalizeCenter($);let q=p.project(G),Y=p.project($).sub(q),re=i.curve,ie=Math.max(p.width,p.height),ae=ie/N,W=Y.mag();if("minZoom"in i){let Se=r.ad(Math.min(i.minZoom,_,T),p.minZoom,p.maxZoom),Me=ie/p.zoomScale(Se-_);re=Math.sqrt(Me/W*2)}let K=re*re;function fe(Se){let Me=(ae*ae-ie*ie+(Se?-1:1)*K*K*W*W)/(2*(Se?ae:ie)*K*W);return Math.log(Math.sqrt(Me*Me+1)-Me)}function he(Se){return(Math.exp(Se)-Math.exp(-Se))/2}function ve(Se){return(Math.exp(Se)+Math.exp(-Se))/2}let Ie=fe(0),ye=function(Se){return ve(Ie)/ve(Ie+re*Se)},Ae=function(Se){return ie*((ve(Ie)*(he(Me=Ie+re*Se)/ve(Me))-he(Ie))/K)/W;var Me},Fe=(fe(1)-Ie)/re;if(Math.abs(W)<1e-6||!isFinite(Fe)){if(Math.abs(ie-ae)<1e-6)return this.easeTo(i,l);let Se=ae<ie?-1:1;Fe=Math.abs(Math.log(ae/ie))/re,Ae=function(){return 0},ye=function(Me){return Math.exp(Se*re*Me)}}i.duration="duration"in i?+i.duration:1e3*Fe/("screenSpeed"in i?+i.screenSpeed/re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);let _e=v!==M,De=P!==b,Xe=!p.isPaddingEqual(k),be=Se=>Me=>{let oe=Me*Fe,Ve=1/ye(oe);Se.zoom=Me===1?T:_+Se.scaleZoom(Ve),_e&&(Se.bearing=r.X(v,M,Me)),De&&(Se.pitch=r.X(b,P,Me)),Xe&&(Se.interpolatePadding(D,k,Me),H=Se.centerPoint.add(L));let yt=Me===1?$:Se.unproject(q.add(Y.mult(Ae(oe))).mult(Ve));return Se.setLocationAtPoint(Se.renderWorldCopies?yt.wrap():yt,H),Se._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),Se};if(i.preloadOnly){let Se=this._emulate(be,i.duration,p);return this._preloadTiles(Se),this}return this._zooming=!0,this._rotating=_e,this._pitching=De,this._padding=Xe,this._prepareEase(l,!1),this._ease(be(p),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!i){let p=this.handlers;p&&p.stop(!1)}return this}_ease(i,l,p){p.animate===!1||p.duration===0?(i(1),l()):(this._easeStart=r.f.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let i=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=r.bk(i,-180,180);let p=Math.abs(i-l);return Math.abs(i-360-l)<p&&(i-=360),Math.abs(i+360-l)<p&&(i+=360),i}_normalizeCenter(i){let l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;let p=i.lng-l.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,p){let _=Math.ceil(15*l/1e3),v=[],b=i(p.clone());for(let D=0;D<=_;D++){let T=b(D/_);v.push(T.clone())}return v}_preloadTiles(i,l){}}class Dp{constructor(i={}){this.options=i,r.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){let l=this.options&&this.options.compact;return this._map=i,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V("button","mapboxgl-ctrl-attrib-button",this._container),V("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){let p=this._map._getUIString(`AttributionControl.${l}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.dd.ACCESS_TOKEN}];if(i){let p=l.reduce((_,v,b)=>(v.value&&(_+=`${v.key}=${v.value}${b<l.length-1?"&":""}`),_),"?");i.href=`${r.dd.FEEDBACK_URL}/${p}#${$0(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let l=this._map.style._mergedSourceCaches;for(let _ in l){let v=l[_];if(v.used){let b=v.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort((_,v)=>_.length-v.length),i=i.filter((_,v)=>{for(let b=v+1;b<i.length;b++)if(i[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));let p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class og{constructor(){r.a$(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=V("div","mapboxgl-ctrl");let l=V("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(let l in i){let p=i[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let i=this._container.children;if(i.length){let l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Wh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){let l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){let l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(let _ of p)if(_.id===i)return void(_.cancelled=!0)}run(i=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let p of l)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zh(d,i,l){if(d=new r.bq(d.lng,d.lat),i){let p=new r.bq(d.lng-360,d.lat),_=new r.bq(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),b=l.locationPoint(d).distSqr(i),D=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(p).distSqr(i)<b&&(D||Math.abs(p.lng-l.center.lng)<v)?d=p:l.locationPoint(_).distSqr(i)<b&&(D||Math.abs(_.lng-l.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){let p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}let Pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class su extends r.E{constructor(i,l){if(super(),(i instanceof HTMLElement||l)&&(i=r.e({element:i},l)),r.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=V("div");let v=41,b=27,D=Z("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),T=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},D));Z("stop",{offset:"10%","stop-opacity":.4},T),Z("stop",{offset:"100%","stop-opacity":.05},T),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let p=this._element.classList;for(let v in Pl)p.remove(`mapboxgl-marker-anchor-${v}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);let _=i&&i.className?i.className.trim().split(/\s+/):[];p.add(..._),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){let i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.bq.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){let l=i.code,p=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){let l=i.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let i=this._map,l=this._pos;if(!i||!l)return!1;let p=i.unproject(l),_=i.getFreeCameraOptions();if(!_.position)return!1;let v=_.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let i=this._map;if(!i)return;let l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();let p=i.unproject(l),_;i._showingGlobe()&&r.de(i.transform,this._lngLat)?_=0:(_=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let i=this._pos;if(!i||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Pl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){let i=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!i||p!=="map")return"";if(!l._showingGlobe()){let T=l.getPitch();return T?`rotateX(${T}deg)`:""}let _=r.bI(r.df(l.transform,this._lngLat)),v=i.sub(r.dg(l.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";let D=_/b;return`rotateX(${-v.y*D}deg) rotateY(${v.x*D}deg)`}_calculateZTransform(){let i=this._pos,l=this._map;if(!l||!i)return"";let p=0,_=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){let v=l.project(new r.bq(this._lngLat.lng,this._lngLat.lat+.001)),b=l.project(new r.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=r.bI(Math.atan2(b.y,b.x))-90}else p=-l.getBearing();else if(_==="horizon"){let v=r.S(4,6,l.getZoom()),b=r.dg(l.transform);b.y+=v*l.transform.height;let D=i.sub(b),T=r.bI(Math.atan2(D.y,D.x));p=(T>90?T-270:T+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Zh(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){let l=this._map;if(!l)return;let p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){let v=this._clickTolerance||l._clickTolerance;if(i.point.dist(p)<v)return;this._isDragging=!0}this._pos=i.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(i){let l=this._map,p=this._pos;l&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;let l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let au={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sg=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lu(d=new r.P(0,0),i="bottom"){if(typeof d=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new r.P(0,d);case"top-left":return new r.P(l,l);case"top-right":return new r.P(-l,l);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(l,-l);case"bottom-right":return new r.P(-l,-l);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[i]||[0,0])}class Qh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;let l=r.ch((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,p){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+p}}class ag{registerParameter(i,l,p,_,v){}registerButton(i,l,p){}registerBinding(i,l,p,_){}refreshUI(){}}let ca={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},gs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ol={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yh{constructor(i,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new _p({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new Va({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),Ce()}move(i,l){let p=this.map,_=this.mouseRotate.mousemoveWindow(i,l),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){let b=this.mousePitch.mousemoveWindow(i,l),D=b&&b.pitchDelta;D&&p.setPitch(p.getPitch()+D)}}off(){let i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Te(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.e({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ke(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ke(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pe(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Pe(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let It={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},lg={maxWidth:100,unit:"metric"},cg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.du,supported:I,setRTLTextPlugin:r.dw,getRTLTextPluginStatus:r.dx,Map:class extends Uv{constructor(d){let i=d;if((d=r.e({},gs,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.dh(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new vh(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Wh,this._domRenderTaskQueue=new Wh,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aF(),this._locale=r.e({},ca,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.di(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?$t({},d.contextCreateOptions):{},typeof d.container=="string"){let l=document.getElementById(d.container);if(!l)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=l}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),r.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=d.devtools?new ag(this):new ag,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ou(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.dd.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new kv(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let l=d.bounds;l&&(this.resize(),this.fitBounds(l,r.e({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Dp({customAttribution:d.customAttribution})),this._logoControl=new og,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new r.b(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new r.b(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=d.onAdd(this);this._controls.push(d);let p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let i=!this._moving;return i&&this.fire(new r.b("movestart",d)).fire(new r.b("move",d)),this.fire(new r.b("resize",d)),i&&this.fire(new r.b("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.ag.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?navigator.language:i):d}setLanguage(d){let i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,i=d.projection.name,l;i==="globe"&&d.zoom>=r.bA?(d.setMercatorFromTransition(),l=!0):i==="mercator"&&d.zoom<r.bA&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;return i=d.name==="globe"&&this.transform.zoom>=r.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(r.bq.convert(d))}unproject(d){return this.transform.pointLocation3D(r.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,l){if(d==="mouseenter"||d==="mouseover"){let p=!1,_=b=>{let D=i.filter(M=>this.getLayer(M)),T=D.length?this.queryRenderedFeatures(b.point,{layers:D}):[];T.length?p||(p=!0,l.call(this,new Pr(d,this,b.originalEvent,{features:T}))):p=!1},v=()=>{p=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:_,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let p=!1,_=b=>{let D=i.filter(T=>this.getLayer(T));(D.length?this.queryRenderedFeatures(b.point,{layers:D}):[]).length?p=!0:p&&(p=!1,l.call(this,new Pr(d,this,b.originalEvent)))},v=b=>{p&&(p=!1,l.call(this,new Pr(d,this,b.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:_,mouseout:v}}}{let p=_=>{let v=i.filter(D=>this.getLayer(D)),b=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];b.length&&(_.features=b,l.call(this,_),delete _.features)};return{layers:new Set(i),listener:l,delegates:{[d]:p}}}}on(d,i,l){if(l===void 0)return super.on(d,i);if(Array.isArray(i)||(i=[i]),i){for(let _ of i)if(!this._isValidId(_))return this}let p=this._createDelegatedListener(d,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(let _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,i,l){if(l===void 0)return super.once(d,i);if(Array.isArray(i)||(i=[i]),i){for(let _ of i)if(!this._isValidId(_))return this}let p=this._createDelegatedListener(d,i,l);for(let _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,i,l){if(l===void 0)return super.off(d,i);i=new Set(Array.isArray(i)?i:[i]);for(let v of i)if(!this._isValidId(v))return this;let p=(v,b)=>{if(v.size!==b.size)return!1;for(let D of v)if(!b.has(D))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(v=>{for(let b=0;b<v.length;b++){let D=v[b];if(D.listener===l&&p(D.layers,i)){for(let T in D.delegates)this.off(T,D.delegates[T]);return v.splice(b,1),this}}})(_),this}queryRenderedFeatures(d,i){if(!this.style)return[];if(i!==void 0||d===void 0||d instanceof r.P||Array.isArray(d)||(i=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(let l of i.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(d,i,this.transform)}querySourceFeatures(d,i){return this._isValidId(d)?this.style.querySourceFeatures(d,i):[]}isPointOnSurface(d){let{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}setStyle(d,i){return i=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&d&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(d,(l,p)=>{l?(r.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(d,i)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){let i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){let l=r.e({},i);i&&i.config&&(l.initialConfig=i.config,delete l.config),this.style=new Jo(this,l).setEventedParent(this,{style:this.style}).load(d)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Jo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c9(d)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,i){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,l)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,i,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){let{width:D,height:T,data:M}=r.f.getImageData(i);this.style.addImage(d,{data:new r.h({width:D,height:T},M),pixelRatio:l,stretchX:_,stretchY:v,content:b,sdf:p,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:D,height:T}=i,M=i;this.style.addImage(d,{data:new r.h({width:D,height:T},new Uint8Array(M.data)),pixelRatio:l,stretchX:_,stretchY:v,content:b,sdf:p,version:0,userImage:M}),M.onAdd&&M.onAdd(this,d)}}updateImage(d,i){this._lazyInitEmptyStyle();let l=this.style.getImage(d);if(!l)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.f.getImageData(i):i,{width:_,height:v}=p,b=p.data;if(_===void 0||v===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==l.data.width||v!==l.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));let D=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);l.data.replace(b,D),this.style.updateImage(d,l)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){r.d(this._requestManager.transformRequest(d,r.R.Image),(l,p)=>{i(l,p instanceof HTMLImageElement?r.f.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(d,i){this._lazyInitEmptyStyle(),this.style.addModel(d,i)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,i){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)):this}getSlot(d){let i=this.getLayer(d);return i&&i.slot||null}setSlot(d,i){return this.style.setSlot(d,i),this.style.mergeLayers(),this._update(!0)}addImport(d,i){return this.style.addImport(d,i),this}updateImport(d,i){return typeof i!="string"&&i.id!==d?(this.removeImport(d),this.addImport(i)):(this.style.updateImport(d,i),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,i){return this.style.moveImport(d,i),this._update(!0)}moveLayer(d,i){return this._isValidId(d)?(this.style.moveLayer(d,i),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){return this._isValidId(d)?this.style.getOwnLayer(d):null}setLayerZoomRange(d,i,l){return this._isValidId(d)?(this.style.setLayerZoomRange(d,i,l),this._update(!0)):this}setFilter(d,i,l={}){return this._isValidId(d)?(this.style.setFilter(d,i,l),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,i,l,p={}){return this._isValidId(d)?(this.style.setPaintProperty(d,i,l,p),this._update(!0)):this}getPaintProperty(d,i){return this._isValidId(d)?this.style.getPaintProperty(d,i):null}setLayoutProperty(d,i,l,p={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,i,l,p),this._update(!0)):this}getLayoutProperty(d,i){return this._isValidId(d)?this.style.getLayoutProperty(d,i):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,i){return this.style.setSchema(d,i),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,i){return this.style.setConfig(d,i),this._update(!0)}getConfigProperty(d,i){return this.style.getConfigProperty(d,i)}setConfigProperty(d,i,l){return this.style.setConfigProperty(d,i,l),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let i=d[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bq.convert(d),this.transform):0}setFeatureState(d,i){return this._isValidId(d.source)?(this.style.setFeatureState(d,i),this._update()):this}removeFeatureState(d,i){return this._isValidId(d.source)?(this.style.removeFeatureState(d,i),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300,l,p,_,v=this._container;for(;v&&(!p||!_);){let b=window.getComputedStyle(v).transform;b&&b!=="none"&&(l=b.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(d/p):d,this._containerHeight=_?Math.abs(i/_):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=V("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let i=this._canvasContainer=V("div","mapboxgl-canvas-container",d);this._canvas=V("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=V("div","mapboxgl-control-container",d),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=V("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){let l=r.f.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){let d=r.e({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",d);i?(r.dj(i,!0),this.painter=new G0(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dk.testSupport(i)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;this.fire(new r.b("renderstart"));let l=this.painter.context.extTimerQuery,p=r.f.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=_.createQuery(),_.beginQuery(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let T=this.transform.zoom,M=this.transform.pitch,P=r.f.now(),k=new r.N(T,{now:P,fadeDuration:v,pitch:M,transition:this.style.transition});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){let T=r.f.now()-p;_.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{let M=_.getQueryParameter(i,_.QUERY_RESULT)/1e6;_.deleteQuery(i),this.fire(new r.b("gpu-timing-frame",{cpuTime:T,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){let T=this.painter.collectGpuTimers();setTimeout(()=>{let M=this.painter.queryGpuTimers(T);this.fire(new r.b("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){let T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let M=this.painter.queryGpuTimeDeferredRender(T);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:M}))},50)}let D=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(D||this._repaint)this.triggerRepaint();else{let T=!this.isMoving()&&this.loaded();if(T&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let M=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(let i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){let l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);let p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let _=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=d;let b=Math.abs(_-v);if(b>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===r.dn||d.status===401)){let i=this.painter.context.gl;r.dj(i,!1),this._logoControl instanceof og&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());let l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);let b=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,b),b}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),i.canvasCopies.map(_),i.timeStamps)}_canvasPixelComparison(d,i,l){let p=l[1]-l[0],_=d.length/4;for(let v=0;v<i.length;v++){let b=i[v],D=0;for(let T=0;T<b.length;T+=4)b[T]===d[T]&&b[T+1]===d[T+1]&&b[T+2]===d[T+2]&&b[T+3]===d[T+3]&&(D+=1);p+=(l[v+2]-l[v+1])*(1-D/_)}return p}remove(){this._hash&&this._hash.remove();for(let i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dr(this.painter.context.gl),r.ds.remove(),r.dt.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.f.frame(i=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(d){let i=this.style?this.style.getSourceCaches():[];return r.b4(i,(l,p)=>l._preloadTiles(d,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,i){r.dv(d,i)}get version(){return r.du}},NavigationControl:class{constructor(d){this.options=r.e({},Ol,d),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),V("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),V("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=V("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let i=d.getZoom(),l=i===d.getMaxZoom(),p=i===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yh(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){let l=V("button",d,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(d,i){if(!this._map)return;let l=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends r.E{constructor(d){super();let i=navigator.geolocation;this.options=r.e({geolocation:i},It,d),r.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=H0(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>i(l.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){let i=this._map.getMaxBounds(),l=d.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",d)),this._finish()}}_updateCamera(d){let i=new r.bq(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=r.e({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){let i=new r.bq(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,i=r.bo(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=V("button","mapboxgl-ctrl-geolocate",this._container),V("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V("div","mapboxgl-user-location"),this._dotElement.appendChild(V("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new su({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new su({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dp,ScaleControl:class{constructor(d){this.options=r.e({},lg,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,p=i._containerWidth/2-d/2,_=i.unproject([p,l]),v=i.unproject([p+d,l]),b=_.distanceTo(v);if(this.options.unit==="imperial"){let D=3.2808*b;D>5280?this._setScale(d,D/5280,"mile"):this._setScale(d,D,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,i,l){this._map._requestDomTask(()=>{let p=function(v){let b=Math.pow(10,`${Math.floor(v)}`.length-1),D=v/b;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(T){let M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M}(D),b*D}(i),_=p/i;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${cg[l]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=V("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(d){super(),this.options=r.e(Object.create(au),d),r.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.bq.convert(d),this._pos=null,this._trackPointer=!1,this._update();let i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let i=document.createDocumentFragment(),l=document.createElement("body"),p;for(l.innerHTML=d;p=l.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=V("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){let l=this._closeButton=V("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let i=this._map,l=this._container,p=this._pos;if(!i||!l||!p)return"bottom";let _=l.offsetWidth,v=l.offsetHeight,b=p.x<_/2,D=p.x>i.transform.width-_/2;if(p.y+d<v)return b?"top-left":D?"top-right":"top";if(p.y>i.transform.height-v){if(b)return"bottom-left";if(D)return"bottom-right"}return b?"left":D?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){let i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=V("div","mapboxgl-popup",i.getContainer()),this._tip=V("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zh(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){let _=this._pos=this._trackPointer&&d?d:i.project(this._lngLat),v=lu(this.options.offset),b=this._anchor=this._getAnchor(v.y),D=lu(this.options.offset,b),T=_.add(D).round();i._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Pl[b]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&i._showingGlobe()){let _=r.de(i.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(sg);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:su,Style:Jo,LngLat:r.bq,LngLatBounds:r.ag,Point:r.P,MercatorCoordinate:r.O,FreeCameraOptions:_l,Evented:r.E,config:r.dd,prewarm:r.dy,clearPrewarmedResources:r.dz,get accessToken(){return r.dd.ACCESS_TOKEN},set accessToken(d){r.dd.ACCESS_TOKEN=d},get baseApiUrl(){return r.dd.API_URL},set baseApiUrl(d){r.dd.API_URL=d},get workerCount(){return r.dA.workerCount},set workerCount(d){r.dA.workerCount=d},get maxParallelImageRequests(){return r.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.dd.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.dB(d)},get workerUrl(){return r.dC.workerUrl},set workerUrl(d){r.dC.workerUrl=d},get workerClass(){return r.dC.workerClass},set workerClass(d){r.dC.workerClass=d},get workerParams(){return r.dC.workerParams},set workerParams(d){r.dC.workerParams=d},get dracoUrl(){return r.dD()},set dracoUrl(d){r.dE(d)},get meshoptUrl(){return r.dF()},set meshoptUrl(d){r.dG(d)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var g=f;return g})});var wO=fi(()=>{"use strict"});var xi=fi((I1,DO)=>{"use strict";(function(s,o){typeof I1=="object"?DO.exports=I1=o():typeof define=="function"&&define.amd?define([],o):s.CryptoJS=o()})(I1,function(){var s=s||function(o,f){var u;if(typeof window<"u"&&window.crypto&&(u=window.crypto),typeof self<"u"&&self.crypto&&(u=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(u=globalThis.crypto),!u&&typeof window<"u"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof global<"u"&&global.crypto&&(u=global.crypto),!u&&typeof zT=="function")try{u=wO()}catch{}var g=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function ce(){}return function(me){var ke;return ce.prototype=me,ke=new ce,ce.prototype=null,ke}}(),E={},I=E.lib={},O=I.Base=function(){return{extend:function(ce){var me=r(this);return ce&&me.mixIn(ce),(!me.hasOwnProperty("init")||this.init===me.init)&&(me.init=function(){me.$super.init.apply(this,arguments)}),me.init.prototype=me,me.$super=this,me},create:function(){var ce=this.extend();return ce.init.apply(ce,arguments),ce},init:function(){},mixIn:function(ce){for(var me in ce)ce.hasOwnProperty(me)&&(this[me]=ce[me]);ce.hasOwnProperty("toString")&&(this.toString=ce.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),U=I.WordArray=O.extend({init:function(ce,me){ce=this.words=ce||[],me!=f?this.sigBytes=me:this.sigBytes=ce.length*4},toString:function(ce){return(ce||Z).stringify(this)},concat:function(ce){var me=this.words,ke=ce.words,Pe=this.sigBytes,Ze=ce.sigBytes;if(this.clamp(),Pe%4)for(var $e=0;$e<Ze;$e++){var ot=ke[$e>>>2]>>>24-$e%4*8&255;me[Pe+$e>>>2]|=ot<<24-(Pe+$e)%4*8}else for(var bt=0;bt<Ze;bt+=4)me[Pe+bt>>>2]=ke[bt>>>2];return this.sigBytes+=Ze,this},clamp:function(){var ce=this.words,me=this.sigBytes;ce[me>>>2]&=4294967295<<32-me%4*8,ce.length=o.ceil(me/4)},clone:function(){var ce=O.clone.call(this);return ce.words=this.words.slice(0),ce},random:function(ce){for(var me=[],ke=0;ke<ce;ke+=4)me.push(g());return new U.init(me,ce)}}),V=E.enc={},Z=V.Hex={stringify:function(ce){for(var me=ce.words,ke=ce.sigBytes,Pe=[],Ze=0;Ze<ke;Ze++){var $e=me[Ze>>>2]>>>24-Ze%4*8&255;Pe.push(($e>>>4).toString(16)),Pe.push(($e&15).toString(16))}return Pe.join("")},parse:function(ce){for(var me=ce.length,ke=[],Pe=0;Pe<me;Pe+=2)ke[Pe>>>3]|=parseInt(ce.substr(Pe,2),16)<<24-Pe%8*4;return new U.init(ke,me/2)}},te=V.Latin1={stringify:function(ce){for(var me=ce.words,ke=ce.sigBytes,Pe=[],Ze=0;Ze<ke;Ze++){var $e=me[Ze>>>2]>>>24-Ze%4*8&255;Pe.push(String.fromCharCode($e))}return Pe.join("")},parse:function(ce){for(var me=ce.length,ke=[],Pe=0;Pe<me;Pe++)ke[Pe>>>2]|=(ce.charCodeAt(Pe)&255)<<24-Pe%4*8;return new U.init(ke,me)}},se=V.Utf8={stringify:function(ce){try{return decodeURIComponent(escape(te.stringify(ce)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(ce){return te.parse(unescape(encodeURIComponent(ce)))}},pe=I.BufferedBlockAlgorithm=O.extend({reset:function(){this._data=new U.init,this._nDataBytes=0},_append:function(ce){typeof ce=="string"&&(ce=se.parse(ce)),this._data.concat(ce),this._nDataBytes+=ce.sigBytes},_process:function(ce){var me,ke=this._data,Pe=ke.words,Ze=ke.sigBytes,$e=this.blockSize,ot=$e*4,bt=Ze/ot;ce?bt=o.ceil(bt):bt=o.max((bt|0)-this._minBufferSize,0);var Tt=bt*$e,qt=o.min(Tt*4,Ze);if(Tt){for(var st=0;st<Tt;st+=$e)this._doProcessBlock(Pe,st);me=Pe.splice(0,Tt),ke.sigBytes-=qt}return new U.init(me,qt)},clone:function(){var ce=O.clone.call(this);return ce._data=this._data.clone(),ce},_minBufferSize:0}),Ce=I.Hasher=pe.extend({cfg:O.extend(),init:function(ce){this.cfg=this.cfg.extend(ce),this.reset()},reset:function(){pe.reset.call(this),this._doReset()},update:function(ce){return this._append(ce),this._process(),this},finalize:function(ce){ce&&this._append(ce);var me=this._doFinalize();return me},blockSize:512/32,_createHelper:function(ce){return function(me,ke){return new ce.init(ke).finalize(me)}},_createHmacHelper:function(ce){return function(me,ke){return new Te.HMAC.init(ce,ke).finalize(me)}}}),Te=E.algo={};return E}(Math);return s})});var Xm=fi((M1,CO)=>{"use strict";(function(s,o){typeof M1=="object"?CO.exports=M1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(M1,function(s){return function(o){var f=s,u=f.lib,g=u.Base,r=u.WordArray,E=f.x64={},I=E.Word=g.extend({init:function(U,V){this.high=U,this.low=V}}),O=E.WordArray=g.extend({init:function(U,V){U=this.words=U||[],V!=o?this.sigBytes=V:this.sigBytes=U.length*8},toX32:function(){for(var U=this.words,V=U.length,Z=[],te=0;te<V;te++){var se=U[te];Z.push(se.high),Z.push(se.low)}return r.create(Z,this.sigBytes)},clone:function(){for(var U=g.clone.call(this),V=U.words=this.words.slice(0),Z=V.length,te=0;te<Z;te++)V[te]=V[te].clone();return U}})}(),s})});var AO=fi((F1,EO)=>{"use strict";(function(s,o){typeof F1=="object"?EO.exports=F1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(F1,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,f=o.lib,u=f.WordArray,g=u.init,r=u.init=function(E){if(E instanceof ArrayBuffer&&(E=new Uint8Array(E)),(E instanceof Int8Array||typeof Uint8ClampedArray<"u"&&E instanceof Uint8ClampedArray||E instanceof Int16Array||E instanceof Uint16Array||E instanceof Int32Array||E instanceof Uint32Array||E instanceof Float32Array||E instanceof Float64Array)&&(E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),E instanceof Uint8Array){for(var I=E.byteLength,O=[],U=0;U<I;U++)O[U>>>2]|=E[U]<<24-U%4*8;g.call(this,O,I)}else g.apply(this,arguments)};r.prototype=u}}(),s.lib.WordArray})});var SO=fi((P1,TO)=>{"use strict";(function(s,o){typeof P1=="object"?TO.exports=P1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(P1,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=o.enc,r=g.Utf16=g.Utf16BE={stringify:function(I){for(var O=I.words,U=I.sigBytes,V=[],Z=0;Z<U;Z+=2){var te=O[Z>>>2]>>>16-Z%4*8&65535;V.push(String.fromCharCode(te))}return V.join("")},parse:function(I){for(var O=I.length,U=[],V=0;V<O;V++)U[V>>>1]|=I.charCodeAt(V)<<16-V%2*16;return u.create(U,O*2)}};g.Utf16LE={stringify:function(I){for(var O=I.words,U=I.sigBytes,V=[],Z=0;Z<U;Z+=2){var te=E(O[Z>>>2]>>>16-Z%4*8&65535);V.push(String.fromCharCode(te))}return V.join("")},parse:function(I){for(var O=I.length,U=[],V=0;V<O;V++)U[V>>>1]|=E(I.charCodeAt(V)<<16-V%2*16);return u.create(U,O*2)}};function E(I){return I<<8&4278255360|I>>>8&16711935}}(),s.enc.Utf16})});var wc=fi((O1,IO)=>{"use strict";(function(s,o){typeof O1=="object"?IO.exports=O1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(O1,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=o.enc,r=g.Base64={stringify:function(I){var O=I.words,U=I.sigBytes,V=this._map;I.clamp();for(var Z=[],te=0;te<U;te+=3)for(var se=O[te>>>2]>>>24-te%4*8&255,pe=O[te+1>>>2]>>>24-(te+1)%4*8&255,Ce=O[te+2>>>2]>>>24-(te+2)%4*8&255,Te=se<<16|pe<<8|Ce,ce=0;ce<4&&te+ce*.75<U;ce++)Z.push(V.charAt(Te>>>6*(3-ce)&63));var me=V.charAt(64);if(me)for(;Z.length%4;)Z.push(me);return Z.join("")},parse:function(I){var O=I.length,U=this._map,V=this._reverseMap;if(!V){V=this._reverseMap=[];for(var Z=0;Z<U.length;Z++)V[U.charCodeAt(Z)]=Z}var te=U.charAt(64);if(te){var se=I.indexOf(te);se!==-1&&(O=se)}return E(I,O,V)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function E(I,O,U){for(var V=[],Z=0,te=0;te<O;te++)if(te%4){var se=U[I.charCodeAt(te-1)]<<te%4*2,pe=U[I.charCodeAt(te)]>>>6-te%4*2,Ce=se|pe;V[Z>>>2]|=Ce<<24-Z%4*8,Z++}return u.create(V,Z)}}(),s.enc.Base64})});var FO=fi((R1,MO)=>{"use strict";(function(s,o){typeof R1=="object"?MO.exports=R1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(R1,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=o.enc,r=g.Base64url={stringify:function(I,O){O===void 0&&(O=!0);var U=I.words,V=I.sigBytes,Z=O?this._safe_map:this._map;I.clamp();for(var te=[],se=0;se<V;se+=3)for(var pe=U[se>>>2]>>>24-se%4*8&255,Ce=U[se+1>>>2]>>>24-(se+1)%4*8&255,Te=U[se+2>>>2]>>>24-(se+2)%4*8&255,ce=pe<<16|Ce<<8|Te,me=0;me<4&&se+me*.75<V;me++)te.push(Z.charAt(ce>>>6*(3-me)&63));var ke=Z.charAt(64);if(ke)for(;te.length%4;)te.push(ke);return te.join("")},parse:function(I,O){O===void 0&&(O=!0);var U=I.length,V=O?this._safe_map:this._map,Z=this._reverseMap;if(!Z){Z=this._reverseMap=[];for(var te=0;te<V.length;te++)Z[V.charCodeAt(te)]=te}var se=V.charAt(64);if(se){var pe=I.indexOf(se);pe!==-1&&(U=pe)}return E(I,U,Z)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function E(I,O,U){for(var V=[],Z=0,te=0;te<O;te++)if(te%4){var se=U[I.charCodeAt(te-1)]<<te%4*2,pe=U[I.charCodeAt(te)]>>>6-te%4*2,Ce=se|pe;V[Z>>>2]|=Ce<<24-Z%4*8,Z++}return u.create(V,Z)}}(),s.enc.Base64url})});var Dc=fi((k1,PO)=>{"use strict";(function(s,o){typeof k1=="object"?PO.exports=k1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(k1,function(s){return function(o){var f=s,u=f.lib,g=u.WordArray,r=u.Hasher,E=f.algo,I=[];(function(){for(var se=0;se<64;se++)I[se]=o.abs(o.sin(se+1))*4294967296|0})();var O=E.MD5=r.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(se,pe){for(var Ce=0;Ce<16;Ce++){var Te=pe+Ce,ce=se[Te];se[Te]=(ce<<8|ce>>>24)&16711935|(ce<<24|ce>>>8)&4278255360}var me=this._hash.words,ke=se[pe+0],Pe=se[pe+1],Ze=se[pe+2],$e=se[pe+3],ot=se[pe+4],bt=se[pe+5],Tt=se[pe+6],qt=se[pe+7],st=se[pe+8],_t=se[pe+9],wt=se[pe+10],Dt=se[pe+11],tn=se[pe+12],Yt=se[pe+13],In=se[pe+14],zn=se[pe+15],qe=me[0],xt=me[1],ht=me[2],mt=me[3];qe=U(qe,xt,ht,mt,ke,7,I[0]),mt=U(mt,qe,xt,ht,Pe,12,I[1]),ht=U(ht,mt,qe,xt,Ze,17,I[2]),xt=U(xt,ht,mt,qe,$e,22,I[3]),qe=U(qe,xt,ht,mt,ot,7,I[4]),mt=U(mt,qe,xt,ht,bt,12,I[5]),ht=U(ht,mt,qe,xt,Tt,17,I[6]),xt=U(xt,ht,mt,qe,qt,22,I[7]),qe=U(qe,xt,ht,mt,st,7,I[8]),mt=U(mt,qe,xt,ht,_t,12,I[9]),ht=U(ht,mt,qe,xt,wt,17,I[10]),xt=U(xt,ht,mt,qe,Dt,22,I[11]),qe=U(qe,xt,ht,mt,tn,7,I[12]),mt=U(mt,qe,xt,ht,Yt,12,I[13]),ht=U(ht,mt,qe,xt,In,17,I[14]),xt=U(xt,ht,mt,qe,zn,22,I[15]),qe=V(qe,xt,ht,mt,Pe,5,I[16]),mt=V(mt,qe,xt,ht,Tt,9,I[17]),ht=V(ht,mt,qe,xt,Dt,14,I[18]),xt=V(xt,ht,mt,qe,ke,20,I[19]),qe=V(qe,xt,ht,mt,bt,5,I[20]),mt=V(mt,qe,xt,ht,wt,9,I[21]),ht=V(ht,mt,qe,xt,zn,14,I[22]),xt=V(xt,ht,mt,qe,ot,20,I[23]),qe=V(qe,xt,ht,mt,_t,5,I[24]),mt=V(mt,qe,xt,ht,In,9,I[25]),ht=V(ht,mt,qe,xt,$e,14,I[26]),xt=V(xt,ht,mt,qe,st,20,I[27]),qe=V(qe,xt,ht,mt,Yt,5,I[28]),mt=V(mt,qe,xt,ht,Ze,9,I[29]),ht=V(ht,mt,qe,xt,qt,14,I[30]),xt=V(xt,ht,mt,qe,tn,20,I[31]),qe=Z(qe,xt,ht,mt,bt,4,I[32]),mt=Z(mt,qe,xt,ht,st,11,I[33]),ht=Z(ht,mt,qe,xt,Dt,16,I[34]),xt=Z(xt,ht,mt,qe,In,23,I[35]),qe=Z(qe,xt,ht,mt,Pe,4,I[36]),mt=Z(mt,qe,xt,ht,ot,11,I[37]),ht=Z(ht,mt,qe,xt,qt,16,I[38]),xt=Z(xt,ht,mt,qe,wt,23,I[39]),qe=Z(qe,xt,ht,mt,Yt,4,I[40]),mt=Z(mt,qe,xt,ht,ke,11,I[41]),ht=Z(ht,mt,qe,xt,$e,16,I[42]),xt=Z(xt,ht,mt,qe,Tt,23,I[43]),qe=Z(qe,xt,ht,mt,_t,4,I[44]),mt=Z(mt,qe,xt,ht,tn,11,I[45]),ht=Z(ht,mt,qe,xt,zn,16,I[46]),xt=Z(xt,ht,mt,qe,Ze,23,I[47]),qe=te(qe,xt,ht,mt,ke,6,I[48]),mt=te(mt,qe,xt,ht,qt,10,I[49]),ht=te(ht,mt,qe,xt,In,15,I[50]),xt=te(xt,ht,mt,qe,bt,21,I[51]),qe=te(qe,xt,ht,mt,tn,6,I[52]),mt=te(mt,qe,xt,ht,$e,10,I[53]),ht=te(ht,mt,qe,xt,wt,15,I[54]),xt=te(xt,ht,mt,qe,Pe,21,I[55]),qe=te(qe,xt,ht,mt,st,6,I[56]),mt=te(mt,qe,xt,ht,zn,10,I[57]),ht=te(ht,mt,qe,xt,Tt,15,I[58]),xt=te(xt,ht,mt,qe,Yt,21,I[59]),qe=te(qe,xt,ht,mt,ot,6,I[60]),mt=te(mt,qe,xt,ht,Dt,10,I[61]),ht=te(ht,mt,qe,xt,Ze,15,I[62]),xt=te(xt,ht,mt,qe,_t,21,I[63]),me[0]=me[0]+qe|0,me[1]=me[1]+xt|0,me[2]=me[2]+ht|0,me[3]=me[3]+mt|0},_doFinalize:function(){var se=this._data,pe=se.words,Ce=this._nDataBytes*8,Te=se.sigBytes*8;pe[Te>>>5]|=128<<24-Te%32;var ce=o.floor(Ce/4294967296),me=Ce;pe[(Te+64>>>9<<4)+15]=(ce<<8|ce>>>24)&16711935|(ce<<24|ce>>>8)&4278255360,pe[(Te+64>>>9<<4)+14]=(me<<8|me>>>24)&16711935|(me<<24|me>>>8)&4278255360,se.sigBytes=(pe.length+1)*4,this._process();for(var ke=this._hash,Pe=ke.words,Ze=0;Ze<4;Ze++){var $e=Pe[Ze];Pe[Ze]=($e<<8|$e>>>24)&16711935|($e<<24|$e>>>8)&4278255360}return ke},clone:function(){var se=r.clone.call(this);return se._hash=this._hash.clone(),se}});function U(se,pe,Ce,Te,ce,me,ke){var Pe=se+(pe&Ce|~pe&Te)+ce+ke;return(Pe<<me|Pe>>>32-me)+pe}function V(se,pe,Ce,Te,ce,me,ke){var Pe=se+(pe&Te|Ce&~Te)+ce+ke;return(Pe<<me|Pe>>>32-me)+pe}function Z(se,pe,Ce,Te,ce,me,ke){var Pe=se+(pe^Ce^Te)+ce+ke;return(Pe<<me|Pe>>>32-me)+pe}function te(se,pe,Ce,Te,ce,me,ke){var Pe=se+(Ce^(pe|~Te))+ce+ke;return(Pe<<me|Pe>>>32-me)+pe}f.MD5=r._createHelper(O),f.HmacMD5=r._createHmacHelper(O)}(Math),s.MD5})});var lC=fi((B1,OO)=>{"use strict";(function(s,o){typeof B1=="object"?OO.exports=B1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(B1,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=f.Hasher,r=o.algo,E=[],I=r.SHA1=g.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(O,U){for(var V=this._hash.words,Z=V[0],te=V[1],se=V[2],pe=V[3],Ce=V[4],Te=0;Te<80;Te++){if(Te<16)E[Te]=O[U+Te]|0;else{var ce=E[Te-3]^E[Te-8]^E[Te-14]^E[Te-16];E[Te]=ce<<1|ce>>>31}var me=(Z<<5|Z>>>27)+Ce+E[Te];Te<20?me+=(te&se|~te&pe)+1518500249:Te<40?me+=(te^se^pe)+1859775393:Te<60?me+=(te&se|te&pe|se&pe)-1894007588:me+=(te^se^pe)-899497514,Ce=pe,pe=se,se=te<<30|te>>>2,te=Z,Z=me}V[0]=V[0]+Z|0,V[1]=V[1]+te|0,V[2]=V[2]+se|0,V[3]=V[3]+pe|0,V[4]=V[4]+Ce|0},_doFinalize:function(){var O=this._data,U=O.words,V=this._nDataBytes*8,Z=O.sigBytes*8;return U[Z>>>5]|=128<<24-Z%32,U[(Z+64>>>9<<4)+14]=Math.floor(V/4294967296),U[(Z+64>>>9<<4)+15]=V,O.sigBytes=U.length*4,this._process(),this._hash},clone:function(){var O=g.clone.call(this);return O._hash=this._hash.clone(),O}});o.SHA1=g._createHelper(I),o.HmacSHA1=g._createHmacHelper(I)}(),s.SHA1})});var L1=fi((N1,RO)=>{"use strict";(function(s,o){typeof N1=="object"?RO.exports=N1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(N1,function(s){return function(o){var f=s,u=f.lib,g=u.WordArray,r=u.Hasher,E=f.algo,I=[],O=[];(function(){function Z(Ce){for(var Te=o.sqrt(Ce),ce=2;ce<=Te;ce++)if(!(Ce%ce))return!1;return!0}function te(Ce){return(Ce-(Ce|0))*4294967296|0}for(var se=2,pe=0;pe<64;)Z(se)&&(pe<8&&(I[pe]=te(o.pow(se,1/2))),O[pe]=te(o.pow(se,1/3)),pe++),se++})();var U=[],V=E.SHA256=r.extend({_doReset:function(){this._hash=new g.init(I.slice(0))},_doProcessBlock:function(Z,te){for(var se=this._hash.words,pe=se[0],Ce=se[1],Te=se[2],ce=se[3],me=se[4],ke=se[5],Pe=se[6],Ze=se[7],$e=0;$e<64;$e++){if($e<16)U[$e]=Z[te+$e]|0;else{var ot=U[$e-15],bt=(ot<<25|ot>>>7)^(ot<<14|ot>>>18)^ot>>>3,Tt=U[$e-2],qt=(Tt<<15|Tt>>>17)^(Tt<<13|Tt>>>19)^Tt>>>10;U[$e]=bt+U[$e-7]+qt+U[$e-16]}var st=me&ke^~me&Pe,_t=pe&Ce^pe&Te^Ce&Te,wt=(pe<<30|pe>>>2)^(pe<<19|pe>>>13)^(pe<<10|pe>>>22),Dt=(me<<26|me>>>6)^(me<<21|me>>>11)^(me<<7|me>>>25),tn=Ze+Dt+st+O[$e]+U[$e],Yt=wt+_t;Ze=Pe,Pe=ke,ke=me,me=ce+tn|0,ce=Te,Te=Ce,Ce=pe,pe=tn+Yt|0}se[0]=se[0]+pe|0,se[1]=se[1]+Ce|0,se[2]=se[2]+Te|0,se[3]=se[3]+ce|0,se[4]=se[4]+me|0,se[5]=se[5]+ke|0,se[6]=se[6]+Pe|0,se[7]=se[7]+Ze|0},_doFinalize:function(){var Z=this._data,te=Z.words,se=this._nDataBytes*8,pe=Z.sigBytes*8;return te[pe>>>5]|=128<<24-pe%32,te[(pe+64>>>9<<4)+14]=o.floor(se/4294967296),te[(pe+64>>>9<<4)+15]=se,Z.sigBytes=te.length*4,this._process(),this._hash},clone:function(){var Z=r.clone.call(this);return Z._hash=this._hash.clone(),Z}});f.SHA256=r._createHelper(V),f.HmacSHA256=r._createHmacHelper(V)}(Math),s.SHA256})});var BO=fi((U1,kO)=>{"use strict";(function(s,o,f){typeof U1=="object"?kO.exports=U1=o(xi(),L1()):typeof define=="function"&&define.amd?define(["./core","./sha256"],o):o(s.CryptoJS)})(U1,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=o.algo,r=g.SHA256,E=g.SHA224=r.extend({_doReset:function(){this._hash=new u.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var I=r._doFinalize.call(this);return I.sigBytes-=4,I}});o.SHA224=r._createHelper(E),o.HmacSHA224=r._createHmacHelper(E)}(),s.SHA224})});var cC=fi((z1,NO)=>{"use strict";(function(s,o,f){typeof z1=="object"?NO.exports=z1=o(xi(),Xm()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],o):o(s.CryptoJS)})(z1,function(s){return function(){var o=s,f=o.lib,u=f.Hasher,g=o.x64,r=g.Word,E=g.WordArray,I=o.algo;function O(){return r.create.apply(r,arguments)}var U=[O(1116352408,3609767458),O(1899447441,602891725),O(3049323471,3964484399),O(3921009573,2173295548),O(961987163,4081628472),O(1508970993,3053834265),O(2453635748,2937671579),O(2870763221,3664609560),O(3624381080,2734883394),O(310598401,1164996542),O(607225278,1323610764),O(1426881987,3590304994),O(1925078388,4068182383),O(2162078206,991336113),O(2614888103,633803317),O(3248222580,3479774868),O(3835390401,2666613458),O(4022224774,944711139),O(264347078,2341262773),O(604807628,2007800933),O(770255983,1495990901),O(1249150122,1856431235),O(1555081692,3175218132),O(1996064986,2198950837),O(2554220882,3999719339),O(2821834349,766784016),O(2952996808,2566594879),O(3210313671,3203337956),O(3336571891,1034457026),O(3584528711,2466948901),O(113926993,3758326383),O(338241895,168717936),O(666307205,1188179964),O(773529912,1546045734),O(1294757372,1522805485),O(1396182291,2643833823),O(1695183700,2343527390),O(1986661051,1014477480),O(2177026350,1206759142),O(2456956037,344077627),O(2730485921,1290863460),O(2820302411,3158454273),O(3259730800,3505952657),O(3345764771,106217008),O(3516065817,3606008344),O(3600352804,1432725776),O(4094571909,1467031594),O(275423344,851169720),O(430227734,3100823752),O(506948616,1363258195),O(659060556,3750685593),O(883997877,3785050280),O(958139571,3318307427),O(1322822218,3812723403),O(1537002063,2003034995),O(1747873779,3602036899),O(1955562222,1575990012),O(2024104815,1125592928),O(2227730452,2716904306),O(2361852424,442776044),O(2428436474,593698344),O(2756734187,3733110249),O(3204031479,2999351573),O(3329325298,3815920427),O(3391569614,3928383900),O(3515267271,566280711),O(3940187606,3454069534),O(4118630271,4000239992),O(116418474,1914138554),O(174292421,2731055270),O(289380356,3203993006),O(460393269,320620315),O(685471733,587496836),O(852142971,1086792851),O(1017036298,365543100),O(1126000580,2618297676),O(1288033470,3409855158),O(1501505948,4234509866),O(1607167915,987167468),O(1816402316,1246189591)],V=[];(function(){for(var te=0;te<80;te++)V[te]=O()})();var Z=I.SHA512=u.extend({_doReset:function(){this._hash=new E.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(te,se){for(var pe=this._hash.words,Ce=pe[0],Te=pe[1],ce=pe[2],me=pe[3],ke=pe[4],Pe=pe[5],Ze=pe[6],$e=pe[7],ot=Ce.high,bt=Ce.low,Tt=Te.high,qt=Te.low,st=ce.high,_t=ce.low,wt=me.high,Dt=me.low,tn=ke.high,Yt=ke.low,In=Pe.high,zn=Pe.low,qe=Ze.high,xt=Ze.low,ht=$e.high,mt=$e.low,Di=ot,Kn=bt,Bt=Tt,Mn=qt,hi=st,Po=_t,hs=wt,oo=Dt,pr=tn,vr=Yt,qo=In,Bi=zn,Ss=qe,Zt=xt,Wt=ht,Wo=mt,Yi=0;Yi<80;Yi++){var Ye,ee,le=V[Yi];if(Yi<16)ee=le.high=te[se+Yi*2]|0,Ye=le.low=te[se+Yi*2+1]|0;else{var xe=V[Yi-15],He=xe.high,Qe=xe.low,at=(He>>>1|Qe<<31)^(He>>>8|Qe<<24)^He>>>7,kt=(Qe>>>1|He<<31)^(Qe>>>8|He<<24)^(Qe>>>7|He<<25),je=V[Yi-2],vt=je.high,St=je.low,Lt=(vt>>>19|St<<13)^(vt<<3|St>>>29)^vt>>>6,gt=(St>>>19|vt<<13)^(St<<3|vt>>>29)^(St>>>6|vt<<26),ri=V[Yi-7],Hn=ri.high,oi=ri.low,Vn=V[Yi-16],$n=Vn.high,si=Vn.low;Ye=kt+oi,ee=at+Hn+(Ye>>>0<kt>>>0?1:0),Ye=Ye+gt,ee=ee+Lt+(Ye>>>0<gt>>>0?1:0),Ye=Ye+si,ee=ee+$n+(Ye>>>0<si>>>0?1:0),le.high=ee,le.low=Ye}var Mi=pr&qo^~pr&Ss,rr=vr&Bi^~vr&Zt,bi=Di&Bt^Di&hi^Bt&hi,Mr=Kn&Mn^Kn&Po^Mn&Po,wr=(Di>>>28|Kn<<4)^(Di<<30|Kn>>>2)^(Di<<25|Kn>>>7),so=(Kn>>>28|Di<<4)^(Kn<<30|Di>>>2)^(Kn<<25|Di>>>7),Xi=(pr>>>14|vr<<18)^(pr>>>18|vr<<14)^(pr<<23|vr>>>9),Pi=(vr>>>14|pr<<18)^(vr>>>18|pr<<14)^(vr<<23|pr>>>9),Ue=U[Yi],ze=Ue.high,et=Ue.low,it=Wo+Pi,rt=Wt+Xi+(it>>>0<Wo>>>0?1:0),it=it+rr,rt=rt+Mi+(it>>>0<rr>>>0?1:0),it=it+et,rt=rt+ze+(it>>>0<et>>>0?1:0),it=it+Ye,rt=rt+ee+(it>>>0<Ye>>>0?1:0),ut=so+Mr,dt=wr+bi+(ut>>>0<so>>>0?1:0);Wt=Ss,Wo=Zt,Ss=qo,Zt=Bi,qo=pr,Bi=vr,vr=oo+it|0,pr=hs+rt+(vr>>>0<oo>>>0?1:0)|0,hs=hi,oo=Po,hi=Bt,Po=Mn,Bt=Di,Mn=Kn,Kn=it+ut|0,Di=rt+dt+(Kn>>>0<it>>>0?1:0)|0}bt=Ce.low=bt+Kn,Ce.high=ot+Di+(bt>>>0<Kn>>>0?1:0),qt=Te.low=qt+Mn,Te.high=Tt+Bt+(qt>>>0<Mn>>>0?1:0),_t=ce.low=_t+Po,ce.high=st+hi+(_t>>>0<Po>>>0?1:0),Dt=me.low=Dt+oo,me.high=wt+hs+(Dt>>>0<oo>>>0?1:0),Yt=ke.low=Yt+vr,ke.high=tn+pr+(Yt>>>0<vr>>>0?1:0),zn=Pe.low=zn+Bi,Pe.high=In+qo+(zn>>>0<Bi>>>0?1:0),xt=Ze.low=xt+Zt,Ze.high=qe+Ss+(xt>>>0<Zt>>>0?1:0),mt=$e.low=mt+Wo,$e.high=ht+Wt+(mt>>>0<Wo>>>0?1:0)},_doFinalize:function(){var te=this._data,se=te.words,pe=this._nDataBytes*8,Ce=te.sigBytes*8;se[Ce>>>5]|=128<<24-Ce%32,se[(Ce+128>>>10<<5)+30]=Math.floor(pe/4294967296),se[(Ce+128>>>10<<5)+31]=pe,te.sigBytes=se.length*4,this._process();var Te=this._hash.toX32();return Te},clone:function(){var te=u.clone.call(this);return te._hash=this._hash.clone(),te},blockSize:1024/32});o.SHA512=u._createHelper(Z),o.HmacSHA512=u._createHmacHelper(Z)}(),s.SHA512})});var UO=fi((V1,LO)=>{"use strict";(function(s,o,f){typeof V1=="object"?LO.exports=V1=o(xi(),Xm(),cC()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],o):o(s.CryptoJS)})(V1,function(s){return function(){var o=s,f=o.x64,u=f.Word,g=f.WordArray,r=o.algo,E=r.SHA512,I=r.SHA384=E.extend({_doReset:function(){this._hash=new g.init([new u.init(3418070365,3238371032),new u.init(1654270250,914150663),new u.init(2438529370,812702999),new u.init(355462360,4144912697),new u.init(1731405415,4290775857),new u.init(2394180231,1750603025),new u.init(3675008525,1694076839),new u.init(1203062813,3204075428)])},_doFinalize:function(){var O=E._doFinalize.call(this);return O.sigBytes-=16,O}});o.SHA384=E._createHelper(I),o.HmacSHA384=E._createHmacHelper(I)}(),s.SHA384})});var VO=fi((j1,zO)=>{"use strict";(function(s,o,f){typeof j1=="object"?zO.exports=j1=o(xi(),Xm()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],o):o(s.CryptoJS)})(j1,function(s){return function(o){var f=s,u=f.lib,g=u.WordArray,r=u.Hasher,E=f.x64,I=E.Word,O=f.algo,U=[],V=[],Z=[];(function(){for(var pe=1,Ce=0,Te=0;Te<24;Te++){U[pe+5*Ce]=(Te+1)*(Te+2)/2%64;var ce=Ce%5,me=(2*pe+3*Ce)%5;pe=ce,Ce=me}for(var pe=0;pe<5;pe++)for(var Ce=0;Ce<5;Ce++)V[pe+5*Ce]=Ce+(2*pe+3*Ce)%5*5;for(var ke=1,Pe=0;Pe<24;Pe++){for(var Ze=0,$e=0,ot=0;ot<7;ot++){if(ke&1){var bt=(1<<ot)-1;bt<32?$e^=1<<bt:Ze^=1<<bt-32}ke&128?ke=ke<<1^113:ke<<=1}Z[Pe]=I.create(Ze,$e)}})();var te=[];(function(){for(var pe=0;pe<25;pe++)te[pe]=I.create()})();var se=O.SHA3=r.extend({cfg:r.cfg.extend({outputLength:512}),_doReset:function(){for(var pe=this._state=[],Ce=0;Ce<25;Ce++)pe[Ce]=new I.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(pe,Ce){for(var Te=this._state,ce=this.blockSize/2,me=0;me<ce;me++){var ke=pe[Ce+2*me],Pe=pe[Ce+2*me+1];ke=(ke<<8|ke>>>24)&16711935|(ke<<24|ke>>>8)&4278255360,Pe=(Pe<<8|Pe>>>24)&16711935|(Pe<<24|Pe>>>8)&4278255360;var Ze=Te[me];Ze.high^=Pe,Ze.low^=ke}for(var $e=0;$e<24;$e++){for(var ot=0;ot<5;ot++){for(var bt=0,Tt=0,qt=0;qt<5;qt++){var Ze=Te[ot+5*qt];bt^=Ze.high,Tt^=Ze.low}var st=te[ot];st.high=bt,st.low=Tt}for(var ot=0;ot<5;ot++)for(var _t=te[(ot+4)%5],wt=te[(ot+1)%5],Dt=wt.high,tn=wt.low,bt=_t.high^(Dt<<1|tn>>>31),Tt=_t.low^(tn<<1|Dt>>>31),qt=0;qt<5;qt++){var Ze=Te[ot+5*qt];Ze.high^=bt,Ze.low^=Tt}for(var Yt=1;Yt<25;Yt++){var bt,Tt,Ze=Te[Yt],In=Ze.high,zn=Ze.low,qe=U[Yt];qe<32?(bt=In<<qe|zn>>>32-qe,Tt=zn<<qe|In>>>32-qe):(bt=zn<<qe-32|In>>>64-qe,Tt=In<<qe-32|zn>>>64-qe);var xt=te[V[Yt]];xt.high=bt,xt.low=Tt}var ht=te[0],mt=Te[0];ht.high=mt.high,ht.low=mt.low;for(var ot=0;ot<5;ot++)for(var qt=0;qt<5;qt++){var Yt=ot+5*qt,Ze=Te[Yt],Di=te[Yt],Kn=te[(ot+1)%5+5*qt],Bt=te[(ot+2)%5+5*qt];Ze.high=Di.high^~Kn.high&Bt.high,Ze.low=Di.low^~Kn.low&Bt.low}var Ze=Te[0],Mn=Z[$e];Ze.high^=Mn.high,Ze.low^=Mn.low}},_doFinalize:function(){var pe=this._data,Ce=pe.words,Te=this._nDataBytes*8,ce=pe.sigBytes*8,me=this.blockSize*32;Ce[ce>>>5]|=1<<24-ce%32,Ce[(o.ceil((ce+1)/me)*me>>>5)-1]|=128,pe.sigBytes=Ce.length*4,this._process();for(var ke=this._state,Pe=this.cfg.outputLength/8,Ze=Pe/8,$e=[],ot=0;ot<Ze;ot++){var bt=ke[ot],Tt=bt.high,qt=bt.low;Tt=(Tt<<8|Tt>>>24)&16711935|(Tt<<24|Tt>>>8)&4278255360,qt=(qt<<8|qt>>>24)&16711935|(qt<<24|qt>>>8)&4278255360,$e.push(qt),$e.push(Tt)}return new g.init($e,Pe)},clone:function(){for(var pe=r.clone.call(this),Ce=pe._state=this._state.slice(0),Te=0;Te<25;Te++)Ce[Te]=Ce[Te].clone();return pe}});f.SHA3=r._createHelper(se),f.HmacSHA3=r._createHmacHelper(se)}(Math),s.SHA3})});var GO=fi((G1,jO)=>{"use strict";(function(s,o){typeof G1=="object"?jO.exports=G1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(G1,function(s){return function(o){var f=s,u=f.lib,g=u.WordArray,r=u.Hasher,E=f.algo,I=g.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),O=g.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),U=g.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),V=g.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),Z=g.create([0,1518500249,1859775393,2400959708,2840853838]),te=g.create([1352829926,1548603684,1836072691,2053994217,0]),se=E.RIPEMD160=r.extend({_doReset:function(){this._hash=g.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(Pe,Ze){for(var $e=0;$e<16;$e++){var ot=Ze+$e,bt=Pe[ot];Pe[ot]=(bt<<8|bt>>>24)&16711935|(bt<<24|bt>>>8)&4278255360}var Tt=this._hash.words,qt=Z.words,st=te.words,_t=I.words,wt=O.words,Dt=U.words,tn=V.words,Yt,In,zn,qe,xt,ht,mt,Di,Kn,Bt;ht=Yt=Tt[0],mt=In=Tt[1],Di=zn=Tt[2],Kn=qe=Tt[3],Bt=xt=Tt[4];for(var Mn,$e=0;$e<80;$e+=1)Mn=Yt+Pe[Ze+_t[$e]]|0,$e<16?Mn+=pe(In,zn,qe)+qt[0]:$e<32?Mn+=Ce(In,zn,qe)+qt[1]:$e<48?Mn+=Te(In,zn,qe)+qt[2]:$e<64?Mn+=ce(In,zn,qe)+qt[3]:Mn+=me(In,zn,qe)+qt[4],Mn=Mn|0,Mn=ke(Mn,Dt[$e]),Mn=Mn+xt|0,Yt=xt,xt=qe,qe=ke(zn,10),zn=In,In=Mn,Mn=ht+Pe[Ze+wt[$e]]|0,$e<16?Mn+=me(mt,Di,Kn)+st[0]:$e<32?Mn+=ce(mt,Di,Kn)+st[1]:$e<48?Mn+=Te(mt,Di,Kn)+st[2]:$e<64?Mn+=Ce(mt,Di,Kn)+st[3]:Mn+=pe(mt,Di,Kn)+st[4],Mn=Mn|0,Mn=ke(Mn,tn[$e]),Mn=Mn+Bt|0,ht=Bt,Bt=Kn,Kn=ke(Di,10),Di=mt,mt=Mn;Mn=Tt[1]+zn+Kn|0,Tt[1]=Tt[2]+qe+Bt|0,Tt[2]=Tt[3]+xt+ht|0,Tt[3]=Tt[4]+Yt+mt|0,Tt[4]=Tt[0]+In+Di|0,Tt[0]=Mn},_doFinalize:function(){var Pe=this._data,Ze=Pe.words,$e=this._nDataBytes*8,ot=Pe.sigBytes*8;Ze[ot>>>5]|=128<<24-ot%32,Ze[(ot+64>>>9<<4)+14]=($e<<8|$e>>>24)&16711935|($e<<24|$e>>>8)&4278255360,Pe.sigBytes=(Ze.length+1)*4,this._process();for(var bt=this._hash,Tt=bt.words,qt=0;qt<5;qt++){var st=Tt[qt];Tt[qt]=(st<<8|st>>>24)&16711935|(st<<24|st>>>8)&4278255360}return bt},clone:function(){var Pe=r.clone.call(this);return Pe._hash=this._hash.clone(),Pe}});function pe(Pe,Ze,$e){return Pe^Ze^$e}function Ce(Pe,Ze,$e){return Pe&Ze|~Pe&$e}function Te(Pe,Ze,$e){return(Pe|~Ze)^$e}function ce(Pe,Ze,$e){return Pe&$e|Ze&~$e}function me(Pe,Ze,$e){return Pe^(Ze|~$e)}function ke(Pe,Ze){return Pe<<Ze|Pe>>>32-Ze}f.RIPEMD160=r._createHelper(se),f.HmacRIPEMD160=r._createHmacHelper(se)}(Math),s.RIPEMD160})});var $1=fi((H1,HO)=>{"use strict";(function(s,o){typeof H1=="object"?HO.exports=H1=o(xi()):typeof define=="function"&&define.amd?define(["./core"],o):o(s.CryptoJS)})(H1,function(s){(function(){var o=s,f=o.lib,u=f.Base,g=o.enc,r=g.Utf8,E=o.algo,I=E.HMAC=u.extend({init:function(O,U){O=this._hasher=new O.init,typeof U=="string"&&(U=r.parse(U));var V=O.blockSize,Z=V*4;U.sigBytes>Z&&(U=O.finalize(U)),U.clamp();for(var te=this._oKey=U.clone(),se=this._iKey=U.clone(),pe=te.words,Ce=se.words,Te=0;Te<V;Te++)pe[Te]^=1549556828,Ce[Te]^=909522486;te.sigBytes=se.sigBytes=Z,this.reset()},reset:function(){var O=this._hasher;O.reset(),O.update(this._iKey)},update:function(O){return this._hasher.update(O),this},finalize:function(O){var U=this._hasher,V=U.finalize(O);U.reset();var Z=U.finalize(this._oKey.clone().concat(V));return Z}})})()})});var qO=fi((q1,$O)=>{"use strict";(function(s,o,f){typeof q1=="object"?$O.exports=q1=o(xi(),L1(),$1()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],o):o(s.CryptoJS)})(q1,function(s){return function(){var o=s,f=o.lib,u=f.Base,g=f.WordArray,r=o.algo,E=r.SHA256,I=r.HMAC,O=r.PBKDF2=u.extend({cfg:u.extend({keySize:128/32,hasher:E,iterations:25e4}),init:function(U){this.cfg=this.cfg.extend(U)},compute:function(U,V){for(var Z=this.cfg,te=I.create(Z.hasher,U),se=g.create(),pe=g.create([1]),Ce=se.words,Te=pe.words,ce=Z.keySize,me=Z.iterations;Ce.length<ce;){var ke=te.update(V).finalize(pe);te.reset();for(var Pe=ke.words,Ze=Pe.length,$e=ke,ot=1;ot<me;ot++){$e=te.finalize($e),te.reset();for(var bt=$e.words,Tt=0;Tt<Ze;Tt++)Pe[Tt]^=bt[Tt]}se.concat(ke),Te[0]++}return se.sigBytes=ce*4,se}});o.PBKDF2=function(U,V,Z){return O.create(Z).compute(U,V)}}(),s.PBKDF2})});var ul=fi((W1,WO)=>{"use strict";(function(s,o,f){typeof W1=="object"?WO.exports=W1=o(xi(),lC(),$1()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],o):o(s.CryptoJS)})(W1,function(s){return function(){var o=s,f=o.lib,u=f.Base,g=f.WordArray,r=o.algo,E=r.MD5,I=r.EvpKDF=u.extend({cfg:u.extend({keySize:128/32,hasher:E,iterations:1}),init:function(O){this.cfg=this.cfg.extend(O)},compute:function(O,U){for(var V,Z=this.cfg,te=Z.hasher.create(),se=g.create(),pe=se.words,Ce=Z.keySize,Te=Z.iterations;pe.length<Ce;){V&&te.update(V),V=te.update(O).finalize(U),te.reset();for(var ce=1;ce<Te;ce++)V=te.finalize(V),te.reset();se.concat(V)}return se.sigBytes=Ce*4,se}});o.EvpKDF=function(O,U,V){return I.create(V).compute(O,U)}}(),s.EvpKDF})});var Ur=fi((Z1,ZO)=>{"use strict";(function(s,o,f){typeof Z1=="object"?ZO.exports=Z1=o(xi(),ul()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],o):o(s.CryptoJS)})(Z1,function(s){s.lib.Cipher||function(o){var f=s,u=f.lib,g=u.Base,r=u.WordArray,E=u.BufferedBlockAlgorithm,I=f.enc,O=I.Utf8,U=I.Base64,V=f.algo,Z=V.EvpKDF,te=u.Cipher=E.extend({cfg:g.extend(),createEncryptor:function(st,_t){return this.create(this._ENC_XFORM_MODE,st,_t)},createDecryptor:function(st,_t){return this.create(this._DEC_XFORM_MODE,st,_t)},init:function(st,_t,wt){this.cfg=this.cfg.extend(wt),this._xformMode=st,this._key=_t,this.reset()},reset:function(){E.reset.call(this),this._doReset()},process:function(st){return this._append(st),this._process()},finalize:function(st){st&&this._append(st);var _t=this._doFinalize();return _t},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function st(_t){return typeof _t=="string"?qt:ot}return function(_t){return{encrypt:function(wt,Dt,tn){return st(Dt).encrypt(_t,wt,Dt,tn)},decrypt:function(wt,Dt,tn){return st(Dt).decrypt(_t,wt,Dt,tn)}}}}()}),se=u.StreamCipher=te.extend({_doFinalize:function(){var st=this._process(!0);return st},blockSize:1}),pe=f.mode={},Ce=u.BlockCipherMode=g.extend({createEncryptor:function(st,_t){return this.Encryptor.create(st,_t)},createDecryptor:function(st,_t){return this.Decryptor.create(st,_t)},init:function(st,_t){this._cipher=st,this._iv=_t}}),Te=pe.CBC=function(){var st=Ce.extend();st.Encryptor=st.extend({processBlock:function(wt,Dt){var tn=this._cipher,Yt=tn.blockSize;_t.call(this,wt,Dt,Yt),tn.encryptBlock(wt,Dt),this._prevBlock=wt.slice(Dt,Dt+Yt)}}),st.Decryptor=st.extend({processBlock:function(wt,Dt){var tn=this._cipher,Yt=tn.blockSize,In=wt.slice(Dt,Dt+Yt);tn.decryptBlock(wt,Dt),_t.call(this,wt,Dt,Yt),this._prevBlock=In}});function _t(wt,Dt,tn){var Yt,In=this._iv;In?(Yt=In,this._iv=o):Yt=this._prevBlock;for(var zn=0;zn<tn;zn++)wt[Dt+zn]^=Yt[zn]}return st}(),ce=f.pad={},me=ce.Pkcs7={pad:function(st,_t){for(var wt=_t*4,Dt=wt-st.sigBytes%wt,tn=Dt<<24|Dt<<16|Dt<<8|Dt,Yt=[],In=0;In<Dt;In+=4)Yt.push(tn);var zn=r.create(Yt,Dt);st.concat(zn)},unpad:function(st){var _t=st.words[st.sigBytes-1>>>2]&255;st.sigBytes-=_t}},ke=u.BlockCipher=te.extend({cfg:te.cfg.extend({mode:Te,padding:me}),reset:function(){var st;te.reset.call(this);var _t=this.cfg,wt=_t.iv,Dt=_t.mode;this._xformMode==this._ENC_XFORM_MODE?st=Dt.createEncryptor:(st=Dt.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==st?this._mode.init(this,wt&&wt.words):(this._mode=st.call(Dt,this,wt&&wt.words),this._mode.__creator=st)},_doProcessBlock:function(st,_t){this._mode.processBlock(st,_t)},_doFinalize:function(){var st,_t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(_t.pad(this._data,this.blockSize),st=this._process(!0)):(st=this._process(!0),_t.unpad(st)),st},blockSize:128/32}),Pe=u.CipherParams=g.extend({init:function(st){this.mixIn(st)},toString:function(st){return(st||this.formatter).stringify(this)}}),Ze=f.format={},$e=Ze.OpenSSL={stringify:function(st){var _t,wt=st.ciphertext,Dt=st.salt;return Dt?_t=r.create([1398893684,1701076831]).concat(Dt).concat(wt):_t=wt,_t.toString(U)},parse:function(st){var _t,wt=U.parse(st),Dt=wt.words;return Dt[0]==1398893684&&Dt[1]==1701076831&&(_t=r.create(Dt.slice(2,4)),Dt.splice(0,4),wt.sigBytes-=16),Pe.create({ciphertext:wt,salt:_t})}},ot=u.SerializableCipher=g.extend({cfg:g.extend({format:$e}),encrypt:function(st,_t,wt,Dt){Dt=this.cfg.extend(Dt);var tn=st.createEncryptor(wt,Dt),Yt=tn.finalize(_t),In=tn.cfg;return Pe.create({ciphertext:Yt,key:wt,iv:In.iv,algorithm:st,mode:In.mode,padding:In.padding,blockSize:st.blockSize,formatter:Dt.format})},decrypt:function(st,_t,wt,Dt){Dt=this.cfg.extend(Dt),_t=this._parse(_t,Dt.format);var tn=st.createDecryptor(wt,Dt).finalize(_t.ciphertext);return tn},_parse:function(st,_t){return typeof st=="string"?_t.parse(st,this):st}}),bt=f.kdf={},Tt=bt.OpenSSL={execute:function(st,_t,wt,Dt,tn){if(Dt||(Dt=r.random(64/8)),tn)var Yt=Z.create({keySize:_t+wt,hasher:tn}).compute(st,Dt);else var Yt=Z.create({keySize:_t+wt}).compute(st,Dt);var In=r.create(Yt.words.slice(_t),wt*4);return Yt.sigBytes=_t*4,Pe.create({key:Yt,iv:In,salt:Dt})}},qt=u.PasswordBasedCipher=ot.extend({cfg:ot.cfg.extend({kdf:Tt}),encrypt:function(st,_t,wt,Dt){Dt=this.cfg.extend(Dt);var tn=Dt.kdf.execute(wt,st.keySize,st.ivSize,Dt.salt,Dt.hasher);Dt.iv=tn.iv;var Yt=ot.encrypt.call(this,st,_t,tn.key,Dt);return Yt.mixIn(tn),Yt},decrypt:function(st,_t,wt,Dt){Dt=this.cfg.extend(Dt),_t=this._parse(_t,Dt.format);var tn=Dt.kdf.execute(wt,st.keySize,st.ivSize,_t.salt,Dt.hasher);Dt.iv=tn.iv;var Yt=ot.decrypt.call(this,st,_t,tn.key,Dt);return Yt}})}()})});var YO=fi((Q1,QO)=>{"use strict";(function(s,o,f){typeof Q1=="object"?QO.exports=Q1=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(Q1,function(s){return s.mode.CFB=function(){var o=s.lib.BlockCipherMode.extend();o.Encryptor=o.extend({processBlock:function(u,g){var r=this._cipher,E=r.blockSize;f.call(this,u,g,E,r),this._prevBlock=u.slice(g,g+E)}}),o.Decryptor=o.extend({processBlock:function(u,g){var r=this._cipher,E=r.blockSize,I=u.slice(g,g+E);f.call(this,u,g,E,r),this._prevBlock=I}});function f(u,g,r,E){var I,O=this._iv;O?(I=O.slice(0),this._iv=void 0):I=this._prevBlock,E.encryptBlock(I,0);for(var U=0;U<r;U++)u[g+U]^=I[U]}return o}(),s.mode.CFB})});var KO=fi((Y1,XO)=>{"use strict";(function(s,o,f){typeof Y1=="object"?XO.exports=Y1=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(Y1,function(s){return s.mode.CTR=function(){var o=s.lib.BlockCipherMode.extend(),f=o.Encryptor=o.extend({processBlock:function(u,g){var r=this._cipher,E=r.blockSize,I=this._iv,O=this._counter;I&&(O=this._counter=I.slice(0),this._iv=void 0);var U=O.slice(0);r.encryptBlock(U,0),O[E-1]=O[E-1]+1|0;for(var V=0;V<E;V++)u[g+V]^=U[V]}});return o.Decryptor=f,o}(),s.mode.CTR})});var eR=fi((X1,JO)=>{"use strict";(function(s,o,f){typeof X1=="object"?JO.exports=X1=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(X1,function(s){return s.mode.CTRGladman=function(){var o=s.lib.BlockCipherMode.extend();function f(r){if((r>>24&255)===255){var E=r>>16&255,I=r>>8&255,O=r&255;E===255?(E=0,I===255?(I=0,O===255?O=0:++O):++I):++E,r=0,r+=E<<16,r+=I<<8,r+=O}else r+=1<<24;return r}function u(r){return(r[0]=f(r[0]))===0&&(r[1]=f(r[1])),r}var g=o.Encryptor=o.extend({processBlock:function(r,E){var I=this._cipher,O=I.blockSize,U=this._iv,V=this._counter;U&&(V=this._counter=U.slice(0),this._iv=void 0),u(V);var Z=V.slice(0);I.encryptBlock(Z,0);for(var te=0;te<O;te++)r[E+te]^=Z[te]}});return o.Decryptor=g,o}(),s.mode.CTRGladman})});var nR=fi((K1,tR)=>{"use strict";(function(s,o,f){typeof K1=="object"?tR.exports=K1=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(K1,function(s){return s.mode.OFB=function(){var o=s.lib.BlockCipherMode.extend(),f=o.Encryptor=o.extend({processBlock:function(u,g){var r=this._cipher,E=r.blockSize,I=this._iv,O=this._keystream;I&&(O=this._keystream=I.slice(0),this._iv=void 0),r.encryptBlock(O,0);for(var U=0;U<E;U++)u[g+U]^=O[U]}});return o.Decryptor=f,o}(),s.mode.OFB})});var rR=fi((J1,iR)=>{"use strict";(function(s,o,f){typeof J1=="object"?iR.exports=J1=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(J1,function(s){return s.mode.ECB=function(){var o=s.lib.BlockCipherMode.extend();return o.Encryptor=o.extend({processBlock:function(f,u){this._cipher.encryptBlock(f,u)}}),o.Decryptor=o.extend({processBlock:function(f,u){this._cipher.decryptBlock(f,u)}}),o}(),s.mode.ECB})});var sR=fi((ev,oR)=>{"use strict";(function(s,o,f){typeof ev=="object"?oR.exports=ev=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(ev,function(s){return s.pad.AnsiX923={pad:function(o,f){var u=o.sigBytes,g=f*4,r=g-u%g,E=u+r-1;o.clamp(),o.words[E>>>2]|=r<<24-E%4*8,o.sigBytes+=r},unpad:function(o){var f=o.words[o.sigBytes-1>>>2]&255;o.sigBytes-=f}},s.pad.Ansix923})});var lR=fi((tv,aR)=>{"use strict";(function(s,o,f){typeof tv=="object"?aR.exports=tv=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(tv,function(s){return s.pad.Iso10126={pad:function(o,f){var u=f*4,g=u-o.sigBytes%u;o.concat(s.lib.WordArray.random(g-1)).concat(s.lib.WordArray.create([g<<24],1))},unpad:function(o){var f=o.words[o.sigBytes-1>>>2]&255;o.sigBytes-=f}},s.pad.Iso10126})});var uR=fi((nv,cR)=>{"use strict";(function(s,o,f){typeof nv=="object"?cR.exports=nv=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(nv,function(s){return s.pad.Iso97971={pad:function(o,f){o.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(o,f)},unpad:function(o){s.pad.ZeroPadding.unpad(o),o.sigBytes--}},s.pad.Iso97971})});var dR=fi((iv,hR)=>{"use strict";(function(s,o,f){typeof iv=="object"?hR.exports=iv=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(iv,function(s){return s.pad.ZeroPadding={pad:function(o,f){var u=f*4;o.clamp(),o.sigBytes+=u-(o.sigBytes%u||u)},unpad:function(o){for(var f=o.words,u=o.sigBytes-1,u=o.sigBytes-1;u>=0;u--)if(f[u>>>2]>>>24-u%4*8&255){o.sigBytes=u+1;break}}},s.pad.ZeroPadding})});var pR=fi((rv,fR)=>{"use strict";(function(s,o,f){typeof rv=="object"?fR.exports=rv=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(rv,function(s){return s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding})});var gR=fi((ov,mR)=>{"use strict";(function(s,o,f){typeof ov=="object"?mR.exports=ov=o(xi(),Ur()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],o):o(s.CryptoJS)})(ov,function(s){return function(o){var f=s,u=f.lib,g=u.CipherParams,r=f.enc,E=r.Hex,I=f.format,O=I.Hex={stringify:function(U){return U.ciphertext.toString(E)},parse:function(U){var V=E.parse(U);return g.create({ciphertext:V})}}}(),s.format.Hex})});var yR=fi((sv,_R)=>{"use strict";(function(s,o,f){typeof sv=="object"?_R.exports=sv=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(sv,function(s){return function(){var o=s,f=o.lib,u=f.BlockCipher,g=o.algo,r=[],E=[],I=[],O=[],U=[],V=[],Z=[],te=[],se=[],pe=[];(function(){for(var ce=[],me=0;me<256;me++)me<128?ce[me]=me<<1:ce[me]=me<<1^283;for(var ke=0,Pe=0,me=0;me<256;me++){var Ze=Pe^Pe<<1^Pe<<2^Pe<<3^Pe<<4;Ze=Ze>>>8^Ze&255^99,r[ke]=Ze,E[Ze]=ke;var $e=ce[ke],ot=ce[$e],bt=ce[ot],Tt=ce[Ze]*257^Ze*16843008;I[ke]=Tt<<24|Tt>>>8,O[ke]=Tt<<16|Tt>>>16,U[ke]=Tt<<8|Tt>>>24,V[ke]=Tt;var Tt=bt*16843009^ot*65537^$e*257^ke*16843008;Z[Ze]=Tt<<24|Tt>>>8,te[Ze]=Tt<<16|Tt>>>16,se[Ze]=Tt<<8|Tt>>>24,pe[Ze]=Tt,ke?(ke=$e^ce[ce[ce[bt^$e]]],Pe^=ce[ce[Pe]]):ke=Pe=1}})();var Ce=[0,1,2,4,8,16,32,64,128,27,54],Te=g.AES=u.extend({_doReset:function(){var ce;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var me=this._keyPriorReset=this._key,ke=me.words,Pe=me.sigBytes/4,Ze=this._nRounds=Pe+6,$e=(Ze+1)*4,ot=this._keySchedule=[],bt=0;bt<$e;bt++)bt<Pe?ot[bt]=ke[bt]:(ce=ot[bt-1],bt%Pe?Pe>6&&bt%Pe==4&&(ce=r[ce>>>24]<<24|r[ce>>>16&255]<<16|r[ce>>>8&255]<<8|r[ce&255]):(ce=ce<<8|ce>>>24,ce=r[ce>>>24]<<24|r[ce>>>16&255]<<16|r[ce>>>8&255]<<8|r[ce&255],ce^=Ce[bt/Pe|0]<<24),ot[bt]=ot[bt-Pe]^ce);for(var Tt=this._invKeySchedule=[],qt=0;qt<$e;qt++){var bt=$e-qt;if(qt%4)var ce=ot[bt];else var ce=ot[bt-4];qt<4||bt<=4?Tt[qt]=ce:Tt[qt]=Z[r[ce>>>24]]^te[r[ce>>>16&255]]^se[r[ce>>>8&255]]^pe[r[ce&255]]}}},encryptBlock:function(ce,me){this._doCryptBlock(ce,me,this._keySchedule,I,O,U,V,r)},decryptBlock:function(ce,me){var ke=ce[me+1];ce[me+1]=ce[me+3],ce[me+3]=ke,this._doCryptBlock(ce,me,this._invKeySchedule,Z,te,se,pe,E);var ke=ce[me+1];ce[me+1]=ce[me+3],ce[me+3]=ke},_doCryptBlock:function(ce,me,ke,Pe,Ze,$e,ot,bt){for(var Tt=this._nRounds,qt=ce[me]^ke[0],st=ce[me+1]^ke[1],_t=ce[me+2]^ke[2],wt=ce[me+3]^ke[3],Dt=4,tn=1;tn<Tt;tn++){var Yt=Pe[qt>>>24]^Ze[st>>>16&255]^$e[_t>>>8&255]^ot[wt&255]^ke[Dt++],In=Pe[st>>>24]^Ze[_t>>>16&255]^$e[wt>>>8&255]^ot[qt&255]^ke[Dt++],zn=Pe[_t>>>24]^Ze[wt>>>16&255]^$e[qt>>>8&255]^ot[st&255]^ke[Dt++],qe=Pe[wt>>>24]^Ze[qt>>>16&255]^$e[st>>>8&255]^ot[_t&255]^ke[Dt++];qt=Yt,st=In,_t=zn,wt=qe}var Yt=(bt[qt>>>24]<<24|bt[st>>>16&255]<<16|bt[_t>>>8&255]<<8|bt[wt&255])^ke[Dt++],In=(bt[st>>>24]<<24|bt[_t>>>16&255]<<16|bt[wt>>>8&255]<<8|bt[qt&255])^ke[Dt++],zn=(bt[_t>>>24]<<24|bt[wt>>>16&255]<<16|bt[qt>>>8&255]<<8|bt[st&255])^ke[Dt++],qe=(bt[wt>>>24]<<24|bt[qt>>>16&255]<<16|bt[st>>>8&255]<<8|bt[_t&255])^ke[Dt++];ce[me]=Yt,ce[me+1]=In,ce[me+2]=zn,ce[me+3]=qe},keySize:256/32});o.AES=u._createHelper(Te)}(),s.AES})});var xR=fi((av,vR)=>{"use strict";(function(s,o,f){typeof av=="object"?vR.exports=av=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(av,function(s){return function(){var o=s,f=o.lib,u=f.WordArray,g=f.BlockCipher,r=o.algo,E=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],I=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],O=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],U=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],V=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],Z=r.DES=g.extend({_doReset:function(){for(var Ce=this._key,Te=Ce.words,ce=[],me=0;me<56;me++){var ke=E[me]-1;ce[me]=Te[ke>>>5]>>>31-ke%32&1}for(var Pe=this._subKeys=[],Ze=0;Ze<16;Ze++){for(var $e=Pe[Ze]=[],ot=O[Ze],me=0;me<24;me++)$e[me/6|0]|=ce[(I[me]-1+ot)%28]<<31-me%6,$e[4+(me/6|0)]|=ce[28+(I[me+24]-1+ot)%28]<<31-me%6;$e[0]=$e[0]<<1|$e[0]>>>31;for(var me=1;me<7;me++)$e[me]=$e[me]>>>(me-1)*4+3;$e[7]=$e[7]<<5|$e[7]>>>27}for(var bt=this._invSubKeys=[],me=0;me<16;me++)bt[me]=Pe[15-me]},encryptBlock:function(Ce,Te){this._doCryptBlock(Ce,Te,this._subKeys)},decryptBlock:function(Ce,Te){this._doCryptBlock(Ce,Te,this._invSubKeys)},_doCryptBlock:function(Ce,Te,ce){this._lBlock=Ce[Te],this._rBlock=Ce[Te+1],te.call(this,4,252645135),te.call(this,16,65535),se.call(this,2,858993459),se.call(this,8,16711935),te.call(this,1,1431655765);for(var me=0;me<16;me++){for(var ke=ce[me],Pe=this._lBlock,Ze=this._rBlock,$e=0,ot=0;ot<8;ot++)$e|=U[ot][((Ze^ke[ot])&V[ot])>>>0];this._lBlock=Ze,this._rBlock=Pe^$e}var bt=this._lBlock;this._lBlock=this._rBlock,this._rBlock=bt,te.call(this,1,1431655765),se.call(this,8,16711935),se.call(this,2,858993459),te.call(this,16,65535),te.call(this,4,252645135),Ce[Te]=this._lBlock,Ce[Te+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function te(Ce,Te){var ce=(this._lBlock>>>Ce^this._rBlock)&Te;this._rBlock^=ce,this._lBlock^=ce<<Ce}function se(Ce,Te){var ce=(this._rBlock>>>Ce^this._lBlock)&Te;this._lBlock^=ce,this._rBlock^=ce<<Ce}o.DES=g._createHelper(Z);var pe=r.TripleDES=g.extend({_doReset:function(){var Ce=this._key,Te=Ce.words;if(Te.length!==2&&Te.length!==4&&Te.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var ce=Te.slice(0,2),me=Te.length<4?Te.slice(0,2):Te.slice(2,4),ke=Te.length<6?Te.slice(0,2):Te.slice(4,6);this._des1=Z.createEncryptor(u.create(ce)),this._des2=Z.createEncryptor(u.create(me)),this._des3=Z.createEncryptor(u.create(ke))},encryptBlock:function(Ce,Te){this._des1.encryptBlock(Ce,Te),this._des2.decryptBlock(Ce,Te),this._des3.encryptBlock(Ce,Te)},decryptBlock:function(Ce,Te){this._des3.decryptBlock(Ce,Te),this._des2.encryptBlock(Ce,Te),this._des1.decryptBlock(Ce,Te)},keySize:192/32,ivSize:64/32,blockSize:64/32});o.TripleDES=g._createHelper(pe)}(),s.TripleDES})});var wR=fi((lv,bR)=>{"use strict";(function(s,o,f){typeof lv=="object"?bR.exports=lv=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(lv,function(s){return function(){var o=s,f=o.lib,u=f.StreamCipher,g=o.algo,r=g.RC4=u.extend({_doReset:function(){for(var O=this._key,U=O.words,V=O.sigBytes,Z=this._S=[],te=0;te<256;te++)Z[te]=te;for(var te=0,se=0;te<256;te++){var pe=te%V,Ce=U[pe>>>2]>>>24-pe%4*8&255;se=(se+Z[te]+Ce)%256;var Te=Z[te];Z[te]=Z[se],Z[se]=Te}this._i=this._j=0},_doProcessBlock:function(O,U){O[U]^=E.call(this)},keySize:256/32,ivSize:0});function E(){for(var O=this._S,U=this._i,V=this._j,Z=0,te=0;te<4;te++){U=(U+1)%256,V=(V+O[U])%256;var se=O[U];O[U]=O[V],O[V]=se,Z|=O[(O[U]+O[V])%256]<<24-te*8}return this._i=U,this._j=V,Z}o.RC4=u._createHelper(r);var I=g.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var O=this.cfg.drop;O>0;O--)E.call(this)}});o.RC4Drop=u._createHelper(I)}(),s.RC4})});var CR=fi((cv,DR)=>{"use strict";(function(s,o,f){typeof cv=="object"?DR.exports=cv=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(cv,function(s){return function(){var o=s,f=o.lib,u=f.StreamCipher,g=o.algo,r=[],E=[],I=[],O=g.Rabbit=u.extend({_doReset:function(){for(var V=this._key.words,Z=this.cfg.iv,te=0;te<4;te++)V[te]=(V[te]<<8|V[te]>>>24)&16711935|(V[te]<<24|V[te]>>>8)&4278255360;var se=this._X=[V[0],V[3]<<16|V[2]>>>16,V[1],V[0]<<16|V[3]>>>16,V[2],V[1]<<16|V[0]>>>16,V[3],V[2]<<16|V[1]>>>16],pe=this._C=[V[2]<<16|V[2]>>>16,V[0]&4294901760|V[1]&65535,V[3]<<16|V[3]>>>16,V[1]&4294901760|V[2]&65535,V[0]<<16|V[0]>>>16,V[2]&4294901760|V[3]&65535,V[1]<<16|V[1]>>>16,V[3]&4294901760|V[0]&65535];this._b=0;for(var te=0;te<4;te++)U.call(this);for(var te=0;te<8;te++)pe[te]^=se[te+4&7];if(Z){var Ce=Z.words,Te=Ce[0],ce=Ce[1],me=(Te<<8|Te>>>24)&16711935|(Te<<24|Te>>>8)&4278255360,ke=(ce<<8|ce>>>24)&16711935|(ce<<24|ce>>>8)&4278255360,Pe=me>>>16|ke&4294901760,Ze=ke<<16|me&65535;pe[0]^=me,pe[1]^=Pe,pe[2]^=ke,pe[3]^=Ze,pe[4]^=me,pe[5]^=Pe,pe[6]^=ke,pe[7]^=Ze;for(var te=0;te<4;te++)U.call(this)}},_doProcessBlock:function(V,Z){var te=this._X;U.call(this),r[0]=te[0]^te[5]>>>16^te[3]<<16,r[1]=te[2]^te[7]>>>16^te[5]<<16,r[2]=te[4]^te[1]>>>16^te[7]<<16,r[3]=te[6]^te[3]>>>16^te[1]<<16;for(var se=0;se<4;se++)r[se]=(r[se]<<8|r[se]>>>24)&16711935|(r[se]<<24|r[se]>>>8)&4278255360,V[Z+se]^=r[se]},blockSize:128/32,ivSize:64/32});function U(){for(var V=this._X,Z=this._C,te=0;te<8;te++)E[te]=Z[te];Z[0]=Z[0]+1295307597+this._b|0,Z[1]=Z[1]+3545052371+(Z[0]>>>0<E[0]>>>0?1:0)|0,Z[2]=Z[2]+886263092+(Z[1]>>>0<E[1]>>>0?1:0)|0,Z[3]=Z[3]+1295307597+(Z[2]>>>0<E[2]>>>0?1:0)|0,Z[4]=Z[4]+3545052371+(Z[3]>>>0<E[3]>>>0?1:0)|0,Z[5]=Z[5]+886263092+(Z[4]>>>0<E[4]>>>0?1:0)|0,Z[6]=Z[6]+1295307597+(Z[5]>>>0<E[5]>>>0?1:0)|0,Z[7]=Z[7]+3545052371+(Z[6]>>>0<E[6]>>>0?1:0)|0,this._b=Z[7]>>>0<E[7]>>>0?1:0;for(var te=0;te<8;te++){var se=V[te]+Z[te],pe=se&65535,Ce=se>>>16,Te=((pe*pe>>>17)+pe*Ce>>>15)+Ce*Ce,ce=((se&4294901760)*se|0)+((se&65535)*se|0);I[te]=Te^ce}V[0]=I[0]+(I[7]<<16|I[7]>>>16)+(I[6]<<16|I[6]>>>16)|0,V[1]=I[1]+(I[0]<<8|I[0]>>>24)+I[7]|0,V[2]=I[2]+(I[1]<<16|I[1]>>>16)+(I[0]<<16|I[0]>>>16)|0,V[3]=I[3]+(I[2]<<8|I[2]>>>24)+I[1]|0,V[4]=I[4]+(I[3]<<16|I[3]>>>16)+(I[2]<<16|I[2]>>>16)|0,V[5]=I[5]+(I[4]<<8|I[4]>>>24)+I[3]|0,V[6]=I[6]+(I[5]<<16|I[5]>>>16)+(I[4]<<16|I[4]>>>16)|0,V[7]=I[7]+(I[6]<<8|I[6]>>>24)+I[5]|0}o.Rabbit=u._createHelper(O)}(),s.Rabbit})});var AR=fi((uv,ER)=>{"use strict";(function(s,o,f){typeof uv=="object"?ER.exports=uv=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(uv,function(s){return function(){var o=s,f=o.lib,u=f.StreamCipher,g=o.algo,r=[],E=[],I=[],O=g.RabbitLegacy=u.extend({_doReset:function(){var V=this._key.words,Z=this.cfg.iv,te=this._X=[V[0],V[3]<<16|V[2]>>>16,V[1],V[0]<<16|V[3]>>>16,V[2],V[1]<<16|V[0]>>>16,V[3],V[2]<<16|V[1]>>>16],se=this._C=[V[2]<<16|V[2]>>>16,V[0]&4294901760|V[1]&65535,V[3]<<16|V[3]>>>16,V[1]&4294901760|V[2]&65535,V[0]<<16|V[0]>>>16,V[2]&4294901760|V[3]&65535,V[1]<<16|V[1]>>>16,V[3]&4294901760|V[0]&65535];this._b=0;for(var pe=0;pe<4;pe++)U.call(this);for(var pe=0;pe<8;pe++)se[pe]^=te[pe+4&7];if(Z){var Ce=Z.words,Te=Ce[0],ce=Ce[1],me=(Te<<8|Te>>>24)&16711935|(Te<<24|Te>>>8)&4278255360,ke=(ce<<8|ce>>>24)&16711935|(ce<<24|ce>>>8)&4278255360,Pe=me>>>16|ke&4294901760,Ze=ke<<16|me&65535;se[0]^=me,se[1]^=Pe,se[2]^=ke,se[3]^=Ze,se[4]^=me,se[5]^=Pe,se[6]^=ke,se[7]^=Ze;for(var pe=0;pe<4;pe++)U.call(this)}},_doProcessBlock:function(V,Z){var te=this._X;U.call(this),r[0]=te[0]^te[5]>>>16^te[3]<<16,r[1]=te[2]^te[7]>>>16^te[5]<<16,r[2]=te[4]^te[1]>>>16^te[7]<<16,r[3]=te[6]^te[3]>>>16^te[1]<<16;for(var se=0;se<4;se++)r[se]=(r[se]<<8|r[se]>>>24)&16711935|(r[se]<<24|r[se]>>>8)&4278255360,V[Z+se]^=r[se]},blockSize:128/32,ivSize:64/32});function U(){for(var V=this._X,Z=this._C,te=0;te<8;te++)E[te]=Z[te];Z[0]=Z[0]+1295307597+this._b|0,Z[1]=Z[1]+3545052371+(Z[0]>>>0<E[0]>>>0?1:0)|0,Z[2]=Z[2]+886263092+(Z[1]>>>0<E[1]>>>0?1:0)|0,Z[3]=Z[3]+1295307597+(Z[2]>>>0<E[2]>>>0?1:0)|0,Z[4]=Z[4]+3545052371+(Z[3]>>>0<E[3]>>>0?1:0)|0,Z[5]=Z[5]+886263092+(Z[4]>>>0<E[4]>>>0?1:0)|0,Z[6]=Z[6]+1295307597+(Z[5]>>>0<E[5]>>>0?1:0)|0,Z[7]=Z[7]+3545052371+(Z[6]>>>0<E[6]>>>0?1:0)|0,this._b=Z[7]>>>0<E[7]>>>0?1:0;for(var te=0;te<8;te++){var se=V[te]+Z[te],pe=se&65535,Ce=se>>>16,Te=((pe*pe>>>17)+pe*Ce>>>15)+Ce*Ce,ce=((se&4294901760)*se|0)+((se&65535)*se|0);I[te]=Te^ce}V[0]=I[0]+(I[7]<<16|I[7]>>>16)+(I[6]<<16|I[6]>>>16)|0,V[1]=I[1]+(I[0]<<8|I[0]>>>24)+I[7]|0,V[2]=I[2]+(I[1]<<16|I[1]>>>16)+(I[0]<<16|I[0]>>>16)|0,V[3]=I[3]+(I[2]<<8|I[2]>>>24)+I[1]|0,V[4]=I[4]+(I[3]<<16|I[3]>>>16)+(I[2]<<16|I[2]>>>16)|0,V[5]=I[5]+(I[4]<<8|I[4]>>>24)+I[3]|0,V[6]=I[6]+(I[5]<<16|I[5]>>>16)+(I[4]<<16|I[4]>>>16)|0,V[7]=I[7]+(I[6]<<8|I[6]>>>24)+I[5]|0}o.RabbitLegacy=u._createHelper(O)}(),s.RabbitLegacy})});var SR=fi((hv,TR)=>{"use strict";(function(s,o,f){typeof hv=="object"?TR.exports=hv=o(xi(),wc(),Dc(),ul(),Ur()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],o):o(s.CryptoJS)})(hv,function(s){return function(){var o=s,f=o.lib,u=f.BlockCipher,g=o.algo;let r=16,E=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],I=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var O={pbox:[],sbox:[]};function U(pe,Ce){let Te=Ce>>24&255,ce=Ce>>16&255,me=Ce>>8&255,ke=Ce&255,Pe=pe.sbox[0][Te]+pe.sbox[1][ce];return Pe=Pe^pe.sbox[2][me],Pe=Pe+pe.sbox[3][ke],Pe}function V(pe,Ce,Te){let ce=Ce,me=Te,ke;for(let Pe=0;Pe<r;++Pe)ce=ce^pe.pbox[Pe],me=U(pe,ce)^me,ke=ce,ce=me,me=ke;return ke=ce,ce=me,me=ke,me=me^pe.pbox[r],ce=ce^pe.pbox[r+1],{left:ce,right:me}}function Z(pe,Ce,Te){let ce=Ce,me=Te,ke;for(let Pe=r+1;Pe>1;--Pe)ce=ce^pe.pbox[Pe],me=U(pe,ce)^me,ke=ce,ce=me,me=ke;return ke=ce,ce=me,me=ke,me=me^pe.pbox[1],ce=ce^pe.pbox[0],{left:ce,right:me}}function te(pe,Ce,Te){for(let Ze=0;Ze<4;Ze++){pe.sbox[Ze]=[];for(let $e=0;$e<256;$e++)pe.sbox[Ze][$e]=I[Ze][$e]}let ce=0;for(let Ze=0;Ze<r+2;Ze++)pe.pbox[Ze]=E[Ze]^Ce[ce],ce++,ce>=Te&&(ce=0);let me=0,ke=0,Pe=0;for(let Ze=0;Ze<r+2;Ze+=2)Pe=V(pe,me,ke),me=Pe.left,ke=Pe.right,pe.pbox[Ze]=me,pe.pbox[Ze+1]=ke;for(let Ze=0;Ze<4;Ze++)for(let $e=0;$e<256;$e+=2)Pe=V(pe,me,ke),me=Pe.left,ke=Pe.right,pe.sbox[Ze][$e]=me,pe.sbox[Ze][$e+1]=ke;return!0}var se=g.Blowfish=u.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var pe=this._keyPriorReset=this._key,Ce=pe.words,Te=pe.sigBytes/4;te(O,Ce,Te)}},encryptBlock:function(pe,Ce){var Te=V(O,pe[Ce],pe[Ce+1]);pe[Ce]=Te.left,pe[Ce+1]=Te.right},decryptBlock:function(pe,Ce){var Te=Z(O,pe[Ce],pe[Ce+1]);pe[Ce]=Te.left,pe[Ce+1]=Te.right},blockSize:64/32,keySize:128/32,ivSize:64/32});o.Blowfish=u._createHelper(se)}(),s.Blowfish})});var MR=fi((dv,IR)=>{"use strict";(function(s,o,f){typeof dv=="object"?IR.exports=dv=o(xi(),Xm(),AO(),SO(),wc(),FO(),Dc(),lC(),L1(),BO(),cC(),UO(),VO(),GO(),$1(),qO(),ul(),Ur(),YO(),KO(),eR(),nR(),rR(),sR(),lR(),uR(),dR(),pR(),gR(),yR(),xR(),wR(),CR(),AR(),SR()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],o):s.CryptoJS=o(s.CryptoJS)})(dv,function(s){return s})});var jT=null;var yb=1,GT=Symbol("SIGNAL");function Si(s){let o=jT;return jT=s,o}var HT={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function XN(s){if(!(bb(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===yb)){if(!s.producerMustRecompute(s)&&!vb(s)){s.dirty=!1,s.lastCleanEpoch=yb;return}s.producerRecomputeValue(s),s.dirty=!1,s.lastCleanEpoch=yb}}function $T(s){return s&&(s.nextProducerIndex=0),Si(s)}function qT(s,o){if(Si(o),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(bb(s))for(let f=s.nextProducerIndex;f<s.producerNode.length;f++)xb(s.producerNode[f],s.producerIndexOfThis[f]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function vb(s){c_(s);for(let o=0;o<s.producerNode.length;o++){let f=s.producerNode[o],u=s.producerLastReadVersion[o];if(u!==f.version||(XN(f),u!==f.version))return!0}return!1}function WT(s){if(c_(s),bb(s))for(let o=0;o<s.producerNode.length;o++)xb(s.producerNode[o],s.producerIndexOfThis[o]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function xb(s,o){if(KN(s),c_(s),s.liveConsumerNode.length===1)for(let u=0;u<s.producerNode.length;u++)xb(s.producerNode[u],s.producerIndexOfThis[u]);let f=s.liveConsumerNode.length-1;if(s.liveConsumerNode[o]=s.liveConsumerNode[f],s.liveConsumerIndexOfThis[o]=s.liveConsumerIndexOfThis[f],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,o<s.liveConsumerNode.length){let u=s.liveConsumerIndexOfThis[o],g=s.liveConsumerNode[o];c_(g),g.producerIndexOfThis[u]=o}}function bb(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function c_(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function KN(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function JN(){throw new Error}var e4=JN;function ZT(s){e4=s}function Tn(s){return typeof s=="function"}function bd(s){let f=s(u=>{Error.call(u),u.stack=new Error().stack});return f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f}var u_=bd(s=>function(f){s(this),this.message=f?`${f.length} errors occurred during unsubscription:
${f.map((u,g)=>`${g+1}) ${u.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=f});function Tu(s,o){if(s){let f=s.indexOf(o);0<=f&&s.splice(f,1)}}var br=class s{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;let{_parentage:f}=this;if(f)if(this._parentage=null,Array.isArray(f))for(let r of f)r.remove(this);else f.remove(this);let{initialTeardown:u}=this;if(Tn(u))try{u()}catch(r){o=r instanceof u_?r.errors:[r]}let{_finalizers:g}=this;if(g){this._finalizers=null;for(let r of g)try{QT(r)}catch(E){o=o??[],E instanceof u_?o=[...o,...E.errors]:o.push(E)}}if(o)throw new u_(o)}}add(o){var f;if(o&&o!==this)if(this.closed)QT(o);else{if(o instanceof s){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=(f=this._finalizers)!==null&&f!==void 0?f:[]).push(o)}}_hasParent(o){let{_parentage:f}=this;return f===o||Array.isArray(f)&&f.includes(o)}_addParent(o){let{_parentage:f}=this;this._parentage=Array.isArray(f)?(f.push(o),f):f?[f,o]:o}_removeParent(o){let{_parentage:f}=this;f===o?this._parentage=null:Array.isArray(f)&&Tu(f,o)}remove(o){let{_finalizers:f}=this;f&&Tu(f,o),o instanceof s&&o._removeParent(this)}};br.EMPTY=(()=>{let s=new br;return s.closed=!0,s})();var wb=br.EMPTY;function h_(s){return s instanceof br||s&&"closed"in s&&Tn(s.remove)&&Tn(s.add)&&Tn(s.unsubscribe)}function QT(s){Tn(s)?s():s.unsubscribe()}var qs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var wd={setTimeout(s,o,...f){let{delegate:u}=wd;return u?.setTimeout?u.setTimeout(s,o,...f):setTimeout(s,o,...f)},clearTimeout(s){let{delegate:o}=wd;return(o?.clearTimeout||clearTimeout)(s)},delegate:void 0};function d_(s){wd.setTimeout(()=>{let{onUnhandledError:o}=qs;if(o)o(s);else throw s})}function Su(){}var YT=Db("C",void 0,void 0);function XT(s){return Db("E",void 0,s)}function KT(s){return Db("N",s,void 0)}function Db(s,o,f){return{kind:s,value:o,error:f}}var Iu=null;function Dd(s){if(qs.useDeprecatedSynchronousErrorHandling){let o=!Iu;if(o&&(Iu={errorThrown:!1,error:null}),s(),o){let{errorThrown:f,error:u}=Iu;if(Iu=null,f)throw u}}else s()}function JT(s){qs.useDeprecatedSynchronousErrorHandling&&Iu&&(Iu.errorThrown=!0,Iu.error=s)}var Mu=class extends br{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,h_(o)&&o.add(this)):this.destination=i4}static create(o,f,u){return new Cd(o,f,u)}next(o){this.isStopped?Eb(KT(o),this):this._next(o)}error(o){this.isStopped?Eb(XT(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?Eb(YT,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},t4=Function.prototype.bind;function Cb(s,o){return t4.call(s,o)}var Ab=class{constructor(o){this.partialObserver=o}next(o){let{partialObserver:f}=this;if(f.next)try{f.next(o)}catch(u){f_(u)}}error(o){let{partialObserver:f}=this;if(f.error)try{f.error(o)}catch(u){f_(u)}else f_(o)}complete(){let{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(f){f_(f)}}},Cd=class extends Mu{constructor(o,f,u){super();let g;if(Tn(o)||!o)g={next:o??void 0,error:f??void 0,complete:u??void 0};else{let r;this&&qs.useDeprecatedNextContext?(r=Object.create(o),r.unsubscribe=()=>this.unsubscribe(),g={next:o.next&&Cb(o.next,r),error:o.error&&Cb(o.error,r),complete:o.complete&&Cb(o.complete,r)}):g=o}this.destination=new Ab(g)}};function f_(s){qs.useDeprecatedSynchronousErrorHandling?JT(s):d_(s)}function n4(s){throw s}function Eb(s,o){let{onStoppedNotification:f}=qs;f&&wd.setTimeout(()=>f(s,o))}var i4={closed:!0,next:Su,error:n4,complete:Su};var Ed=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Eo(s){return s}function Tb(...s){return Sb(s)}function Sb(s){return s.length===0?Eo:s.length===1?s[0]:function(f){return s.reduce((u,g)=>g(u),f)}}var ti=(()=>{class s{constructor(f){f&&(this._subscribe=f)}lift(f){let u=new s;return u.source=this,u.operator=f,u}subscribe(f,u,g){let r=o4(f)?f:new Cd(f,u,g);return Dd(()=>{let{operator:E,source:I}=this;r.add(E?E.call(r,I):I?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(f){try{return this._subscribe(f)}catch(u){f.error(u)}}forEach(f,u){return u=eS(u),new u((g,r)=>{let E=new Cd({next:I=>{try{f(I)}catch(O){r(O),E.unsubscribe()}},error:r,complete:g});this.subscribe(E)})}_subscribe(f){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(f)}[Ed](){return this}pipe(...f){return Sb(f)(this)}toPromise(f){return f=eS(f),new f((u,g)=>{let r;this.subscribe(E=>r=E,E=>g(E),()=>u(r))})}}return s.create=o=>new s(o),s})();function eS(s){var o;return(o=s??qs.Promise)!==null&&o!==void 0?o:Promise}function r4(s){return s&&Tn(s.next)&&Tn(s.error)&&Tn(s.complete)}function o4(s){return s&&s instanceof Mu||r4(s)&&h_(s)}function Ib(s){return Tn(s?.lift)}function vi(s){return o=>{if(Ib(o))return o.lift(function(f){try{return s(f,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function Qn(s,o,f,u,g){return new Mb(s,o,f,u,g)}var Mb=class extends Mu{constructor(o,f,u,g,r,E){super(o),this.onFinalize=r,this.shouldUnsubscribe=E,this._next=f?function(I){try{f(I)}catch(O){o.error(O)}}:super._next,this._error=g?function(I){try{g(I)}catch(O){o.error(O)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(I){o.error(I)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:f}=this;super.unsubscribe(),!f&&((o=this.onFinalize)===null||o===void 0||o.call(this))}}};function Ad(){return vi((s,o)=>{let f=null;s._refCount++;let u=Qn(o,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){f=null;return}let g=s._connection,r=f;f=null,g&&(!r||g===r)&&g.unsubscribe(),o.unsubscribe()});s.subscribe(u),u.closed||(f=s.connect())})}var Td=class extends ti{constructor(o,f){super(),this.source=o,this.subjectFactory=f,this._subject=null,this._refCount=0,this._connection=null,Ib(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){let o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new br;let f=this.getSubject();o.add(this.source.subscribe(Qn(f,void 0,()=>{this._teardown(),f.complete()},u=>{this._teardown(),f.error(u)},()=>this._teardown()))),o.closed&&(this._connection=null,o=br.EMPTY)}return o}refCount(){return Ad()(this)}};var tS=bd(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var nr=(()=>{class s extends ti{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(f){let u=new p_(this,this);return u.operator=f,u}_throwIfClosed(){if(this.closed)throw new tS}next(f){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let u of this.currentObservers)u.next(f)}})}error(f){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=f;let{observers:u}=this;for(;u.length;)u.shift().error(f)}})}complete(){Dd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:f}=this;for(;f.length;)f.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var f;return((f=this.observers)===null||f===void 0?void 0:f.length)>0}_trySubscribe(f){return this._throwIfClosed(),super._trySubscribe(f)}_subscribe(f){return this._throwIfClosed(),this._checkFinalizedStatuses(f),this._innerSubscribe(f)}_innerSubscribe(f){let{hasError:u,isStopped:g,observers:r}=this;return u||g?wb:(this.currentObservers=null,r.push(f),new br(()=>{this.currentObservers=null,Tu(r,f)}))}_checkFinalizedStatuses(f){let{hasError:u,thrownError:g,isStopped:r}=this;u?f.error(g):r&&f.complete()}asObservable(){let f=new ti;return f.source=this,f}}return s.create=(o,f)=>new p_(o,f),s})(),p_=class extends nr{constructor(o,f){super(),this.destination=o,this.source=f}next(o){var f,u;(u=(f=this.destination)===null||f===void 0?void 0:f.next)===null||u===void 0||u.call(f,o)}error(o){var f,u;(u=(f=this.destination)===null||f===void 0?void 0:f.error)===null||u===void 0||u.call(f,o)}complete(){var o,f;(f=(o=this.destination)===null||o===void 0?void 0:o.complete)===null||f===void 0||f.call(o)}_subscribe(o){var f,u;return(u=(f=this.source)===null||f===void 0?void 0:f.subscribe(o))!==null&&u!==void 0?u:wb}};var Sr=class extends nr{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){let f=super._subscribe(o);return!f.closed&&o.next(this._value),f}getValue(){let{hasError:o,thrownError:f,_value:u}=this;if(o)throw f;return this._throwIfClosed(),u}next(o){super.next(this._value=o)}};var Fb={now(){return(Fb.delegate||Date).now()},delegate:void 0};var m_=class extends br{constructor(o,f){super()}schedule(o,f=0){return this}};var nm={setInterval(s,o,...f){let{delegate:u}=nm;return u?.setInterval?u.setInterval(s,o,...f):setInterval(s,o,...f)},clearInterval(s){let{delegate:o}=nm;return(o?.clearInterval||clearInterval)(s)},delegate:void 0};var g_=class extends m_{constructor(o,f){super(o,f),this.scheduler=o,this.work=f,this.pending=!1}schedule(o,f=0){var u;if(this.closed)return this;this.state=o;let g=this.id,r=this.scheduler;return g!=null&&(this.id=this.recycleAsyncId(r,g,f)),this.pending=!0,this.delay=f,this.id=(u=this.id)!==null&&u!==void 0?u:this.requestAsyncId(r,this.id,f),this}requestAsyncId(o,f,u=0){return nm.setInterval(o.flush.bind(o,this),u)}recycleAsyncId(o,f,u=0){if(u!=null&&this.delay===u&&this.pending===!1)return f;f!=null&&nm.clearInterval(f)}execute(o,f){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let u=this._execute(o,f);if(u)return u;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(o,f){let u=!1,g;try{this.work(o)}catch(r){u=!0,g=r||new Error("Scheduled action threw falsy error")}if(u)return this.unsubscribe(),g}unsubscribe(){if(!this.closed){let{id:o,scheduler:f}=this,{actions:u}=f;this.work=this.state=this.scheduler=null,this.pending=!1,Tu(u,this),o!=null&&(this.id=this.recycleAsyncId(f,o,null)),this.delay=null,super.unsubscribe()}}};var Sd=class s{constructor(o,f=s.now){this.schedulerActionCtor=o,this.now=f}schedule(o,f=0,u){return new this.schedulerActionCtor(this,o).schedule(u,f)}};Sd.now=Fb.now;var __=class extends Sd{constructor(o,f=Sd.now){super(o,f),this.actions=[],this._active=!1}flush(o){let{actions:f}=this;if(this._active){f.push(o);return}let u;this._active=!0;do if(u=o.execute(o.state,o.delay))break;while(o=f.shift());if(this._active=!1,u){for(;o=f.shift();)o.unsubscribe();throw u}}};var s4=new __(g_),nS=s4;var Xr=new ti(s=>s.complete());function y_(s){return s&&Tn(s.schedule)}function iS(s){return s[s.length-1]}function ec(s){return Tn(iS(s))?s.pop():void 0}function tc(s){return y_(iS(s))?s.pop():void 0}function oS(s,o,f,u){function g(r){return r instanceof f?r:new f(function(E){E(r)})}return new(f||(f=Promise))(function(r,E){function I(V){try{U(u.next(V))}catch(Z){E(Z)}}function O(V){try{U(u.throw(V))}catch(Z){E(Z)}}function U(V){V.done?r(V.value):g(V.value).then(I,O)}U((u=u.apply(s,o||[])).next())})}function rS(s){var o=typeof Symbol=="function"&&Symbol.iterator,f=o&&s[o],u=0;if(f)return f.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&u>=s.length&&(s=void 0),{value:s&&s[u++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fu(s){return this instanceof Fu?(this.v=s,this):new Fu(s)}function sS(s,o,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=f.apply(s,o||[]),g,r=[];return g={},I("next"),I("throw"),I("return",E),g[Symbol.asyncIterator]=function(){return this},g;function E(se){return function(pe){return Promise.resolve(pe).then(se,Z)}}function I(se,pe){u[se]&&(g[se]=function(Ce){return new Promise(function(Te,ce){r.push([se,Ce,Te,ce])>1||O(se,Ce)})},pe&&(g[se]=pe(g[se])))}function O(se,pe){try{U(u[se](pe))}catch(Ce){te(r[0][3],Ce)}}function U(se){se.value instanceof Fu?Promise.resolve(se.value.v).then(V,Z):te(r[0][2],se)}function V(se){O("next",se)}function Z(se){O("throw",se)}function te(se,pe){se(pe),r.shift(),r.length&&O(r[0][0],r[0][1])}}function aS(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],f;return o?o.call(s):(s=typeof rS=="function"?rS(s):s[Symbol.iterator](),f={},u("next"),u("throw"),u("return"),f[Symbol.asyncIterator]=function(){return this},f);function u(r){f[r]=s[r]&&function(E){return new Promise(function(I,O){E=s[r](E),g(I,O,E.done,E.value)})}}function g(r,E,I,O){Promise.resolve(O).then(function(U){r({value:U,done:I})},E)}}var Id=s=>s&&typeof s.length=="number"&&typeof s!="function";function v_(s){return Tn(s?.then)}function x_(s){return Tn(s[Ed])}function b_(s){return Symbol.asyncIterator&&Tn(s?.[Symbol.asyncIterator])}function w_(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function a4(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var D_=a4();function C_(s){return Tn(s?.[D_])}function E_(s){return sS(this,arguments,function*(){let f=s.getReader();try{for(;;){let{value:u,done:g}=yield Fu(f.read());if(g)return yield Fu(void 0);yield yield Fu(u)}}finally{f.releaseLock()}})}function A_(s){return Tn(s?.getReader)}function $i(s){if(s instanceof ti)return s;if(s!=null){if(x_(s))return l4(s);if(Id(s))return c4(s);if(v_(s))return u4(s);if(b_(s))return lS(s);if(C_(s))return h4(s);if(A_(s))return d4(s)}throw w_(s)}function l4(s){return new ti(o=>{let f=s[Ed]();if(Tn(f.subscribe))return f.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function c4(s){return new ti(o=>{for(let f=0;f<s.length&&!o.closed;f++)o.next(s[f]);o.complete()})}function u4(s){return new ti(o=>{s.then(f=>{o.closed||(o.next(f),o.complete())},f=>o.error(f)).then(null,d_)})}function h4(s){return new ti(o=>{for(let f of s)if(o.next(f),o.closed)return;o.complete()})}function lS(s){return new ti(o=>{f4(s,o).catch(f=>o.error(f))})}function d4(s){return lS(E_(s))}function f4(s,o){var f,u,g,r;return oS(this,void 0,void 0,function*(){try{for(f=aS(s);u=yield f.next(),!u.done;){let E=u.value;if(o.next(E),o.closed)return}}catch(E){g={error:E}}finally{try{u&&!u.done&&(r=f.return)&&(yield r.call(f))}finally{if(g)throw g.error}}o.complete()})}function zo(s,o,f,u=0,g=!1){let r=o.schedule(function(){f(),g?s.add(this.schedule(null,u)):this.unsubscribe()},u);if(s.add(r),!g)return r}function T_(s,o=0){return vi((f,u)=>{f.subscribe(Qn(u,g=>zo(u,s,()=>u.next(g),o),()=>zo(u,s,()=>u.complete(),o),g=>zo(u,s,()=>u.error(g),o)))})}function S_(s,o=0){return vi((f,u)=>{u.add(s.schedule(()=>f.subscribe(u),o))})}function cS(s,o){return $i(s).pipe(S_(o),T_(o))}function uS(s,o){return $i(s).pipe(S_(o),T_(o))}function hS(s,o){return new ti(f=>{let u=0;return o.schedule(function(){u===s.length?f.complete():(f.next(s[u++]),f.closed||this.schedule())})})}function dS(s,o){return new ti(f=>{let u;return zo(f,o,()=>{u=s[D_](),zo(f,o,()=>{let g,r;try{({value:g,done:r}=u.next())}catch(E){f.error(E);return}r?f.complete():f.next(g)},0,!0)}),()=>Tn(u?.return)&&u.return()})}function I_(s,o){if(!s)throw new Error("Iterable cannot be null");return new ti(f=>{zo(f,o,()=>{let u=s[Symbol.asyncIterator]();zo(f,o,()=>{u.next().then(g=>{g.done?f.complete():f.next(g.value)})},0,!0)})})}function fS(s,o){return I_(E_(s),o)}function pS(s,o){if(s!=null){if(x_(s))return cS(s,o);if(Id(s))return hS(s,o);if(v_(s))return uS(s,o);if(b_(s))return I_(s,o);if(C_(s))return dS(s,o);if(A_(s))return fS(s,o)}throw w_(s)}function dr(s,o){return o?pS(s,o):$i(s)}function Sn(...s){let o=tc(s);return dr(s,o)}function Md(s,o){let f=Tn(s)?s:()=>s,u=g=>g.error(f());return new ti(o?g=>o.schedule(u,0,g):u)}function Pb(s){return!!s&&(s instanceof ti||Tn(s.lift)&&Tn(s.subscribe))}var Ka=bd(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function mS(s){return s instanceof Date&&!isNaN(s)}function ci(s,o){return vi((f,u)=>{let g=0;f.subscribe(Qn(u,r=>{u.next(s.call(o,r,g++))}))})}var{isArray:p4}=Array;function m4(s,o){return p4(o)?s(...o):s(o)}function Fd(s){return ci(o=>m4(s,o))}var{isArray:g4}=Array,{getPrototypeOf:_4,prototype:y4,keys:v4}=Object;function M_(s){if(s.length===1){let o=s[0];if(g4(o))return{args:o,keys:null};if(x4(o)){let f=v4(o);return{args:f.map(u=>o[u]),keys:f}}}return{args:s,keys:null}}function x4(s){return s&&typeof s=="object"&&_4(s)===y4}function F_(s,o){return s.reduce((f,u,g)=>(f[u]=o[g],f),{})}function Pd(...s){let o=tc(s),f=ec(s),{args:u,keys:g}=M_(s);if(u.length===0)return dr([],o);let r=new ti(b4(u,o,g?E=>F_(g,E):Eo));return f?r.pipe(Fd(f)):r}function b4(s,o,f=Eo){return u=>{gS(o,()=>{let{length:g}=s,r=new Array(g),E=g,I=g;for(let O=0;O<g;O++)gS(o,()=>{let U=dr(s[O],o),V=!1;U.subscribe(Qn(u,Z=>{r[O]=Z,V||(V=!0,I--),I||u.next(f(r.slice()))},()=>{--E||u.complete()}))},u)},u)}}function gS(s,o,f){s?zo(f,s,o):o()}function _S(s,o,f,u,g,r,E,I){let O=[],U=0,V=0,Z=!1,te=()=>{Z&&!O.length&&!U&&o.complete()},se=Ce=>U<u?pe(Ce):O.push(Ce),pe=Ce=>{r&&o.next(Ce),U++;let Te=!1;$i(f(Ce,V++)).subscribe(Qn(o,ce=>{g?.(ce),r?se(ce):o.next(ce)},()=>{Te=!0},void 0,()=>{if(Te)try{for(U--;O.length&&U<u;){let ce=O.shift();E?zo(o,E,()=>pe(ce)):pe(ce)}te()}catch(ce){o.error(ce)}}))};return s.subscribe(Qn(o,se,()=>{Z=!0,te()})),()=>{I?.()}}function fr(s,o,f=1/0){return Tn(o)?fr((u,g)=>ci((r,E)=>o(u,r,g,E))($i(s(u,g))),f):(typeof o=="number"&&(f=o),vi((u,g)=>_S(u,g,s,f)))}function Od(s=1/0){return fr(Eo,s)}function yS(){return Od(1)}function nc(...s){return yS()(dr(s,tc(s)))}function P_(s){return new ti(o=>{$i(s()).subscribe(o)})}function Ob(...s){let o=ec(s),{args:f,keys:u}=M_(s),g=new ti(r=>{let{length:E}=f;if(!E){r.complete();return}let I=new Array(E),O=E,U=E;for(let V=0;V<E;V++){let Z=!1;$i(f[V]).subscribe(Qn(r,te=>{Z||(Z=!0,U--),I[V]=te},()=>O--,void 0,()=>{(!O||!Z)&&(U||r.next(u?F_(u,I):I),r.complete())}))}});return o?g.pipe(Fd(o)):g}var w4=["addListener","removeListener"],D4=["addEventListener","removeEventListener"],C4=["on","off"];function Ds(s,o,f,u){if(Tn(f)&&(u=f,f=void 0),u)return Ds(s,o,f).pipe(Fd(u));let[g,r]=T4(s)?D4.map(E=>I=>s[E](o,I,f)):E4(s)?w4.map(vS(s,o)):A4(s)?C4.map(vS(s,o)):[];if(!g&&Id(s))return fr(E=>Ds(E,o,f))($i(s));if(!g)throw new TypeError("Invalid event target");return new ti(E=>{let I=(...O)=>E.next(1<O.length?O:O[0]);return g(I),()=>r(I)})}function vS(s,o){return f=>u=>s[f](o,u)}function E4(s){return Tn(s.addListener)&&Tn(s.removeListener)}function A4(s){return Tn(s.on)&&Tn(s.off)}function T4(s){return Tn(s.addEventListener)&&Tn(s.removeEventListener)}function Rb(s=0,o,f=nS){let u=-1;return o!=null&&(y_(o)?f=o:u=o),new ti(g=>{let r=mS(s)?+s-f.now():s;r<0&&(r=0);let E=0;return f.schedule(function(){g.closed||(g.next(E++),0<=u?this.schedule(void 0,u):g.complete())},r)})}var{isArray:S4}=Array;function O_(s){return s.length===1&&S4(s[0])?s[0]:s}function Kr(s,o){return vi((f,u)=>{let g=0;f.subscribe(Qn(u,r=>s.call(o,r,g++)&&u.next(r)))})}function kb(...s){return s=O_(s),s.length===1?$i(s[0]):new ti(I4(s))}function I4(s){return o=>{let f=[];for(let u=0;f&&!o.closed&&u<s.length;u++)f.push($i(s[u]).subscribe(Qn(o,g=>{if(f){for(let r=0;r<f.length;r++)r!==u&&f[r].unsubscribe();f=null}o.next(g)})))}}function im(...s){let o=ec(s),f=O_(s);return f.length?new ti(u=>{let g=f.map(()=>[]),r=f.map(()=>!1);u.add(()=>{g=r=null});for(let E=0;!u.closed&&E<f.length;E++)$i(f[E]).subscribe(Qn(u,I=>{if(g[E].push(I),g.every(O=>O.length)){let O=g.map(U=>U.shift());u.next(o?o(...O):O),g.some((U,V)=>!U.length&&r[V])&&u.complete()}},()=>{r[E]=!0,!g[E].length&&u.complete()}));return()=>{g=r=null}}):Xr}function ic(s){return vi((o,f)=>{let u=null,g=!1,r;u=o.subscribe(Qn(f,void 0,void 0,E=>{r=$i(s(E,ic(s)(o))),u?(u.unsubscribe(),u=null,r.subscribe(f)):g=!0})),g&&(u.unsubscribe(),u=null,r.subscribe(f))})}function xS(s,o,f,u,g){return(r,E)=>{let I=f,O=o,U=0;r.subscribe(Qn(E,V=>{let Z=U++;O=I?s(O,V,Z):(I=!0,V),u&&E.next(O)},g&&(()=>{I&&E.next(O),E.complete()})))}}function Pu(s,o){return Tn(o)?fr(s,o,1):fr(s,1)}function rc(s){return vi((o,f)=>{let u=!1;o.subscribe(Qn(f,g=>{u=!0,f.next(g)},()=>{u||f.next(s),f.complete()}))})}function Vo(s){return s<=0?()=>Xr:vi((o,f)=>{let u=0;o.subscribe(Qn(f,g=>{++u<=s&&(f.next(g),s<=u&&f.complete())}))})}function Bb(s){return ci(()=>s)}function R_(s=M4){return vi((o,f)=>{let u=!1;o.subscribe(Qn(f,g=>{u=!0,f.next(g)},()=>u?f.complete():f.error(s())))})}function M4(){return new Ka}function Nb(...s){return o=>nc(o,Sn(...s))}function Rd(s){return vi((o,f)=>{try{o.subscribe(f)}finally{f.add(s)}})}function fa(s,o){let f=arguments.length>=2;return u=>u.pipe(s?Kr((g,r)=>s(g,r,u)):Eo,Vo(1),f?rc(o):R_(()=>new Ka))}function kd(s){return s<=0?()=>Xr:vi((o,f)=>{let u=[];o.subscribe(Qn(f,g=>{u.push(g),s<u.length&&u.shift()},()=>{for(let g of u)f.next(g);f.complete()},void 0,()=>{u=null}))})}function Lb(s,o){let f=arguments.length>=2;return u=>u.pipe(s?Kr((g,r)=>s(g,r,u)):Eo,kd(1),f?rc(o):R_(()=>new Ka))}function Ub(s,o){return vi(xS(s,o,arguments.length>=2,!0))}function k_(...s){let o=tc(s);return vi((f,u)=>{(o?nc(s,f,o):nc(s,f)).subscribe(u)})}function jo(s,o){return vi((f,u)=>{let g=null,r=0,E=!1,I=()=>E&&!g&&u.complete();f.subscribe(Qn(u,O=>{g?.unsubscribe();let U=0,V=r++;$i(s(O,V)).subscribe(g=Qn(u,Z=>u.next(o?o(O,Z,V,U++):Z),()=>{g=null,I()}))},()=>{E=!0,I()}))})}function mo(s){return vi((o,f)=>{$i(s).subscribe(Qn(f,()=>f.complete(),Su)),!f.closed&&o.subscribe(f)})}function Nr(s,o,f){let u=Tn(s)||o||f?{next:s,error:o,complete:f}:s;return u?vi((g,r)=>{var E;(E=u.subscribe)===null||E===void 0||E.call(u);let I=!0;g.subscribe(Qn(r,O=>{var U;(U=u.next)===null||U===void 0||U.call(u,O),r.next(O)},()=>{var O;I=!1,(O=u.complete)===null||O===void 0||O.call(u),r.complete()},O=>{var U;I=!1,(U=u.error)===null||U===void 0||U.call(u,O),r.error(O)},()=>{var O,U;I&&((O=u.unsubscribe)===null||O===void 0||O.call(u)),(U=u.finalize)===null||U===void 0||U.call(u)}))}):Eo}function B_(...s){let o=ec(s);return vi((f,u)=>{let g=s.length,r=new Array(g),E=s.map(()=>!1),I=!1;for(let O=0;O<g;O++)$i(s[O]).subscribe(Qn(u,U=>{r[O]=U,!I&&!E[O]&&(E[O]=!0,(I=E.every(Eo))&&(E=null))},Su));f.subscribe(Qn(u,O=>{if(I){let U=[O,...r];u.next(o?o(...U):U)}}))})}var rI="https://g.co/ng/security#xss",mn=class extends Error{constructor(o,f){super(Xw(o,f)),this.code=o}};function Xw(s,o){return`${`NG0${Math.abs(s)}`}${o?": "+o:""}`}function _m(s){return{toString:s}.toString()}var N_="__parameters__";function F4(s){return function(...f){if(s){let u=s(...f);for(let g in u)this[g]=u[g]}}}function oI(s,o,f){return _m(()=>{let u=F4(o);function g(...r){if(this instanceof g)return u.apply(this,r),this;let E=new g(...r);return I.annotation=E,I;function I(O,U,V){let Z=O.hasOwnProperty(N_)?O[N_]:Object.defineProperty(O,N_,{value:[]})[N_];for(;Z.length<=V;)Z.push(null);return(Z[V]=Z[V]||[]).push(E),O}}return f&&(g.prototype=Object.create(f.prototype)),g.prototype.ngMetadataName=s,g.annotationCls=g,g})}var To=globalThis;function Qi(s){for(let o in s)if(s[o]===Qi)return o;throw Error("Could not find renamed property on target object.")}function P4(s,o){for(let f in o)o.hasOwnProperty(f)&&!s.hasOwnProperty(f)&&(s[f]=o[f])}function So(s){if(typeof s=="string")return s;if(Array.isArray(s))return"["+s.map(So).join(", ")+"]";if(s==null)return""+s;if(s.overriddenName)return`${s.overriddenName}`;if(s.name)return`${s.name}`;let o=s.toString();if(o==null)return""+o;let f=o.indexOf(`
`);return f===-1?o:o.substring(0,f)}function tw(s,o){return s==null||s===""?o===null?"":o:o==null||o===""?s:s+" "+o}var O4=Qi({__forward_ref__:Qi});function nl(s){return s.__forward_ref__=nl,s.toString=function(){return So(this())},s}function Ao(s){return sI(s)?s():s}function sI(s){return typeof s=="function"&&s.hasOwnProperty(O4)&&s.__forward_ref__===nl}function un(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function Ai(s){return{providers:s.providers||[],imports:s.imports||[]}}function _y(s){return bS(s,lI)||bS(s,cI)}function aI(s){return _y(s)!==null}function bS(s,o){return s.hasOwnProperty(o)?s[o]:null}function R4(s){let o=s&&(s[lI]||s[cI]);return o||null}function wS(s){return s&&(s.hasOwnProperty(DS)||s.hasOwnProperty(k4))?s[DS]:null}var lI=Qi({\u0275prov:Qi}),DS=Qi({\u0275inj:Qi}),cI=Qi({ngInjectableDef:Qi}),k4=Qi({ngInjectorDef:Qi}),wn=class{constructor(o,f){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof f=="number"?this.__NG_ELEMENT_ID__=f:f!==void 0&&(this.\u0275prov=un({token:this,providedIn:f.providedIn||"root",factory:f.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function uI(s){return s&&!!s.\u0275providers}var B4=Qi({\u0275cmp:Qi}),N4=Qi({\u0275dir:Qi}),L4=Qi({\u0275pipe:Qi}),U4=Qi({\u0275mod:Qi}),Z_=Qi({\u0275fac:Qi}),rm=Qi({__NG_ELEMENT_ID__:Qi}),CS=Qi({__NG_ENV_ID__:Qi});function yy(s){return typeof s=="string"?s:s==null?"":String(s)}function z4(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():yy(s)}function V4(s,o){let f=o?`. Dependency path: ${o.join(" > ")} > ${s}`:"";throw new mn(-200,s)}function Kw(s,o){throw new mn(-201,!1)}var pi=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(pi||{}),nw;function hI(){return nw}function Cs(s){let o=nw;return nw=s,o}function dI(s,o,f){let u=_y(s);if(u&&u.providedIn=="root")return u.value===void 0?u.value=u.factory():u.value;if(f&pi.Optional)return null;if(o!==void 0)return o;Kw(s,"Injector")}var j4={},sm=j4,iw="__NG_DI_FLAG__",Q_="ngTempTokenPath",G4="ngTokenPath",H4=/\n/gm,$4="\u0275",ES="__source",zd;function q4(){return zd}function oc(s){let o=zd;return zd=s,o}function W4(s,o=pi.Default){if(zd===void 0)throw new mn(-203,!1);return zd===null?dI(s,void 0,o):zd.get(s,o&pi.Optional?null:void 0,o)}function Rn(s,o=pi.Default){return(hI()||W4)(Ao(s),o)}function Ot(s,o=pi.Default){return Rn(s,vy(o))}function vy(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function rw(s){let o=[];for(let f=0;f<s.length;f++){let u=Ao(s[f]);if(Array.isArray(u)){if(u.length===0)throw new mn(900,!1);let g,r=pi.Default;for(let E=0;E<u.length;E++){let I=u[E],O=Z4(I);typeof O=="number"?O===-1?g=I.token:r|=O:g=I}o.push(Rn(g,r))}else o.push(Rn(u))}return o}function fI(s,o){return s[iw]=o,s.prototype[iw]=o,s}function Z4(s){return s[iw]}function Q4(s,o,f,u){let g=s[Q_];throw o[ES]&&g.unshift(o[ES]),s.message=Y4(`
`+s.message,g,f,u),s[G4]=g,s[Q_]=null,s}function Y4(s,o,f,u=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==$4?s.slice(2):s;let g=So(o);if(Array.isArray(o))g=o.map(So).join(" -> ");else if(typeof o=="object"){let r=[];for(let E in o)if(o.hasOwnProperty(E)){let I=o[E];r.push(E+":"+(typeof I=="string"?JSON.stringify(I):So(I)))}g=`{${r.join(", ")}}`}return`${f}${u?"("+u+")":""}[${g}]: ${s.replace(H4,`
  `)}`}var Jw=fI(oI("Optional"),8);var pI=fI(oI("SkipSelf"),4);function jd(s,o){let f=s.hasOwnProperty(Z_);return f?s[Z_]:null}function X4(s,o,f){if(s.length!==o.length)return!1;for(let u=0;u<s.length;u++){let g=s[u],r=o[u];if(f&&(g=f(g),r=f(r)),r!==g)return!1}return!0}function K4(s){return s.flat(Number.POSITIVE_INFINITY)}function e2(s,o){s.forEach(f=>Array.isArray(f)?e2(f,o):o(f))}function mI(s,o,f){o>=s.length?s.push(f):s.splice(o,0,f)}function Y_(s,o){return o>=s.length-1?s.pop():s.splice(o,1)[0]}function J4(s,o){let f=[];for(let u=0;u<s;u++)f.push(o);return f}function eL(s,o,f,u){let g=s.length;if(g==o)s.push(f,u);else if(g===1)s.push(u,s[0]),s[0]=f;else{for(g--,s.push(s[g-1],s[g]);g>o;){let r=g-2;s[g]=s[r],g--}s[o]=f,s[o+1]=u}}function t2(s,o,f){let u=ym(s,o);return u>=0?s[u|1]=f:(u=~u,eL(s,u,o,f)),u}function zb(s,o){let f=ym(s,o);if(f>=0)return s[f|1]}function ym(s,o){return tL(s,o,1)}function tL(s,o,f){let u=0,g=s.length>>f;for(;g!==u;){let r=u+(g-u>>1),E=s[r<<f];if(o===E)return r<<f;E>o?g=r:u=r+1}return~(g<<f)}var Gd={},Go=[],Hd=new wn(""),gI=new wn("",-1),_I=new wn(""),X_=class{get(o,f=sm){if(f===sm){let u=new Error(`NullInjectorError: No provider for ${So(o)}!`);throw u.name="NullInjectorError",u}return f}},yI=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(yI||{}),ga=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(ga||{}),Jr=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(Jr||{});function nL(s,o,f){let u=s.length;for(;;){let g=s.indexOf(o,f);if(g===-1)return g;if(g===0||s.charCodeAt(g-1)<=32){let r=o.length;if(g+r===u||s.charCodeAt(g+r)<=32)return g}f=g+1}}function ow(s,o,f){let u=0;for(;u<f.length;){let g=f[u];if(typeof g=="number"){if(g!==0)break;u++;let r=f[u++],E=f[u++],I=f[u++];s.setAttribute(o,E,I,r)}else{let r=g,E=f[++u];iL(r)?s.setProperty(o,r,E):s.setAttribute(o,r,E),u++}}return u}function vI(s){return s===3||s===4||s===6}function iL(s){return s.charCodeAt(0)===64}function am(s,o){if(!(o===null||o.length===0))if(s===null||s.length===0)s=o.slice();else{let f=-1;for(let u=0;u<o.length;u++){let g=o[u];typeof g=="number"?f=g:f===0||(f===-1||f===2?AS(s,f,g,null,o[++u]):AS(s,f,g,null,null))}}return s}function AS(s,o,f,u,g){let r=0,E=s.length;if(o===-1)E=-1;else for(;r<s.length;){let I=s[r++];if(typeof I=="number"){if(I===o){E=-1;break}else if(I>o){E=r-1;break}}}for(;r<s.length;){let I=s[r];if(typeof I=="number")break;if(I===f){if(u===null){g!==null&&(s[r+1]=g);return}else if(u===s[r+1]){s[r+2]=g;return}}r++,u!==null&&r++,g!==null&&r++}E!==-1&&(s.splice(E,0,o),r=E+1),s.splice(r++,0,f),u!==null&&s.splice(r++,0,u),g!==null&&s.splice(r++,0,g)}var xI="ng-template";function rL(s,o,f,u){let g=0;if(u){for(;g<o.length&&typeof o[g]=="string";g+=2)if(o[g]==="class"&&nL(o[g+1].toLowerCase(),f,0)!==-1)return!0}else if(n2(s))return!1;if(g=o.indexOf(1,g),g>-1){let r;for(;++g<o.length&&typeof(r=o[g])=="string";)if(r.toLowerCase()===f)return!0}return!1}function n2(s){return s.type===4&&s.value!==xI}function oL(s,o,f){let u=s.type===4&&!f?xI:s.value;return o===u}function sL(s,o,f){let u=4,g=s.attrs,r=g!==null?cL(g):0,E=!1;for(let I=0;I<o.length;I++){let O=o[I];if(typeof O=="number"){if(!E&&!Ws(u)&&!Ws(O))return!1;if(E&&Ws(O))continue;E=!1,u=O|u&1;continue}if(!E)if(u&4){if(u=2|u&1,O!==""&&!oL(s,O,f)||O===""&&o.length===1){if(Ws(u))return!1;E=!0}}else if(u&8){if(g===null||!rL(s,g,O,f)){if(Ws(u))return!1;E=!0}}else{let U=o[++I],V=aL(O,g,n2(s),f);if(V===-1){if(Ws(u))return!1;E=!0;continue}if(U!==""){let Z;if(V>r?Z="":Z=g[V+1].toLowerCase(),u&2&&U!==Z){if(Ws(u))return!1;E=!0}}}}return Ws(u)||E}function Ws(s){return(s&1)===0}function aL(s,o,f,u){if(o===null)return-1;let g=0;if(u||!f){let r=!1;for(;g<o.length;){let E=o[g];if(E===s)return g;if(E===3||E===6)r=!0;else if(E===1||E===2){let I=o[++g];for(;typeof I=="string";)I=o[++g];continue}else{if(E===4)break;if(E===0){g+=4;continue}}g+=r?1:2}return-1}else return uL(o,s)}function bI(s,o,f=!1){for(let u=0;u<o.length;u++)if(sL(s,o[u],f))return!0;return!1}function lL(s){let o=s.attrs;if(o!=null){let f=o.indexOf(5);if(!(f&1))return o[f+1]}return null}function cL(s){for(let o=0;o<s.length;o++){let f=s[o];if(vI(f))return o}return s.length}function uL(s,o){let f=s.indexOf(4);if(f>-1)for(f++;f<s.length;){let u=s[f];if(typeof u=="number")return-1;if(u===o)return f;f++}return-1}function hL(s,o){e:for(let f=0;f<o.length;f++){let u=o[f];if(s.length===u.length){for(let g=0;g<s.length;g++)if(s[g]!==u[g])continue e;return!0}}return!1}function TS(s,o){return s?":not("+o.trim()+")":o}function dL(s){let o=s[0],f=1,u=2,g="",r=!1;for(;f<s.length;){let E=s[f];if(typeof E=="string")if(u&2){let I=s[++f];g+="["+E+(I.length>0?'="'+I+'"':"")+"]"}else u&8?g+="."+E:u&4&&(g+=" "+E);else g!==""&&!Ws(E)&&(o+=TS(r,g),g=""),u=E,r=r||!Ws(u);f++}return g!==""&&(o+=TS(r,g)),o}function fL(s){return s.map(dL).join(",")}function pL(s){let o=[],f=[],u=1,g=2;for(;u<s.length;){let r=s[u];if(typeof r=="string")g===2?r!==""&&o.push(r,s[++u]):g===8&&f.push(r);else{if(!Ws(g))break;g=r}u++}return{attrs:o,classes:f}}function no(s){return _m(()=>{let o=AI(s),f=Li($t({},o),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===yI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&s.dependencies||null,getStandaloneInjector:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||ga.Emulated,styles:s.styles||Go,_:null,schemas:s.schemas||null,tView:null,id:""});TI(f);let u=s.dependencies;return f.directiveDefs=IS(u,!1),f.pipeDefs=IS(u,!0),f.id=_L(f),f})}function mL(s){return Ja(s)||wI(s)}function gL(s){return s!==null}function Ti(s){return _m(()=>({type:s.type,bootstrap:s.bootstrap||Go,declarations:s.declarations||Go,imports:s.imports||Go,exports:s.exports||Go,transitiveCompileScopes:null,schemas:s.schemas||null,id:s.id||null}))}function SS(s,o){if(s==null)return Gd;let f={};for(let u in s)if(s.hasOwnProperty(u)){let g=s[u],r,E,I=Jr.None;Array.isArray(g)?(I=g[0],r=g[1],E=g[2]??r):(r=g,E=g),o?(f[r]=I!==Jr.None?[u,I]:u,o[r]=E):f[r]=u}return f}function io(s){return _m(()=>{let o=AI(s);return TI(o),o})}function Ja(s){return s[B4]||null}function wI(s){return s[N4]||null}function DI(s){return s[L4]||null}function CI(s){let o=Ja(s)||wI(s)||DI(s);return o!==null?o.standalone:!1}function EI(s,o){let f=s[U4]||null;if(!f&&o===!0)throw new Error(`Type ${So(s)} does not have '\u0275mod' property.`);return f}function AI(s){let o={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:s.inputs||Gd,exportAs:s.exportAs||null,standalone:s.standalone===!0,signals:s.signals===!0,selectors:s.selectors||Go,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:SS(s.inputs,o),outputs:SS(s.outputs),debugInfo:null}}function TI(s){s.features?.forEach(o=>o(s))}function IS(s,o){if(!s)return null;let f=o?DI:mL;return()=>(typeof s=="function"?s():s).map(u=>f(u)).filter(gL)}function _L(s){let o=0,f=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery].join("|");for(let g of f)o=Math.imul(31,o)+g.charCodeAt(0)<<0;return o+=2147483648,"c"+o}function yL(...s){return{\u0275providers:SI(!0,s),\u0275fromNgModule:!0}}function SI(s,...o){let f=[],u=new Set,g,r=E=>{f.push(E)};return e2(o,E=>{let I=E;sw(I,r,[],u)&&(g||=[],g.push(I))}),g!==void 0&&II(g,r),f}function II(s,o){for(let f=0;f<s.length;f++){let{ngModule:u,providers:g}=s[f];i2(g,r=>{o(r,u)})}}function sw(s,o,f,u){if(s=Ao(s),!s)return!1;let g=null,r=wS(s),E=!r&&Ja(s);if(!r&&!E){let O=s.ngModule;if(r=wS(O),r)g=O;else return!1}else{if(E&&!E.standalone)return!1;g=s}let I=u.has(g);if(E){if(I)return!1;if(u.add(g),E.dependencies){let O=typeof E.dependencies=="function"?E.dependencies():E.dependencies;for(let U of O)sw(U,o,f,u)}}else if(r){if(r.imports!=null&&!I){u.add(g);let U;try{e2(r.imports,V=>{sw(V,o,f,u)&&(U||=[],U.push(V))})}finally{}U!==void 0&&II(U,o)}if(!I){let U=jd(g)||(()=>new g);o({provide:g,useFactory:U,deps:Go},g),o({provide:_I,useValue:g,multi:!0},g),o({provide:Hd,useValue:()=>Rn(g),multi:!0},g)}let O=r.providers;if(O!=null&&!I){let U=s;i2(O,V=>{o(V,U)})}}else return!1;return g!==s&&s.providers!==void 0}function i2(s,o){for(let f of s)uI(f)&&(f=f.\u0275providers),Array.isArray(f)?i2(f,o):o(f)}var vL=Qi({provide:String,useValue:Qi});function MI(s){return s!==null&&typeof s=="object"&&vL in s}function xL(s){return!!(s&&s.useExisting)}function bL(s){return!!(s&&s.useFactory)}function $d(s){return typeof s=="function"}function wL(s){return!!s.useClass}var xy=new wn(""),j_={},DL={},Vb;function by(){return Vb===void 0&&(Vb=new X_),Vb}var eo=class{},lm=class extends eo{get destroyed(){return this._destroyed}constructor(o,f,u,g){super(),this.parent=f,this.source=u,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,lw(o,E=>this.processProvider(E)),this.records.set(gI,Bd(void 0,this)),g.has("environment")&&this.records.set(eo,Bd(void 0,this));let r=this.records.get(xy);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(_I,Go,pi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let o=Si(null);try{for(let u of this._ngOnDestroyHooks)u.ngOnDestroy();let f=this._onDestroyHooks;this._onDestroyHooks=[];for(let u of f)u()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Si(o)}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();let f=oc(this),u=Cs(void 0),g;try{return o()}finally{oc(f),Cs(u)}}get(o,f=sm,u=pi.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(CS))return o[CS](this);u=vy(u);let g,r=oc(this),E=Cs(void 0);try{if(!(u&pi.SkipSelf)){let O=this.records.get(o);if(O===void 0){let U=SL(o)&&_y(o);U&&this.injectableDefInScope(U)?O=Bd(aw(o),j_):O=null,this.records.set(o,O)}if(O!=null)return this.hydrate(o,O)}let I=u&pi.Self?by():this.parent;return f=u&pi.Optional&&f===sm?null:f,I.get(o,f)}catch(I){if(I.name==="NullInjectorError"){if((I[Q_]=I[Q_]||[]).unshift(So(o)),r)throw I;return Q4(I,o,"R3InjectorError",this.source)}else throw I}finally{Cs(E),oc(r)}}resolveInjectorInitializers(){let o=Si(null),f=oc(this),u=Cs(void 0),g;try{let r=this.get(Hd,Go,pi.Self);for(let E of r)E()}finally{oc(f),Cs(u),Si(o)}}toString(){let o=[],f=this.records;for(let u of f.keys())o.push(So(u));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new mn(205,!1)}processProvider(o){o=Ao(o);let f=$d(o)?o:Ao(o&&o.provide),u=EL(o);if(!$d(o)&&o.multi===!0){let g=this.records.get(f);g||(g=Bd(void 0,j_,!0),g.factory=()=>rw(g.multi),this.records.set(f,g)),f=o,g.multi.push(o)}this.records.set(f,u)}hydrate(o,f){let u=Si(null);try{return f.value===j_&&(f.value=DL,f.value=f.factory()),typeof f.value=="object"&&f.value&&TL(f.value)&&this._ngOnDestroyHooks.add(f.value),f.value}finally{Si(u)}}injectableDefInScope(o){if(!o.providedIn)return!1;let f=Ao(o.providedIn);return typeof f=="string"?f==="any"||this.scopes.has(f):this.injectorDefTypes.has(f)}removeOnDestroy(o){let f=this._onDestroyHooks.indexOf(o);f!==-1&&this._onDestroyHooks.splice(f,1)}};function aw(s){let o=_y(s),f=o!==null?o.factory:jd(s);if(f!==null)return f;if(s instanceof wn)throw new mn(204,!1);if(s instanceof Function)return CL(s);throw new mn(204,!1)}function CL(s){if(s.length>0)throw new mn(204,!1);let f=R4(s);return f!==null?()=>f.factory(s):()=>new s}function EL(s){if(MI(s))return Bd(void 0,s.useValue);{let o=FI(s);return Bd(o,j_)}}function FI(s,o,f){let u;if($d(s)){let g=Ao(s);return jd(g)||aw(g)}else if(MI(s))u=()=>Ao(s.useValue);else if(bL(s))u=()=>s.useFactory(...rw(s.deps||[]));else if(xL(s))u=()=>Rn(Ao(s.useExisting));else{let g=Ao(s&&(s.useClass||s.provide));if(AL(s))u=()=>new g(...rw(s.deps));else return jd(g)||aw(g)}return u}function Bd(s,o,f=!1){return{factory:s,value:o,multi:f?[]:void 0}}function AL(s){return!!s.deps}function TL(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function SL(s){return typeof s=="function"||typeof s=="object"&&s instanceof wn}function lw(s,o){for(let f of s)Array.isArray(f)?lw(f,o):f&&uI(f)?lw(f.\u0275providers,o):o(f)}function il(s,o){s instanceof lm&&s.assertNotDestroyed();let f,u=oc(s),g=Cs(void 0);try{return o()}finally{oc(u),Cs(g)}}function PI(){return hI()!==void 0||q4()!=null}function IL(s){if(!PI())throw new mn(-203,!1)}function ML(s){let o=To.ng;if(o&&o.\u0275compilerFacade)return o.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function FL(s){return typeof s=="function"}var rl=0,Yn=1,Nn=2,to=3,Qs=4,as=5,qd=6,cm=7,Io=8,Wd=9,Ys=10,Lr=11,um=12,MS=13,Xd=14,Es=15,vm=16,Nd=17,el=18,wy=19,OI=20,sc=21,jb=22,ku=23,Xs=25,RI=1;var Bu=7,K_=8,Zd=9,go=10,r2=function(s){return s[s.None=0]="None",s[s.HasTransplantedViews=2]="HasTransplantedViews",s}(r2||{});function Ou(s){return Array.isArray(s)&&typeof s[RI]=="object"}function ol(s){return Array.isArray(s)&&s[RI]===!0}function kI(s){return(s.flags&4)!==0}function Dy(s){return s.componentOffset>-1}function o2(s){return(s.flags&1)===1}function ac(s){return!!s.template}function PL(s){return(s[Nn]&512)!==0}var cw=class{constructor(o,f,u){this.previousValue=o,this.currentValue=f,this.firstChange=u}isFirstChange(){return this.firstChange}};function BI(s,o,f,u){o!==null?o.applyValueToInputSignal(o,u):s[f]=u}function sl(){return NI}function NI(s){return s.type.prototype.ngOnChanges&&(s.setInput=RL),OL}sl.ngInherit=!0;function OL(){let s=UI(this),o=s?.current;if(o){let f=s.previous;if(f===Gd)s.previous=o;else for(let u in o)f[u]=o[u];s.current=null,this.ngOnChanges(o)}}function RL(s,o,f,u,g){let r=this.declaredInputs[u],E=UI(s)||kL(s,{previous:Gd,current:null}),I=E.current||(E.current={}),O=E.previous,U=O[r];I[r]=new cw(U&&U.currentValue,f,O===Gd),BI(s,o,g,f)}var LI="__ngSimpleChanges__";function UI(s){return s[LI]||null}function kL(s,o){return s[LI]=o}var FS=null;var pa=function(s,o,f){FS?.(s,o,f)},zI="svg",BL="math",NL=!1;function LL(){return NL}function _a(s){for(;Array.isArray(s);)s=s[rl];return s}function VI(s,o){return _a(o[s])}function As(s,o){return _a(o[s.index])}function s2(s,o){return s.data[o]}function UL(s,o){return s[o]}function uc(s,o){let f=o[s];return Ou(f)?f:f[rl]}function zL(s){return(s[Nn]&4)===4}function a2(s){return(s[Nn]&128)===128}function VL(s){return ol(s[to])}function J_(s,o){return o==null?null:s[o]}function jI(s){s[Nd]=0}function jL(s){s[Nn]&1024||(s[Nn]|=1024,a2(s)&&hm(s))}function GL(s,o){for(;s>0;)o=o[Xd],s--;return o}function l2(s){return!!(s[Nn]&9216||s[ku]?.dirty)}function uw(s){s[Ys].changeDetectionScheduler?.notify(1),l2(s)?hm(s):s[Nn]&64&&(LL()?(s[Nn]|=1024,hm(s)):s[Ys].changeDetectionScheduler?.notify())}function hm(s){s[Ys].changeDetectionScheduler?.notify();let o=dm(s);for(;o!==null&&!(o[Nn]&8192||(o[Nn]|=8192,!a2(o)));)o=dm(o)}function GI(s,o){if((s[Nn]&256)===256)throw new mn(911,!1);s[sc]===null&&(s[sc]=[]),s[sc].push(o)}function HL(s,o){if(s[sc]===null)return;let f=s[sc].indexOf(o);f!==-1&&s[sc].splice(f,1)}function dm(s){let o=s[to];return ol(o)?o[to]:o}var ni={lFrame:eM(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function $L(){return ni.lFrame.elementDepthCount}function qL(){ni.lFrame.elementDepthCount++}function WL(){ni.lFrame.elementDepthCount--}function HI(){return ni.bindingsEnabled}function $I(){return ni.skipHydrationRootTNode!==null}function ZL(s){return ni.skipHydrationRootTNode===s}function QL(){ni.skipHydrationRootTNode=null}function Ii(){return ni.lFrame.lView}function Mo(){return ni.lFrame.tView}function Kd(s){return ni.lFrame.contextLView=s,s[Io]}function Jd(s){return ni.lFrame.contextLView=null,s}function ls(){let s=qI();for(;s!==null&&s.type===64;)s=s.parent;return s}function qI(){return ni.lFrame.currentTNode}function YL(){let s=ni.lFrame,o=s.currentTNode;return s.isParent?o:o.parent}function xm(s,o){let f=ni.lFrame;f.currentTNode=s,f.isParent=o}function WI(){return ni.lFrame.isParent}function ZI(){ni.lFrame.isParent=!1}function XL(){return ni.lFrame.contextLView}function QI(){let s=ni.lFrame,o=s.bindingRootIndex;return o===-1&&(o=s.bindingRootIndex=s.tView.bindingStartIndex),o}function KL(s){return ni.lFrame.bindingIndex=s}function Cy(){return ni.lFrame.bindingIndex++}function YI(s){let o=ni.lFrame,f=o.bindingIndex;return o.bindingIndex=o.bindingIndex+s,f}function JL(){return ni.lFrame.inI18n}function e5(s,o){let f=ni.lFrame;f.bindingIndex=f.bindingRootIndex=s,hw(o)}function t5(){return ni.lFrame.currentDirectiveIndex}function hw(s){ni.lFrame.currentDirectiveIndex=s}function n5(s){let o=ni.lFrame.currentDirectiveIndex;return o===-1?null:s[o]}function XI(){return ni.lFrame.currentQueryIndex}function c2(s){ni.lFrame.currentQueryIndex=s}function i5(s){let o=s[Yn];return o.type===2?o.declTNode:o.type===1?s[as]:null}function KI(s,o,f){if(f&pi.SkipSelf){let g=o,r=s;for(;g=g.parent,g===null&&!(f&pi.Host);)if(g=i5(r),g===null||(r=r[Xd],g.type&10))break;if(g===null)return!1;o=g,s=r}let u=ni.lFrame=JI();return u.currentTNode=o,u.lView=s,!0}function u2(s){let o=JI(),f=s[Yn];ni.lFrame=o,o.currentTNode=f.firstChild,o.lView=s,o.tView=f,o.contextLView=s,o.bindingIndex=f.bindingStartIndex,o.inI18n=!1}function JI(){let s=ni.lFrame,o=s===null?null:s.child;return o===null?eM(s):o}function eM(s){let o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=o),o}function tM(){let s=ni.lFrame;return ni.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var nM=tM;function h2(){let s=tM();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function r5(s){return(ni.lFrame.contextLView=GL(s,ni.lFrame.contextLView))[Io]}function hc(){return ni.lFrame.selectedIndex}function Nu(s){ni.lFrame.selectedIndex=s}function iM(){let s=ni.lFrame;return s2(s.tView,s.selectedIndex)}function d2(){ni.lFrame.currentNamespace=zI}function rM(){o5()}function o5(){ni.lFrame.currentNamespace=null}function s5(){return ni.lFrame.currentNamespace}var oM=!0;function f2(){return oM}function p2(s){oM=s}function a5(s,o,f){let{ngOnChanges:u,ngOnInit:g,ngDoCheck:r}=o.type.prototype;if(u){let E=NI(o);(f.preOrderHooks??=[]).push(s,E),(f.preOrderCheckHooks??=[]).push(s,E)}g&&(f.preOrderHooks??=[]).push(0-s,g),r&&((f.preOrderHooks??=[]).push(s,r),(f.preOrderCheckHooks??=[]).push(s,r))}function m2(s,o){for(let f=o.directiveStart,u=o.directiveEnd;f<u;f++){let r=s.data[f].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:I,ngAfterViewInit:O,ngAfterViewChecked:U,ngOnDestroy:V}=r;E&&(s.contentHooks??=[]).push(-f,E),I&&((s.contentHooks??=[]).push(f,I),(s.contentCheckHooks??=[]).push(f,I)),O&&(s.viewHooks??=[]).push(-f,O),U&&((s.viewHooks??=[]).push(f,U),(s.viewCheckHooks??=[]).push(f,U)),V!=null&&(s.destroyHooks??=[]).push(f,V)}}function G_(s,o,f){sM(s,o,3,f)}function H_(s,o,f,u){(s[Nn]&3)===f&&sM(s,o,f,u)}function Gb(s,o){let f=s[Nn];(f&3)===o&&(f&=16383,f+=1,s[Nn]=f)}function sM(s,o,f,u){let g=u!==void 0?s[Nd]&65535:0,r=u??-1,E=o.length-1,I=0;for(let O=g;O<E;O++)if(typeof o[O+1]=="number"){if(I=o[O],u!=null&&I>=u)break}else o[O]<0&&(s[Nd]+=65536),(I<r||r==-1)&&(l5(s,f,o,O),s[Nd]=(s[Nd]&4294901760)+O+2),O++}function PS(s,o){pa(4,s,o);let f=Si(null);try{o.call(s)}finally{Si(f),pa(5,s,o)}}function l5(s,o,f,u){let g=f[u]<0,r=f[u+1],E=g?-f[u]:f[u],I=s[E];g?s[Nn]>>14<s[Nd]>>16&&(s[Nn]&3)===o&&(s[Nn]+=16384,PS(I,r)):PS(I,r)}var Vd=-1,Lu=class{constructor(o,f,u){this.factory=o,this.resolving=!1,this.canSeeViewProviders=f,this.injectImpl=u}};function c5(s){return s instanceof Lu}function u5(s){return(s.flags&8)!==0}function h5(s){return(s.flags&16)!==0}function aM(s){return s!==Vd}function ey(s){return s&32767}function d5(s){return s>>16}function ty(s,o){let f=d5(s),u=o;for(;f>0;)u=u[Xd],f--;return u}var dw=!0;function OS(s){let o=dw;return dw=s,o}var f5=256,lM=f5-1,cM=5,p5=0,ma={};function m5(s,o,f){let u;typeof f=="string"?u=f.charCodeAt(0)||0:f.hasOwnProperty(rm)&&(u=f[rm]),u==null&&(u=f[rm]=p5++);let g=u&lM,r=1<<g;o.data[s+(g>>cM)]|=r}function ny(s,o){let f=uM(s,o);if(f!==-1)return f;let u=o[Yn];u.firstCreatePass&&(s.injectorIndex=o.length,Hb(u.data,s),Hb(o,null),Hb(u.blueprint,null));let g=g2(s,o),r=s.injectorIndex;if(aM(g)){let E=ey(g),I=ty(g,o),O=I[Yn].data;for(let U=0;U<8;U++)o[r+U]=I[E+U]|O[E+U]}return o[r+8]=g,r}function Hb(s,o){s.push(0,0,0,0,0,0,0,0,o)}function uM(s,o){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||o[s.injectorIndex+8]===null?-1:s.injectorIndex}function g2(s,o){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let f=0,u=null,g=o;for(;g!==null;){if(u=mM(g),u===null)return Vd;if(f++,g=g[Xd],u.injectorIndex!==-1)return u.injectorIndex|f<<16}return Vd}function fw(s,o,f){m5(s,o,f)}function g5(s,o){if(o==="class")return s.classes;if(o==="style")return s.styles;let f=s.attrs;if(f){let u=f.length,g=0;for(;g<u;){let r=f[g];if(vI(r))break;if(r===0)g=g+2;else if(typeof r=="number")for(g++;g<u&&typeof f[g]=="string";)g++;else{if(r===o)return f[g+1];g=g+2}}}return null}function hM(s,o,f){if(f&pi.Optional||s!==void 0)return s;Kw(o,"NodeInjector")}function dM(s,o,f,u){if(f&pi.Optional&&u===void 0&&(u=null),!(f&(pi.Self|pi.Host))){let g=s[Wd],r=Cs(void 0);try{return g?g.get(o,u,f&pi.Optional):dI(o,u,f&pi.Optional)}finally{Cs(r)}}return hM(u,o,f)}function fM(s,o,f,u=pi.Default,g){if(s!==null){if(o[Nn]&2048&&!(u&pi.Self)){let E=x5(s,o,f,u,ma);if(E!==ma)return E}let r=pM(s,o,f,u,ma);if(r!==ma)return r}return dM(o,f,u,g)}function pM(s,o,f,u,g){let r=y5(f);if(typeof r=="function"){if(!KI(o,s,u))return u&pi.Host?hM(g,f,u):dM(o,f,u,g);try{let E;if(E=r(u),E==null&&!(u&pi.Optional))Kw(f);else return E}finally{nM()}}else if(typeof r=="number"){let E=null,I=uM(s,o),O=Vd,U=u&pi.Host?o[Es][as]:null;for((I===-1||u&pi.SkipSelf)&&(O=I===-1?g2(s,o):o[I+8],O===Vd||!kS(u,!1)?I=-1:(E=o[Yn],I=ey(O),o=ty(O,o)));I!==-1;){let V=o[Yn];if(RS(r,I,V.data)){let Z=_5(I,o,f,E,u,U);if(Z!==ma)return Z}O=o[I+8],O!==Vd&&kS(u,o[Yn].data[I+8]===U)&&RS(r,I,o)?(E=V,I=ey(O),o=ty(O,o)):I=-1}}return g}function _5(s,o,f,u,g,r){let E=o[Yn],I=E.data[s+8],O=u==null?Dy(I)&&dw:u!=E&&(I.type&3)!==0,U=g&pi.Host&&r===I,V=$_(I,E,f,O,U);return V!==null?Uu(o,E,V,I):ma}function $_(s,o,f,u,g){let r=s.providerIndexes,E=o.data,I=r&1048575,O=s.directiveStart,U=s.directiveEnd,V=r>>20,Z=u?I:I+V,te=g?I+V:U;for(let se=Z;se<te;se++){let pe=E[se];if(se<O&&f===pe||se>=O&&pe.type===f)return se}if(g){let se=E[O];if(se&&ac(se)&&se.type===f)return O}return null}function Uu(s,o,f,u){let g=s[f],r=o.data;if(c5(g)){let E=g;E.resolving&&V4(z4(r[f]));let I=OS(E.canSeeViewProviders);E.resolving=!0;let O,U=E.injectImpl?Cs(E.injectImpl):null,V=KI(s,u,pi.Default);try{g=s[f]=E.factory(void 0,r,s,u),o.firstCreatePass&&f>=u.directiveStart&&a5(f,r[f],o)}finally{U!==null&&Cs(U),OS(I),E.resolving=!1,nM()}}return g}function y5(s){if(typeof s=="string")return s.charCodeAt(0)||0;let o=s.hasOwnProperty(rm)?s[rm]:void 0;return typeof o=="number"?o>=0?o&lM:v5:o}function RS(s,o,f){let u=1<<s;return!!(f[o+(s>>cM)]&u)}function kS(s,o){return!(s&pi.Self)&&!(s&pi.Host&&o)}var Ru=class{constructor(o,f){this._tNode=o,this._lView=f}get(o,f,u){return fM(this._tNode,this._lView,o,vy(u),f)}};function v5(){return new Ru(ls(),Ii())}function Hu(s){return _m(()=>{let o=s.prototype.constructor,f=o[Z_]||pw(o),u=Object.prototype,g=Object.getPrototypeOf(s.prototype).constructor;for(;g&&g!==u;){let r=g[Z_]||pw(g);if(r&&r!==f)return r;g=Object.getPrototypeOf(g)}return r=>new r})}function pw(s){return sI(s)?()=>{let o=pw(Ao(s));return o&&o()}:jd(s)}function x5(s,o,f,u,g){let r=s,E=o;for(;r!==null&&E!==null&&E[Nn]&2048&&!(E[Nn]&512);){let I=pM(r,E,f,u|pi.Self,ma);if(I!==ma)return I;let O=r.parent;if(!O){let U=E[OI];if(U){let V=U.get(f,ma,u);if(V!==ma)return V}O=mM(E),E=E[Xd]}r=O}return g}function mM(s){let o=s[Yn],f=o.type;return f===2?o.declTNode:f===1?s[as]:null}function Ey(s){return g5(ls(),s)}function BS(s,o=null,f=null,u){let g=gM(s,o,f,u);return g.resolveInjectorInitializers(),g}function gM(s,o=null,f=null,u,g=new Set){let r=[f||Go,yL(s)];return u=u||(typeof s=="object"?void 0:So(s)),new lm(r,o||by(),u||null,g)}var _o=(()=>{let o=class o{static create(u,g){if(Array.isArray(u))return BS({name:""},g,u,"");{let r=u.name??"";return BS({name:r},u.parent,u.providers,r)}}};o.THROW_IF_NOT_FOUND=sm,o.NULL=new X_,o.\u0275prov=un({token:o,providedIn:"any",factory:()=>Rn(gI)}),o.__NG_ELEMENT_ID__=-1;let s=o;return s})();var b5="ngOriginalError";function $b(s){return s[b5]}var ya=class{constructor(){this._console=console}handleError(o){let f=this._findOriginalError(o);this._console.error("ERROR",o),f&&this._console.error("ORIGINAL ERROR",f)}_findOriginalError(o){let f=o&&$b(o);for(;f&&$b(f);)f=$b(f);return f||null}},_M=new wn("",{providedIn:"root",factory:()=>Ot(ya).handleError.bind(void 0)}),Ay=(()=>{let o=class o{};o.__NG_ELEMENT_ID__=w5,o.__NG_ENV_ID__=u=>u;let s=o;return s})(),mw=class extends Ay{constructor(o){super(),this._lView=o}onDestroy(o){return GI(this._lView,o),()=>HL(this._lView,o)}};function w5(){return new mw(Ii())}function D5(){return ef(ls(),Ii())}function ef(s,o){return new Fo(As(s,o))}var Fo=(()=>{let o=class o{constructor(u){this.nativeElement=u}};o.__NG_ELEMENT_ID__=D5;let s=o;return s})();function C5(s){return s instanceof Fo?s.nativeElement:s}var gw=class extends nr{constructor(o=!1){super(),this.destroyRef=void 0,this.__isAsync=o,PI()&&(this.destroyRef=Ot(Ay,{optional:!0})??void 0)}emit(o){let f=Si(null);try{super.next(o)}finally{Si(f)}}subscribe(o,f,u){let g=o,r=f||(()=>null),E=u;if(o&&typeof o=="object"){let O=o;g=O.next?.bind(O),r=O.error?.bind(O),E=O.complete?.bind(O)}this.__isAsync&&(r=qb(r),g&&(g=qb(g)),E&&(E=qb(E)));let I=super.subscribe({next:g,error:r,complete:E});return o instanceof br&&o.add(I),I}};function qb(s){return o=>{setTimeout(s,void 0,o)}}var lr=gw;function E5(){return this._results[Symbol.iterator]()}var _w=class s{get changes(){return this._changes??=new lr}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let f=s.prototype;f[Symbol.iterator]||(f[Symbol.iterator]=E5)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,f){return this._results.reduce(o,f)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,f){this.dirty=!1;let u=K4(o);(this._changesDetected=!X4(this._results,u,f))&&(this._results=u,this.length=u.length,this.last=u[this.length-1],this.first=u[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(o){this._onDirty=o}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function yM(s){return(s.flags&128)===128}var vM=new Map,A5=0;function T5(){return A5++}function S5(s){vM.set(s[wy],s)}function I5(s){vM.delete(s[wy])}var NS="__ngContext__";function zu(s,o){Ou(o)?(s[NS]=o[wy],S5(o)):s[NS]=o}function xM(s){return wM(s[um])}function bM(s){return wM(s[Qs])}function wM(s){for(;s!==null&&!ol(s);)s=s[Qs];return s}var yw;function DM(s){yw=s}function M5(){if(yw!==void 0)return yw;if(typeof document<"u")return document;throw new mn(210,!1)}var Ty=new wn("",{providedIn:"root",factory:()=>F5}),F5="ng",_2=new wn(""),al=new wn("",{providedIn:"platform",factory:()=>"unknown"});var y2=new wn("",{providedIn:"root",factory:()=>M5().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var P5="h",O5="b";var R5=()=>null;function v2(s,o,f=!1){return R5(s,o,f)}var CM=!1,k5=new wn("",{providedIn:"root",factory:()=>CM});var L_;function B5(){if(L_===void 0&&(L_=null,To.trustedTypes))try{L_=To.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:s=>s,createScript:s=>s,createScriptURL:s=>s})}catch{}return L_}function LS(s){return B5()?.createScriptURL(s)||s}var iy=class{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${rI})`}};function tf(s){return s instanceof iy?s.changingThisBreaksApplicationSecurity:s}function x2(s,o){let f=N5(s);if(f!=null&&f!==o){if(f==="ResourceURL"&&o==="URL")return!0;throw new Error(`Required a safe ${o}, got a ${f} (see ${rI})`)}return f===o}function N5(s){return s instanceof iy&&s.getTypeName()||null}var L5=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function EM(s){return s=String(s),s.match(L5)?s:"unsafe:"+s}var Sy=function(s){return s[s.NONE=0]="NONE",s[s.HTML=1]="HTML",s[s.STYLE=2]="STYLE",s[s.SCRIPT=3]="SCRIPT",s[s.URL=4]="URL",s[s.RESOURCE_URL=5]="RESOURCE_URL",s}(Sy||{});function U5(s){let o=TM();return o?o.sanitize(Sy.URL,s)||"":x2(s,"URL")?tf(s):EM(yy(s))}function z5(s){let o=TM();if(o)return LS(o.sanitize(Sy.RESOURCE_URL,s)||"");if(x2(s,"ResourceURL"))return LS(tf(s));throw new mn(904,!1)}function V5(s,o){return o==="src"&&(s==="embed"||s==="frame"||s==="iframe"||s==="media"||s==="script")||o==="href"&&(s==="base"||s==="link")?z5:U5}function AM(s,o,f){return V5(o,f)(s)}function TM(){let s=Ii();return s&&s[Ys].sanitizer}function SM(s){return s instanceof Function?s():s}function j5(s){return(s??Ot(_o)).get(al)==="browser"}var tl=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(tl||{}),G5;function b2(s,o){return G5(s,o)}function Ld(s,o,f,u,g){if(u!=null){let r,E=!1;ol(u)?r=u:Ou(u)&&(E=!0,u=u[rl]);let I=_a(u);s===0&&f!==null?g==null?OM(o,f,I):ry(o,f,I,g||null,!0):s===1&&f!==null?ry(o,f,I,g||null,!0):s===2?rU(o,I,E):s===3&&o.destroyNode(I),r!=null&&sU(o,s,r,f,g)}}function H5(s,o){return s.createText(o)}function $5(s,o,f){s.setValue(o,f)}function IM(s,o,f){return s.createElement(o,f)}function q5(s,o){MM(s,o),o[rl]=null,o[as]=null}function W5(s,o,f,u,g,r){u[rl]=g,u[as]=o,My(s,u,f,1,g,r)}function MM(s,o){o[Ys].changeDetectionScheduler?.notify(1),My(s,o,o[Lr],2,null,null)}function Z5(s){let o=s[um];if(!o)return Wb(s[Yn],s);for(;o;){let f=null;if(Ou(o))f=o[um];else{let u=o[go];u&&(f=u)}if(!f){for(;o&&!o[Qs]&&o!==s;)Ou(o)&&Wb(o[Yn],o),o=o[to];o===null&&(o=s),Ou(o)&&Wb(o[Yn],o),f=o&&o[Qs]}o=f}}function Q5(s,o,f,u){let g=go+u,r=f.length;u>0&&(f[g-1][Qs]=o),u<r-go?(o[Qs]=f[g],mI(f,go+u,o)):(f.push(o),o[Qs]=null),o[to]=f;let E=o[vm];E!==null&&f!==E&&Y5(E,o);let I=o[el];I!==null&&I.insertView(s),uw(o),o[Nn]|=128}function Y5(s,o){let f=s[Zd],g=o[to][to][Es];o[Es]!==g&&(s[Nn]|=r2.HasTransplantedViews),f===null?s[Zd]=[o]:f.push(o)}function FM(s,o){let f=s[Zd],u=f.indexOf(o);f.splice(u,1)}function fm(s,o){if(s.length<=go)return;let f=go+o,u=s[f];if(u){let g=u[vm];g!==null&&g!==s&&FM(g,u),o>0&&(s[f-1][Qs]=u[Qs]);let r=Y_(s,go+o);q5(u[Yn],u);let E=r[el];E!==null&&E.detachView(r[Yn]),u[to]=null,u[Qs]=null,u[Nn]&=-129}return u}function Iy(s,o){if(!(o[Nn]&256)){let f=o[Lr];f.destroyNode&&My(s,o,f,3,null,null),Z5(o)}}function Wb(s,o){if(o[Nn]&256)return;let f=Si(null);try{o[Nn]&=-129,o[Nn]|=256,o[ku]&&WT(o[ku]),K5(s,o),X5(s,o),o[Yn].type===1&&o[Lr].destroy();let u=o[vm];if(u!==null&&ol(o[to])){u!==o[to]&&FM(u,o);let g=o[el];g!==null&&g.detachView(s)}I5(o)}finally{Si(f)}}function X5(s,o){let f=s.cleanup,u=o[cm];if(f!==null)for(let r=0;r<f.length-1;r+=2)if(typeof f[r]=="string"){let E=f[r+3];E>=0?u[E]():u[-E].unsubscribe(),r+=2}else{let E=u[f[r+1]];f[r].call(E)}u!==null&&(o[cm]=null);let g=o[sc];if(g!==null){o[sc]=null;for(let r=0;r<g.length;r++){let E=g[r];E()}}}function K5(s,o){let f;if(s!=null&&(f=s.destroyHooks)!=null)for(let u=0;u<f.length;u+=2){let g=o[f[u]];if(!(g instanceof Lu)){let r=f[u+1];if(Array.isArray(r))for(let E=0;E<r.length;E+=2){let I=g[r[E]],O=r[E+1];pa(4,I,O);try{O.call(I)}finally{pa(5,I,O)}}else{pa(4,g,r);try{r.call(g)}finally{pa(5,g,r)}}}}}function PM(s,o,f){return J5(s,o.parent,f)}function J5(s,o,f){let u=o;for(;u!==null&&u.type&40;)o=u,u=o.parent;if(u===null)return f[rl];{let{componentOffset:g}=u;if(g>-1){let{encapsulation:r}=s.data[u.directiveStart+g];if(r===ga.None||r===ga.Emulated)return null}return As(u,f)}}function ry(s,o,f,u,g){s.insertBefore(o,f,u,g)}function OM(s,o,f){s.appendChild(o,f)}function US(s,o,f,u,g){u!==null?ry(s,o,f,u,g):OM(s,o,f)}function eU(s,o,f,u){s.removeChild(o,f,u)}function w2(s,o){return s.parentNode(o)}function tU(s,o){return s.nextSibling(o)}function RM(s,o,f){return iU(s,o,f)}function nU(s,o,f){return s.type&40?As(s,f):null}var iU=nU,zS;function D2(s,o,f,u){let g=PM(s,u,o),r=o[Lr],E=u.parent||o[as],I=RM(E,u,o);if(g!=null)if(Array.isArray(f))for(let O=0;O<f.length;O++)US(r,g,f[O],I,!1);else US(r,g,f,I,!1);zS!==void 0&&zS(r,u,o,f,g)}function q_(s,o){if(o!==null){let f=o.type;if(f&3)return As(o,s);if(f&4)return vw(-1,s[o.index]);if(f&8){let u=o.child;if(u!==null)return q_(s,u);{let g=s[o.index];return ol(g)?vw(-1,g):_a(g)}}else{if(f&32)return b2(o,s)()||_a(s[o.index]);{let u=kM(s,o);if(u!==null){if(Array.isArray(u))return u[0];let g=dm(s[Es]);return q_(g,u)}else return q_(s,o.next)}}}return null}function kM(s,o){if(o!==null){let u=s[Es][as],g=o.projection;return u.projection[g]}return null}function vw(s,o){let f=go+s+1;if(f<o.length){let u=o[f],g=u[Yn].firstChild;if(g!==null)return q_(u,g)}return o[Bu]}function rU(s,o,f){let u=w2(s,o);u&&eU(s,u,o,f)}function C2(s,o,f,u,g,r,E){for(;f!=null;){let I=u[f.index],O=f.type;if(E&&o===0&&(I&&zu(_a(I),u),f.flags|=2),(f.flags&32)!==32)if(O&8)C2(s,o,f.child,u,g,r,!1),Ld(o,s,g,I,r);else if(O&32){let U=b2(f,u),V;for(;V=U();)Ld(o,s,g,V,r);Ld(o,s,g,I,r)}else O&16?BM(s,o,u,f,g,r):Ld(o,s,g,I,r);f=E?f.projectionNext:f.next}}function My(s,o,f,u,g,r){C2(f,u,s.firstChild,o,g,r,!1)}function oU(s,o,f){let u=o[Lr],g=PM(s,f,o),r=f.parent||o[as],E=RM(r,f,o);BM(u,0,o,f,g,E)}function BM(s,o,f,u,g,r){let E=f[Es],O=E[as].projection[u.projection];if(Array.isArray(O))for(let U=0;U<O.length;U++){let V=O[U];Ld(o,s,g,V,r)}else{let U=O,V=E[to];yM(u)&&(U.flags|=128),C2(s,o,U,V,g,r,!0)}}function sU(s,o,f,u,g){let r=f[Bu],E=_a(f);r!==E&&Ld(o,s,u,r,g);for(let I=go;I<f.length;I++){let O=f[I];My(O[Yn],O,s,o,u,r)}}function aU(s,o,f,u,g){if(o)g?s.addClass(f,u):s.removeClass(f,u);else{let r=u.indexOf("-")===-1?void 0:tl.DashCase;g==null?s.removeStyle(f,u,r):(typeof g=="string"&&g.endsWith("!important")&&(g=g.slice(0,-10),r|=tl.Important),s.setStyle(f,u,g,r))}}function lU(s,o,f){s.setAttribute(o,"style",f)}function NM(s,o,f){f===""?s.removeAttribute(o,"class"):s.setAttribute(o,"class",f)}function LM(s,o,f){let{mergedAttrs:u,classes:g,styles:r}=f;u!==null&&ow(s,o,u),g!==null&&NM(s,o,g),r!==null&&lU(s,o,r)}var va={};function ui(s=1){UM(Mo(),Ii(),hc()+s,!1)}function UM(s,o,f,u){if(!u)if((o[Nn]&3)===3){let r=s.preOrderCheckHooks;r!==null&&G_(o,r,f)}else{let r=s.preOrderHooks;r!==null&&H_(o,r,0,f)}Nu(f)}function Xn(s,o=pi.Default){let f=Ii();if(f===null)return Rn(s,o);let u=ls();return fM(u,f,Ao(s),o)}function zM(){let s="invalid";throw new Error(s)}function VM(s,o,f,u,g,r){let E=Si(null);try{let I=null;g&Jr.SignalBased&&(I=o[u][GT]),I!==null&&I.transformFn!==void 0&&(r=I.transformFn(r)),g&Jr.HasDecoratorInputTransform&&(r=s.inputTransforms[u].call(o,r)),s.setInput!==null?s.setInput(o,I,r,f,u):BI(o,I,u,r)}finally{Si(E)}}function cU(s,o){let f=s.hostBindingOpCodes;if(f!==null)try{for(let u=0;u<f.length;u++){let g=f[u];if(g<0)Nu(~g);else{let r=g,E=f[++u],I=f[++u];e5(E,r);let O=o[r];I(2,O)}}}finally{Nu(-1)}}function Fy(s,o,f,u,g,r,E,I,O,U,V){let Z=o.blueprint.slice();return Z[rl]=g,Z[Nn]=u|4|128|8|64,(U!==null||s&&s[Nn]&2048)&&(Z[Nn]|=2048),jI(Z),Z[to]=Z[Xd]=s,Z[Io]=f,Z[Ys]=E||s&&s[Ys],Z[Lr]=I||s&&s[Lr],Z[Wd]=O||s&&s[Wd]||null,Z[as]=r,Z[wy]=T5(),Z[qd]=V,Z[OI]=U,Z[Es]=o.type==2?s[Es]:Z,Z}function bm(s,o,f,u,g){let r=s.data[o];if(r===null)r=uU(s,o,f,u,g),JL()&&(r.flags|=32);else if(r.type&64){r.type=f,r.value=u,r.attrs=g;let E=YL();r.injectorIndex=E===null?-1:E.injectorIndex}return xm(r,!0),r}function uU(s,o,f,u,g){let r=qI(),E=WI(),I=E?r:r&&r.parent,O=s.data[o]=gU(s,I,f,o,u,g);return s.firstChild===null&&(s.firstChild=O),r!==null&&(E?r.child==null&&O.parent!==null&&(r.child=O):r.next===null&&(r.next=O,O.prev=r)),O}function jM(s,o,f,u){if(f===0)return-1;let g=o.length;for(let r=0;r<f;r++)o.push(u),s.blueprint.push(u),s.data.push(null);return g}function GM(s,o,f,u,g){let r=hc(),E=u&2;try{Nu(-1),E&&o.length>Xs&&UM(s,o,Xs,!1),pa(E?2:0,g),f(u,g)}finally{Nu(r),pa(E?3:1,g)}}function HM(s,o,f){if(kI(o)){let u=Si(null);try{let g=o.directiveStart,r=o.directiveEnd;for(let E=g;E<r;E++){let I=s.data[E];if(I.contentQueries){let O=f[E];I.contentQueries(1,O,E)}}}finally{Si(u)}}}function $M(s,o,f){HI()&&(DU(s,o,f,As(f,o)),(f.flags&64)===64&&YM(s,o,f))}function qM(s,o,f=As){let u=o.localNames;if(u!==null){let g=o.index+1;for(let r=0;r<u.length;r+=2){let E=u[r+1],I=E===-1?f(o,s):s[E];s[g++]=I}}}function WM(s){let o=s.tView;return o===null||o.incompleteFirstPass?s.tView=E2(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):o}function E2(s,o,f,u,g,r,E,I,O,U,V){let Z=Xs+u,te=Z+g,se=hU(Z,te),pe=typeof U=="function"?U():U;return se[Yn]={type:s,blueprint:se,template:f,queries:null,viewQuery:I,declTNode:o,data:se.slice().fill(null,Z),bindingStartIndex:Z,expandoStartIndex:te,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof E=="function"?E():E,firstChild:null,schemas:O,consts:pe,incompleteFirstPass:!1,ssrId:V}}function hU(s,o){let f=[];for(let u=0;u<o;u++)f.push(u<s?null:va);return f}function dU(s,o,f,u){let r=u.get(k5,CM)||f===ga.ShadowDom,E=s.selectRootElement(o,r);return fU(E),E}function fU(s){pU(s)}var pU=()=>null;function mU(s,o,f,u){let g=JM(o);g.push(f),s.firstCreatePass&&eF(s).push(u,g.length-1)}function gU(s,o,f,u,g,r){let E=o?o.injectorIndex:-1,I=0;return $I()&&(I|=128),{type:f,index:u,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:I,providerIndexes:0,value:g,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function VS(s,o,f,u,g){for(let r in o){if(!o.hasOwnProperty(r))continue;let E=o[r];if(E===void 0)continue;u??={};let I,O=Jr.None;Array.isArray(E)?(I=E[0],O=E[1]):I=E;let U=r;if(g!==null){if(!g.hasOwnProperty(r))continue;U=g[r]}s===0?jS(u,f,U,I,O):jS(u,f,U,I)}return u}function jS(s,o,f,u,g){let r;s.hasOwnProperty(f)?(r=s[f]).push(o,u):r=s[f]=[o,u],g!==void 0&&r.push(g)}function _U(s,o,f){let u=o.directiveStart,g=o.directiveEnd,r=s.data,E=o.attrs,I=[],O=null,U=null;for(let V=u;V<g;V++){let Z=r[V],te=f?f.get(Z):null,se=te?te.inputs:null,pe=te?te.outputs:null;O=VS(0,Z.inputs,V,O,se),U=VS(1,Z.outputs,V,U,pe);let Ce=O!==null&&E!==null&&!n2(o)?RU(O,V,E):null;I.push(Ce)}O!==null&&(O.hasOwnProperty("class")&&(o.flags|=8),O.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=I,o.inputs=O,o.outputs=U}function yU(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function vU(s,o,f,u,g,r,E,I){let O=As(o,f),U=o.inputs,V;!I&&U!=null&&(V=U[u])?(A2(s,f,V,u,g),Dy(o)&&xU(f,o.index)):o.type&3?(u=yU(u),g=E!=null?E(g,o.value||"",u):g,r.setProperty(O,u,g)):o.type&12}function xU(s,o){let f=uc(o,s);f[Nn]&16||(f[Nn]|=64)}function ZM(s,o,f,u){if(HI()){let g=u===null?null:{"":-1},r=EU(s,f),E,I;r===null?E=I=null:[E,I]=r,E!==null&&QM(s,o,f,E,g,I),g&&AU(f,u,g)}f.mergedAttrs=am(f.mergedAttrs,f.attrs)}function QM(s,o,f,u,g,r){for(let U=0;U<u.length;U++)fw(ny(f,o),s,u[U].type);SU(f,s.data.length,u.length);for(let U=0;U<u.length;U++){let V=u[U];V.providersResolver&&V.providersResolver(V)}let E=!1,I=!1,O=jM(s,o,u.length,null);for(let U=0;U<u.length;U++){let V=u[U];f.mergedAttrs=am(f.mergedAttrs,V.hostAttrs),IU(s,f,o,O,V),TU(O,V,g),V.contentQueries!==null&&(f.flags|=4),(V.hostBindings!==null||V.hostAttrs!==null||V.hostVars!==0)&&(f.flags|=64);let Z=V.type.prototype;!E&&(Z.ngOnChanges||Z.ngOnInit||Z.ngDoCheck)&&((s.preOrderHooks??=[]).push(f.index),E=!0),!I&&(Z.ngOnChanges||Z.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(f.index),I=!0),O++}_U(s,f,r)}function bU(s,o,f,u,g){let r=g.hostBindings;if(r){let E=s.hostBindingOpCodes;E===null&&(E=s.hostBindingOpCodes=[]);let I=~o.index;wU(E)!=I&&E.push(I),E.push(f,u,r)}}function wU(s){let o=s.length;for(;o>0;){let f=s[--o];if(typeof f=="number"&&f<0)return f}return 0}function DU(s,o,f,u){let g=f.directiveStart,r=f.directiveEnd;Dy(f)&&MU(o,f,s.data[g+f.componentOffset]),s.firstCreatePass||ny(f,o),zu(u,o);let E=f.initialInputs;for(let I=g;I<r;I++){let O=s.data[I],U=Uu(o,s,I,f);if(zu(U,o),E!==null&&OU(o,I-g,U,O,f,E),ac(O)){let V=uc(f.index,o);V[Io]=Uu(o,s,I,f)}}}function YM(s,o,f){let u=f.directiveStart,g=f.directiveEnd,r=f.index,E=t5();try{Nu(r);for(let I=u;I<g;I++){let O=s.data[I],U=o[I];hw(I),(O.hostBindings!==null||O.hostVars!==0||O.hostAttrs!==null)&&CU(O,U)}}finally{Nu(-1),hw(E)}}function CU(s,o){s.hostBindings!==null&&s.hostBindings(1,o)}function EU(s,o){let f=s.directiveRegistry,u=null,g=null;if(f)for(let r=0;r<f.length;r++){let E=f[r];if(bI(o,E.selectors,!1))if(u||(u=[]),ac(E))if(E.findHostDirectiveDefs!==null){let I=[];g=g||new Map,E.findHostDirectiveDefs(E,I,g),u.unshift(...I,E);let O=I.length;xw(s,o,O)}else u.unshift(E),xw(s,o,0);else g=g||new Map,E.findHostDirectiveDefs?.(E,u,g),u.push(E)}return u===null?null:[u,g]}function xw(s,o,f){o.componentOffset=f,(s.components??=[]).push(o.index)}function AU(s,o,f){if(o){let u=s.localNames=[];for(let g=0;g<o.length;g+=2){let r=f[o[g+1]];if(r==null)throw new mn(-301,!1);u.push(o[g],r)}}}function TU(s,o,f){if(f){if(o.exportAs)for(let u=0;u<o.exportAs.length;u++)f[o.exportAs[u]]=s;ac(o)&&(f[""]=s)}}function SU(s,o,f){s.flags|=1,s.directiveStart=o,s.directiveEnd=o+f,s.providerIndexes=o}function IU(s,o,f,u,g){s.data[u]=g;let r=g.factory||(g.factory=jd(g.type,!0)),E=new Lu(r,ac(g),Xn);s.blueprint[u]=E,f[u]=E,bU(s,o,u,jM(s,f,g.hostVars,va),g)}function MU(s,o,f){let u=As(o,s),g=WM(f),r=s[Ys].rendererFactory,E=16;f.signals?E=4096:f.onPush&&(E=64);let I=Py(s,Fy(s,g,null,E,u,o,null,r.createRenderer(u,f),null,null,null));s[o.index]=I}function FU(s,o,f,u,g,r){let E=As(s,o);PU(o[Lr],E,r,s.value,f,u,g)}function PU(s,o,f,u,g,r,E){if(r==null)s.removeAttribute(o,g,f);else{let I=E==null?yy(r):E(r,u||"",g);s.setAttribute(o,g,I,f)}}function OU(s,o,f,u,g,r){let E=r[o];if(E!==null)for(let I=0;I<E.length;){let O=E[I++],U=E[I++],V=E[I++],Z=E[I++];VM(u,f,O,U,V,Z)}}function RU(s,o,f){let u=null,g=0;for(;g<f.length;){let r=f[g];if(r===0){g+=4;continue}else if(r===5){g+=2;continue}if(typeof r=="number")break;if(s.hasOwnProperty(r)){u===null&&(u=[]);let E=s[r];for(let I=0;I<E.length;I+=3)if(E[I]===o){u.push(r,E[I+1],E[I+2],f[g+1]);break}}g+=2}return u}function XM(s,o,f,u){return[s,!0,0,o,null,u,null,f,null,null]}function KM(s,o){let f=s.contentQueries;if(f!==null){let u=Si(null);try{for(let g=0;g<f.length;g+=2){let r=f[g],E=f[g+1];if(E!==-1){let I=s.data[E];c2(r),I.contentQueries(2,o[E],E)}}}finally{Si(u)}}}function Py(s,o){return s[um]?s[MS][Qs]=o:s[um]=o,s[MS]=o,o}function bw(s,o,f){c2(0);let u=Si(null);try{o(s,f)}finally{Si(u)}}function JM(s){return s[cm]||(s[cm]=[])}function eF(s){return s.cleanup||(s.cleanup=[])}function tF(s,o){let f=s[Wd],u=f?f.get(ya,null):null;u&&u.handleError(o)}function A2(s,o,f,u,g){for(let r=0;r<f.length;){let E=f[r++],I=f[r++],O=f[r++],U=o[E],V=s.data[E];VM(V,U,u,I,O,g)}}function kU(s,o,f){let u=VI(o,s);$5(s[Lr],u,f)}function BU(s,o){let f=uc(o,s),u=f[Yn];NU(u,f);let g=f[rl];g!==null&&f[qd]===null&&(f[qd]=v2(g,f[Wd])),T2(u,f,f[Io])}function NU(s,o){for(let f=o.length;f<s.blueprint.length;f++)o.push(s.blueprint[f])}function T2(s,o,f){u2(o);try{let u=s.viewQuery;u!==null&&bw(1,u,f);let g=s.template;g!==null&&GM(s,o,g,1,f),s.firstCreatePass&&(s.firstCreatePass=!1),o[el]?.finishViewCreation(s),s.staticContentQueries&&KM(s,o),s.staticViewQueries&&bw(2,s.viewQuery,f);let r=s.components;r!==null&&LU(o,r)}catch(u){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),u}finally{o[Nn]&=-5,h2()}}function LU(s,o){for(let f=0;f<o.length;f++)BU(s,o[f])}function S2(s,o,f,u){let g=Si(null);try{let r=o.tView,I=s[Nn]&4096?4096:16,O=Fy(s,r,f,I,null,o,null,null,u?.injector??null,u?.embeddedViewInjector??null,u?.dehydratedView??null),U=s[o.index];O[vm]=U;let V=s[el];return V!==null&&(O[el]=V.createEmbeddedView(r)),T2(r,O,f),O}finally{Si(g)}}function UU(s,o){let f=go+o;if(f<s.length)return s[f]}function oy(s,o){return!o||o.firstChild===null||yM(s)}function I2(s,o,f,u=!0){let g=o[Yn];if(Q5(g,o,s,f),u){let E=vw(f,s),I=o[Lr],O=w2(I,s[Bu]);O!==null&&W5(g,s[as],I,o,O,E)}let r=o[qd];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function zU(s,o){let f=fm(s,o);return f!==void 0&&Iy(f[Yn],f),f}function sy(s,o,f,u,g=!1){for(;f!==null;){let r=o[f.index];r!==null&&u.push(_a(r)),ol(r)&&VU(r,u);let E=f.type;if(E&8)sy(s,o,f.child,u);else if(E&32){let I=b2(f,o),O;for(;O=I();)u.push(O)}else if(E&16){let I=kM(o,f);if(Array.isArray(I))u.push(...I);else{let O=dm(o[Es]);sy(O[Yn],O,I,u,!0)}}f=g?f.projectionNext:f.next}return u}function VU(s,o){for(let f=go;f<s.length;f++){let u=s[f],g=u[Yn].firstChild;g!==null&&sy(u[Yn],u,g,o)}s[Bu]!==s[rl]&&o.push(s[Bu])}var nF=[];function jU(s){return s[ku]??GU(s)}function GU(s){let o=nF.pop()??Object.create($U);return o.lView=s,o}function HU(s){s.lView[ku]!==s&&(s.lView=null,nF.push(s))}var $U=Li($t({},HT),{consumerIsAlwaysLive:!0,consumerMarkedDirty:s=>{hm(s.lView)},consumerOnSignalRead(){this.lView[ku]=this}}),iF=100;function rF(s,o=!0,f=0){let u=s[Ys],g=u.rendererFactory,r=!1;r||g.begin?.();try{qU(s,f)}catch(E){throw o&&tF(s,E),E}finally{r||(g.end?.(),u.inlineEffectRunner?.flush())}}function qU(s,o){ww(s,o);let f=0;for(;l2(s);){if(f===iF)throw new mn(103,!1);f++,ww(s,1)}}function WU(s,o,f,u){let g=o[Nn];if((g&256)===256)return;let r=!1;!r&&o[Ys].inlineEffectRunner?.flush(),u2(o);let E=null,I=null;!r&&ZU(s)&&(I=jU(o),E=$T(I));try{jI(o),KL(s.bindingStartIndex),f!==null&&GM(s,o,f,2,u);let O=(g&3)===3;if(!r)if(O){let Z=s.preOrderCheckHooks;Z!==null&&G_(o,Z,null)}else{let Z=s.preOrderHooks;Z!==null&&H_(o,Z,0,null),Gb(o,0)}if(QU(o),oF(o,0),s.contentQueries!==null&&KM(s,o),!r)if(O){let Z=s.contentCheckHooks;Z!==null&&G_(o,Z)}else{let Z=s.contentHooks;Z!==null&&H_(o,Z,1),Gb(o,1)}cU(s,o);let U=s.components;U!==null&&aF(o,U,0);let V=s.viewQuery;if(V!==null&&bw(2,V,u),!r)if(O){let Z=s.viewCheckHooks;Z!==null&&G_(o,Z)}else{let Z=s.viewHooks;Z!==null&&H_(o,Z,2),Gb(o,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),o[jb]){for(let Z of o[jb])Z();o[jb]=null}r||(o[Nn]&=-73)}catch(O){throw hm(o),O}finally{I!==null&&(qT(I,E),HU(I)),h2()}}function ZU(s){return s.type!==2}function oF(s,o){for(let f=xM(s);f!==null;f=bM(f))for(let u=go;u<f.length;u++){let g=f[u];sF(g,o)}}function QU(s){for(let o=xM(s);o!==null;o=bM(o)){if(!(o[Nn]&r2.HasTransplantedViews))continue;let f=o[Zd];for(let u=0;u<f.length;u++){let g=f[u],r=g[to];jL(g)}}}function YU(s,o,f){let u=uc(o,s);sF(u,f)}function sF(s,o){a2(s)&&ww(s,o)}function ww(s,o){let u=s[Yn],g=s[Nn],r=s[ku],E=!!(o===0&&g&16);if(E||=!!(g&64&&o===0),E||=!!(g&1024),E||=!!(r?.dirty&&vb(r)),r&&(r.dirty=!1),s[Nn]&=-9217,E)WU(u,s,u.template,s[Io]);else if(g&8192){oF(s,1);let I=u.components;I!==null&&aF(s,I,1)}}function aF(s,o,f){for(let u=0;u<o.length;u++)YU(s,o[u],f)}function M2(s){for(s[Ys].changeDetectionScheduler?.notify();s;){s[Nn]|=64;let o=dm(s);if(PL(s)&&!o)return s;s=o}return null}var Vu=class{get rootNodes(){let o=this._lView,f=o[Yn];return sy(f,o,f.firstChild,[])}constructor(o,f,u=!0){this._lView=o,this._cdRefInjectingView=f,this.notifyErrorHandler=u,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Io]}set context(o){this._lView[Io]=o}get destroyed(){return(this._lView[Nn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let o=this._lView[to];if(ol(o)){let f=o[K_],u=f?f.indexOf(this):-1;u>-1&&(fm(o,u),Y_(f,u))}this._attachedToViewContainer=!1}Iy(this._lView[Yn],this._lView)}onDestroy(o){GI(this._lView,o)}markForCheck(){M2(this._cdRefInjectingView||this._lView)}detach(){this._lView[Nn]&=-129}reattach(){uw(this._lView),this._lView[Nn]|=128}detectChanges(){this._lView[Nn]|=1024,rF(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new mn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,MM(this._lView[Yn],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new mn(902,!1);this._appRef=o,uw(this._lView)}},lc=(()=>{let o=class o{};o.__NG_ELEMENT_ID__=JU;let s=o;return s})(),XU=lc,KU=class extends XU{constructor(o,f,u){super(),this._declarationLView=o,this._declarationTContainer=f,this.elementRef=u}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,f){return this.createEmbeddedViewImpl(o,f)}createEmbeddedViewImpl(o,f,u){let g=S2(this._declarationLView,this._declarationTContainer,o,{embeddedViewInjector:f,dehydratedView:u});return new Vu(g)}};function JU(){return F2(ls(),Ii())}function F2(s,o){return s.type&4?new KU(o,s,ef(s,o)):null}var WZ=new RegExp(`^(\\d+)*(${O5}|${P5})*(.*)`);var ez=()=>null;function ay(s,o){return ez(s,o)}var ly=class{},Dw=class{},cy=class{};function tz(s){let o=Error(`No component factory found for ${So(s)}.`);return o[nz]=s,o}var nz="ngComponent";var Cw=class{resolveComponentFactory(o){throw tz(o)}},Oy=(()=>{let o=class o{};o.NULL=new Cw;let s=o;return s})(),pm=class{},dc=(()=>{let o=class o{constructor(){this.destroyNode=null}};o.__NG_ELEMENT_ID__=()=>iz();let s=o;return s})();function iz(){let s=Ii(),o=ls(),f=uc(o.index,s);return(Ou(f)?f:s)[Lr]}var rz=(()=>{let o=class o{};o.\u0275prov=un({token:o,providedIn:"root",factory:()=>null});let s=o;return s})(),Zb={};var GS=new Set;function Ry(s){GS.has(s)||(GS.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}function HS(...s){}function oz(){let s=typeof To.requestAnimationFrame=="function",o=To[s?"requestAnimationFrame":"setTimeout"],f=To[s?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&f){let u=o[Zone.__symbol__("OriginalDelegate")];u&&(o=u);let g=f[Zone.__symbol__("OriginalDelegate")];g&&(f=g)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:f}}var Ui=class s{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:f=!1,shouldCoalesceRunChangeDetection:u=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new lr(!1),this.onMicrotaskEmpty=new lr(!1),this.onStable=new lr(!1),this.onError=new lr(!1),typeof Zone>"u")throw new mn(908,!1);Zone.assertZonePatched();let g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!u&&f,g.shouldCoalesceRunChangeDetection=u,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=oz().nativeRequestAnimationFrame,lz(g)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new mn(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new mn(909,!1)}run(o,f,u){return this._inner.run(o,f,u)}runTask(o,f,u,g){let r=this._inner,E=r.scheduleEventTask("NgZoneEvent: "+g,o,sz,HS,HS);try{return r.runTask(E,f,u)}finally{r.cancelTask(E)}}runGuarded(o,f,u){return this._inner.runGuarded(o,f,u)}runOutsideAngular(o){return this._outer.run(o)}},sz={};function P2(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function az(s){s.isCheckStableRunning||s.lastRequestAnimationFrameId!==-1||(s.lastRequestAnimationFrameId=s.nativeRequestAnimationFrame.call(To,()=>{s.fakeTopEventTask||(s.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{s.lastRequestAnimationFrameId=-1,Ew(s),s.isCheckStableRunning=!0,P2(s),s.isCheckStableRunning=!1},void 0,()=>{},()=>{})),s.fakeTopEventTask.invoke()}),Ew(s))}function lz(s){let o=()=>{az(s)};s._inner=s._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(f,u,g,r,E,I)=>{if(cz(I))return f.invokeTask(g,r,E,I);try{return $S(s),f.invokeTask(g,r,E,I)}finally{(s.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&o(),qS(s)}},onInvoke:(f,u,g,r,E,I,O)=>{try{return $S(s),f.invoke(g,r,E,I,O)}finally{s.shouldCoalesceRunChangeDetection&&o(),qS(s)}},onHasTask:(f,u,g,r)=>{f.hasTask(g,r),u===g&&(r.change=="microTask"?(s._hasPendingMicrotasks=r.microTask,Ew(s),P2(s)):r.change=="macroTask"&&(s.hasPendingMacrotasks=r.macroTask))},onHandleError:(f,u,g,r)=>(f.handleError(g,r),s.runOutsideAngular(()=>s.onError.emit(r)),!1)})}function Ew(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.lastRequestAnimationFrameId!==-1?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function $S(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function qS(s){s._nesting--,P2(s)}var Aw=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new lr,this.onMicrotaskEmpty=new lr,this.onStable=new lr,this.onError=new lr}run(o,f,u){return o.apply(f,u)}runGuarded(o,f,u){return o.apply(f,u)}runOutsideAngular(o){return o()}runTask(o,f,u,g){return o.apply(f,u)}};function cz(s){return!Array.isArray(s)||s.length!==1?!1:s[0].data?.__ignore_ng_zone__===!0}function uz(s="zone.js",o){return s==="noop"?new Aw:s==="zone.js"?new Ui(o):s}var Ud=function(s){return s[s.EarlyRead=0]="EarlyRead",s[s.Write=1]="Write",s[s.MixedReadWrite=2]="MixedReadWrite",s[s.Read=3]="Read",s}(Ud||{}),hz={destroy(){}};function ky(s,o){!o&&IL(ky);let f=o?.injector??Ot(_o);if(!j5(f))return hz;Ry("NgAfterNextRender");let u=f.get(O2),g=u.handler??=new Sw,r=o?.phase??Ud.MixedReadWrite,E=()=>{g.unregister(O),I()},I=f.get(Ay).onDestroy(E),O=il(f,()=>new Tw(r,()=>{E(),s()}));return g.register(O),{destroy:E}}var Tw=class{constructor(o,f){this.phase=o,this.callbackFn=f,this.zone=Ot(Ui),this.errorHandler=Ot(ya,{optional:!0}),Ot(ly,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(o){this.errorHandler?.handleError(o)}}},Sw=class{constructor(){this.executingCallbacks=!1,this.buckets={[Ud.EarlyRead]:new Set,[Ud.Write]:new Set,[Ud.MixedReadWrite]:new Set,[Ud.Read]:new Set},this.deferredCallbacks=new Set}register(o){(this.executingCallbacks?this.deferredCallbacks:this.buckets[o.phase]).add(o)}unregister(o){this.buckets[o.phase].delete(o),this.deferredCallbacks.delete(o)}execute(){this.executingCallbacks=!0;for(let o of Object.values(this.buckets))for(let f of o)f.invoke();this.executingCallbacks=!1;for(let o of this.deferredCallbacks)this.buckets[o.phase].add(o);this.deferredCallbacks.clear()}destroy(){for(let o of Object.values(this.buckets))o.clear();this.deferredCallbacks.clear()}},O2=(()=>{let o=class o{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let u=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let g of u)g()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};o.\u0275prov=un({token:o,providedIn:"root",factory:()=>new o});let s=o;return s})();function Iw(s,o,f){let u=f?s.styles:null,g=f?s.classes:null,r=0;if(o!==null)for(let E=0;E<o.length;E++){let I=o[E];if(typeof I=="number")r=I;else if(r==1)g=tw(g,I);else if(r==2){let O=I,U=o[++E];u=tw(u,O+": "+U+";")}}f?s.styles=u:s.stylesWithoutHost=u,f?s.classes=g:s.classesWithoutHost=g}var uy=class extends Oy{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){let f=Ja(o);return new ju(f,this.ngModule)}};function WS(s){let o=[];for(let f in s){if(!s.hasOwnProperty(f))continue;let u=s[f];u!==void 0&&o.push({propName:Array.isArray(u)?u[0]:u,templateName:f})}return o}function dz(s){let o=s.toLowerCase();return o==="svg"?zI:o==="math"?BL:null}var Mw=class{constructor(o,f){this.injector=o,this.parentInjector=f}get(o,f,u){u=vy(u);let g=this.injector.get(o,Zb,u);return g!==Zb||f===Zb?g:this.parentInjector.get(o,f,u)}},ju=class extends cy{get inputs(){let o=this.componentDef,f=o.inputTransforms,u=WS(o.inputs);if(f!==null)for(let g of u)f.hasOwnProperty(g.propName)&&(g.transform=f[g.propName]);return u}get outputs(){return WS(this.componentDef.outputs)}constructor(o,f){super(),this.componentDef=o,this.ngModule=f,this.componentType=o.type,this.selector=fL(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!f}create(o,f,u,g){let r=Si(null);try{g=g||this.ngModule;let E=g instanceof eo?g:g?.injector;E&&this.componentDef.getStandaloneInjector!==null&&(E=this.componentDef.getStandaloneInjector(E)||E);let I=E?new Mw(o,E):o,O=I.get(pm,null);if(O===null)throw new mn(407,!1);let U=I.get(rz,null),V=I.get(O2,null),Z=I.get(ly,null),te={rendererFactory:O,sanitizer:U,inlineEffectRunner:null,afterRenderEventManager:V,changeDetectionScheduler:Z},se=O.createRenderer(null,this.componentDef),pe=this.componentDef.selectors[0][0]||"div",Ce=u?dU(se,u,this.componentDef.encapsulation,I):IM(se,pe,dz(pe)),Te=512;this.componentDef.signals?Te|=4096:this.componentDef.onPush||(Te|=16);let ce=null;Ce!==null&&(ce=v2(Ce,I,!0));let me=E2(0,null,null,1,0,null,null,null,null,null,null),ke=Fy(null,me,null,Te,null,null,te,se,I,null,ce);u2(ke);let Pe,Ze;try{let $e=this.componentDef,ot,bt=null;$e.findHostDirectiveDefs?(ot=[],bt=new Map,$e.findHostDirectiveDefs($e,ot,bt),ot.push($e)):ot=[$e];let Tt=fz(ke,Ce),qt=pz(Tt,Ce,$e,ot,ke,te,se);Ze=s2(me,Xs),Ce&&_z(se,$e,Ce,u),f!==void 0&&yz(Ze,this.ngContentSelectors,f),Pe=gz(qt,$e,ot,bt,ke,[vz]),T2(me,ke,null)}finally{h2()}return new Fw(this.componentType,Pe,ef(Ze,ke),ke,Ze)}finally{Si(r)}}},Fw=class extends Dw{constructor(o,f,u,g,r){super(),this.location=u,this._rootLView=g,this._tNode=r,this.previousInputValues=null,this.instance=f,this.hostView=this.changeDetectorRef=new Vu(g,void 0,!1),this.componentType=o}setInput(o,f){let u=this._tNode.inputs,g;if(u!==null&&(g=u[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),f))return;let r=this._rootLView;A2(r[Yn],r,g,o,f),this.previousInputValues.set(o,f);let E=uc(this._tNode.index,r);M2(E)}}get injector(){return new Ru(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}};function fz(s,o){let f=s[Yn],u=Xs;return s[u]=o,bm(f,u,2,"#host",null)}function pz(s,o,f,u,g,r,E){let I=g[Yn];mz(u,s,o,E);let O=null;o!==null&&(O=v2(o,g[Wd]));let U=r.rendererFactory.createRenderer(o,f),V=16;f.signals?V=4096:f.onPush&&(V=64);let Z=Fy(g,WM(f),null,V,g[s.index],s,r,U,null,null,O);return I.firstCreatePass&&xw(I,s,u.length-1),Py(g,Z),g[s.index]=Z}function mz(s,o,f,u){for(let g of s)o.mergedAttrs=am(o.mergedAttrs,g.hostAttrs);o.mergedAttrs!==null&&(Iw(o,o.mergedAttrs,!0),f!==null&&LM(u,f,o))}function gz(s,o,f,u,g,r){let E=ls(),I=g[Yn],O=As(E,g);QM(I,g,E,f,null,u);for(let V=0;V<f.length;V++){let Z=E.directiveStart+V,te=Uu(g,I,Z,E);zu(te,g)}YM(I,g,E),O&&zu(O,g);let U=Uu(g,I,E.directiveStart+E.componentOffset,E);if(s[Io]=g[Io]=U,r!==null)for(let V of r)V(U,o);return HM(I,E,g),U}function _z(s,o,f,u){if(u)ow(s,f,["ng-version","17.3.11"]);else{let{attrs:g,classes:r}=pL(o.selectors[0]);g&&ow(s,f,g),r&&r.length>0&&NM(s,f,r.join(" "))}}function yz(s,o,f){let u=s.projection=[];for(let g=0;g<o.length;g++){let r=f[g];u.push(r!=null?Array.from(r):null)}}function vz(){let s=ls();m2(Ii()[Yn],s)}var fc=(()=>{let o=class o{};o.__NG_ELEMENT_ID__=xz;let s=o;return s})();function xz(){let s=ls();return cF(s,Ii())}var bz=fc,lF=class extends bz{constructor(o,f,u){super(),this._lContainer=o,this._hostTNode=f,this._hostLView=u}get element(){return ef(this._hostTNode,this._hostLView)}get injector(){return new Ru(this._hostTNode,this._hostLView)}get parentInjector(){let o=g2(this._hostTNode,this._hostLView);if(aM(o)){let f=ty(o,this._hostLView),u=ey(o),g=f[Yn].data[u+8];return new Ru(g,f)}else return new Ru(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){let f=ZS(this._lContainer);return f!==null&&f[o]||null}get length(){return this._lContainer.length-go}createEmbeddedView(o,f,u){let g,r;typeof u=="number"?g=u:u!=null&&(g=u.index,r=u.injector);let E=ay(this._lContainer,o.ssrId),I=o.createEmbeddedViewImpl(f||{},r,E);return this.insertImpl(I,g,oy(this._hostTNode,E)),I}createComponent(o,f,u,g,r){let E=o&&!FL(o),I;if(E)I=f;else{let pe=f||{};I=pe.index,u=pe.injector,g=pe.projectableNodes,r=pe.environmentInjector||pe.ngModuleRef}let O=E?o:new ju(Ja(o)),U=u||this.parentInjector;if(!r&&O.ngModule==null){let Ce=(E?U:this.parentInjector).get(eo,null);Ce&&(r=Ce)}let V=Ja(O.componentType??{}),Z=ay(this._lContainer,V?.id??null),te=Z?.firstChild??null,se=O.create(U,g,te,r);return this.insertImpl(se.hostView,I,oy(this._hostTNode,Z)),se}insert(o,f){return this.insertImpl(o,f,!0)}insertImpl(o,f,u){let g=o._lView;if(VL(g)){let I=this.indexOf(o);if(I!==-1)this.detach(I);else{let O=g[to],U=new lF(O,O[as],O[to]);U.detach(U.indexOf(o))}}let r=this._adjustIndex(f),E=this._lContainer;return I2(E,g,r,u),o.attachToViewContainerRef(),mI(Qb(E),r,o),o}move(o,f){return this.insert(o,f)}indexOf(o){let f=ZS(this._lContainer);return f!==null?f.indexOf(o):-1}remove(o){let f=this._adjustIndex(o,-1),u=fm(this._lContainer,f);u&&(Y_(Qb(this._lContainer),f),Iy(u[Yn],u))}detach(o){let f=this._adjustIndex(o,-1),u=fm(this._lContainer,f);return u&&Y_(Qb(this._lContainer),f)!=null?new Vu(u):null}_adjustIndex(o,f=0){return o??this.length+f}};function ZS(s){return s[K_]}function Qb(s){return s[K_]||(s[K_]=[])}function cF(s,o){let f,u=o[s.index];return ol(u)?f=u:(f=XM(u,o,null,s),o[s.index]=f,Py(o,f)),Dz(f,o,s,u),new lF(f,s,o)}function wz(s,o){let f=s[Lr],u=f.createComment(""),g=As(o,s),r=w2(f,g);return ry(f,r,u,tU(f,g),!1),u}var Dz=Az,Cz=()=>!1;function Ez(s,o,f){return Cz(s,o,f)}function Az(s,o,f,u){if(s[Bu])return;let g;f.type&8?g=_a(u):g=wz(o,f),s[Bu]=g}var Pw=class s{constructor(o){this.queryList=o,this.matches=null}clone(){return new s(this.queryList)}setDirty(){this.queryList.setDirty()}},Ow=class s{constructor(o=[]){this.queries=o}createEmbeddedView(o){let f=o.queries;if(f!==null){let u=o.contentQueries!==null?o.contentQueries[0]:f.length,g=[];for(let r=0;r<u;r++){let E=f.getByIndex(r),I=this.queries[E.indexInDeclarationView];g.push(I.clone())}return new s(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}finishViewCreation(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let f=0;f<this.queries.length;f++)R2(o,f).matches!==null&&this.queries[f].setDirty()}},Rw=class{constructor(o,f,u=null){this.flags=f,this.read=u,typeof o=="string"?this.predicate=Rz(o):this.predicate=o}},kw=class s{constructor(o=[]){this.queries=o}elementStart(o,f){for(let u=0;u<this.queries.length;u++)this.queries[u].elementStart(o,f)}elementEnd(o){for(let f=0;f<this.queries.length;f++)this.queries[f].elementEnd(o)}embeddedTView(o){let f=null;for(let u=0;u<this.length;u++){let g=f!==null?f.length:0,r=this.getByIndex(u).embeddedTView(o,g);r&&(r.indexInDeclarationView=u,f!==null?f.push(r):f=[r])}return f!==null?new s(f):null}template(o,f){for(let u=0;u<this.queries.length;u++)this.queries[u].template(o,f)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}},Bw=class s{constructor(o,f=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=f}elementStart(o,f){this.isApplyingToNode(f)&&this.matchTNode(o,f)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,f){this.elementStart(o,f)}embeddedTView(o,f){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,f),new s(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let f=this._declarationNodeIndex,u=o.parent;for(;u!==null&&u.type&8&&u.index!==f;)u=u.parent;return f===(u!==null?u.index:-1)}return this._appliesToNextNode}matchTNode(o,f){let u=this.metadata.predicate;if(Array.isArray(u))for(let g=0;g<u.length;g++){let r=u[g];this.matchTNodeWithReadOption(o,f,Tz(f,r)),this.matchTNodeWithReadOption(o,f,$_(f,o,r,!1,!1))}else u===lc?f.type&4&&this.matchTNodeWithReadOption(o,f,-1):this.matchTNodeWithReadOption(o,f,$_(f,o,u,!1,!1))}matchTNodeWithReadOption(o,f,u){if(u!==null){let g=this.metadata.read;if(g!==null)if(g===Fo||g===fc||g===lc&&f.type&4)this.addMatch(f.index,-2);else{let r=$_(f,o,g,!1,!1);r!==null&&this.addMatch(f.index,r)}else this.addMatch(f.index,u)}}addMatch(o,f){this.matches===null?this.matches=[o,f]:this.matches.push(o,f)}};function Tz(s,o){let f=s.localNames;if(f!==null){for(let u=0;u<f.length;u+=2)if(f[u]===o)return f[u+1]}return null}function Sz(s,o){return s.type&11?ef(s,o):s.type&4?F2(s,o):null}function Iz(s,o,f,u){return f===-1?Sz(o,s):f===-2?Mz(s,o,u):Uu(s,s[Yn],f,o)}function Mz(s,o,f){if(f===Fo)return ef(o,s);if(f===lc)return F2(o,s);if(f===fc)return cF(o,s)}function uF(s,o,f,u){let g=o[el].queries[u];if(g.matches===null){let r=s.data,E=f.matches,I=[];for(let O=0;E!==null&&O<E.length;O+=2){let U=E[O];if(U<0)I.push(null);else{let V=r[U];I.push(Iz(o,V,E[O+1],f.metadata.read))}}g.matches=I}return g.matches}function Nw(s,o,f,u){let g=s.queries.getByIndex(f),r=g.matches;if(r!==null){let E=uF(s,o,g,f);for(let I=0;I<r.length;I+=2){let O=r[I];if(O>0)u.push(E[I/2]);else{let U=r[I+1],V=o[-O];for(let Z=go;Z<V.length;Z++){let te=V[Z];te[vm]===te[to]&&Nw(te[Yn],te,U,u)}if(V[Zd]!==null){let Z=V[Zd];for(let te=0;te<Z.length;te++){let se=Z[te];Nw(se[Yn],se,U,u)}}}}}return u}function Fz(s,o){return s[el].queries[o].queryList}function Pz(s,o,f){let u=new _w((f&4)===4);return mU(s,o,u,u.destroy),(o[el]??=new Ow).queries.push(new Pw(u))-1}function Oz(s,o,f){let u=Mo();return u.firstCreatePass&&(kz(u,new Rw(s,o,f),-1),(o&2)===2&&(u.staticViewQueries=!0)),Pz(u,Ii(),o)}function Rz(s){return s.split(",").map(o=>o.trim())}function kz(s,o,f){s.queries===null&&(s.queries=new kw),s.queries.track(new Bw(o,f))}function R2(s,o){return s.queries.getByIndex(o)}function Bz(s,o){let f=s[Yn],u=R2(f,o);return u.crossesNgTemplate?Nw(f,s,o,[]):uF(f,s,u,o)}function Nz(s){let o=[],f=new Map;function u(g){let r=f.get(g);if(!r){let E=s(g);f.set(g,r=E.then(Vz))}return r}return hy.forEach((g,r)=>{let E=[];g.templateUrl&&E.push(u(g.templateUrl).then(U=>{g.template=U}));let I=typeof g.styles=="string"?[g.styles]:g.styles||[];if(g.styles=I,g.styleUrl&&g.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(g.styleUrls?.length){let U=g.styles.length,V=g.styleUrls;g.styleUrls.forEach((Z,te)=>{I.push(""),E.push(u(Z).then(se=>{I[U+te]=se,V.splice(V.indexOf(Z),1),V.length==0&&(g.styleUrls=void 0)}))})}else g.styleUrl&&E.push(u(g.styleUrl).then(U=>{I.push(U),g.styleUrl=void 0}));let O=Promise.all(E).then(()=>jz(r));o.push(O)}),Uz(),Promise.all(o).then(()=>{})}var hy=new Map,Lz=new Set;function Uz(){let s=hy;return hy=new Map,s}function zz(){return hy.size===0}function Vz(s){return typeof s=="string"?s:s.text()}function jz(s){Lz.delete(s)}function Gz(s){return Object.getPrototypeOf(s.prototype).constructor}function Ks(s){let o=Gz(s.type),f=!0,u=[s];for(;o;){let g;if(ac(s))g=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new mn(903,!1);g=o.\u0275dir}if(g){if(f){u.push(g);let E=s;E.inputs=U_(s.inputs),E.inputTransforms=U_(s.inputTransforms),E.declaredInputs=U_(s.declaredInputs),E.outputs=U_(s.outputs);let I=g.hostBindings;I&&Zz(s,I);let O=g.viewQuery,U=g.contentQueries;if(O&&qz(s,O),U&&Wz(s,U),Hz(s,g),P4(s.outputs,g.outputs),ac(g)&&g.data.animation){let V=s.data;V.animation=(V.animation||[]).concat(g.data.animation)}}let r=g.features;if(r)for(let E=0;E<r.length;E++){let I=r[E];I&&I.ngInherit&&I(s),I===Ks&&(f=!1)}}o=Object.getPrototypeOf(o)}$z(u)}function Hz(s,o){for(let f in o.inputs){if(!o.inputs.hasOwnProperty(f)||s.inputs.hasOwnProperty(f))continue;let u=o.inputs[f];if(u!==void 0&&(s.inputs[f]=u,s.declaredInputs[f]=o.declaredInputs[f],o.inputTransforms!==null)){let g=Array.isArray(u)?u[0]:u;if(!o.inputTransforms.hasOwnProperty(g))continue;s.inputTransforms??={},s.inputTransforms[g]=o.inputTransforms[g]}}}function $z(s){let o=0,f=null;for(let u=s.length-1;u>=0;u--){let g=s[u];g.hostVars=o+=g.hostVars,g.hostAttrs=am(g.hostAttrs,f=am(f,g.hostAttrs))}}function U_(s){return s===Gd?{}:s===Go?[]:s}function qz(s,o){let f=s.viewQuery;f?s.viewQuery=(u,g)=>{o(u,g),f(u,g)}:s.viewQuery=o}function Wz(s,o){let f=s.contentQueries;f?s.contentQueries=(u,g,r)=>{o(u,g,r),f(u,g,r)}:s.contentQueries=o}function Zz(s,o){let f=s.hostBindings;f?s.hostBindings=(u,g)=>{o(u,g),f(u,g)}:s.hostBindings=o}function k2(s){let o=s.inputConfig,f={};for(let u in o)if(o.hasOwnProperty(u)){let g=o[u];Array.isArray(g)&&g[3]&&(f[u]=g[3])}s.inputTransforms=f}var cc=class{},mm=class{};var dy=class extends cc{constructor(o,f,u){super(),this._parent=f,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new uy(this);let g=EI(o);this._bootstrapComponents=SM(g.bootstrap),this._r3Injector=gM(o,f,[{provide:cc,useValue:this},{provide:Oy,useValue:this.componentFactoryResolver},...u],So(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){let o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(f=>f()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}},fy=class extends mm{constructor(o){super(),this.moduleType=o}create(o){return new dy(this.moduleType,o,[])}};function Qz(s,o,f){return new dy(s,o,f)}var Lw=class extends cc{constructor(o){super(),this.componentFactoryResolver=new uy(this),this.instance=null;let f=new lm([...o.providers,{provide:cc,useValue:this},{provide:Oy,useValue:this.componentFactoryResolver}],o.parent||by(),o.debugName,new Set(["environment"]));this.injector=f,o.runEnvironmentInitializers&&f.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}};function By(s,o,f=null){return new Lw({providers:s,parent:o,debugName:f,runEnvironmentInitializers:!0}).injector}var Ny=(()=>{let o=class o{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Sr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let u=this.taskId++;return this.pendingTasks.add(u),u}remove(u){this.pendingTasks.delete(u),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function hF(s,o,f){return s[o]=f}function Yz(s,o){return s[o]}function $u(s,o,f){let u=s[o];return Object.is(u,f)?!1:(s[o]=f,!0)}function Xz(s){return(s.flags&32)===32}function Kz(s,o,f,u,g,r,E,I,O){let U=o.consts,V=bm(o,s,4,E||null,J_(U,I));ZM(o,f,V,J_(U,O)),m2(o,V);let Z=V.tView=E2(2,V,u,g,r,o.directiveRegistry,o.pipeRegistry,null,o.schemas,U,null);return o.queries!==null&&(o.queries.template(o,V),Z.queries=o.queries.embeddedTView(V)),V}function Qd(s,o,f,u,g,r,E,I){let O=Ii(),U=Mo(),V=s+Xs,Z=U.firstCreatePass?Kz(V,U,O,o,f,u,g,r,E):U.data[V];xm(Z,!1);let te=Jz(U,O,Z,s);f2()&&D2(U,O,te,Z),zu(te,O);let se=XM(te,O,te,Z);return O[V]=se,Py(O,se),Ez(se,Z,O),o2(Z)&&$M(U,O,Z),E!=null&&qM(O,Z,I),Qd}var Jz=e6;function e6(s,o,f,u){return p2(!0),o[Lr].createComment("")}function nf(s,o,f,u){let g=Ii(),r=Cy();if($u(g,r,o)){let E=Mo(),I=iM();FU(I,g,s,o,f,u)}return nf}function t6(s,o,f,u){return $u(s,Cy(),f)?o+yy(f)+u:va}function z_(s,o){return s<<17|o<<2}function Gu(s){return s>>17&32767}function n6(s){return(s&2)==2}function i6(s,o){return s&131071|o<<17}function Uw(s){return s|2}function Yd(s){return(s&131068)>>2}function Yb(s,o){return s&-131069|o<<2}function r6(s){return(s&1)===1}function zw(s){return s|1}function o6(s,o,f,u,g,r){let E=r?o.classBindings:o.styleBindings,I=Gu(E),O=Yd(E);s[u]=f;let U=!1,V;if(Array.isArray(f)){let Z=f;V=Z[1],(V===null||ym(Z,V)>0)&&(U=!0)}else V=f;if(g)if(O!==0){let te=Gu(s[I+1]);s[u+1]=z_(te,I),te!==0&&(s[te+1]=Yb(s[te+1],u)),s[I+1]=i6(s[I+1],u)}else s[u+1]=z_(I,0),I!==0&&(s[I+1]=Yb(s[I+1],u)),I=u;else s[u+1]=z_(O,0),I===0?I=u:s[O+1]=Yb(s[O+1],u),O=u;U&&(s[u+1]=Uw(s[u+1])),QS(s,V,u,!0),QS(s,V,u,!1),s6(o,V,s,u,r),E=z_(I,O),r?o.classBindings=E:o.styleBindings=E}function s6(s,o,f,u,g){let r=g?s.residualClasses:s.residualStyles;r!=null&&typeof o=="string"&&ym(r,o)>=0&&(f[u+1]=zw(f[u+1]))}function QS(s,o,f,u){let g=s[f+1],r=o===null,E=u?Gu(g):Yd(g),I=!1;for(;E!==0&&(I===!1||r);){let O=s[E],U=s[E+1];a6(O,o)&&(I=!0,s[E+1]=u?zw(U):Uw(U)),E=u?Gu(U):Yd(U)}I&&(s[f+1]=u?Uw(g):zw(g))}function a6(s,o){return s===null||o==null||(Array.isArray(s)?s[1]:s)===o?!0:Array.isArray(s)&&typeof o=="string"?ym(s,o)>=0:!1}var Zs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function l6(s){return s.substring(Zs.key,Zs.keyEnd)}function c6(s){return u6(s),dF(s,fF(s,0,Zs.textEnd))}function dF(s,o){let f=Zs.textEnd;return f===o?-1:(o=Zs.keyEnd=h6(s,Zs.key=o,f),fF(s,o,f))}function u6(s){Zs.key=0,Zs.keyEnd=0,Zs.value=0,Zs.valueEnd=0,Zs.textEnd=s.length}function fF(s,o,f){for(;o<f&&s.charCodeAt(o)<=32;)o++;return o}function h6(s,o,f){for(;o<f&&s.charCodeAt(o)>32;)o++;return o}function cr(s,o,f){let u=Ii(),g=Cy();if($u(u,g,o)){let r=Mo(),E=iM();vU(r,E,u,s,o,u[Lr],f,!1)}return cr}function Vw(s,o,f,u,g){let r=o.inputs,E=g?"class":"style";A2(s,f,r[E],E,u)}function qu(s,o){return f6(s,o,null,!0),qu}function Ly(s){p6(x6,d6,s,!0)}function d6(s,o){for(let f=c6(o);f>=0;f=dF(o,f))t2(s,l6(o),!0)}function f6(s,o,f,u){let g=Ii(),r=Mo(),E=YI(2);if(r.firstUpdatePass&&mF(r,s,E,u),o!==va&&$u(g,E,o)){let I=r.data[hc()];gF(r,I,g,g[Lr],s,g[E+1]=w6(o,f),u,E)}}function p6(s,o,f,u){let g=Mo(),r=YI(2);g.firstUpdatePass&&mF(g,null,r,u);let E=Ii();if(f!==va&&$u(E,r,f)){let I=g.data[hc()];if(_F(I,u)&&!pF(g,r)){let O=u?I.classesWithoutHost:I.stylesWithoutHost;O!==null&&(f=tw(O,f||"")),Vw(g,I,E,f,u)}else b6(g,I,E,E[Lr],E[r+1],E[r+1]=v6(s,o,f),u,r)}}function pF(s,o){return o>=s.expandoStartIndex}function mF(s,o,f,u){let g=s.data;if(g[f+1]===null){let r=g[hc()],E=pF(s,f);_F(r,u)&&o===null&&!E&&(o=!1),o=m6(g,r,o,u),o6(g,r,o,f,E,u)}}function m6(s,o,f,u){let g=n5(s),r=u?o.residualClasses:o.residualStyles;if(g===null)(u?o.classBindings:o.styleBindings)===0&&(f=Xb(null,s,o,f,u),f=gm(f,o.attrs,u),r=null);else{let E=o.directiveStylingLast;if(E===-1||s[E]!==g)if(f=Xb(g,s,o,f,u),r===null){let O=g6(s,o,u);O!==void 0&&Array.isArray(O)&&(O=Xb(null,s,o,O[1],u),O=gm(O,o.attrs,u),_6(s,o,u,O))}else r=y6(s,o,u)}return r!==void 0&&(u?o.residualClasses=r:o.residualStyles=r),f}function g6(s,o,f){let u=f?o.classBindings:o.styleBindings;if(Yd(u)!==0)return s[Gu(u)]}function _6(s,o,f,u){let g=f?o.classBindings:o.styleBindings;s[Gu(g)]=u}function y6(s,o,f){let u,g=o.directiveEnd;for(let r=1+o.directiveStylingLast;r<g;r++){let E=s[r].hostAttrs;u=gm(u,E,f)}return gm(u,o.attrs,f)}function Xb(s,o,f,u,g){let r=null,E=f.directiveEnd,I=f.directiveStylingLast;for(I===-1?I=f.directiveStart:I++;I<E&&(r=o[I],u=gm(u,r.hostAttrs,g),r!==s);)I++;return s!==null&&(f.directiveStylingLast=I),u}function gm(s,o,f){let u=f?1:2,g=-1;if(o!==null)for(let r=0;r<o.length;r++){let E=o[r];typeof E=="number"?g=E:g===u&&(Array.isArray(s)||(s=s===void 0?[]:["",s]),t2(s,E,f?!0:o[++r]))}return s===void 0?null:s}function v6(s,o,f){if(f==null||f==="")return Go;let u=[],g=tf(f);if(Array.isArray(g))for(let r=0;r<g.length;r++)s(u,g[r],!0);else if(typeof g=="object")for(let r in g)g.hasOwnProperty(r)&&s(u,r,g[r]);else typeof g=="string"&&o(u,g);return u}function x6(s,o,f){let u=String(o);u!==""&&!u.includes(" ")&&t2(s,u,f)}function b6(s,o,f,u,g,r,E,I){g===va&&(g=Go);let O=0,U=0,V=0<g.length?g[0]:null,Z=0<r.length?r[0]:null;for(;V!==null||Z!==null;){let te=O<g.length?g[O+1]:void 0,se=U<r.length?r[U+1]:void 0,pe=null,Ce;V===Z?(O+=2,U+=2,te!==se&&(pe=Z,Ce=se)):Z===null||V!==null&&V<Z?(O+=2,pe=V):(U+=2,pe=Z,Ce=se),pe!==null&&gF(s,o,f,u,pe,Ce,E,I),V=O<g.length?g[O]:null,Z=U<r.length?r[U]:null}}function gF(s,o,f,u,g,r,E,I){if(!(o.type&3))return;let O=s.data,U=O[I+1],V=r6(U)?YS(O,o,f,g,Yd(U),E):void 0;if(!py(V)){py(r)||n6(U)&&(r=YS(O,null,f,g,I,E));let Z=VI(hc(),f);aU(u,E,Z,g,r)}}function YS(s,o,f,u,g,r){let E=o===null,I;for(;g>0;){let O=s[g],U=Array.isArray(O),V=U?O[1]:O,Z=V===null,te=f[g+1];te===va&&(te=Z?Go:void 0);let se=Z?zb(te,u):V===u?te:void 0;if(U&&!py(se)&&(se=zb(O,u)),py(se)&&(I=se,E))return I;let pe=s[g+1];g=E?Gu(pe):Yd(pe)}if(o!==null){let O=r?o.residualClasses:o.residualStyles;O!=null&&(I=zb(O,u))}return I}function py(s){return s!==void 0}function w6(s,o){return s==null||s===""||(typeof o=="string"?s=s+o:typeof s=="object"&&(s=So(tf(s)))),s}function _F(s,o){return(s.flags&(o?8:16))!==0}var jw=class{destroy(o){}updateValue(o,f){}swap(o,f){let u=Math.min(o,f),g=Math.max(o,f),r=this.detach(g);if(g-u>1){let E=this.detach(u);this.attach(u,r),this.attach(g,E)}else this.attach(u,r)}move(o,f){this.attach(f,this.detach(o))}};function Kb(s,o,f,u,g){return s===f&&Object.is(o,u)?1:Object.is(g(s,o),g(f,u))?-1:0}function D6(s,o,f){let u,g,r=0,E=s.length-1;if(Array.isArray(o)){let I=o.length-1;for(;r<=E&&r<=I;){let O=s.at(r),U=o[r],V=Kb(r,O,r,U,f);if(V!==0){V<0&&s.updateValue(r,U),r++;continue}let Z=s.at(E),te=o[I],se=Kb(E,Z,I,te,f);if(se!==0){se<0&&s.updateValue(E,te),E--,I--;continue}let pe=f(r,O),Ce=f(E,Z),Te=f(r,U);if(Object.is(Te,Ce)){let ce=f(I,te);Object.is(ce,pe)?(s.swap(r,E),s.updateValue(E,te),I--,E--):s.move(E,r),s.updateValue(r,U),r++;continue}if(u??=new my,g??=KS(s,r,E,f),Gw(s,u,r,Te))s.updateValue(r,U),r++,E++;else if(g.has(Te))u.set(pe,s.detach(r)),E--;else{let ce=s.create(r,o[r]);s.attach(r,ce),r++,E++}}for(;r<=I;)XS(s,u,f,r,o[r]),r++}else if(o!=null){let I=o[Symbol.iterator](),O=I.next();for(;!O.done&&r<=E;){let U=s.at(r),V=O.value,Z=Kb(r,U,r,V,f);if(Z!==0)Z<0&&s.updateValue(r,V),r++,O=I.next();else{u??=new my,g??=KS(s,r,E,f);let te=f(r,V);if(Gw(s,u,r,te))s.updateValue(r,V),r++,E++,O=I.next();else if(!g.has(te))s.attach(r,s.create(r,V)),r++,E++,O=I.next();else{let se=f(r,U);u.set(se,s.detach(r)),E--}}}for(;!O.done;)XS(s,u,f,s.length,O.value),O=I.next()}for(;r<=E;)s.destroy(s.detach(E--));u?.forEach(I=>{s.destroy(I)})}function Gw(s,o,f,u){return o!==void 0&&o.has(u)?(s.attach(f,o.get(u)),o.delete(u),!0):!1}function XS(s,o,f,u,g){if(Gw(s,o,u,f(u,g)))s.updateValue(u,g);else{let r=s.create(u,g);s.attach(u,r)}}function KS(s,o,f,u){let g=new Set;for(let r=o;r<=f;r++)g.add(u(r,s.at(r)));return g}var my=class{constructor(){this.kvMap=new Map,this._vMap=void 0}has(o){return this.kvMap.has(o)}delete(o){if(!this.has(o))return!1;let f=this.kvMap.get(o);return this._vMap!==void 0&&this._vMap.has(f)?(this.kvMap.set(o,this._vMap.get(f)),this._vMap.delete(f)):this.kvMap.delete(o),!0}get(o){return this.kvMap.get(o)}set(o,f){if(this.kvMap.has(o)){let u=this.kvMap.get(o);this._vMap===void 0&&(this._vMap=new Map);let g=this._vMap;for(;g.has(u);)u=g.get(u);g.set(u,f)}else this.kvMap.set(o,f)}forEach(o){for(let[f,u]of this.kvMap)if(o(u,f),this._vMap!==void 0){let g=this._vMap;for(;g.has(u);)u=g.get(u),o(u,f)}}};var Hw=class{constructor(o,f,u){this.lContainer=o,this.$implicit=f,this.$index=u}get $count(){return this.lContainer.length-go}};function yF(s){return s}var $w=class{constructor(o,f,u){this.hasEmptyBlock=o,this.trackByFn=f,this.liveCollection=u}};function B2(s,o,f,u,g,r,E,I,O,U,V,Z,te){Ry("NgControlFlow");let se=O!==void 0,pe=Ii(),Ce=I?E.bind(pe[Es][Io]):E,Te=new $w(se,Ce);pe[Xs+s]=Te,Qd(s+1,o,f,u,g,r),se&&Qd(s+2,O,U,V,Z,te)}var qw=class extends jw{constructor(o,f,u){super(),this.lContainer=o,this.hostLView=f,this.templateTNode=u,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-go}at(o){return this.getLView(o)[Io].$implicit}attach(o,f){let u=f[qd];this.needsIndexUpdate||=o!==this.length,I2(this.lContainer,f,o,oy(this.templateTNode,u))}detach(o){return this.needsIndexUpdate||=o!==this.length-1,C6(this.lContainer,o)}create(o,f){let u=ay(this.lContainer,this.templateTNode.tView.ssrId);return S2(this.hostLView,this.templateTNode,new Hw(this.lContainer,f,o),{dehydratedView:u})}destroy(o){Iy(o[Yn],o)}updateValue(o,f){this.getLView(o)[Io].$implicit=f}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let o=0;o<this.length;o++)this.getLView(o)[Io].$index=o}getLView(o){return E6(this.lContainer,o)}};function N2(s){let o=Si(null),f=hc();try{let u=Ii(),g=u[Yn],r=u[f];if(r.liveCollection===void 0){let I=f+1,O=JS(u,I),U=eI(g,I);r.liveCollection=new qw(O,u,U)}else r.liveCollection.reset();let E=r.liveCollection;if(D6(E,s,r.trackByFn),E.updateIndexes(),r.hasEmptyBlock){let I=Cy(),O=E.length===0;if($u(u,I,O)){let U=f+2,V=JS(u,U);if(O){let Z=eI(g,U),te=ay(V,Z.tView.ssrId),se=S2(u,Z,void 0,{dehydratedView:te});I2(V,se,0,oy(Z,te))}else zU(V,0)}}}finally{Si(o)}}function JS(s,o){return s[o]}function C6(s,o){return fm(s,o)}function E6(s,o){return UU(s,o)}function eI(s,o){return s2(s,o)}function A6(s,o,f,u,g,r){let E=o.consts,I=J_(E,g),O=bm(o,s,2,u,I);return ZM(o,f,O,J_(E,r)),O.attrs!==null&&Iw(O,O.attrs,!1),O.mergedAttrs!==null&&Iw(O,O.mergedAttrs,!0),o.queries!==null&&o.queries.elementStart(o,O),O}function rn(s,o,f,u){let g=Ii(),r=Mo(),E=Xs+s,I=g[Lr],O=r.firstCreatePass?A6(E,r,g,o,f,u):r.data[E],U=T6(r,g,O,I,o,s);g[E]=U;let V=o2(O);return xm(O,!0),LM(I,U,O),!Xz(O)&&f2()&&D2(r,g,U,O),$L()===0&&zu(U,g),qL(),V&&($M(r,g,O),HM(r,O,g)),u!==null&&qM(g,O),rn}function Jt(){let s=ls();WI()?ZI():(s=s.parent,xm(s,!1));let o=s;ZL(o)&&QL(),WL();let f=Mo();return f.firstCreatePass&&(m2(f,s),kI(s)&&f.queries.elementEnd(s)),o.classesWithoutHost!=null&&u5(o)&&Vw(f,o,Ii(),o.classesWithoutHost,!0),o.stylesWithoutHost!=null&&h5(o)&&Vw(f,o,Ii(),o.stylesWithoutHost,!1),Jt}function ur(s,o,f,u){return rn(s,o,f,u),Jt(),ur}var T6=(s,o,f,u,g,r)=>(p2(!0),IM(u,g,s5()));function L2(){return Ii()}var gy="en-US";var S6=gy;function I6(s){typeof s=="string"&&(S6=s.toLowerCase().replace(/_/g,"-"))}function yo(s,o,f,u){let g=Ii(),r=Mo(),E=ls();return F6(r,g,g[Lr],E,s,o,u),yo}function M6(s,o,f,u){let g=s.cleanup;if(g!=null)for(let r=0;r<g.length-1;r+=2){let E=g[r];if(E===f&&g[r+1]===u){let I=o[cm],O=g[r+2];return I.length>O?I[O]:null}typeof E=="string"&&(r+=2)}return null}function F6(s,o,f,u,g,r,E){let I=o2(u),U=s.firstCreatePass&&eF(s),V=o[Io],Z=JM(o),te=!0;if(u.type&3||E){let Ce=As(u,o),Te=E?E(Ce):Ce,ce=Z.length,me=E?Pe=>E(_a(Pe[u.index])):u.index,ke=null;if(!E&&I&&(ke=M6(s,o,g,u.index)),ke!==null){let Pe=ke.__ngLastListenerFn__||ke;Pe.__ngNextListenerFn__=r,ke.__ngLastListenerFn__=r,te=!1}else{r=nI(u,o,V,r,!1);let Pe=f.listen(Te,g,r);Z.push(r,Pe),U&&U.push(g,me,ce,ce+1)}}else r=nI(u,o,V,r,!1);let se=u.outputs,pe;if(te&&se!==null&&(pe=se[g])){let Ce=pe.length;if(Ce)for(let Te=0;Te<Ce;Te+=2){let ce=pe[Te],me=pe[Te+1],Ze=o[ce][me].subscribe(r),$e=Z.length;Z.push(r,Ze),U&&U.push(g,u.index,$e,-($e+1))}}}function tI(s,o,f,u){let g=Si(null);try{return pa(6,o,f),f(u)!==!1}catch(r){return tF(s,r),!1}finally{pa(7,o,f),Si(g)}}function nI(s,o,f,u,g){return function r(E){if(E===Function)return u;let I=s.componentOffset>-1?uc(s.index,o):o;M2(I);let O=tI(o,f,u,E),U=r.__ngNextListenerFn__;for(;U;)O=tI(o,f,U,E)&&O,U=U.__ngNextListenerFn__;return g&&O===!1&&E.preventDefault(),O}}function U2(s=1){return r5(s)}function P6(s,o){let f=null,u=lL(s);for(let g=0;g<o.length;g++){let r=o[g];if(r==="*"){f=g;continue}if(u===null?bI(s,r,!0):hL(u,r))return g}return f}function vF(s){let o=Ii()[Es][as];if(!o.projection){let f=s?s.length:1,u=o.projection=J4(f,null),g=u.slice(),r=o.child;for(;r!==null;){let E=s?P6(r,s):0;E!==null&&(g[E]?g[E].projectionNext=r:u[E]=r,g[E]=r),r=r.next}}}function xF(s,o=0,f){let u=Ii(),g=Mo(),r=bm(g,Xs+s,16,null,f||null);r.projection===null&&(r.projection=o),ZI(),(!u[qd]||$I())&&(r.flags&32)!==32&&oU(g,u,r)}function bF(s,o,f){Oz(s,o,f)}function z2(s){let o=Ii(),f=Mo(),u=XI();c2(u+1);let g=R2(f,u);if(s.dirty&&zL(o)===((g.metadata.flags&2)===2)){if(g.matches===null)s.reset([]);else{let r=Bz(o,u);s.reset(r,C5),s.notifyOnChanges()}return!0}return!1}function V2(){return Fz(Ii(),XI())}function j2(s){let o=XL();return UL(o,Xs+s)}function vn(s,o=""){let f=Ii(),u=Mo(),g=s+Xs,r=u.firstCreatePass?bm(u,g,1,o,null):u.data[g],E=O6(u,f,r,o,s);f[g]=E,f2()&&D2(u,f,E,r),xm(r,!1)}var O6=(s,o,f,u,g)=>(p2(!0),H5(o[Lr],u));function rf(s){return ro("",s,""),rf}function ro(s,o,f){let u=Ii(),g=t6(u,s,o,f);return g!==va&&kU(u,hc(),g),ro}function R6(s,o,f){let u=Mo();if(u.firstCreatePass){let g=ac(s);Ww(f,u.data,u.blueprint,g,!0),Ww(o,u.data,u.blueprint,g,!1)}}function Ww(s,o,f,u,g){if(s=Ao(s),Array.isArray(s))for(let r=0;r<s.length;r++)Ww(s[r],o,f,u,g);else{let r=Mo(),E=Ii(),I=ls(),O=$d(s)?s:Ao(s.provide),U=FI(s),V=I.providerIndexes&1048575,Z=I.directiveStart,te=I.providerIndexes>>20;if($d(s)||!s.multi){let se=new Lu(U,g,Xn),pe=ew(O,o,g?V:V+te,Z);pe===-1?(fw(ny(I,E),r,O),Jb(r,s,o.length),o.push(O),I.directiveStart++,I.directiveEnd++,g&&(I.providerIndexes+=1048576),f.push(se),E.push(se)):(f[pe]=se,E[pe]=se)}else{let se=ew(O,o,V+te,Z),pe=ew(O,o,V,V+te),Ce=se>=0&&f[se],Te=pe>=0&&f[pe];if(g&&!Te||!g&&!Ce){fw(ny(I,E),r,O);let ce=N6(g?B6:k6,f.length,g,u,U);!g&&Te&&(f[pe].providerFactory=ce),Jb(r,s,o.length,0),o.push(O),I.directiveStart++,I.directiveEnd++,g&&(I.providerIndexes+=1048576),f.push(ce),E.push(ce)}else{let ce=wF(f[g?pe:se],U,!g&&u);Jb(r,s,se>-1?se:pe,ce)}!g&&u&&Te&&f[pe].componentProviders++}}}function Jb(s,o,f,u){let g=$d(o),r=wL(o);if(g||r){let O=(r?Ao(o.useClass):o).prototype.ngOnDestroy;if(O){let U=s.destroyHooks||(s.destroyHooks=[]);if(!g&&o.multi){let V=U.indexOf(f);V===-1?U.push(f,[u,O]):U[V+1].push(u,O)}else U.push(f,O)}}}function wF(s,o,f){return f&&s.componentProviders++,s.multi.push(o)-1}function ew(s,o,f,u){for(let g=f;g<u;g++)if(o[g]===s)return g;return-1}function k6(s,o,f,u){return Zw(this.multi,[])}function B6(s,o,f,u){let g=this.multi,r;if(this.providerFactory){let E=this.providerFactory.componentProviders,I=Uu(f,f[Yn],this.providerFactory.index,u);r=I.slice(0,E),Zw(g,r);for(let O=E;O<I.length;O++)r.push(I[O])}else r=[],Zw(g,r);return r}function Zw(s,o){for(let f=0;f<s.length;f++){let u=s[f];o.push(u())}return o}function N6(s,o,f,u,g){let r=new Lu(s,f,Xn);return r.multi=[],r.index=o,r.componentProviders=0,wF(r,g,u&&!f),r}function Wu(s,o=[]){return f=>{f.providersResolver=(u,g)=>R6(u,g?g(s):s,o)}}var L6=(()=>{let o=class o{constructor(u){this._injector=u,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(u){if(!u.standalone)return null;if(!this.cachedInjectors.has(u)){let g=SI(!1,u.type),r=g.length>0?By([g],this._injector,`Standalone[${u.type.name}]`):null;this.cachedInjectors.set(u,r)}return this.cachedInjectors.get(u)}ngOnDestroy(){try{for(let u of this.cachedInjectors.values())u!==null&&u.destroy()}finally{this.cachedInjectors.clear()}}};o.\u0275prov=un({token:o,providedIn:"environment",factory:()=>new o(Rn(eo))});let s=o;return s})();function wm(s){Ry("NgStandalone"),s.getStandaloneInjector=o=>o.get(L6).getOrCreateStandaloneInjector(s)}function pc(s,o,f){let u=QI()+s,g=Ii();return g[u]===va?hF(g,u,f?o.call(f):o()):Yz(g,u)}function G2(s,o,f,u){return z6(Ii(),QI(),s,o,f,u)}function U6(s,o){let f=s[o];return f===va?void 0:f}function z6(s,o,f,u,g,r){let E=o+f;return $u(s,E,g)?hF(s,E+1,r?u.call(r,g):u(g)):U6(s,E+1)}var V_=null;function V6(s){V_!==null&&(s.defaultEncapsulation!==V_.defaultEncapsulation||s.preserveWhitespaces!==V_.preserveWhitespaces)||(V_=s)}var Uy=(()=>{let o=class o{log(u){console.log(u)}warn(u){console.warn(u)}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"platform"});let s=o;return s})();var H2=new wn(""),Dm=new wn(""),zy=(()=>{let o=class o{constructor(u,g,r){this._ngZone=u,this.registry=g,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,$2||(j6(r),r.addToWindow(g)),this._watchAngularEvents(),u.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ui.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&this._pendingCount===0&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let u=this._callbacks.pop();clearTimeout(u.timeoutId),u.doneCb()}});else{let u=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>g.updateCb&&g.updateCb(u)?(clearTimeout(g.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(u=>({source:u.source,creationLocation:u.creationLocation,data:u.data})):[]}addCallback(u,g,r){let E=-1;g&&g>0&&(E=setTimeout(()=>{this._callbacks=this._callbacks.filter(I=>I.timeoutId!==E),u()},g)),this._callbacks.push({doneCb:u,timeoutId:E,updateCb:r})}whenStable(u,g,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(u,g,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(u){this.registry.registerApplication(u,this)}unregisterApplication(u){this.registry.unregisterApplication(u)}findProviders(u,g,r){return[]}};o.\u0275fac=function(g){return new(g||o)(Rn(Ui),Rn(Vy),Rn(Dm))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),Vy=(()=>{let o=class o{constructor(){this._applications=new Map}registerApplication(u,g){this._applications.set(u,g)}unregisterApplication(u){this._applications.delete(u)}unregisterAllApplications(){this._applications.clear()}getTestability(u){return this._applications.get(u)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(u,g=!0){return $2?.findTestabilityInTree(this,u,g)??null}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"platform"});let s=o;return s})();function j6(s){$2=s}var $2;function Zu(s){return!!s&&typeof s.then=="function"}function DF(s){return!!s&&typeof s.subscribe=="function"}var jy=new wn(""),CF=(()=>{let o=class o{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((u,g)=>{this.resolve=u,this.reject=g}),this.appInits=Ot(jy,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let u=[];for(let r of this.appInits){let E=r();if(Zu(E))u.push(E);else if(DF(E)){let I=new Promise((O,U)=>{E.subscribe({complete:O,error:U})});u.push(I)}}let g=()=>{this.done=!0,this.resolve()};Promise.all(u).then(()=>{g()}).catch(r=>{this.reject(r)}),u.length===0&&g(),this.initialized=!0}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),q2=new wn("");function G6(){ZT(()=>{throw new mn(600,!1)})}function H6(s){return s.isBoundToModule}function $6(s,o,f){try{let u=f();return Zu(u)?u.catch(g=>{throw o.runOutsideAngular(()=>s.handleError(g)),g}):u}catch(u){throw o.runOutsideAngular(()=>s.handleError(u)),u}}function EF(s,o){return Array.isArray(o)?o.reduce(EF,s):$t($t({},s),o)}var mc=(()=>{let o=class o{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ot(_M),this.afterRenderEffectManager=Ot(O2),this.externalTestViews=new Set,this.beforeRender=new nr,this.afterTick=new nr,this.componentTypes=[],this.components=[],this.isStable=Ot(Ny).hasPendingTasks.pipe(ci(u=>!u)),this._injector=Ot(eo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(u,g){let r=u instanceof cy;if(!this._injector.get(CF).done){let se=!r&&CI(u),pe=!1;throw new mn(405,pe)}let I;r?I=u:I=this._injector.get(Oy).resolveComponentFactory(u),this.componentTypes.push(I.componentType);let O=H6(I)?void 0:this._injector.get(cc),U=g||I.selector,V=I.create(_o.NULL,[],U,O),Z=V.location.nativeElement,te=V.injector.get(H2,null);return te?.registerApplication(Z),V.onDestroy(()=>{this.detachView(V.hostView),W_(this.components,V),te?.unregisterApplication(Z)}),this._loadComponent(V),V}tick(){this._tick(!0)}_tick(u){if(this._runningTick)throw new mn(101,!1);let g=Si(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(u)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,Si(g)}}detectChangesInAttachedViews(u){let g=0,r=this.afterRenderEffectManager;for(;;){if(g===iF)throw new mn(103,!1);if(u){let E=g===0;this.beforeRender.next(E);for(let{_lView:I,notifyErrorHandler:O}of this._views)q6(I,E,O)}if(g++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:E})=>Qw(E))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:E})=>Qw(E))))break}}attachView(u){let g=u;this._views.push(g),g.attachToAppRef(this)}detachView(u){let g=u;W_(this._views,g),g.detachFromAppRef()}_loadComponent(u){this.attachView(u.hostView),this.tick(),this.components.push(u);let g=this._injector.get(q2,[]);[...this._bootstrapListeners,...g].forEach(r=>r(u))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(u=>u()),this._views.slice().forEach(u=>u.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(u){return this._destroyListeners.push(u),()=>W_(this._destroyListeners,u)}destroy(){if(this._destroyed)throw new mn(406,!1);let u=this._injector;u.destroy&&!u.destroyed&&u.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function W_(s,o){let f=s.indexOf(o);f>-1&&s.splice(f,1)}function q6(s,o,f){!o&&!Qw(s)||W6(s,f,o)}function Qw(s){return l2(s)}function W6(s,o,f){let u;f?(u=0,s[Nn]|=1024):s[Nn]&64?u=0:u=1,rF(s,o,u)}var Yw=class{constructor(o,f){this.ngModuleFactory=o,this.componentFactories=f}},Gy=(()=>{let o=class o{compileModuleSync(u){return new fy(u)}compileModuleAsync(u){return Promise.resolve(this.compileModuleSync(u))}compileModuleAndAllComponentsSync(u){let g=this.compileModuleSync(u),r=EI(u),E=SM(r.declarations).reduce((I,O)=>{let U=Ja(O);return U&&I.push(new ju(U)),I},[]);return new Yw(g,E)}compileModuleAndAllComponentsAsync(u){return Promise.resolve(this.compileModuleAndAllComponentsSync(u))}clearCache(){}clearCacheFor(u){}getModuleId(u){}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),Z6=new wn("");function Q6(s,o,f){let u=new fy(f);return Promise.resolve(u)}function iI(s){for(let o=s.length-1;o>=0;o--)if(s[o]!==void 0)return s[o]}var Y6=(()=>{let o=class o{constructor(){this.zone=Ot(Ui),this.applicationRef=Ot(mc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function X6(s){return[{provide:Ui,useFactory:s},{provide:Hd,multi:!0,useFactory:()=>{let o=Ot(Y6,{optional:!0});return()=>o.initialize()}},{provide:Hd,multi:!0,useFactory:()=>{let o=Ot(e8);return()=>{o.initialize()}}},{provide:_M,useFactory:K6}]}function K6(){let s=Ot(Ui),o=Ot(ya);return f=>s.runOutsideAngular(()=>o.handleError(f))}function J6(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var e8=(()=>{let o=class o{constructor(){this.subscription=new br,this.initialized=!1,this.zone=Ot(Ui),this.pendingTasks=Ot(Ny)}initialize(){if(this.initialized)return;this.initialized=!0;let u=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(u=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Ui.assertNotInAngularZone(),queueMicrotask(()=>{u!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(u),u=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Ui.assertInAngularZone(),u??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function t8(){return typeof $localize<"u"&&$localize.locale||gy}var Hy=new wn("",{providedIn:"root",factory:()=>Ot(Hy,pi.Optional|pi.SkipSelf)||t8()});var AF=new wn(""),TF=(()=>{let o=class o{constructor(u){this._injector=u,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(u,g){let r=uz(g?.ngZone,J6({eventCoalescing:g?.ngZoneEventCoalescing,runCoalescing:g?.ngZoneRunCoalescing}));return r.run(()=>{let E=Qz(u.moduleType,this.injector,X6(()=>r)),I=E.injector.get(ya,null);return r.runOutsideAngular(()=>{let O=r.onError.subscribe({next:U=>{I.handleError(U)}});E.onDestroy(()=>{W_(this._modules,E),O.unsubscribe()})}),$6(I,r,()=>{let O=E.injector.get(CF);return O.runInitializers(),O.donePromise.then(()=>{let U=E.injector.get(Hy,gy);return I6(U||gy),this._moduleDoBootstrap(E),E})})})}bootstrapModule(u,g=[]){let r=EF({},g);return Q6(this.injector,r,u).then(E=>this.bootstrapModuleFactory(E,r))}_moduleDoBootstrap(u){let g=u.injector.get(mc);if(u._bootstrapComponents.length>0)u._bootstrapComponents.forEach(r=>g.bootstrap(r));else if(u.instance.ngDoBootstrap)u.instance.ngDoBootstrap(g);else throw new mn(-403,!1);this._modules.push(u)}onDestroy(u){this._destroyListeners.push(u)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new mn(404,!1);this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());let u=this._injector.get(AF,null);u&&(u.forEach(g=>g()),u.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};o.\u0275fac=function(g){return new(g||o)(Rn(_o))},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"platform"});let s=o;return s})(),om=null,SF=new wn("");function n8(s){if(om&&!om.get(SF,!1))throw new mn(400,!1);G6(),om=s;let o=s.get(TF);return o8(s),o}function W2(s,o,f=[]){let u=`Platform: ${o}`,g=new wn(u);return(r=[])=>{let E=IF();if(!E||E.injector.get(SF,!1)){let I=[...f,...r,{provide:g,useValue:!0}];s?s(I):n8(i8(I,u))}return r8(g)}}function i8(s=[],o){return _o.create({name:o,providers:[{provide:xy,useValue:"platform"},{provide:AF,useValue:new Set([()=>om=null])},...s]})}function r8(s){let o=IF();if(!o)throw new mn(401,!1);return o}function IF(){return om?.get(TF)??null}function o8(s){s.get(_2,null)?.forEach(f=>f())}var gc=(()=>{let o=class o{};o.__NG_ELEMENT_ID__=s8;let s=o;return s})();function s8(s){return a8(ls(),Ii(),(s&16)===16)}function a8(s,o,f){if(Dy(s)&&!f){let u=uc(s.index,o);return new Vu(u,u)}else if(s.type&47){let u=o[Es];return new Vu(u,o)}return null}var MF=W2(null,"core",[]),FF=(()=>{let o=class o{constructor(u){}};o.\u0275fac=function(g){return new(g||o)(Rn(mc))},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();function of(s){return typeof s=="boolean"?s:s!=null&&s!=="false"}function $y(s,o){let f=Ja(s),u=o.elementInjector||by();return new ju(f).create(u,o.projectableNodes,o.hostElement,o.environmentInjector)}function PF(s){let o=Ja(s);if(!o)return null;let f=new ju(o);return{get selector(){return f.selector},get type(){return f.componentType},get inputs(){return f.inputs},get outputs(){return f.outputs},get ngContentSelectors(){return f.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}var BF=null;function xa(){return BF}function NF(s){BF??=s}var qy=class{};var Hr=new wn(""),K2=(()=>{let o=class o{historyGo(u){throw new Error("")}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(c8),providedIn:"platform"});let s=o;return s})(),LF=new wn(""),c8=(()=>{let o=class o extends K2{constructor(){super(),this._doc=Ot(Hr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return xa().getBaseHref(this._doc)}onPopState(u){let g=xa().getGlobalEventTarget(this._doc,"window");return g.addEventListener("popstate",u,!1),()=>g.removeEventListener("popstate",u)}onHashChange(u){let g=xa().getGlobalEventTarget(this._doc,"window");return g.addEventListener("hashchange",u,!1),()=>g.removeEventListener("hashchange",u)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(u){this._location.pathname=u}pushState(u,g,r){this._history.pushState(u,g,r)}replaceState(u,g,r){this._history.replaceState(u,g,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(u=0){this._history.go(u)}getState(){return this._history.state}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>new o,providedIn:"platform"});let s=o;return s})();function J2(s,o){if(s.length==0)return o;if(o.length==0)return s;let f=0;return s.endsWith("/")&&f++,o.startsWith("/")&&f++,f==2?s+o.substring(1):f==1?s+o:s+"/"+o}function OF(s){let o=s.match(/#|\?|$/),f=o&&o.index||s.length,u=f-(s[f-1]==="/"?1:0);return s.slice(0,u)+s.slice(f)}function ll(s){return s&&s[0]!=="?"?"?"+s:s}var cl=(()=>{let o=class o{historyGo(u){throw new Error("")}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(eD),providedIn:"root"});let s=o;return s})(),UF=new wn(""),eD=(()=>{let o=class o extends cl{constructor(u,g){super(),this._platformLocation=u,this._removeListenerFns=[],this._baseHref=g??this._platformLocation.getBaseHrefFromDOM()??Ot(Hr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}prepareExternalUrl(u){return J2(this._baseHref,u)}path(u=!1){let g=this._platformLocation.pathname+ll(this._platformLocation.search),r=this._platformLocation.hash;return r&&u?`${g}${r}`:g}pushState(u,g,r,E){let I=this.prepareExternalUrl(r+ll(E));this._platformLocation.pushState(u,g,I)}replaceState(u,g,r,E){let I=this.prepareExternalUrl(r+ll(E));this._platformLocation.replaceState(u,g,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(u=0){this._platformLocation.historyGo?.(u)}};o.\u0275fac=function(g){return new(g||o)(Rn(K2),Rn(UF,8))},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),zF=(()=>{let o=class o extends cl{constructor(u,g){super(),this._platformLocation=u,this._baseHref="",this._removeListenerFns=[],g!=null&&(this._baseHref=g)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(u){this._removeListenerFns.push(this._platformLocation.onPopState(u),this._platformLocation.onHashChange(u))}getBaseHref(){return this._baseHref}path(u=!1){let g=this._platformLocation.hash??"#";return g.length>0?g.substring(1):g}prepareExternalUrl(u){let g=J2(this._baseHref,u);return g.length>0?"#"+g:g}pushState(u,g,r,E){let I=this.prepareExternalUrl(r+ll(E));I.length==0&&(I=this._platformLocation.pathname),this._platformLocation.pushState(u,g,I)}replaceState(u,g,r,E){let I=this.prepareExternalUrl(r+ll(E));I.length==0&&(I=this._platformLocation.pathname),this._platformLocation.replaceState(u,g,I)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(u=0){this._platformLocation.historyGo?.(u)}};o.\u0275fac=function(g){return new(g||o)(Rn(K2),Rn(UF,8))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),sf=(()=>{let o=class o{constructor(u){this._subject=new lr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=u;let g=this._locationStrategy.getBaseHref();this._basePath=d8(OF(RF(g))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(u=!1){return this.normalize(this._locationStrategy.path(u))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(u,g=""){return this.path()==this.normalize(u+ll(g))}normalize(u){return o.stripTrailingSlash(h8(this._basePath,RF(u)))}prepareExternalUrl(u){return u&&u[0]!=="/"&&(u="/"+u),this._locationStrategy.prepareExternalUrl(u)}go(u,g="",r=null){this._locationStrategy.pushState(r,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+ll(g)),r)}replaceState(u,g="",r=null){this._locationStrategy.replaceState(r,"",u,g),this._notifyUrlChangeListeners(this.prepareExternalUrl(u+ll(g)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(u=0){this._locationStrategy.historyGo?.(u)}onUrlChange(u){return this._urlChangeListeners.push(u),this._urlChangeSubscription??=this.subscribe(g=>{this._notifyUrlChangeListeners(g.url,g.state)}),()=>{let g=this._urlChangeListeners.indexOf(u);this._urlChangeListeners.splice(g,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(u="",g){this._urlChangeListeners.forEach(r=>r(u,g))}subscribe(u,g,r){return this._subject.subscribe({next:u,error:g,complete:r})}};o.normalizeQueryParams=ll,o.joinWithSlash=J2,o.stripTrailingSlash=OF,o.\u0275fac=function(g){return new(g||o)(Rn(cl))},o.\u0275prov=un({token:o,factory:()=>u8(),providedIn:"root"});let s=o;return s})();function u8(){return new sf(Rn(cl))}function h8(s,o){if(!s||!o.startsWith(s))return o;let f=o.substring(s.length);return f===""||["/",";","?","#"].includes(f[0])?f:o}function RF(s){return s.replace(/\/index.html$/,"")}function d8(s){if(new RegExp("^(https?:)?//").test(s)){let[,f]=s.split(/\/\/[^\/]+/);return f}return s}function VF(s,o){o=encodeURIComponent(o);for(let f of s.split(";")){let u=f.indexOf("="),[g,r]=u==-1?[f,""]:[f.slice(0,u),f.slice(u+1)];if(g.trim()===o)return decodeURIComponent(r)}return null}var jF=(()=>{let o=class o{constructor(u,g){this._viewContainer=u,this._context=new Z2,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=g}set ngIf(u){this._context.$implicit=this._context.ngIf=u,this._updateView()}set ngIfThen(u){kF("ngIfThen",u),this._thenTemplateRef=u,this._thenViewRef=null,this._updateView()}set ngIfElse(u){kF("ngIfElse",u),this._elseTemplateRef=u,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(u,g){return!0}};o.\u0275fac=function(g){return new(g||o)(Xn(fc),Xn(lc))},o.\u0275dir=io({type:o,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let s=o;return s})(),Z2=class{constructor(){this.$implicit=null,this.ngIf=null}};function kF(s,o){if(!!!(!o||o.createEmbeddedView))throw new Error(`${s} must be a TemplateRef, but received '${So(o)}'.`)}var GF=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})(),tD="browser",f8="server";function HF(s){return s===tD}function nD(s){return s===f8}var $F=(()=>{let o=class o{};o.\u0275prov=un({token:o,providedIn:"root",factory:()=>HF(Ot(al))?new Q2(Ot(Hr),window):new Y2});let s=o;return s})(),Q2=class{constructor(o,f){this.document=o,this.window=f,this.offset=()=>[0,0]}setOffset(o){Array.isArray(o)?this.offset=()=>o:this.offset=o}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(o){this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){let f=p8(this.document,o);f&&(this.scrollToElement(f),f.focus())}setHistoryScrollRestoration(o){this.window.history.scrollRestoration=o}scrollToElement(o){let f=o.getBoundingClientRect(),u=f.left+this.window.pageXOffset,g=f.top+this.window.pageYOffset,r=this.offset();this.window.scrollTo(u-r[0],g-r[1])}};function p8(s,o){let f=s.getElementById(o)||s.getElementsByName(o)[0];if(f)return f;if(typeof s.createTreeWalker=="function"&&s.body&&typeof s.body.attachShadow=="function"){let u=s.createTreeWalker(s.body,NodeFilter.SHOW_ELEMENT),g=u.currentNode;for(;g;){let r=g.shadowRoot;if(r){let E=r.getElementById(o)||r.querySelector(`[name="${o}"]`);if(E)return E}g=u.nextNode()}}return null}var Y2=class{setOffset(o){}getScrollPosition(){return[0,0]}scrollToPosition(o){}scrollToAnchor(o){}setHistoryScrollRestoration(o){}},Wy=class{};var oD=class extends qy{constructor(){super(...arguments),this.supportsDOMEvents=!0}},sD=class s extends oD{static makeCurrent(){NF(new s)}onAndCancel(o,f,u){return o.addEventListener(f,u),()=>{o.removeEventListener(f,u)}}dispatchEvent(o,f){o.dispatchEvent(f)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,f){return f=f||this.getDefaultDocument(),f.createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,f){return f==="window"?window:f==="document"?o:f==="body"?o.body:null}getBaseHref(o){let f=g8();return f==null?null:_8(f)}resetBaseElement(){Cm=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return VF(document.cookie,o)}},Cm=null;function g8(){return Cm=Cm||document.querySelector("base"),Cm?Cm.getAttribute("href"):null}function _8(s){return new URL(s,document.baseURI).pathname}var aD=class{addToWindow(o){To.getAngularTestability=(u,g=!0)=>{let r=o.findTestabilityInTree(u,g);if(r==null)throw new mn(5103,!1);return r},To.getAllAngularTestabilities=()=>o.getAllTestabilities(),To.getAllAngularRootElements=()=>o.getAllRootElements();let f=u=>{let g=To.getAllAngularTestabilities(),r=g.length,E=function(){r--,r==0&&u()};g.forEach(I=>{I.whenStable(E)})};To.frameworkStabilizers||(To.frameworkStabilizers=[]),To.frameworkStabilizers.push(f)}findTestabilityInTree(o,f,u){if(f==null)return null;let g=o.getTestability(f);return g??(u?xa().isShadowRoot(f)?this.findTestabilityInTree(o,f.host,!0):this.findTestabilityInTree(o,f.parentElement,!0):null)}},y8=(()=>{let o=class o{build(){return new XMLHttpRequest}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),lD=new wn(""),YF=(()=>{let o=class o{constructor(u,g){this._zone=g,this._eventNameToPlugin=new Map,u.forEach(r=>{r.manager=this}),this._plugins=u.slice().reverse()}addEventListener(u,g,r){return this._findPluginFor(g).addEventListener(u,g,r)}getZone(){return this._zone}_findPluginFor(u){let g=this._eventNameToPlugin.get(u);if(g)return g;if(g=this._plugins.find(E=>E.supports(u)),!g)throw new mn(5101,!1);return this._eventNameToPlugin.set(u,g),g}};o.\u0275fac=function(g){return new(g||o)(Rn(lD),Rn(Ui))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),Zy=class{constructor(o){this._doc=o}},iD="ng-app-id",XF=(()=>{let o=class o{constructor(u,g,r,E={}){this.doc=u,this.appId=g,this.nonce=r,this.platformId=E,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=nD(E),this.resetHostNodes()}addStyles(u){for(let g of u)this.changeUsageCount(g,1)===1&&this.onStyleAdded(g)}removeStyles(u){for(let g of u)this.changeUsageCount(g,-1)<=0&&this.onStyleRemoved(g)}ngOnDestroy(){let u=this.styleNodesInDOM;u&&(u.forEach(g=>g.remove()),u.clear());for(let g of this.getAllStyles())this.onStyleRemoved(g);this.resetHostNodes()}addHost(u){this.hostNodes.add(u);for(let g of this.getAllStyles())this.addStyleToHost(u,g)}removeHost(u){this.hostNodes.delete(u)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(u){for(let g of this.hostNodes)this.addStyleToHost(g,u)}onStyleRemoved(u){let g=this.styleRef;g.get(u)?.elements?.forEach(r=>r.remove()),g.delete(u)}collectServerRenderedStyles(){let u=this.doc.head?.querySelectorAll(`style[${iD}="${this.appId}"]`);if(u?.length){let g=new Map;return u.forEach(r=>{r.textContent!=null&&g.set(r.textContent,r)}),g}return null}changeUsageCount(u,g){let r=this.styleRef;if(r.has(u)){let E=r.get(u);return E.usage+=g,E.usage}return r.set(u,{usage:g,elements:[]}),g}getStyleElement(u,g){let r=this.styleNodesInDOM,E=r?.get(g);if(E?.parentNode===u)return r.delete(g),E.removeAttribute(iD),E;{let I=this.doc.createElement("style");return this.nonce&&I.setAttribute("nonce",this.nonce),I.textContent=g,this.platformIsServer&&I.setAttribute(iD,this.appId),u.appendChild(I),I}}addStyleToHost(u,g){let r=this.getStyleElement(u,g),E=this.styleRef,I=E.get(g)?.elements;I?I.push(r):E.set(g,{elements:[r],usage:1})}resetHostNodes(){let u=this.hostNodes;u.clear(),u.add(this.doc.head)}};o.\u0275fac=function(g){return new(g||o)(Rn(Hr),Rn(Ty),Rn(y2,8),Rn(al))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),rD={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},uD=/%COMP%/g,KF="%COMP%",v8=`_nghost-${KF}`,x8=`_ngcontent-${KF}`,b8=!0,w8=new wn("",{providedIn:"root",factory:()=>b8});function D8(s){return x8.replace(uD,s)}function C8(s){return v8.replace(uD,s)}function JF(s,o){return o.map(f=>f.replace(uD,s))}var WF=(()=>{let o=class o{constructor(u,g,r,E,I,O,U,V=null){this.eventManager=u,this.sharedStylesHost=g,this.appId=r,this.removeStylesOnCompDestroy=E,this.doc=I,this.platformId=O,this.ngZone=U,this.nonce=V,this.rendererByCompId=new Map,this.platformIsServer=nD(O),this.defaultRenderer=new Em(u,I,U,this.platformIsServer)}createRenderer(u,g){if(!u||!g)return this.defaultRenderer;this.platformIsServer&&g.encapsulation===ga.ShadowDom&&(g=Li($t({},g),{encapsulation:ga.Emulated}));let r=this.getOrCreateRenderer(u,g);return r instanceof Qy?r.applyToHost(u):r instanceof Am&&r.applyStyles(),r}getOrCreateRenderer(u,g){let r=this.rendererByCompId,E=r.get(g.id);if(!E){let I=this.doc,O=this.ngZone,U=this.eventManager,V=this.sharedStylesHost,Z=this.removeStylesOnCompDestroy,te=this.platformIsServer;switch(g.encapsulation){case ga.Emulated:E=new Qy(U,V,g,this.appId,Z,I,O,te);break;case ga.ShadowDom:return new cD(U,V,u,g,I,O,this.nonce,te);default:E=new Am(U,V,g,Z,I,O,te);break}r.set(g.id,E)}return E}ngOnDestroy(){this.rendererByCompId.clear()}};o.\u0275fac=function(g){return new(g||o)(Rn(YF),Rn(XF),Rn(Ty),Rn(w8),Rn(Hr),Rn(al),Rn(Ui),Rn(y2))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),Em=class{constructor(o,f,u,g){this.eventManager=o,this.doc=f,this.ngZone=u,this.platformIsServer=g,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(o,f){return f?this.doc.createElementNS(rD[f]||f,o):this.doc.createElement(o)}createComment(o){return this.doc.createComment(o)}createText(o){return this.doc.createTextNode(o)}appendChild(o,f){(ZF(o)?o.content:o).appendChild(f)}insertBefore(o,f,u){o&&(ZF(o)?o.content:o).insertBefore(f,u)}removeChild(o,f){o&&o.removeChild(f)}selectRootElement(o,f){let u=typeof o=="string"?this.doc.querySelector(o):o;if(!u)throw new mn(-5104,!1);return f||(u.textContent=""),u}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,f,u,g){if(g){f=g+":"+f;let r=rD[g];r?o.setAttributeNS(r,f,u):o.setAttribute(f,u)}else o.setAttribute(f,u)}removeAttribute(o,f,u){if(u){let g=rD[u];g?o.removeAttributeNS(g,f):o.removeAttribute(`${u}:${f}`)}else o.removeAttribute(f)}addClass(o,f){o.classList.add(f)}removeClass(o,f){o.classList.remove(f)}setStyle(o,f,u,g){g&(tl.DashCase|tl.Important)?o.style.setProperty(f,u,g&tl.Important?"important":""):o.style[f]=u}removeStyle(o,f,u){u&tl.DashCase?o.style.removeProperty(f):o.style[f]=""}setProperty(o,f,u){o!=null&&(o[f]=u)}setValue(o,f){o.nodeValue=f}listen(o,f,u){if(typeof o=="string"&&(o=xa().getGlobalEventTarget(this.doc,o),!o))throw new Error(`Unsupported event target ${o} for event ${f}`);return this.eventManager.addEventListener(o,f,this.decoratePreventDefault(u))}decoratePreventDefault(o){return f=>{if(f==="__ngUnwrap__")return o;(this.platformIsServer?this.ngZone.runGuarded(()=>o(f)):o(f))===!1&&f.preventDefault()}}};function ZF(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var cD=class extends Em{constructor(o,f,u,g,r,E,I,O){super(o,r,E,O),this.sharedStylesHost=f,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let U=JF(g.id,g.styles);for(let V of U){let Z=document.createElement("style");I&&Z.setAttribute("nonce",I),Z.textContent=V,this.shadowRoot.appendChild(Z)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}appendChild(o,f){return super.appendChild(this.nodeOrShadowRoot(o),f)}insertBefore(o,f,u){return super.insertBefore(this.nodeOrShadowRoot(o),f,u)}removeChild(o,f){return super.removeChild(this.nodeOrShadowRoot(o),f)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Am=class extends Em{constructor(o,f,u,g,r,E,I,O){super(o,r,E,I),this.sharedStylesHost=f,this.removeStylesOnCompDestroy=g,this.styles=O?JF(O,u.styles):u.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Qy=class extends Am{constructor(o,f,u,g,r,E,I,O){let U=g+"-"+u.id;super(o,f,u,r,E,I,O,U),this.contentAttr=D8(U),this.hostAttr=C8(U)}applyToHost(o){this.applyStyles(),this.setAttribute(o,this.hostAttr,"")}createElement(o,f){let u=super.createElement(o,f);return super.setAttribute(u,this.contentAttr,""),u}},E8=(()=>{let o=class o extends Zy{constructor(u){super(u)}supports(u){return!0}addEventListener(u,g,r){return u.addEventListener(g,r,!1),()=>this.removeEventListener(u,g,r)}removeEventListener(u,g,r){return u.removeEventListener(g,r)}};o.\u0275fac=function(g){return new(g||o)(Rn(Hr))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})(),QF=["alt","control","meta","shift"],A8={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},T8={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},S8=(()=>{let o=class o extends Zy{constructor(u){super(u)}supports(u){return o.parseEventName(u)!=null}addEventListener(u,g,r){let E=o.parseEventName(g),I=o.eventCallback(E.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>xa().onAndCancel(u,E.domEventName,I))}static parseEventName(u){let g=u.toLowerCase().split("."),r=g.shift();if(g.length===0||!(r==="keydown"||r==="keyup"))return null;let E=o._normalizeKey(g.pop()),I="",O=g.indexOf("code");if(O>-1&&(g.splice(O,1),I="code."),QF.forEach(V=>{let Z=g.indexOf(V);Z>-1&&(g.splice(Z,1),I+=V+".")}),I+=E,g.length!=0||E.length===0)return null;let U={};return U.domEventName=r,U.fullKey=I,U}static matchEventFullKeyCode(u,g){let r=A8[u.key]||u.key,E="";return g.indexOf("code.")>-1&&(r=u.code,E="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),QF.forEach(I=>{if(I!==r){let O=T8[I];O(u)&&(E+=I+".")}}),E+=r,E===g)}static eventCallback(u,g,r){return E=>{o.matchEventFullKeyCode(E,u)&&r.runGuarded(()=>g(E))}}static _normalizeKey(u){return u==="esc"?"escape":u}};o.\u0275fac=function(g){return new(g||o)(Rn(Hr))},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})();function I8(){sD.makeCurrent()}function M8(){return new ya}function F8(){return DM(document),document}var P8=[{provide:al,useValue:tD},{provide:_2,useValue:I8,multi:!0},{provide:Hr,useFactory:F8,deps:[]}],eP=W2(MF,"browser",P8),O8=new wn(""),R8=[{provide:Dm,useClass:aD,deps:[]},{provide:H2,useClass:zy,deps:[Ui,Vy,Dm]},{provide:zy,useClass:zy,deps:[Ui,Vy,Dm]}],k8=[{provide:xy,useValue:"root"},{provide:ya,useFactory:M8,deps:[]},{provide:lD,useClass:E8,multi:!0,deps:[Hr,Ui,al]},{provide:lD,useClass:S8,multi:!0,deps:[Hr]},WF,XF,YF,{provide:pm,useExisting:WF},{provide:Wy,useClass:y8,deps:[]},[]],tP=(()=>{let o=class o{constructor(u){}static withServerTransition(u){return{ngModule:o,providers:[{provide:Ty,useValue:u.appId}]}}};o.\u0275fac=function(g){return new(g||o)(Rn(O8,12))},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({providers:[...k8,...R8],imports:[GF,FF]});let s=o;return s})();var nP=(()=>{let o=class o{constructor(u){this._doc=u}getTitle(){return this._doc.title}setTitle(u){this._doc.title=u||""}};o.\u0275fac=function(g){return new(g||o)(Rn(Hr))},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();var ii="primary",Vm=Symbol("RouteTitle"),mD=class{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){let f=this.params[o];return Array.isArray(f)?f[0]:f}return null}getAll(o){if(this.has(o)){let f=this.params[o];return Array.isArray(f)?f:[f]}return[]}get keys(){return Object.keys(this.params)}};function hf(s){return new mD(s)}function N8(s,o,f){let u=f.path.split("/");if(u.length>s.length||f.pathMatch==="full"&&(o.hasChildren()||u.length<s.length))return null;let g={};for(let r=0;r<u.length;r++){let E=u[r],I=s[r];if(E.startsWith(":"))g[E.substring(1)]=I;else if(E!==I.path)return null}return{consumed:s.slice(0,u.length),posParams:g}}function L8(s,o){if(s.length!==o.length)return!1;for(let f=0;f<s.length;++f)if(!ba(s[f],o[f]))return!1;return!0}function ba(s,o){let f=s?gD(s):void 0,u=o?gD(o):void 0;if(!f||!u||f.length!=u.length)return!1;let g;for(let r=0;r<f.length;r++)if(g=f[r],!dP(s[g],o[g]))return!1;return!0}function gD(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function dP(s,o){if(Array.isArray(s)&&Array.isArray(o)){if(s.length!==o.length)return!1;let f=[...s].sort(),u=[...o].sort();return f.every((g,r)=>u[r]===g)}else return s===o}function fP(s){return s.length>0?s[s.length-1]:null}function xc(s){return Pb(s)?s:Zu(s)?dr(Promise.resolve(s)):Sn(s)}var U8={exact:mP,subset:gP},pP={exact:z8,subset:V8,ignored:()=>!0};function rP(s,o,f){return U8[f.paths](s.root,o.root,f.matrixParams)&&pP[f.queryParams](s.queryParams,o.queryParams)&&!(f.fragment==="exact"&&s.fragment!==o.fragment)}function z8(s,o){return ba(s,o)}function mP(s,o,f){if(!Yu(s.segments,o.segments)||!Ky(s.segments,o.segments,f)||s.numberOfChildren!==o.numberOfChildren)return!1;for(let u in o.children)if(!s.children[u]||!mP(s.children[u],o.children[u],f))return!1;return!0}function V8(s,o){return Object.keys(o).length<=Object.keys(s).length&&Object.keys(o).every(f=>dP(s[f],o[f]))}function gP(s,o,f){return _P(s,o,o.segments,f)}function _P(s,o,f,u){if(s.segments.length>f.length){let g=s.segments.slice(0,f.length);return!(!Yu(g,f)||o.hasChildren()||!Ky(g,f,u))}else if(s.segments.length===f.length){if(!Yu(s.segments,f)||!Ky(s.segments,f,u))return!1;for(let g in o.children)if(!s.children[g]||!gP(s.children[g],o.children[g],u))return!1;return!0}else{let g=f.slice(0,s.segments.length),r=f.slice(s.segments.length);return!Yu(s.segments,g)||!Ky(s.segments,g,u)||!s.children[ii]?!1:_P(s.children[ii],o,r,u)}}function Ky(s,o,f){return o.every((u,g)=>pP[f](s[g].parameters,u.parameters))}var _c=class{constructor(o=new zi([],{}),f={},u=null){this.root=o,this.queryParams=f,this.fragment=u}get queryParamMap(){return this._queryParamMap??=hf(this.queryParams),this._queryParamMap}toString(){return H8.serialize(this)}},zi=class{constructor(o,f){this.segments=o,this.children=f,this.parent=null,Object.values(f).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Jy(this)}},Qu=class{constructor(o,f){this.path=o,this.parameters=f}get parameterMap(){return this._parameterMap??=hf(this.parameters),this._parameterMap}toString(){return vP(this)}};function j8(s,o){return Yu(s,o)&&s.every((f,u)=>ba(f.parameters,o[u].parameters))}function Yu(s,o){return s.length!==o.length?!1:s.every((f,u)=>f.path===o[u].path)}function G8(s,o){let f=[];return Object.entries(s.children).forEach(([u,g])=>{u===ii&&(f=f.concat(o(g,u)))}),Object.entries(s.children).forEach(([u,g])=>{u!==ii&&(f=f.concat(o(g,u)))}),f}var jm=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>new Om,providedIn:"root"});let s=o;return s})(),Om=class{parse(o){let f=new yD(o);return new _c(f.parseRootSegment(),f.parseQueryParams(),f.parseFragment())}serialize(o){let f=`/${Tm(o.root,!0)}`,u=W8(o.queryParams),g=typeof o.fragment=="string"?`#${$8(o.fragment)}`:"";return`${f}${u}${g}`}},H8=new Om;function Jy(s){return s.segments.map(o=>vP(o)).join("/")}function Tm(s,o){if(!s.hasChildren())return Jy(s);if(o){let f=s.children[ii]?Tm(s.children[ii],!1):"",u=[];return Object.entries(s.children).forEach(([g,r])=>{g!==ii&&u.push(`${g}:${Tm(r,!1)}`)}),u.length>0?`${f}(${u.join("//")})`:f}else{let f=G8(s,(u,g)=>g===ii?[Tm(s.children[ii],!1)]:[`${g}:${Tm(u,!1)}`]);return Object.keys(s.children).length===1&&s.children[ii]!=null?`${Jy(s)}/${f[0]}`:`${Jy(s)}/(${f.join("//")})`}}function yP(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Yy(s){return yP(s).replace(/%3B/gi,";")}function $8(s){return encodeURI(s)}function _D(s){return yP(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function e1(s){return decodeURIComponent(s)}function oP(s){return e1(s.replace(/\+/g,"%20"))}function vP(s){return`${_D(s.path)}${q8(s.parameters)}`}function q8(s){return Object.entries(s).map(([o,f])=>`;${_D(o)}=${_D(f)}`).join("")}function W8(s){let o=Object.entries(s).map(([f,u])=>Array.isArray(u)?u.map(g=>`${Yy(f)}=${Yy(g)}`).join("&"):`${Yy(f)}=${Yy(u)}`).filter(f=>f);return o.length?`?${o.join("&")}`:""}var Z8=/^[^\/()?;#]+/;function hD(s){let o=s.match(Z8);return o?o[0]:""}var Q8=/^[^\/()?;=#]+/;function Y8(s){let o=s.match(Q8);return o?o[0]:""}var X8=/^[^=?&#]+/;function K8(s){let o=s.match(X8);return o?o[0]:""}var J8=/^[^&#]+/;function eV(s){let o=s.match(J8);return o?o[0]:""}var yD=class{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new zi([],{}):new zi([],this.parseChildren())}parseQueryParams(){let o={};if(this.consumeOptional("?"))do this.parseQueryParam(o);while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let f={};this.peekStartsWith("/(")&&(this.capture("/"),f=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(o.length>0||Object.keys(f).length>0)&&(u[ii]=new zi(o,f)),u}parseSegment(){let o=hD(this.remaining);if(o===""&&this.peekStartsWith(";"))throw new mn(4009,!1);return this.capture(o),new Qu(e1(o),this.parseMatrixParams())}parseMatrixParams(){let o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){let f=Y8(this.remaining);if(!f)return;this.capture(f);let u="";if(this.consumeOptional("=")){let g=hD(this.remaining);g&&(u=g,this.capture(u))}o[e1(f)]=e1(u)}parseQueryParam(o){let f=K8(this.remaining);if(!f)return;this.capture(f);let u="";if(this.consumeOptional("=")){let E=eV(this.remaining);E&&(u=E,this.capture(u))}let g=oP(f),r=oP(u);if(o.hasOwnProperty(g)){let E=o[g];Array.isArray(E)||(E=[E],o[g]=E),E.push(r)}else o[g]=r}parseParens(o){let f={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=hD(this.remaining),g=this.remaining[u.length];if(g!=="/"&&g!==")"&&g!==";")throw new mn(4010,!1);let r;u.indexOf(":")>-1?(r=u.slice(0,u.indexOf(":")),this.capture(r),this.capture(":")):o&&(r=ii);let E=this.parseChildren();f[r]=Object.keys(E).length===1?E[ii]:new zi([],E),this.consumeOptional("//")}return f}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return this.peekStartsWith(o)?(this.remaining=this.remaining.substring(o.length),!0):!1}capture(o){if(!this.consumeOptional(o))throw new mn(4011,!1)}};function xP(s){return s.segments.length>0?new zi([],{[ii]:s}):s}function bP(s){let o={};for(let[u,g]of Object.entries(s.children)){let r=bP(g);if(u===ii&&r.segments.length===0&&r.hasChildren())for(let[E,I]of Object.entries(r.children))o[E]=I;else(r.segments.length>0||r.hasChildren())&&(o[u]=r)}let f=new zi(s.segments,o);return tV(f)}function tV(s){if(s.numberOfChildren===1&&s.children[ii]){let o=s.children[ii];return new zi(s.segments.concat(o.segments),o.children)}return s}function df(s){return s instanceof _c}function nV(s,o,f=null,u=null){let g=wP(s);return DP(g,o,f,u)}function wP(s){let o;function f(r){let E={};for(let O of r.children){let U=f(O);E[O.outlet]=U}let I=new zi(r.url,E);return r===s&&(o=I),I}let u=f(s.root),g=xP(u);return o??g}function DP(s,o,f,u){let g=s;for(;g.parent;)g=g.parent;if(o.length===0)return dD(g,g,g,f,u);let r=iV(o);if(r.toRoot())return dD(g,g,new zi([],{}),f,u);let E=rV(r,g,s),I=E.processChildren?Mm(E.segmentGroup,E.index,r.commands):EP(E.segmentGroup,E.index,r.commands);return dD(g,E.segmentGroup,I,f,u)}function t1(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function Rm(s){return typeof s=="object"&&s!=null&&s.outlets}function dD(s,o,f,u,g){let r={};u&&Object.entries(u).forEach(([O,U])=>{r[O]=Array.isArray(U)?U.map(V=>`${V}`):`${U}`});let E;s===o?E=f:E=CP(s,o,f);let I=xP(bP(E));return new _c(I,r,g)}function CP(s,o,f){let u={};return Object.entries(s.children).forEach(([g,r])=>{r===o?u[g]=f:u[g]=CP(r,o,f)}),new zi(s.segments,u)}var n1=class{constructor(o,f,u){if(this.isAbsolute=o,this.numberOfDoubleDots=f,this.commands=u,o&&u.length>0&&t1(u[0]))throw new mn(4003,!1);let g=u.find(Rm);if(g&&g!==fP(u))throw new mn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function iV(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new n1(!0,0,s);let o=0,f=!1,u=s.reduce((g,r,E)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let I={};return Object.entries(r.outlets).forEach(([O,U])=>{I[O]=typeof U=="string"?U.split("/"):U}),[...g,{outlets:I}]}if(r.segmentPath)return[...g,r.segmentPath]}return typeof r!="string"?[...g,r]:E===0?(r.split("/").forEach((I,O)=>{O==0&&I==="."||(O==0&&I===""?f=!0:I===".."?o++:I!=""&&g.push(I))}),g):[...g,r]},[]);return new n1(f,o,u)}var cf=class{constructor(o,f,u){this.segmentGroup=o,this.processChildren=f,this.index=u}};function rV(s,o,f){if(s.isAbsolute)return new cf(o,!0,0);if(!f)return new cf(o,!1,NaN);if(f.parent===null)return new cf(f,!0,0);let u=t1(s.commands[0])?0:1,g=f.segments.length-1+u;return oV(f,g,s.numberOfDoubleDots)}function oV(s,o,f){let u=s,g=o,r=f;for(;r>g;){if(r-=g,u=u.parent,!u)throw new mn(4005,!1);g=u.segments.length}return new cf(u,!1,g-r)}function sV(s){return Rm(s[0])?s[0].outlets:{[ii]:s}}function EP(s,o,f){if(s??=new zi([],{}),s.segments.length===0&&s.hasChildren())return Mm(s,o,f);let u=aV(s,o,f),g=f.slice(u.commandIndex);if(u.match&&u.pathIndex<s.segments.length){let r=new zi(s.segments.slice(0,u.pathIndex),{});return r.children[ii]=new zi(s.segments.slice(u.pathIndex),s.children),Mm(r,0,g)}else return u.match&&g.length===0?new zi(s.segments,{}):u.match&&!s.hasChildren()?vD(s,o,f):u.match?Mm(s,0,g):vD(s,o,f)}function Mm(s,o,f){if(f.length===0)return new zi(s.segments,{});{let u=sV(f),g={};if(Object.keys(u).some(r=>r!==ii)&&s.children[ii]&&s.numberOfChildren===1&&s.children[ii].segments.length===0){let r=Mm(s.children[ii],o,f);return new zi(s.segments,r.children)}return Object.entries(u).forEach(([r,E])=>{typeof E=="string"&&(E=[E]),E!==null&&(g[r]=EP(s.children[r],o,E))}),Object.entries(s.children).forEach(([r,E])=>{u[r]===void 0&&(g[r]=E)}),new zi(s.segments,g)}}function aV(s,o,f){let u=0,g=o,r={match:!1,pathIndex:0,commandIndex:0};for(;g<s.segments.length;){if(u>=f.length)return r;let E=s.segments[g],I=f[u];if(Rm(I))break;let O=`${I}`,U=u<f.length-1?f[u+1]:null;if(g>0&&O===void 0)break;if(O&&U&&typeof U=="object"&&U.outlets===void 0){if(!aP(O,U,E))return r;u+=2}else{if(!aP(O,{},E))return r;u++}g++}return{match:!0,pathIndex:g,commandIndex:u}}function vD(s,o,f){let u=s.segments.slice(0,o),g=0;for(;g<f.length;){let r=f[g];if(Rm(r)){let O=lV(r.outlets);return new zi(u,O)}if(g===0&&t1(f[0])){let O=s.segments[o];u.push(new Qu(O.path,sP(f[0]))),g++;continue}let E=Rm(r)?r.outlets[ii]:`${r}`,I=g<f.length-1?f[g+1]:null;E&&I&&t1(I)?(u.push(new Qu(E,sP(I))),g+=2):(u.push(new Qu(E,{})),g++)}return new zi(u,{})}function lV(s){let o={};return Object.entries(s).forEach(([f,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(o[f]=vD(new zi([],{}),0,u))}),o}function sP(s){let o={};return Object.entries(s).forEach(([f,u])=>o[f]=`${u}`),o}function aP(s,o,f){return s==f.path&&ba(o,f.parameters)}var Fm="imperative",$r=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}($r||{}),Ts=class{constructor(o,f){this.id=o,this.url=f}},ff=class extends Ts{constructor(o,f,u="imperative",g=null){super(o,f),this.type=$r.NavigationStart,this.navigationTrigger=u,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},wa=class extends Ts{constructor(o,f,u){super(o,f),this.urlAfterRedirects=u,this.type=$r.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},us=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(us||{}),i1=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(i1||{}),yc=class extends Ts{constructor(o,f,u,g){super(o,f),this.reason=u,this.code=g,this.type=$r.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},vc=class extends Ts{constructor(o,f,u,g){super(o,f),this.reason=u,this.code=g,this.type=$r.NavigationSkipped}},km=class extends Ts{constructor(o,f,u,g){super(o,f),this.error=u,this.target=g,this.type=$r.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},r1=class extends Ts{constructor(o,f,u,g){super(o,f),this.urlAfterRedirects=u,this.state=g,this.type=$r.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xD=class extends Ts{constructor(o,f,u,g){super(o,f),this.urlAfterRedirects=u,this.state=g,this.type=$r.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bD=class extends Ts{constructor(o,f,u,g,r){super(o,f),this.urlAfterRedirects=u,this.state=g,this.shouldActivate=r,this.type=$r.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},wD=class extends Ts{constructor(o,f,u,g){super(o,f),this.urlAfterRedirects=u,this.state=g,this.type=$r.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},DD=class extends Ts{constructor(o,f,u,g){super(o,f),this.urlAfterRedirects=u,this.state=g,this.type=$r.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},CD=class{constructor(o){this.route=o,this.type=$r.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ED=class{constructor(o){this.route=o,this.type=$r.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},AD=class{constructor(o){this.snapshot=o,this.type=$r.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},TD=class{constructor(o){this.snapshot=o,this.type=$r.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},SD=class{constructor(o){this.snapshot=o,this.type=$r.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ID=class{constructor(o){this.snapshot=o,this.type=$r.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},o1=class{constructor(o,f,u){this.routerEvent=o,this.position=f,this.anchor=u,this.type=$r.Scroll}toString(){let o=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${o}')`}},Bm=class{},Nm=class{constructor(o){this.url=o}};var MD=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Gm,this.attachRef=null}},Gm=(()=>{let o=class o{constructor(){this.contexts=new Map}onChildOutletCreated(u,g){let r=this.getOrCreateContext(u);r.outlet=g,this.contexts.set(u,r)}onChildOutletDestroyed(u){let g=this.getContext(u);g&&(g.outlet=null,g.attachRef=null)}onOutletDeactivated(){let u=this.contexts;return this.contexts=new Map,u}onOutletReAttached(u){this.contexts=u}getOrCreateContext(u){let g=this.getContext(u);return g||(g=new MD,this.contexts.set(u,g)),g}getContext(u){return this.contexts.get(u)||null}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),s1=class{constructor(o){this._root=o}get root(){return this._root.value}parent(o){let f=this.pathFromRoot(o);return f.length>1?f[f.length-2]:null}children(o){let f=FD(o,this._root);return f?f.children.map(u=>u.value):[]}firstChild(o){let f=FD(o,this._root);return f&&f.children.length>0?f.children[0].value:null}siblings(o){let f=PD(o,this._root);return f.length<2?[]:f[f.length-2].children.map(g=>g.value).filter(g=>g!==o)}pathFromRoot(o){return PD(o,this._root).map(f=>f.value)}};function FD(s,o){if(s===o.value)return o;for(let f of o.children){let u=FD(s,f);if(u)return u}return null}function PD(s,o){if(s===o.value)return[o];for(let f of o.children){let u=PD(s,f);if(u.length)return u.unshift(o),u}return[]}var cs=class{constructor(o,f){this.value=o,this.children=f}toString(){return`TreeNode(${this.value})`}};function lf(s){let o={};return s&&s.children.forEach(f=>o[f.value.outlet]=f),o}var a1=class extends s1{constructor(o,f){super(o),this.snapshot=f,jD(this,o)}toString(){return this.snapshot.toString()}};function AP(s){let o=cV(s),f=new Sr([new Qu("",{})]),u=new Sr({}),g=new Sr({}),r=new Sr({}),E=new Sr(""),I=new Xu(f,u,r,E,g,ii,s,o.root);return I.snapshot=o.root,new a1(new cs(I,[]),o)}function cV(s){let o={},f={},u={},g="",r=new Lm([],o,u,g,f,ii,s,null,{});return new l1("",new cs(r,[]))}var Xu=class{constructor(o,f,u,g,r,E,I,O){this.urlSubject=o,this.paramsSubject=f,this.queryParamsSubject=u,this.fragmentSubject=g,this.dataSubject=r,this.outlet=E,this.component=I,this._futureSnapshot=O,this.title=this.dataSubject?.pipe(ci(U=>U[Vm]))??Sn(void 0),this.url=o,this.params=f,this.queryParams=u,this.fragment=g,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ci(o=>hf(o))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ci(o=>hf(o))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function VD(s,o,f="emptyOnly"){let u,{routeConfig:g}=s;return o!==null&&(f==="always"||g?.path===""||!o.component&&!o.routeConfig?.loadComponent)?u={params:$t($t({},o.params),s.params),data:$t($t({},o.data),s.data),resolve:$t($t($t($t({},s.data),o.data),g?.data),s._resolvedData)}:u={params:$t({},s.params),data:$t({},s.data),resolve:$t($t({},s.data),s._resolvedData??{})},g&&SP(g)&&(u.resolve[Vm]=g.title),u}var Lm=class{get title(){return this.data?.[Vm]}constructor(o,f,u,g,r,E,I,O,U){this.url=o,this.params=f,this.queryParams=u,this.fragment=g,this.data=r,this.outlet=E,this.component=I,this.routeConfig=O,this._resolve=U}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=hf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=hf(this.queryParams),this._queryParamMap}toString(){let o=this.url.map(u=>u.toString()).join("/"),f=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${o}', path:'${f}')`}},l1=class extends s1{constructor(o,f){super(f),this.url=o,jD(this,f)}toString(){return TP(this._root)}};function jD(s,o){o.value._routerState=s,o.children.forEach(f=>jD(s,f))}function TP(s){let o=s.children.length>0?` { ${s.children.map(TP).join(", ")} } `:"";return`${s.value}${o}`}function fD(s){if(s.snapshot){let o=s.snapshot,f=s._futureSnapshot;s.snapshot=f,ba(o.queryParams,f.queryParams)||s.queryParamsSubject.next(f.queryParams),o.fragment!==f.fragment&&s.fragmentSubject.next(f.fragment),ba(o.params,f.params)||s.paramsSubject.next(f.params),L8(o.url,f.url)||s.urlSubject.next(f.url),ba(o.data,f.data)||s.dataSubject.next(f.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function OD(s,o){let f=ba(s.params,o.params)&&j8(s.url,o.url),u=!s.parent!=!o.parent;return f&&!u&&(!s.parent||OD(s.parent,o.parent))}function SP(s){return typeof s.title=="string"||s.title===null}var GD=(()=>{let o=class o{constructor(){this.activated=null,this._activatedRoute=null,this.name=ii,this.activateEvents=new lr,this.deactivateEvents=new lr,this.attachEvents=new lr,this.detachEvents=new lr,this.parentContexts=Ot(Gm),this.location=Ot(fc),this.changeDetector=Ot(gc),this.environmentInjector=Ot(eo),this.inputBinder=Ot(f1,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(u){if(u.name){let{firstChange:g,previousValue:r}=u.name;if(g)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(u){return this.parentContexts.getContext(u)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let u=this.parentContexts.getContext(this.name);u?.route&&(u.attachRef?this.attach(u.attachRef,u.route):this.activateWith(u.route,u.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new mn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new mn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new mn(4012,!1);this.location.detach();let u=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(u.instance),u}attach(u,g){this.activated=u,this._activatedRoute=g,this.location.insert(u.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(u.instance)}deactivate(){if(this.activated){let u=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(u)}}activateWith(u,g){if(this.isActivated)throw new mn(4013,!1);this._activatedRoute=u;let r=this.location,I=u.snapshot.component,O=this.parentContexts.getOrCreateContext(this.name).children,U=new RD(u,O,r.injector);this.activated=r.createComponent(I,{index:r.length,injector:U,environmentInjector:g??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};o.\u0275fac=function(g){return new(g||o)},o.\u0275dir=io({type:o,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[sl]});let s=o;return s})(),RD=class s{__ngOutletInjector(o){return new s(this.route,this.childContexts,o)}constructor(o,f,u){this.route=o,this.childContexts=f,this.parent=u}get(o,f){return o===Xu?this.route:o===Gm?this.childContexts:this.parent.get(o,f)}},f1=new wn(""),lP=(()=>{let o=class o{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(u){this.unsubscribeFromRouteData(u),this.subscribeToRouteData(u)}unsubscribeFromRouteData(u){this.outletDataSubscriptions.get(u)?.unsubscribe(),this.outletDataSubscriptions.delete(u)}subscribeToRouteData(u){let{activatedRoute:g}=u,r=Pd([g.queryParams,g.params,g.data]).pipe(jo(([E,I,O],U)=>(O=$t($t($t({},E),I),O),U===0?Sn(O):Promise.resolve(O)))).subscribe(E=>{if(!u.isActivated||!u.activatedComponentRef||u.activatedRoute!==g||g.component===null){this.unsubscribeFromRouteData(u);return}let I=PF(g.component);if(!I){this.unsubscribeFromRouteData(u);return}for(let{templateName:O}of I.inputs)u.activatedComponentRef.setInput(O,E[O])});this.outletDataSubscriptions.set(u,r)}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})();function uV(s,o,f){let u=Um(s,o._root,f?f._root:void 0);return new a1(u,o)}function Um(s,o,f){if(f&&s.shouldReuseRoute(o.value,f.value.snapshot)){let u=f.value;u._futureSnapshot=o.value;let g=hV(s,o,f);return new cs(u,g)}else{if(s.shouldAttach(o.value)){let r=s.retrieve(o.value);if(r!==null){let E=r.route;return E.value._futureSnapshot=o.value,E.children=o.children.map(I=>Um(s,I)),E}}let u=dV(o.value),g=o.children.map(r=>Um(s,r));return new cs(u,g)}}function hV(s,o,f){return o.children.map(u=>{for(let g of f.children)if(s.shouldReuseRoute(u.value,g.value.snapshot))return Um(s,u,g);return Um(s,u)})}function dV(s){return new Xu(new Sr(s.url),new Sr(s.params),new Sr(s.queryParams),new Sr(s.fragment),new Sr(s.data),s.outlet,s.component,s)}var IP="ngNavigationCancelingError";function MP(s,o){let{redirectTo:f,navigationBehaviorOptions:u}=df(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,g=FP(!1,us.Redirect);return g.url=f,g.navigationBehaviorOptions=u,g}function FP(s,o){let f=new Error(`NavigationCancelingError: ${s||""}`);return f[IP]=!0,f.cancellationCode=o,f}function fV(s){return PP(s)&&df(s.url)}function PP(s){return!!s&&s[IP]}var pV=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["ng-component"]],standalone:!0,features:[wm],decls:1,vars:0,template:function(g,r){g&1&&ur(0,"router-outlet")},dependencies:[GD],encapsulation:2});let s=o;return s})();function mV(s,o){return s.providers&&!s._injector&&(s._injector=By(s.providers,o,`Route: ${s.path}`)),s._injector??o}function HD(s){let o=s.children&&s.children.map(HD),f=o?Li($t({},s),{children:o}):$t({},s);return!f.component&&!f.loadComponent&&(o||f.loadChildren)&&f.outlet&&f.outlet!==ii&&(f.component=pV),f}function Da(s){return s.outlet||ii}function gV(s,o){let f=s.filter(u=>Da(u)===o);return f.push(...s.filter(u=>Da(u)!==o)),f}function Hm(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let o=s.parent;o;o=o.parent){let f=o.routeConfig;if(f?._loadedInjector)return f._loadedInjector;if(f?._injector)return f._injector}return null}var _V=(s,o,f,u)=>ci(g=>(new kD(o,g.targetRouterState,g.currentRouterState,f,u).activate(s),g)),kD=class{constructor(o,f,u,g,r){this.routeReuseStrategy=o,this.futureState=f,this.currState=u,this.forwardEvent=g,this.inputBindingEnabled=r}activate(o){let f=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(f,u,o),fD(this.futureState.root),this.activateChildRoutes(f,u,o)}deactivateChildRoutes(o,f,u){let g=lf(f);o.children.forEach(r=>{let E=r.value.outlet;this.deactivateRoutes(r,g[E],u),delete g[E]}),Object.values(g).forEach(r=>{this.deactivateRouteAndItsChildren(r,u)})}deactivateRoutes(o,f,u){let g=o.value,r=f?f.value:null;if(g===r)if(g.component){let E=u.getContext(g.outlet);E&&this.deactivateChildRoutes(o,f,E.children)}else this.deactivateChildRoutes(o,f,u);else r&&this.deactivateRouteAndItsChildren(f,u)}deactivateRouteAndItsChildren(o,f){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,f):this.deactivateRouteAndOutlet(o,f)}detachAndStoreRouteSubtree(o,f){let u=f.getContext(o.value.outlet),g=u&&o.value.component?u.children:f,r=lf(o);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,g);if(u&&u.outlet){let E=u.outlet.detach(),I=u.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:E,route:o,contexts:I})}}deactivateRouteAndOutlet(o,f){let u=f.getContext(o.value.outlet),g=u&&o.value.component?u.children:f,r=lf(o);for(let E of Object.values(r))this.deactivateRouteAndItsChildren(E,g);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(o,f,u){let g=lf(f);o.children.forEach(r=>{this.activateRoutes(r,g[r.value.outlet],u),this.forwardEvent(new ID(r.value.snapshot))}),o.children.length&&this.forwardEvent(new TD(o.value.snapshot))}activateRoutes(o,f,u){let g=o.value,r=f?f.value:null;if(fD(g),g===r)if(g.component){let E=u.getOrCreateContext(g.outlet);this.activateChildRoutes(o,f,E.children)}else this.activateChildRoutes(o,f,u);else if(g.component){let E=u.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){let I=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),E.children.onOutletReAttached(I.contexts),E.attachRef=I.componentRef,E.route=I.route.value,E.outlet&&E.outlet.attach(I.componentRef,I.route.value),fD(I.route.value),this.activateChildRoutes(o,null,E.children)}else{let I=Hm(g.snapshot);E.attachRef=null,E.route=g,E.injector=I,E.outlet&&E.outlet.activateWith(g,E.injector),this.activateChildRoutes(o,null,E.children)}}else this.activateChildRoutes(o,null,u)}},c1=class{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}},uf=class{constructor(o,f){this.component=o,this.route=f}};function yV(s,o,f){let u=s._root,g=o?o._root:null;return Sm(u,g,f,[u.value])}function vV(s){let o=s.routeConfig?s.routeConfig.canActivateChild:null;return!o||o.length===0?null:{node:s,guards:o}}function mf(s,o){let f=Symbol(),u=o.get(s,f);return u===f?typeof s=="function"&&!aI(s)?s:o.get(s):u}function Sm(s,o,f,u,g={canDeactivateChecks:[],canActivateChecks:[]}){let r=lf(o);return s.children.forEach(E=>{xV(E,r[E.value.outlet],f,u.concat([E.value]),g),delete r[E.value.outlet]}),Object.entries(r).forEach(([E,I])=>Pm(I,f.getContext(E),g)),g}function xV(s,o,f,u,g={canDeactivateChecks:[],canActivateChecks:[]}){let r=s.value,E=o?o.value:null,I=f?f.getContext(s.value.outlet):null;if(E&&r.routeConfig===E.routeConfig){let O=bV(E,r,r.routeConfig.runGuardsAndResolvers);O?g.canActivateChecks.push(new c1(u)):(r.data=E.data,r._resolvedData=E._resolvedData),r.component?Sm(s,o,I?I.children:null,u,g):Sm(s,o,f,u,g),O&&I&&I.outlet&&I.outlet.isActivated&&g.canDeactivateChecks.push(new uf(I.outlet.component,E))}else E&&Pm(o,I,g),g.canActivateChecks.push(new c1(u)),r.component?Sm(s,null,I?I.children:null,u,g):Sm(s,null,f,u,g);return g}function bV(s,o,f){if(typeof f=="function")return f(s,o);switch(f){case"pathParamsChange":return!Yu(s.url,o.url);case"pathParamsOrQueryParamsChange":return!Yu(s.url,o.url)||!ba(s.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!OD(s,o)||!ba(s.queryParams,o.queryParams);case"paramsChange":default:return!OD(s,o)}}function Pm(s,o,f){let u=lf(s),g=s.value;Object.entries(u).forEach(([r,E])=>{g.component?o?Pm(E,o.children.getContext(r),f):Pm(E,null,f):Pm(E,o,f)}),g.component?o&&o.outlet&&o.outlet.isActivated?f.canDeactivateChecks.push(new uf(o.outlet.component,g)):f.canDeactivateChecks.push(new uf(null,g)):f.canDeactivateChecks.push(new uf(null,g))}function $m(s){return typeof s=="function"}function wV(s){return typeof s=="boolean"}function DV(s){return s&&$m(s.canLoad)}function CV(s){return s&&$m(s.canActivate)}function EV(s){return s&&$m(s.canActivateChild)}function AV(s){return s&&$m(s.canDeactivate)}function TV(s){return s&&$m(s.canMatch)}function OP(s){return s instanceof Ka||s?.name==="EmptyError"}var Xy=Symbol("INITIAL_VALUE");function pf(){return jo(s=>Pd(s.map(o=>o.pipe(Vo(1),k_(Xy)))).pipe(ci(o=>{for(let f of o)if(f!==!0){if(f===Xy)return Xy;if(f===!1||f instanceof _c)return f}return!0}),Kr(o=>o!==Xy),Vo(1)))}function SV(s,o){return fr(f=>{let{targetSnapshot:u,currentSnapshot:g,guards:{canActivateChecks:r,canDeactivateChecks:E}}=f;return E.length===0&&r.length===0?Sn(Li($t({},f),{guardsResult:!0})):IV(E,u,g,s).pipe(fr(I=>I&&wV(I)?MV(u,r,s,o):Sn(I)),ci(I=>Li($t({},f),{guardsResult:I})))})}function IV(s,o,f,u){return dr(s).pipe(fr(g=>kV(g.component,g.route,f,o,u)),fa(g=>g!==!0,!0))}function MV(s,o,f,u){return dr(o).pipe(Pu(g=>nc(PV(g.route.parent,u),FV(g.route,u),RV(s,g.path,f),OV(s,g.route,f))),fa(g=>g!==!0,!0))}function FV(s,o){return s!==null&&o&&o(new SD(s)),Sn(!0)}function PV(s,o){return s!==null&&o&&o(new AD(s)),Sn(!0)}function OV(s,o,f){let u=o.routeConfig?o.routeConfig.canActivate:null;if(!u||u.length===0)return Sn(!0);let g=u.map(r=>P_(()=>{let E=Hm(o)??f,I=mf(r,E),O=CV(I)?I.canActivate(o,s):il(E,()=>I(o,s));return xc(O).pipe(fa())}));return Sn(g).pipe(pf())}function RV(s,o,f){let u=o[o.length-1],r=o.slice(0,o.length-1).reverse().map(E=>vV(E)).filter(E=>E!==null).map(E=>P_(()=>{let I=E.guards.map(O=>{let U=Hm(E.node)??f,V=mf(O,U),Z=EV(V)?V.canActivateChild(u,s):il(U,()=>V(u,s));return xc(Z).pipe(fa())});return Sn(I).pipe(pf())}));return Sn(r).pipe(pf())}function kV(s,o,f,u,g){let r=o&&o.routeConfig?o.routeConfig.canDeactivate:null;if(!r||r.length===0)return Sn(!0);let E=r.map(I=>{let O=Hm(o)??g,U=mf(I,O),V=AV(U)?U.canDeactivate(s,o,f,u):il(O,()=>U(s,o,f,u));return xc(V).pipe(fa())});return Sn(E).pipe(pf())}function BV(s,o,f,u){let g=o.canLoad;if(g===void 0||g.length===0)return Sn(!0);let r=g.map(E=>{let I=mf(E,s),O=DV(I)?I.canLoad(o,f):il(s,()=>I(o,f));return xc(O)});return Sn(r).pipe(pf(),RP(u))}function RP(s){return Tb(Nr(o=>{if(df(o))throw MP(s,o)}),ci(o=>o===!0))}function NV(s,o,f,u){let g=o.canMatch;if(!g||g.length===0)return Sn(!0);let r=g.map(E=>{let I=mf(E,s),O=TV(I)?I.canMatch(o,f):il(s,()=>I(o,f));return xc(O)});return Sn(r).pipe(pf(),RP(u))}var zm=class{constructor(o){this.segmentGroup=o||null}},u1=class extends Error{constructor(o){super(),this.urlTree=o}};function af(s){return Md(new zm(s))}function LV(s){return Md(new mn(4e3,!1))}function UV(s){return Md(FP(!1,us.GuardRejected))}var BD=class{constructor(o,f){this.urlSerializer=o,this.urlTree=f}lineralizeSegments(o,f){let u=[],g=f.root;for(;;){if(u=u.concat(g.segments),g.numberOfChildren===0)return Sn(u);if(g.numberOfChildren>1||!g.children[ii])return LV(o.redirectTo);g=g.children[ii]}}applyRedirectCommands(o,f,u){let g=this.applyRedirectCreateUrlTree(f,this.urlSerializer.parse(f),o,u);if(f.startsWith("/"))throw new u1(g);return g}applyRedirectCreateUrlTree(o,f,u,g){let r=this.createSegmentGroup(o,f.root,u,g);return new _c(r,this.createQueryParams(f.queryParams,this.urlTree.queryParams),f.fragment)}createQueryParams(o,f){let u={};return Object.entries(o).forEach(([g,r])=>{if(typeof r=="string"&&r.startsWith(":")){let I=r.substring(1);u[g]=f[I]}else u[g]=r}),u}createSegmentGroup(o,f,u,g){let r=this.createSegments(o,f.segments,u,g),E={};return Object.entries(f.children).forEach(([I,O])=>{E[I]=this.createSegmentGroup(o,O,u,g)}),new zi(r,E)}createSegments(o,f,u,g){return f.map(r=>r.path.startsWith(":")?this.findPosParam(o,r,g):this.findOrReturn(r,u))}findPosParam(o,f,u){let g=u[f.path.substring(1)];if(!g)throw new mn(4001,!1);return g}findOrReturn(o,f){let u=0;for(let g of f){if(g.path===o.path)return f.splice(u),g;u++}return o}},ND={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zV(s,o,f,u,g){let r=$D(s,o,f);return r.matched?(u=mV(o,u),NV(u,o,f,g).pipe(ci(E=>E===!0?r:$t({},ND)))):Sn(r)}function $D(s,o,f){if(o.path==="**")return VV(f);if(o.path==="")return o.pathMatch==="full"&&(s.hasChildren()||f.length>0)?$t({},ND):{matched:!0,consumedSegments:[],remainingSegments:f,parameters:{},positionalParamSegments:{}};let g=(o.matcher||N8)(f,s,o);if(!g)return $t({},ND);let r={};Object.entries(g.posParams??{}).forEach(([I,O])=>{r[I]=O.path});let E=g.consumed.length>0?$t($t({},r),g.consumed[g.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:g.consumed,remainingSegments:f.slice(g.consumed.length),parameters:E,positionalParamSegments:g.posParams??{}}}function VV(s){return{matched:!0,parameters:s.length>0?fP(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function cP(s,o,f,u){return f.length>0&&HV(s,f,u)?{segmentGroup:new zi(o,GV(u,new zi(f,s.children))),slicedSegments:[]}:f.length===0&&$V(s,f,u)?{segmentGroup:new zi(s.segments,jV(s,f,u,s.children)),slicedSegments:f}:{segmentGroup:new zi(s.segments,s.children),slicedSegments:f}}function jV(s,o,f,u){let g={};for(let r of f)if(p1(s,o,r)&&!u[Da(r)]){let E=new zi([],{});g[Da(r)]=E}return $t($t({},u),g)}function GV(s,o){let f={};f[ii]=o;for(let u of s)if(u.path===""&&Da(u)!==ii){let g=new zi([],{});f[Da(u)]=g}return f}function HV(s,o,f){return f.some(u=>p1(s,o,u)&&Da(u)!==ii)}function $V(s,o,f){return f.some(u=>p1(s,o,u))}function p1(s,o,f){return(s.hasChildren()||o.length>0)&&f.pathMatch==="full"?!1:f.path===""}function qV(s,o,f,u){return Da(s)!==u&&(u===ii||!p1(o,f,s))?!1:$D(o,s,f).matched}function WV(s,o,f){return o.length===0&&!s.children[f]}var LD=class{};function ZV(s,o,f,u,g,r,E="emptyOnly"){return new UD(s,o,f,u,g,E,r).recognize()}var QV=31,UD=class{constructor(o,f,u,g,r,E,I){this.injector=o,this.configLoader=f,this.rootComponentType=u,this.config=g,this.urlTree=r,this.paramsInheritanceStrategy=E,this.urlSerializer=I,this.applyRedirects=new BD(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(o){return new mn(4002,`'${o.segmentGroup}'`)}recognize(){let o=cP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(o).pipe(ci(f=>{let u=new Lm([],Object.freeze({}),Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,{},ii,this.rootComponentType,null,{}),g=new cs(u,f),r=new l1("",g),E=nV(u,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(E),this.inheritParamsAndData(r._root,null),{state:r,tree:E}}))}match(o){return this.processSegmentGroup(this.injector,this.config,o,ii).pipe(ic(u=>{if(u instanceof u1)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof zm?this.noMatchError(u):u}))}inheritParamsAndData(o,f){let u=o.value,g=VD(u,f,this.paramsInheritanceStrategy);u.params=Object.freeze(g.params),u.data=Object.freeze(g.data),o.children.forEach(r=>this.inheritParamsAndData(r,u))}processSegmentGroup(o,f,u,g){return u.segments.length===0&&u.hasChildren()?this.processChildren(o,f,u):this.processSegment(o,f,u,u.segments,g,!0).pipe(ci(r=>r instanceof cs?[r]:[]))}processChildren(o,f,u){let g=[];for(let r of Object.keys(u.children))r==="primary"?g.unshift(r):g.push(r);return dr(g).pipe(Pu(r=>{let E=u.children[r],I=gV(f,r);return this.processSegmentGroup(o,I,E,r)}),Ub((r,E)=>(r.push(...E),r)),rc(null),Lb(),fr(r=>{if(r===null)return af(u);let E=kP(r);return YV(E),Sn(E)}))}processSegment(o,f,u,g,r,E){return dr(f).pipe(Pu(I=>this.processSegmentAgainstRoute(I._injector??o,f,I,u,g,r,E).pipe(ic(O=>{if(O instanceof zm)return Sn(null);throw O}))),fa(I=>!!I),ic(I=>{if(OP(I))return WV(u,g,r)?Sn(new LD):af(u);throw I}))}processSegmentAgainstRoute(o,f,u,g,r,E,I){return qV(u,g,r,E)?u.redirectTo===void 0?this.matchSegmentAgainstRoute(o,g,u,r,E):this.allowRedirects&&I?this.expandSegmentAgainstRouteUsingRedirect(o,g,f,u,r,E):af(g):af(g)}expandSegmentAgainstRouteUsingRedirect(o,f,u,g,r,E){let{matched:I,consumedSegments:O,positionalParamSegments:U,remainingSegments:V}=$D(f,g,r);if(!I)return af(f);g.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>QV&&(this.allowRedirects=!1));let Z=this.applyRedirects.applyRedirectCommands(O,g.redirectTo,U);return this.applyRedirects.lineralizeSegments(g,Z).pipe(fr(te=>this.processSegment(o,u,f,te.concat(V),E,!1)))}matchSegmentAgainstRoute(o,f,u,g,r){let E=zV(f,u,g,o,this.urlSerializer);return u.path==="**"&&(f.children={}),E.pipe(jo(I=>I.matched?(o=u._injector??o,this.getChildConfig(o,u,g).pipe(jo(({routes:O})=>{let U=u._loadedInjector??o,{consumedSegments:V,remainingSegments:Z,parameters:te}=I,se=new Lm(V,te,Object.freeze($t({},this.urlTree.queryParams)),this.urlTree.fragment,KV(u),Da(u),u.component??u._loadedComponent??null,u,JV(u)),{segmentGroup:pe,slicedSegments:Ce}=cP(f,V,Z,O);if(Ce.length===0&&pe.hasChildren())return this.processChildren(U,O,pe).pipe(ci(ce=>ce===null?null:new cs(se,ce)));if(O.length===0&&Ce.length===0)return Sn(new cs(se,[]));let Te=Da(u)===r;return this.processSegment(U,O,pe,Ce,Te?ii:r,!0).pipe(ci(ce=>new cs(se,ce instanceof cs?[ce]:[])))}))):af(f)))}getChildConfig(o,f,u){return f.children?Sn({routes:f.children,injector:o}):f.loadChildren?f._loadedRoutes!==void 0?Sn({routes:f._loadedRoutes,injector:f._loadedInjector}):BV(o,f,u,this.urlSerializer).pipe(fr(g=>g?this.configLoader.loadChildren(o,f).pipe(Nr(r=>{f._loadedRoutes=r.routes,f._loadedInjector=r.injector})):UV(f))):Sn({routes:[],injector:o})}};function YV(s){s.sort((o,f)=>o.value.outlet===ii?-1:f.value.outlet===ii?1:o.value.outlet.localeCompare(f.value.outlet))}function XV(s){let o=s.value.routeConfig;return o&&o.path===""}function kP(s){let o=[],f=new Set;for(let u of s){if(!XV(u)){o.push(u);continue}let g=o.find(r=>u.value.routeConfig===r.value.routeConfig);g!==void 0?(g.children.push(...u.children),f.add(g)):o.push(u)}for(let u of f){let g=kP(u.children);o.push(new cs(u.value,g))}return o.filter(u=>!f.has(u))}function KV(s){return s.data||{}}function JV(s){return s.resolve||{}}function ej(s,o,f,u,g,r){return fr(E=>ZV(s,o,f,u,E.extractedUrl,g,r).pipe(ci(({state:I,tree:O})=>Li($t({},E),{targetSnapshot:I,urlAfterRedirects:O}))))}function tj(s,o){return fr(f=>{let{targetSnapshot:u,guards:{canActivateChecks:g}}=f;if(!g.length)return Sn(f);let r=new Set(g.map(O=>O.route)),E=new Set;for(let O of r)if(!E.has(O))for(let U of BP(O))E.add(U);let I=0;return dr(E).pipe(Pu(O=>r.has(O)?nj(O,u,s,o):(O.data=VD(O,O.parent,s).resolve,Sn(void 0))),Nr(()=>I++),kd(1),fr(O=>I===E.size?Sn(f):Xr))})}function BP(s){let o=s.children.map(f=>BP(f)).flat();return[s,...o]}function nj(s,o,f,u){let g=s.routeConfig,r=s._resolve;return g?.title!==void 0&&!SP(g)&&(r[Vm]=g.title),ij(r,s,o,u).pipe(ci(E=>(s._resolvedData=E,s.data=VD(s,s.parent,f).resolve,null)))}function ij(s,o,f,u){let g=gD(s);if(g.length===0)return Sn({});let r={};return dr(g).pipe(fr(E=>rj(s[E],o,f,u).pipe(fa(),Nr(I=>{r[E]=I}))),kd(1),Bb(r),ic(E=>OP(E)?Xr:Md(E)))}function rj(s,o,f,u){let g=Hm(o)??u,r=mf(s,g),E=r.resolve?r.resolve(o,f):il(g,()=>r(o,f));return xc(E)}function pD(s){return jo(o=>{let f=s(o);return f?dr(f).pipe(ci(()=>o)):Sn(o)})}var NP=(()=>{let o=class o{buildTitle(u){let g,r=u.root;for(;r!==void 0;)g=this.getResolvedTitleForRoute(r)??g,r=r.children.find(E=>E.outlet===ii);return g}getResolvedTitleForRoute(u){return u.data[Vm]}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(oj),providedIn:"root"});let s=o;return s})(),oj=(()=>{let o=class o extends NP{constructor(u){super(),this.title=u}updateTitle(u){let g=this.buildTitle(u);g!==void 0&&this.title.setTitle(g)}};o.\u0275fac=function(g){return new(g||o)(Rn(nP))},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),qm=new wn("",{providedIn:"root",factory:()=>({})}),h1=new wn(""),qD=(()=>{let o=class o{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ot(Gy)}loadComponent(u){if(this.componentLoaders.get(u))return this.componentLoaders.get(u);if(u._loadedComponent)return Sn(u._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(u);let g=xc(u.loadComponent()).pipe(ci(LP),Nr(E=>{this.onLoadEndListener&&this.onLoadEndListener(u),u._loadedComponent=E}),Rd(()=>{this.componentLoaders.delete(u)})),r=new Td(g,()=>new nr).pipe(Ad());return this.componentLoaders.set(u,r),r}loadChildren(u,g){if(this.childrenLoaders.get(g))return this.childrenLoaders.get(g);if(g._loadedRoutes)return Sn({routes:g._loadedRoutes,injector:g._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(g);let E=sj(g,this.compiler,u,this.onLoadEndListener).pipe(Rd(()=>{this.childrenLoaders.delete(g)})),I=new Td(E,()=>new nr).pipe(Ad());return this.childrenLoaders.set(g,I),I}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function sj(s,o,f,u){return xc(s.loadChildren()).pipe(ci(LP),fr(g=>g instanceof mm||Array.isArray(g)?Sn(g):dr(o.compileModuleAsync(g))),ci(g=>{u&&u(s);let r,E,I=!1;return Array.isArray(g)?(E=g,I=!0):(r=g.create(f).injector,E=r.get(h1,[],{optional:!0,self:!0}).flat()),{routes:E.map(HD),injector:r}}))}function aj(s){return s&&typeof s=="object"&&"default"in s}function LP(s){return aj(s)?s.default:s}var WD=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(lj),providedIn:"root"});let s=o;return s})(),lj=(()=>{let o=class o{shouldProcessUrl(u){return!0}extract(u){return u}merge(u,g){return u}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),UP=new wn(""),zP=new wn("");function cj(s,o,f){let u=s.get(zP),g=s.get(Hr);return s.get(Ui).runOutsideAngular(()=>{if(!g.startViewTransition||u.skipNextTransition)return u.skipNextTransition=!1,new Promise(U=>setTimeout(U));let r,E=new Promise(U=>{r=U}),I=g.startViewTransition(()=>(r(),uj(s))),{onViewTransitionCreated:O}=u;return O&&il(s,()=>O({transition:I,from:o,to:f})),E})}function uj(s){return new Promise(o=>{ky(o,{injector:s})})}var ZD=(()=>{let o=class o{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new nr,this.transitionAbortSubject=new nr,this.configLoader=Ot(qD),this.environmentInjector=Ot(eo),this.urlSerializer=Ot(jm),this.rootContexts=Ot(Gm),this.location=Ot(sf),this.inputBindingEnabled=Ot(f1,{optional:!0})!==null,this.titleStrategy=Ot(NP),this.options=Ot(qm,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ot(WD),this.createViewTransition=Ot(UP,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Sn(void 0),this.rootComponentType=null;let u=r=>this.events.next(new CD(r)),g=r=>this.events.next(new ED(r));this.configLoader.onLoadEndListener=g,this.configLoader.onLoadStartListener=u}complete(){this.transitions?.complete()}handleNavigationRequest(u){let g=++this.navigationId;this.transitions?.next(Li($t($t({},this.transitions.value),u),{id:g}))}setupNavigations(u,g,r){return this.transitions=new Sr({id:0,currentUrlTree:g,currentRawUrl:g,extractedUrl:this.urlHandlingStrategy.extract(g),urlAfterRedirects:this.urlHandlingStrategy.extract(g),rawUrl:g,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Fm,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Kr(E=>E.id!==0),ci(E=>Li($t({},E),{extractedUrl:this.urlHandlingStrategy.extract(E.rawUrl)})),jo(E=>{let I=!1,O=!1;return Sn(E).pipe(jo(U=>{if(this.navigationId>E.id)return this.cancelNavigationTransition(E,"",us.SupersededByNewNavigation),Xr;this.currentTransition=E,this.currentNavigation={id:U.id,initialUrl:U.rawUrl,extractedUrl:U.extractedUrl,trigger:U.source,extras:U.extras,previousNavigation:this.lastSuccessfulNavigation?Li($t({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let V=!u.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Z=U.extras.onSameUrlNavigation??u.onSameUrlNavigation;if(!V&&Z!=="reload"){let te="";return this.events.next(new vc(U.id,this.urlSerializer.serialize(U.rawUrl),te,i1.IgnoredSameUrlNavigation)),U.resolve(null),Xr}if(this.urlHandlingStrategy.shouldProcessUrl(U.rawUrl))return Sn(U).pipe(jo(te=>{let se=this.transitions?.getValue();return this.events.next(new ff(te.id,this.urlSerializer.serialize(te.extractedUrl),te.source,te.restoredState)),se!==this.transitions?.getValue()?Xr:Promise.resolve(te)}),ej(this.environmentInjector,this.configLoader,this.rootComponentType,u.config,this.urlSerializer,this.paramsInheritanceStrategy),Nr(te=>{E.targetSnapshot=te.targetSnapshot,E.urlAfterRedirects=te.urlAfterRedirects,this.currentNavigation=Li($t({},this.currentNavigation),{finalUrl:te.urlAfterRedirects});let se=new r1(te.id,this.urlSerializer.serialize(te.extractedUrl),this.urlSerializer.serialize(te.urlAfterRedirects),te.targetSnapshot);this.events.next(se)}));if(V&&this.urlHandlingStrategy.shouldProcessUrl(U.currentRawUrl)){let{id:te,extractedUrl:se,source:pe,restoredState:Ce,extras:Te}=U,ce=new ff(te,this.urlSerializer.serialize(se),pe,Ce);this.events.next(ce);let me=AP(this.rootComponentType).snapshot;return this.currentTransition=E=Li($t({},U),{targetSnapshot:me,urlAfterRedirects:se,extras:Li($t({},Te),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=se,Sn(E)}else{let te="";return this.events.next(new vc(U.id,this.urlSerializer.serialize(U.extractedUrl),te,i1.IgnoredByUrlHandlingStrategy)),U.resolve(null),Xr}}),Nr(U=>{let V=new xD(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(V)}),ci(U=>(this.currentTransition=E=Li($t({},U),{guards:yV(U.targetSnapshot,U.currentSnapshot,this.rootContexts)}),E)),SV(this.environmentInjector,U=>this.events.next(U)),Nr(U=>{if(E.guardsResult=U.guardsResult,df(U.guardsResult))throw MP(this.urlSerializer,U.guardsResult);let V=new bD(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot,!!U.guardsResult);this.events.next(V)}),Kr(U=>U.guardsResult?!0:(this.cancelNavigationTransition(U,"",us.GuardRejected),!1)),pD(U=>{if(U.guards.canActivateChecks.length)return Sn(U).pipe(Nr(V=>{let Z=new wD(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot);this.events.next(Z)}),jo(V=>{let Z=!1;return Sn(V).pipe(tj(this.paramsInheritanceStrategy,this.environmentInjector),Nr({next:()=>Z=!0,complete:()=>{Z||this.cancelNavigationTransition(V,"",us.NoDataFromResolver)}}))}),Nr(V=>{let Z=new DD(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot);this.events.next(Z)}))}),pD(U=>{let V=Z=>{let te=[];Z.routeConfig?.loadComponent&&!Z.routeConfig._loadedComponent&&te.push(this.configLoader.loadComponent(Z.routeConfig).pipe(Nr(se=>{Z.component=se}),ci(()=>{})));for(let se of Z.children)te.push(...V(se));return te};return Pd(V(U.targetSnapshot.root)).pipe(rc(null),Vo(1))}),pD(()=>this.afterPreactivation()),jo(()=>{let{currentSnapshot:U,targetSnapshot:V}=E,Z=this.createViewTransition?.(this.environmentInjector,U.root,V.root);return Z?dr(Z).pipe(ci(()=>E)):Sn(E)}),ci(U=>{let V=uV(u.routeReuseStrategy,U.targetSnapshot,U.currentRouterState);return this.currentTransition=E=Li($t({},U),{targetRouterState:V}),this.currentNavigation.targetRouterState=V,E}),Nr(()=>{this.events.next(new Bm)}),_V(this.rootContexts,u.routeReuseStrategy,U=>this.events.next(U),this.inputBindingEnabled),Vo(1),Nr({next:U=>{I=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new wa(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects))),this.titleStrategy?.updateTitle(U.targetRouterState.snapshot),U.resolve(!0)},complete:()=>{I=!0}}),mo(this.transitionAbortSubject.pipe(Nr(U=>{throw U}))),Rd(()=>{!I&&!O&&this.cancelNavigationTransition(E,"",us.SupersededByNewNavigation),this.currentTransition?.id===E.id&&(this.currentNavigation=null,this.currentTransition=null)}),ic(U=>{if(O=!0,PP(U))this.events.next(new yc(E.id,this.urlSerializer.serialize(E.extractedUrl),U.message,U.cancellationCode)),fV(U)?this.events.next(new Nm(U.url)):E.resolve(!1);else{this.events.next(new km(E.id,this.urlSerializer.serialize(E.extractedUrl),U,E.targetSnapshot??void 0));try{E.resolve(u.errorHandler(U))}catch(V){this.options.resolveNavigationPromiseOnError?E.resolve(!1):E.reject(V)}}return Xr}))}))}cancelNavigationTransition(u,g,r){let E=new yc(u.id,this.urlSerializer.serialize(u.extractedUrl),g,r);this.events.next(E),u.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function hj(s){return s!==Fm}var dj=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(fj),providedIn:"root"});let s=o;return s})(),zD=class{shouldDetach(o){return!1}store(o,f){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,f){return o.routeConfig===f.routeConfig}},fj=(()=>{let o=class o extends zD{};o.\u0275fac=(()=>{let u;return function(r){return(u||(u=Hu(o)))(r||o)}})(),o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),VP=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:()=>Ot(pj),providedIn:"root"});let s=o;return s})(),pj=(()=>{let o=class o extends VP{constructor(){super(...arguments),this.location=Ot(sf),this.urlSerializer=Ot(jm),this.options=Ot(qm,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ot(WD),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new _c,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=AP(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(u){return this.location.subscribe(g=>{g.type==="popstate"&&u(g.url,g.state)})}handleRouterEvent(u,g){if(u instanceof ff)this.stateMemento=this.createStateMemento();else if(u instanceof vc)this.rawUrlTree=g.initialUrl;else if(u instanceof r1){if(this.urlUpdateStrategy==="eager"&&!g.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl);this.setBrowserUrl(r,g)}}else u instanceof Bm?(this.currentUrlTree=g.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(g.finalUrl,g.initialUrl),this.routerState=g.targetRouterState,this.urlUpdateStrategy==="deferred"&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g))):u instanceof yc&&(u.code===us.GuardRejected||u.code===us.NoDataFromResolver)?this.restoreHistory(g):u instanceof km?this.restoreHistory(g,!0):u instanceof wa&&(this.lastSuccessfulId=u.id,this.currentPageId=this.browserPageId)}setBrowserUrl(u,g){let r=this.urlSerializer.serialize(u);if(this.location.isCurrentPathEqualTo(r)||g.extras.replaceUrl){let E=this.browserPageId,I=$t($t({},g.extras.state),this.generateNgRouterState(g.id,E));this.location.replaceState(r,"",I)}else{let E=$t($t({},g.extras.state),this.generateNgRouterState(g.id,this.browserPageId+1));this.location.go(r,"",E)}}restoreHistory(u,g=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,E=this.currentPageId-r;E!==0?this.location.historyGo(E):this.currentUrlTree===u.finalUrl&&E===0&&(this.resetState(u),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(g&&this.resetState(u),this.resetUrlToCurrentUrlTree())}resetState(u){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,u.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(u,g){return this.canceledNavigationResolution==="computed"?{navigationId:u,\u0275routerPageId:g}:{navigationId:u}}};o.\u0275fac=(()=>{let u;return function(r){return(u||(u=Hu(o)))(r||o)}})(),o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),Im=function(s){return s[s.COMPLETE=0]="COMPLETE",s[s.FAILED=1]="FAILED",s[s.REDIRECTING=2]="REDIRECTING",s}(Im||{});function jP(s,o){s.events.pipe(Kr(f=>f instanceof wa||f instanceof yc||f instanceof km||f instanceof vc),ci(f=>f instanceof wa||f instanceof vc?Im.COMPLETE:(f instanceof yc?f.code===us.Redirect||f.code===us.SupersededByNewNavigation:!1)?Im.REDIRECTING:Im.FAILED),Kr(f=>f!==Im.REDIRECTING),Vo(1)).subscribe(()=>{o()})}function mj(s){throw s}var gj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_j={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},$o=(()=>{let o=class o{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Ot(Uy),this.stateManager=Ot(VP),this.options=Ot(qm,{optional:!0})||{},this.pendingTasks=Ot(Ny),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ot(ZD),this.urlSerializer=Ot(jm),this.location=Ot(sf),this.urlHandlingStrategy=Ot(WD),this._events=new nr,this.errorHandler=this.options.errorHandler||mj,this.navigated=!1,this.routeReuseStrategy=Ot(dj),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ot(h1,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ot(f1,{optional:!0}),this.eventsSubscription=new br,this.isNgZoneEnabled=Ot(Ui)instanceof Ui&&Ui.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:u=>{this.console.warn(u)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let u=this.navigationTransitions.events.subscribe(g=>{try{let r=this.navigationTransitions.currentTransition,E=this.navigationTransitions.currentNavigation;if(r!==null&&E!==null){if(this.stateManager.handleRouterEvent(g,E),g instanceof yc&&g.code!==us.Redirect&&g.code!==us.SupersededByNewNavigation)this.navigated=!0;else if(g instanceof wa)this.navigated=!0;else if(g instanceof Nm){let I=this.urlHandlingStrategy.merge(g.url,r.currentRawUrl),O={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||hj(r.source)};this.scheduleNavigation(I,Fm,null,O,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}vj(g)&&this._events.next(g)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(u)}resetRootComponentType(u){this.routerState.root.component=u,this.navigationTransitions.rootComponentType=u}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Fm,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((u,g)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(u,"popstate",g)},0)})}navigateToSyncWithBrowser(u,g,r){let E={replaceUrl:!0},I=r?.navigationId?r:null;if(r){let U=$t({},r);delete U.navigationId,delete U.\u0275routerPageId,Object.keys(U).length!==0&&(E.state=U)}let O=this.parseUrl(u);this.scheduleNavigation(O,g,I,E)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(u){this.config=u.map(HD),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(u,g={}){let{relativeTo:r,queryParams:E,fragment:I,queryParamsHandling:O,preserveFragment:U}=g,V=U?this.currentUrlTree.fragment:I,Z=null;switch(O){case"merge":Z=$t($t({},this.currentUrlTree.queryParams),E);break;case"preserve":Z=this.currentUrlTree.queryParams;break;default:Z=E||null}Z!==null&&(Z=this.removeEmptyProps(Z));let te;try{let se=r?r.snapshot:this.routerState.snapshot.root;te=wP(se)}catch{(typeof u[0]!="string"||!u[0].startsWith("/"))&&(u=[]),te=this.currentUrlTree.root}return DP(te,u,Z,V??null)}navigateByUrl(u,g={skipLocationChange:!1}){let r=df(u)?u:this.parseUrl(u),E=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(E,Fm,null,g)}navigate(u,g={skipLocationChange:!1}){return yj(u),this.navigateByUrl(this.createUrlTree(u,g),g)}serializeUrl(u){return this.urlSerializer.serialize(u)}parseUrl(u){try{return this.urlSerializer.parse(u)}catch{return this.urlSerializer.parse("/")}}isActive(u,g){let r;if(g===!0?r=$t({},gj):g===!1?r=$t({},_j):r=g,df(u))return rP(this.currentUrlTree,u,r);let E=this.parseUrl(u);return rP(this.currentUrlTree,E,r)}removeEmptyProps(u){return Object.entries(u).reduce((g,[r,E])=>(E!=null&&(g[r]=E),g),{})}scheduleNavigation(u,g,r,E,I){if(this.disposed)return Promise.resolve(!1);let O,U,V;I?(O=I.resolve,U=I.reject,V=I.promise):V=new Promise((te,se)=>{O=te,U=se});let Z=this.pendingTasks.add();return jP(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Z))}),this.navigationTransitions.handleNavigationRequest({source:g,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:u,extras:E,resolve:O,reject:U,promise:V,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),V.catch(te=>Promise.reject(te))}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function yj(s){for(let o=0;o<s.length;o++)if(s[o]==null)throw new mn(4008,!1)}function vj(s){return!(s instanceof Bm)&&!(s instanceof Nm)}var gf=(()=>{let o=class o{constructor(u,g,r,E,I,O){this.router=u,this.route=g,this.tabIndexAttribute=r,this.renderer=E,this.el=I,this.locationStrategy=O,this.href=null,this.commands=null,this.onChanges=new nr,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let U=I.nativeElement.tagName?.toLowerCase();this.isAnchorElement=U==="a"||U==="area",this.isAnchorElement?this.subscription=u.events.subscribe(V=>{V instanceof wa&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(u){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",u)}ngOnChanges(u){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(u){u!=null?(this.commands=Array.isArray(u)?u:[u],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(u,g,r,E,I){let O=this.urlTree;if(O===null||this.isAnchorElement&&(u!==0||g||r||E||I||typeof this.target=="string"&&this.target!="_self"))return!0;let U={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(O,U),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let u=this.urlTree;this.href=u!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(u)):null;let g=this.href===null?null:AM(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",g)}applyAttributeValue(u,g){let r=this.renderer,E=this.el.nativeElement;g!==null?r.setAttribute(E,u,g):r.removeAttribute(E,u)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};o.\u0275fac=function(g){return new(g||o)(Xn($o),Xn(Xu),Ey("tabindex"),Xn(dc),Xn(Fo),Xn(cl))},o.\u0275dir=io({type:o,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(g,r){g&1&&yo("click",function(I){return r.onClick(I.button,I.ctrlKey,I.shiftKey,I.altKey,I.metaKey)}),g&2&&nf("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Jr.HasDecoratorInputTransform,"preserveFragment","preserveFragment",of],skipLocationChange:[Jr.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",of],replaceUrl:[Jr.HasDecoratorInputTransform,"replaceUrl","replaceUrl",of],routerLink:"routerLink"},standalone:!0,features:[k2,sl]});let s=o;return s})();var d1=class{};var xj=(()=>{let o=class o{constructor(u,g,r,E,I){this.router=u,this.injector=r,this.preloadingStrategy=E,this.loader=I}setUpPreloading(){this.subscription=this.router.events.pipe(Kr(u=>u instanceof wa),Pu(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(u,g){let r=[];for(let E of g){E.providers&&!E._injector&&(E._injector=By(E.providers,u,`Route: ${E.path}`));let I=E._injector??u,O=E._loadedInjector??I;(E.loadChildren&&!E._loadedRoutes&&E.canLoad===void 0||E.loadComponent&&!E._loadedComponent)&&r.push(this.preloadConfig(I,E)),(E.children||E._loadedRoutes)&&r.push(this.processRoutes(O,E.children??E._loadedRoutes))}return dr(r).pipe(Od())}preloadConfig(u,g){return this.preloadingStrategy.preload(g,()=>{let r;g.loadChildren&&g.canLoad===void 0?r=this.loader.loadChildren(u,g):r=Sn(null);let E=r.pipe(fr(I=>I===null?Sn(void 0):(g._loadedRoutes=I.routes,g._loadedInjector=I.injector,this.processRoutes(I.injector??u,I.routes))));if(g.loadComponent&&!g._loadedComponent){let I=this.loader.loadComponent(g);return dr([E,I]).pipe(Od())}else return E})}};o.\u0275fac=function(g){return new(g||o)(Rn($o),Rn(Gy),Rn(eo),Rn(d1),Rn(qD))},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),GP=new wn(""),bj=(()=>{let o=class o{constructor(u,g,r,E,I={}){this.urlSerializer=u,this.transitions=g,this.viewportScroller=r,this.zone=E,this.options=I,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=Ot(eo),I.scrollPositionRestoration||="disabled",I.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(u=>{u instanceof ff?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=u.navigationTrigger,this.restoredId=u.restoredState?u.restoredState.navigationId:0):u instanceof wa?(this.lastId=u.id,this.scheduleScrollEvent(u,this.urlSerializer.parse(u.urlAfterRedirects).fragment)):u instanceof vc&&u.code===i1.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(u,this.urlSerializer.parse(u.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(u=>{u instanceof o1&&(u.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(u.position):u.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(u.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(u,g){this.zone.runOutsideAngular(()=>_b(this,null,function*(){yield new Promise(r=>{setTimeout(()=>{r()}),ky(()=>{r()},{injector:this.environmentInjector})}),this.zone.run(()=>{this.transitions.events.next(new o1(u,this.lastSource==="popstate"?this.store[this.restoredId]:null,g))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};o.\u0275fac=function(g){zM()},o.\u0275prov=un({token:o,factory:o.\u0275fac});let s=o;return s})();function wj(s){return s.routerState.root}function Wm(s,o){return{\u0275kind:s,\u0275providers:o}}function Dj(){let s=Ot(_o);return o=>{let f=s.get(mc);if(o!==f.components[0])return;let u=s.get($o),g=s.get(HP);s.get(QD)===1&&u.initialNavigation(),s.get($P,null,pi.Optional)?.setUpPreloading(),s.get(GP,null,pi.Optional)?.init(),u.resetRootComponentType(f.componentTypes[0]),g.closed||(g.next(),g.complete(),g.unsubscribe())}}var HP=new wn("",{factory:()=>new nr}),QD=new wn("",{providedIn:"root",factory:()=>1});function Cj(){return Wm(2,[{provide:QD,useValue:0},{provide:jy,multi:!0,deps:[_o],useFactory:o=>{let f=o.get(LF,Promise.resolve());return()=>f.then(()=>new Promise(u=>{let g=o.get($o),r=o.get(HP);jP(g,()=>{u(!0)}),o.get(ZD).afterPreactivation=()=>(u(!0),r.closed?Sn(void 0):r),g.initialNavigation()}))}}])}function Ej(){return Wm(3,[{provide:jy,multi:!0,useFactory:()=>{let o=Ot($o);return()=>{o.setUpLocationChangeListener()}}},{provide:QD,useValue:2}])}var $P=new wn("");function Aj(s){return Wm(0,[{provide:$P,useExisting:xj},{provide:d1,useExisting:s}])}function Tj(){return Wm(8,[lP,{provide:f1,useExisting:lP}])}function Sj(s){let o=[{provide:UP,useValue:cj},{provide:zP,useValue:$t({skipNextTransition:!!s?.skipInitialTransition},s)}];return Wm(9,o)}var uP=new wn("ROUTER_FORROOT_GUARD"),Ij=[sf,{provide:jm,useClass:Om},$o,Gm,{provide:Xu,useFactory:wj,deps:[$o]},qD,[]],YD=(()=>{let o=class o{constructor(u){}static forRoot(u,g){return{ngModule:o,providers:[Ij,[],{provide:h1,multi:!0,useValue:u},{provide:uP,useFactory:Oj,deps:[[$o,new Jw,new pI]]},{provide:qm,useValue:g||{}},g?.useHash?Fj():Pj(),Mj(),g?.preloadingStrategy?Aj(g.preloadingStrategy).\u0275providers:[],g?.initialNavigation?Rj(g):[],g?.bindToComponentInputs?Tj().\u0275providers:[],g?.enableViewTransitions?Sj().\u0275providers:[],kj()]}}static forChild(u){return{ngModule:o,providers:[{provide:h1,multi:!0,useValue:u}]}}};o.\u0275fac=function(g){return new(g||o)(Rn(uP,8))},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();function Mj(){return{provide:GP,useFactory:()=>{let s=Ot($F),o=Ot(Ui),f=Ot(qm),u=Ot(ZD),g=Ot(jm);return f.scrollOffset&&s.setOffset(f.scrollOffset),new bj(g,u,s,o,f)}}}function Fj(){return{provide:cl,useClass:zF}}function Pj(){return{provide:cl,useClass:eD}}function Oj(s){return"guarded"}function Rj(s){return[s.initialNavigation==="disabled"?Ej().\u0275providers:[],s.initialNavigation==="enabledBlocking"?Cj().\u0275providers:[]]}var hP=new wn("");function kj(){return[{provide:hP,useFactory:Dj},{provide:q2,multi:!0,useExisting:hP}]}var XP=(()=>{let o=class o{constructor(u,g){this._renderer=u,this._elementRef=g,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(u,g){this._renderer.setProperty(this._elementRef.nativeElement,u,g)}registerOnTouched(u){this.onTouched=u}registerOnChange(u){this.onChange=u}setDisabledState(u){this.setProperty("disabled",u)}};o.\u0275fac=function(g){return new(g||o)(Xn(dc),Xn(Fo))},o.\u0275dir=io({type:o});let s=o;return s})(),JD=(()=>{let o=class o extends XP{};o.\u0275fac=(()=>{let u;return function(r){return(u||(u=Hu(o)))(r||o)}})(),o.\u0275dir=io({type:o,features:[Ks]});let s=o;return s})(),C1=new wn("");var Bj={provide:C1,useExisting:nl(()=>E1),multi:!0};function Nj(){let s=xa()?xa().getUserAgent():"";return/android (\d+)/.test(s.toLowerCase())}var Lj=new wn(""),E1=(()=>{let o=class o extends XP{constructor(u,g,r){super(u,g),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Nj())}writeValue(u){let g=u??"";this.setProperty("value",g)}_handleInput(u){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(u)}_compositionStart(){this._composing=!0}_compositionEnd(u){this._composing=!1,this._compositionMode&&this.onChange(u)}};o.\u0275fac=function(g){return new(g||o)(Xn(dc),Xn(Fo),Xn(Lj,8))},o.\u0275dir=io({type:o,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(g,r){g&1&&yo("input",function(I){return r._handleInput(I.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(I){return r._compositionEnd(I.target.value)})},features:[Wu([Bj]),Ks]});let s=o;return s})();function bc(s){return s==null||(typeof s=="string"||Array.isArray(s))&&s.length===0}function KP(s){return s!=null&&typeof s.length=="number"}var JP=new wn(""),eO=new wn(""),Uj=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ir=class{static min(o){return zj(o)}static max(o){return Vj(o)}static required(o){return jj(o)}static requiredTrue(o){return Gj(o)}static email(o){return Hj(o)}static minLength(o){return $j(o)}static maxLength(o){return qj(o)}static pattern(o){return Wj(o)}static nullValidator(o){return tO(o)}static compose(o){return aO(o)}static composeAsync(o){return cO(o)}};function zj(s){return o=>{if(bc(o.value)||bc(s))return null;let f=parseFloat(o.value);return!isNaN(f)&&f<s?{min:{min:s,actual:o.value}}:null}}function Vj(s){return o=>{if(bc(o.value)||bc(s))return null;let f=parseFloat(o.value);return!isNaN(f)&&f>s?{max:{max:s,actual:o.value}}:null}}function jj(s){return bc(s.value)?{required:!0}:null}function Gj(s){return s.value===!0?null:{required:!0}}function Hj(s){return bc(s.value)||Uj.test(s.value)?null:{email:!0}}function $j(s){return o=>bc(o.value)||!KP(o.value)?null:o.value.length<s?{minlength:{requiredLength:s,actualLength:o.value.length}}:null}function qj(s){return o=>KP(o.value)&&o.value.length>s?{maxlength:{requiredLength:s,actualLength:o.value.length}}:null}function Wj(s){if(!s)return tO;let o,f;return typeof s=="string"?(f="",s.charAt(0)!=="^"&&(f+="^"),f+=s,s.charAt(s.length-1)!=="$"&&(f+="$"),o=new RegExp(f)):(f=s.toString(),o=s),u=>{if(bc(u.value))return null;let g=u.value;return o.test(g)?null:{pattern:{requiredPattern:f,actualValue:g}}}}function tO(s){return null}function nO(s){return s!=null}function iO(s){return Zu(s)?dr(s):s}function rO(s){let o={};return s.forEach(f=>{o=f!=null?$t($t({},o),f):o}),Object.keys(o).length===0?null:o}function oO(s,o){return o.map(f=>f(s))}function Zj(s){return!s.validate}function sO(s){return s.map(o=>Zj(o)?o:f=>o.validate(f))}function aO(s){if(!s)return null;let o=s.filter(nO);return o.length==0?null:function(f){return rO(oO(f,o))}}function lO(s){return s!=null?aO(sO(s)):null}function cO(s){if(!s)return null;let o=s.filter(nO);return o.length==0?null:function(f){let u=oO(f,o).map(iO);return Ob(u).pipe(ci(rO))}}function uO(s){return s!=null?cO(sO(s)):null}function qP(s,o){return s===null?[o]:Array.isArray(s)?[...s,o]:[s,o]}function hO(s){return s._rawValidators}function dO(s){return s._rawAsyncValidators}function XD(s){return s?Array.isArray(s)?s:[s]:[]}function g1(s,o){return Array.isArray(s)?s.includes(o):s===o}function WP(s,o){let f=XD(o);return XD(s).forEach(g=>{g1(f,g)||f.push(g)}),f}function ZP(s,o){return XD(o).filter(f=>!g1(s,f))}var _1=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=lO(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=uO(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o=void 0){this.control&&this.control.reset(o)}hasError(o,f){return this.control?this.control.hasError(o,f):!1}getError(o,f){return this.control?this.control.getError(o,f):null}},Ym=class extends _1{get formDirective(){return null}get path(){return null}},vf=class extends _1{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},y1=class{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},Qj={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},yY=Li($t({},Qj),{"[class.ng-submitted]":"isSubmitted"}),fO=(()=>{let o=class o extends y1{constructor(u){super(u)}};o.\u0275fac=function(g){return new(g||o)(Xn(vf,2))},o.\u0275dir=io({type:o,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(g,r){g&2&&qu("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Ks]});let s=o;return s})(),pO=(()=>{let o=class o extends y1{constructor(u){super(u)}};o.\u0275fac=function(g){return new(g||o)(Xn(Ym,10))},o.\u0275dir=io({type:o,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(g,r){g&2&&qu("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Ks]});let s=o;return s})();var Zm="VALID",m1="INVALID",yf="PENDING",Qm="DISABLED";function mO(s){return(A1(s)?s.validators:s)||null}function Yj(s){return Array.isArray(s)?lO(s):s||null}function gO(s,o){return(A1(o)?o.asyncValidators:s)||null}function Xj(s){return Array.isArray(s)?uO(s):s||null}function A1(s){return s!=null&&!Array.isArray(s)&&typeof s=="object"}function Kj(s,o,f){let u=s.controls;if(!(o?Object.keys(u):u).length)throw new mn(1e3,"");if(!u[f])throw new mn(1001,"")}function Jj(s,o,f){s._forEachChild((u,g)=>{if(f[g]===void 0)throw new mn(1002,"")})}var v1=class{constructor(o,f){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(o),this._assignAsyncValidators(f)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===Zm}get invalid(){return this.status===m1}get pending(){return this.status==yf}get disabled(){return this.status===Qm}get enabled(){return this.status!==Qm}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._assignValidators(o)}setAsyncValidators(o){this._assignAsyncValidators(o)}addValidators(o){this.setValidators(WP(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(WP(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(ZP(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(ZP(o,this._rawAsyncValidators))}hasValidator(o){return g1(this._rawValidators,o)}hasAsyncValidator(o){return g1(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(f=>{f.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(f=>{f.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=yf,o.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){let f=this._parentMarkedDirty(o.onlySelf);this.status=Qm,this.errors=null,this._forEachChild(u=>{u.disable(Li($t({},o),{onlySelf:!0}))}),this._updateValue(),o.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Li($t({},o),{skipPristineCheck:f})),this._onDisabledChange.forEach(u=>u(!0))}enable(o={}){let f=this._parentMarkedDirty(o.onlySelf);this.status=Zm,this._forEachChild(u=>{u.enable(Li($t({},o),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors(Li($t({},o),{skipPristineCheck:f})),this._onDisabledChange.forEach(u=>u(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Zm||this.status===yf)&&this._runAsyncValidator(o.emitEvent)),o.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(f=>f._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Qm:Zm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=yf,this._hasOwnPendingAsyncValidator=!0;let f=iO(this.asyncValidator(this));this._asyncValidationSubscription=f.subscribe(u=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(u,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,f={}){this.errors=o,this._updateControlsErrors(f.emitEvent!==!1)}get(o){let f=o;return f==null||(Array.isArray(f)||(f=f.split(".")),f.length===0)?null:f.reduce((u,g)=>u&&u._find(g),this)}getError(o,f){let u=f?this.get(f):this;return u&&u.errors?u.errors[o]:null}hasError(o,f){return!!this.getError(o,f)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new lr,this.statusChanges=new lr}_calculateStatus(){return this._allControlsDisabled()?Qm:this.errors?m1:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yf)?yf:this._anyControlsHaveStatus(m1)?m1:Zm}_anyControlsHaveStatus(o){return this._anyControls(f=>f.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){A1(o)&&o.updateOn!=null&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){let f=this._parent&&this._parent.dirty;return!o&&!!f&&!this._parent._anyControlsDirty()}_find(o){return null}_assignValidators(o){this._rawValidators=Array.isArray(o)?o.slice():o,this._composedValidatorFn=Yj(this._rawValidators)}_assignAsyncValidators(o){this._rawAsyncValidators=Array.isArray(o)?o.slice():o,this._composedAsyncValidatorFn=Xj(this._rawAsyncValidators)}},x1=class extends v1{constructor(o,f,u){super(mO(f),gO(u,f)),this.controls=o,this._initObservables(),this._setUpdateStrategy(f),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(o,f){return this.controls[o]?this.controls[o]:(this.controls[o]=f,f.setParent(this),f._registerOnCollectionChange(this._onCollectionChange),f)}addControl(o,f,u={}){this.registerControl(o,f),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}removeControl(o,f={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}setControl(o,f,u={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],f&&this.registerControl(o,f),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}contains(o){return this.controls.hasOwnProperty(o)&&this.controls[o].enabled}setValue(o,f={}){Jj(this,!0,o),Object.keys(o).forEach(u=>{Kj(this,!0,u),this.controls[u].setValue(o[u],{onlySelf:!0,emitEvent:f.emitEvent})}),this.updateValueAndValidity(f)}patchValue(o,f={}){o!=null&&(Object.keys(o).forEach(u=>{let g=this.controls[u];g&&g.patchValue(o[u],{onlySelf:!0,emitEvent:f.emitEvent})}),this.updateValueAndValidity(f))}reset(o={},f={}){this._forEachChild((u,g)=>{u.reset(o?o[g]:null,{onlySelf:!0,emitEvent:f.emitEvent})}),this._updatePristine(f),this._updateTouched(f),this.updateValueAndValidity(f)}getRawValue(){return this._reduceChildren({},(o,f,u)=>(o[u]=f.getRawValue(),o))}_syncPendingControls(){let o=this._reduceChildren(!1,(f,u)=>u._syncPendingControls()?!0:f);return o&&this.updateValueAndValidity({onlySelf:!0}),o}_forEachChild(o){Object.keys(this.controls).forEach(f=>{let u=this.controls[f];u&&o(u,f)})}_setUpControls(){this._forEachChild(o=>{o.setParent(this),o._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(o){for(let[f,u]of Object.entries(this.controls))if(this.contains(f)&&o(u))return!0;return!1}_reduceValue(){let o={};return this._reduceChildren(o,(f,u,g)=>((u.enabled||this.disabled)&&(f[g]=u.value),f))}_reduceChildren(o,f){let u=o;return this._forEachChild((g,r)=>{u=f(u,g,r)}),u}_allControlsDisabled(){for(let o of Object.keys(this.controls))if(this.controls[o].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(o){return this.controls.hasOwnProperty(o)?this.controls[o]:null}};var T1=new wn("CallSetDisabledState",{providedIn:"root",factory:()=>S1}),S1="always";function KD(s,o,f=S1){eC(s,o),o.valueAccessor.writeValue(s.value),(s.disabled||f==="always")&&o.valueAccessor.setDisabledState?.(s.disabled),t9(s,o),i9(s,o),n9(s,o),e9(s,o)}function b1(s,o,f=!0){let u=()=>{};o.valueAccessor&&(o.valueAccessor.registerOnChange(u),o.valueAccessor.registerOnTouched(u)),D1(s,o),s&&(o._invokeOnDestroyCallbacks(),s._registerOnCollectionChange(()=>{}))}function w1(s,o){s.forEach(f=>{f.registerOnValidatorChange&&f.registerOnValidatorChange(o)})}function e9(s,o){if(o.valueAccessor.setDisabledState){let f=u=>{o.valueAccessor.setDisabledState(u)};s.registerOnDisabledChange(f),o._registerOnDestroy(()=>{s._unregisterOnDisabledChange(f)})}}function eC(s,o){let f=hO(s);o.validator!==null?s.setValidators(qP(f,o.validator)):typeof f=="function"&&s.setValidators([f]);let u=dO(s);o.asyncValidator!==null?s.setAsyncValidators(qP(u,o.asyncValidator)):typeof u=="function"&&s.setAsyncValidators([u]);let g=()=>s.updateValueAndValidity();w1(o._rawValidators,g),w1(o._rawAsyncValidators,g)}function D1(s,o){let f=!1;if(s!==null){if(o.validator!==null){let g=hO(s);if(Array.isArray(g)&&g.length>0){let r=g.filter(E=>E!==o.validator);r.length!==g.length&&(f=!0,s.setValidators(r))}}if(o.asyncValidator!==null){let g=dO(s);if(Array.isArray(g)&&g.length>0){let r=g.filter(E=>E!==o.asyncValidator);r.length!==g.length&&(f=!0,s.setAsyncValidators(r))}}}let u=()=>{};return w1(o._rawValidators,u),w1(o._rawAsyncValidators,u),f}function t9(s,o){o.valueAccessor.registerOnChange(f=>{s._pendingValue=f,s._pendingChange=!0,s._pendingDirty=!0,s.updateOn==="change"&&_O(s,o)})}function n9(s,o){o.valueAccessor.registerOnTouched(()=>{s._pendingTouched=!0,s.updateOn==="blur"&&s._pendingChange&&_O(s,o),s.updateOn!=="submit"&&s.markAsTouched()})}function _O(s,o){s._pendingDirty&&s.markAsDirty(),s.setValue(s._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(s._pendingValue),s._pendingChange=!1}function i9(s,o){let f=(u,g)=>{o.valueAccessor.writeValue(u),g&&o.viewToModelUpdate(u)};s.registerOnChange(f),o._registerOnDestroy(()=>{s._unregisterOnChange(f)})}function r9(s,o){s==null,eC(s,o)}function o9(s,o){return D1(s,o)}function s9(s,o){if(!s.hasOwnProperty("model"))return!1;let f=s.model;return f.isFirstChange()?!0:!Object.is(o,f.currentValue)}function a9(s){return Object.getPrototypeOf(s.constructor)===JD}function l9(s,o){s._syncPendingControls(),o.forEach(f=>{let u=f.control;u.updateOn==="submit"&&u._pendingChange&&(f.viewToModelUpdate(u._pendingValue),u._pendingChange=!1)})}function c9(s,o){if(!o)return null;Array.isArray(o);let f,u,g;return o.forEach(r=>{r.constructor===E1?f=r:a9(r)?u=r:g=r}),g||u||f||null}function u9(s,o){let f=s.indexOf(o);f>-1&&s.splice(f,1)}function QP(s,o){let f=s.indexOf(o);f>-1&&s.splice(f,1)}function YP(s){return typeof s=="object"&&s!==null&&Object.keys(s).length===2&&"value"in s&&"disabled"in s}var Ca=class extends v1{constructor(o=null,f,u){super(mO(f),gO(u,f)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(f),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),A1(f)&&(f.nonNullable||f.initialValueIsDefault)&&(YP(o)?this.defaultValue=o.value:this.defaultValue=o)}setValue(o,f={}){this.value=this._pendingValue=o,this._onChange.length&&f.emitModelToViewChange!==!1&&this._onChange.forEach(u=>u(this.value,f.emitViewToModelChange!==!1)),this.updateValueAndValidity(f)}patchValue(o,f={}){this.setValue(o,f)}reset(o=this.defaultValue,f={}){this._applyFormState(o),this.markAsPristine(f),this.markAsUntouched(f),this.setValue(this.value,f),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){QP(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){QP(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(o){YP(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}};var h9=s=>s instanceof Ca;var yO=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275dir=io({type:o,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let s=o;return s})(),d9={provide:C1,useExisting:nl(()=>tC),multi:!0},tC=(()=>{let o=class o extends JD{writeValue(u){let g=u??"";this.setProperty("value",g)}registerOnChange(u){this.onChange=g=>{u(g==""?null:parseFloat(g))}}};o.\u0275fac=(()=>{let u;return function(r){return(u||(u=Hu(o)))(r||o)}})(),o.\u0275dir=io({type:o,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(g,r){g&1&&yo("input",function(I){return r.onChange(I.target.value)})("blur",function(){return r.onTouched()})},features:[Wu([d9]),Ks]});let s=o;return s})(),f9={provide:C1,useExisting:nl(()=>nC),multi:!0};var p9=(()=>{let o=class o{constructor(){this._accessors=[]}add(u,g){this._accessors.push([u,g])}remove(u){for(let g=this._accessors.length-1;g>=0;--g)if(this._accessors[g][1]===u){this._accessors.splice(g,1);return}}select(u){this._accessors.forEach(g=>{this._isSameGroup(g,u)&&g[1]!==u&&g[1].fireUncheck(u.value)})}_isSameGroup(u,g){return u[0].control?u[0]._parent===g._control._parent&&u[1].name===g.name:!1}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),nC=(()=>{let o=class o extends JD{constructor(u,g,r,E){super(u,g),this._registry=r,this._injector=E,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=Ot(T1,{optional:!0})??S1}ngOnInit(){this._control=this._injector.get(vf),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(u){this._state=u===this.value,this.setProperty("checked",this._state)}registerOnChange(u){this._fn=u,this.onChange=()=>{u(this.value),this._registry.select(this)}}setDisabledState(u){(this.setDisabledStateFired||u||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",u),this.setDisabledStateFired=!0}fireUncheck(u){this.writeValue(u)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}};o.\u0275fac=function(g){return new(g||o)(Xn(dc),Xn(Fo),Xn(p9),Xn(_o))},o.\u0275dir=io({type:o,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(g,r){g&1&&yo("change",function(){return r.onChange()})("blur",function(){return r.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[Wu([f9]),Ks]});let s=o;return s})();var vO=new wn(""),m9={provide:vf,useExisting:nl(()=>iC)},iC=(()=>{let o=class o extends vf{set isDisabled(u){}constructor(u,g,r,E,I){super(),this._ngModelWarningConfig=E,this.callSetDisabledState=I,this.update=new lr,this._ngModelWarningSent=!1,this._setValidators(u),this._setAsyncValidators(g),this.valueAccessor=c9(this,r)}ngOnChanges(u){if(this._isControlChanged(u)){let g=u.form.previousValue;g&&b1(g,this,!1),KD(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}s9(u,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&b1(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(u){this.viewModel=u,this.update.emit(u)}_isControlChanged(u){return u.hasOwnProperty("form")}};o._ngModelWarningSentOnce=!1,o.\u0275fac=function(g){return new(g||o)(Xn(JP,10),Xn(eO,10),Xn(C1,10),Xn(vO,8),Xn(T1,8))},o.\u0275dir=io({type:o,selectors:[["","formControl",""]],inputs:{form:[Jr.None,"formControl","form"],isDisabled:[Jr.None,"disabled","isDisabled"],model:[Jr.None,"ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Wu([m9]),Ks,sl]});let s=o;return s})(),g9={provide:Ym,useExisting:nl(()=>rC)},rC=(()=>{let o=class o extends Ym{constructor(u,g,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new lr,this._setValidators(u),this._setAsyncValidators(g)}ngOnChanges(u){this._checkFormPresent(),u.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(D1(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(u){let g=this.form.get(u.path);return KD(g,u,this.callSetDisabledState),g.updateValueAndValidity({emitEvent:!1}),this.directives.push(u),g}getControl(u){return this.form.get(u.path)}removeControl(u){b1(u.control||null,u,!1),u9(this.directives,u)}addFormGroup(u){this._setUpFormContainer(u)}removeFormGroup(u){this._cleanUpFormContainer(u)}getFormGroup(u){return this.form.get(u.path)}addFormArray(u){this._setUpFormContainer(u)}removeFormArray(u){this._cleanUpFormContainer(u)}getFormArray(u){return this.form.get(u.path)}updateModel(u,g){this.form.get(u.path).setValue(g)}onSubmit(u){return this.submitted=!0,l9(this.form,this.directives),this.ngSubmit.emit(u),u?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(u=void 0){this.form.reset(u),this.submitted=!1}_updateDomValue(){this.directives.forEach(u=>{let g=u.control,r=this.form.get(u.path);g!==r&&(b1(g||null,u),h9(r)&&(KD(r,u,this.callSetDisabledState),u.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(u){let g=this.form.get(u.path);r9(g,u),g.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(u){if(this.form){let g=this.form.get(u.path);g&&o9(g,u)&&g.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){eC(this.form,this),this._oldForm&&D1(this._oldForm,this)}_checkFormPresent(){this.form}};o.\u0275fac=function(g){return new(g||o)(Xn(JP,10),Xn(eO,10),Xn(T1,8))},o.\u0275dir=io({type:o,selectors:[["","formGroup",""]],hostBindings:function(g,r){g&1&&yo("submit",function(I){return r.onSubmit(I)})("reset",function(){return r.onReset()})},inputs:{form:[Jr.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wu([g9]),Ks,sl]});let s=o;return s})();var _9=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var xO=(()=>{let o=class o{static withConfig(u){return{ngModule:o,providers:[{provide:vO,useValue:u.warnOnNgModelWithFormControl??"always"},{provide:T1,useValue:u.callSetDisabledState??S1}]}}};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({imports:[_9]});let s=o;return s})();var Km=gb(aC());var Ea=class{constructor(o){this.addressFrom=o&&o.addressFrom||"",this.addressTo=o&&o.addressTo||"",this.date=o&&o.date||new Date,this.time=o&&o.time||new Date().getTime(),this.mobile=o&&o.mobile||0,this.paymentMethod=o&&o.paymentMethod||"",this.cardNumber=o&&o.cardNumber||0,this.cardMonth=o&&o.cardMonth||0,this.cardYear=o&&o.cardYear||0,this.price=o&&o.price||0,this.range=o&&o.range||0,this.id=o&&o.id||0}};var fv=gb(MR());var xf=(()=>{let o=class o{setRide(u){this.ride.next(u)}constructor(){this.obj={addressFrom:"Novi Sad, South Ba\u010Dka District, Serbia",addressTo:"Sombor, West Ba\u010Dka District, Serbia",date:"2024-06-18",time:"12:05",mobile:"+38162134567",paymentMethod:"cash",cardNumber:"",cardMonth:"",cardYear:"",price:100,range:116789/1e3,id:1},this.ride=new Sr(new Ea(this.obj)),this.getRide=this.ride.asObservable(),this.key="123"}saveData(u,g){localStorage.setItem(u,this.encrypt(g))}getData(u){let g=localStorage.getItem(u)||"";return this.decrypt(g)}removeData(u){localStorage.removeItem(u)}clearData(){localStorage.clear()}encrypt(u){return fv.default.AES.encrypt(u,this.key).toString()}decrypt(u){return fv.default.AES.decrypt(u,this.key).toString(fv.default.enc.Utf8)}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function v9(s,o){if(s&1&&(rn(0,"div",25)(1,"label",26),vn(2,"Card number"),Jt(),ur(3,"input",27),rn(4,"label",28),vn(5,"Card expiration date"),Jt(),rn(6,"div",29),ur(7,"input",30)(8,"input",31),Jt()()),s&2){let f=U2();ui(3),cr("formControl",f.form.controls.cardNumber),ui(4),cr("formControl",f.form.controls.cardMonth),ui(),cr("formControl",f.form.controls.cardYear)}}var FR=(()=>{let o=class o{constructor(u,g){this.router=u,this.service=g,this.creditCard=!1,this.range=0,this.form=new x1({date:new Ca(new Date,Ir.required),time:new Ca(Ir.required),phoneNumber:new Ca("",Ir.required),kes:new Ca,card:new Ca,cardNumber:new Ca("",Ir.required),cardMonth:new Ca([Ir.required,Ir.min(1),Ir.max(12)]),cardYear:new Ca([Ir.required,Ir.min(21),Ir.max(28)])})}ngOnInit(){Km.default.accessToken="pk.eyJ1IjoibWF0cmljZTk5IiwiYSI6ImNseDMyMW0yaDAyMjIyanNjZ3FibHg0Mm0ifQ.jkz2w06NI6-ILfDnqXoHRw",navigator.geolocation.getCurrentPosition(u,g,{enableHighAccuracy:!0});function u(E){r([E.coords.longitude,E.coords.latitude])}function g(){r([45.2396,19.8227])}let r=E=>{let I=new Km.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:E,zoom:1}),O=new Km.default.NavigationControl;I.addControl(O),I.addControl(new MapboxDirections({accessToken:Km.default.accessToken,unit:"metric"}).on("route",U=>{let V=U.route[0].distance;this.range=V.toFixed(),this.calculatePrice(this.range)}),"top-left"),I.loaded()===!1&&(document.getElementsByClassName("mapbox-directions-clearfix")[0].style.display="none")};if(this.router.navigated===!0){let E=document.getElementById("hamburger");E.checked===!0&&(E.checked=!1)}this.service.saveData("arrayOfRides",JSON.stringify([]))}calculatePrice(u){let g=u/1e3*2;this.price=Number(g.toFixed())}onSubmit(){let u={addressFrom:document.getElementById("mapbox-directions-origin-input").children[0].children[1].value,addressTo:document.getElementById("mapbox-directions-destination-input").children[0].children[1].value,date:this.form.controls.date.value,time:this.form.controls.time.value,mobile:this.form.controls.phoneNumber.value,paymentMethod:this.creditCard?this.form.controls.card.value:this.form.controls.kes.value,cardNumber:this.form.controls.cardNumber.value,cardMonth:this.form.controls.cardMonth.value,cardYear:this.form.controls.cardYear.value,price:this.price,range:this.range/1e3,id:Math.floor(Math.random()*1e5)},g=new Ea(u);this.service.setRide(g);let E=[...JSON.parse(this.service.getData("arrayOfRides"))];E.push(u),this.service.saveData("arrayOfRides",JSON.stringify([...E])),this.router.navigate(["list"])}focus(u){u.scrollIntoView({behavior:"smooth"})}toggleCard(u){u.target.value==="cash"?(this.creditCard=!1,this.form.controls.cardNumber.clearValidators(),this.form.controls.cardMonth.clearValidators(),this.form.controls.cardYear.clearValidators(),this.form.get("cardNumber")?.updateValueAndValidity(),this.form.get("cardMonth")?.updateValueAndValidity(),this.form.get("cardYear")?.updateValueAndValidity()):(this.creditCard=!0,this.form.get("cardNumber")?.setValidators([Ir.required]),this.form.get("cardMonth")?.setValidators([Ir.required,Ir.min(1),Ir.max(12)]),this.form.get("cardYear")?.setValidators([Ir.required,Ir.min(21),Ir.max(28)]),this.form.get("cardNumber")?.updateValueAndValidity(),this.form.get("cardMonth")?.updateValueAndValidity(),this.form.get("cardYear")?.updateValueAndValidity())}};o.\u0275fac=function(g){return new(g||o)(Xn($o),Xn(xf))},o.\u0275cmp=no({type:o,selectors:[["app-home-page"]],decls:42,vars:9,consts:[["target",""],[1,"hero"],[1,"left"],[3,"click"],[1,"right"],["src","assets/Taxi Slika.png","alt","taxiImage"],[1,"formSection"],[1,"mapSeciton"],["id","map"],["id","form",1,"form"],[3,"formGroup"],["for","date"],["type","date","name","date","id","date",3,"formControl"],["for","time"],["type","time","name","time","id","time",3,"formControl"],["for","phoneNumber"],["type","text","name","phoneNumber","id","phoneNumber","placeholder","+38161234567",3,"formControl"],[1,"paymentMethod"],["for","payment"],["type","radio","name","payment","id","payment","value","cash",3,"change","formControl"],["for","payment1"],["type","radio","name","payment","id","payment1","value","card",3,"change","formControl"],["class","card",4,"ngIf"],[1,"priceAndSubmit"],[3,"click","disabled"],[1,"card"],["for","cardNumber"],["type","text","name","cardNumber","id","cardNumber",3,"formControl"],["for","cardDate"],[1,"wrapperCardDate"],["type","number","name","cardDate","id","cardDate","placeholder","MM",3,"formControl"],["type","number","name","cardDate","id","cardDate1","placeholder","YY",3,"formControl"]],template:function(g,r){if(g&1){let E=L2();rn(0,"div",1)(1,"div",2)(2,"h1"),vn(3,"Get Moving Faster "),ur(4,"br"),vn(5,"Your Go-To Taxi Solution!"),Jt(),rn(6,"p"),vn(7," Get where you need to go faster with our taxi app! Simply tap, ride, and arrive hassle-free. No more waiting on the curb or struggling to find a cab. Reserve now for seamless travel! "),Jt(),rn(8,"button",3),yo("click",function(){Kd(E);let O=j2(16);return Jd(r.focus(O))}),vn(9,"Reserve"),Jt()(),rn(10,"div",4),ur(11,"img",5),Jt()(),rn(12,"div",6)(13,"div",7),ur(14,"div",8),Jt(),rn(15,"div",9,0)(17,"form",10)(18,"label",11),vn(19,"Date"),Jt(),ur(20,"input",12),rn(21,"label",13),vn(22,"Time"),Jt(),ur(23,"input",14),rn(24,"label",15),vn(25,"Mobile number"),Jt(),ur(26,"input",16),rn(27,"p"),vn(28,"Payment method"),Jt(),rn(29,"div",17)(30,"label",18),vn(31,"Cash"),Jt(),rn(32,"input",19),yo("change",function(O){return Kd(E),Jd(r.toggleCard(O))}),Jt(),rn(33,"label",20),vn(34,"Card"),Jt(),rn(35,"input",21),yo("change",function(O){return Kd(E),Jd(r.toggleCard(O))}),Jt()(),Qd(36,v9,9,3,"div",22),rn(37,"div",23)(38,"h4"),vn(39),Jt(),rn(40,"button",24),yo("click",function(){return Kd(E),Jd(r.onSubmit())}),vn(41,"Book now"),Jt()()()()()}g&2&&(ui(17),cr("formGroup",r.form),ui(3),cr("formControl",r.form.controls.date),ui(3),cr("formControl",r.form.controls.time),ui(3),cr("formControl",r.form.controls.phoneNumber),ui(6),cr("formControl",r.form.controls.kes),ui(3),cr("formControl",r.form.controls.card),ui(),cr("ngIf",r.creditCard),ui(3),ro("",r.price,"\u20AC"),ui(),cr("disabled",r.form.invalid))},dependencies:[jF,yO,E1,tC,nC,fO,pO,iC,rC],styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.hero[_ngcontent-%COMP%]{width:100%;padding:60px 50px 50px;display:flex;justify-content:space-between;align-items:center}.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{width:40%;position:relative}.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3rem;margin:0 10px 30px 0}.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:80%;margin:30px 10px 30px 0;background:url("./media/Brush-SWA5OX3B.png");background-repeat:no-repeat;background-size:200%;background-position:100%;padding:50px 15px;border-radius:15px}.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;outline:none;padding:10px 25px;background-color:#040404;color:#fff;border-radius:15px;font-weight:700;font-size:1rem;cursor:pointer}.hero[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:60%}.hero[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.formSection[_ngcontent-%COMP%]{width:100%;padding:30px 50px 50px;display:flex;justify-content:space-between}.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:40rem;height:40rem;border-radius:20px;margin:0 15px 0 0}.form[_ngcontent-%COMP%]{width:48%;padding:0 20px;background-color:#040404;border-radius:20px}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;padding:2.5rem}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:200px;width:80%;border:none;outline:none;padding:10px;background-color:#dbdbdb;color:#000;border-radius:10px;margin:10px 0 20px}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#fff}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:80%;display:flex;flex-direction:column;background:unset}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   [id=cardNumber][_ngcontent-%COMP%]{width:unset}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .wrapperCardDate[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-start}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   [id=cardDate][_ngcontent-%COMP%]{width:20%;min-width:unset;margin-right:20px}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   [id=cardDate1][_ngcontent-%COMP%]{width:20%;min-width:unset}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .priceAndSubmit[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:space-between;margin-top:auto}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .priceAndSubmit[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#fff;font-size:2rem}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 50px;border-radius:10px;border:none;font-weight:700;outline:none;cursor:pointer}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:0 0 20px}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .paymentMethod[_ngcontent-%COMP%]{width:80%;display:flex;justify-content:space-between;align-items:center;margin:0 0 20px}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .paymentMethod[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40%;min-width:unset;margin:unset}@media screen and (max-width: 1158px){.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .hero[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:50%}}@media screen and (max-width: 1175px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:30rem;height:30rem}}@media screen and (max-width: 992px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:25rem;height:25rem}}@media screen and (max-width: 945px){.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem}.form[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 30px}}@media screen and (max-width: 900px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:20rem;height:20rem}}@media screen and (max-width: 810px){.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{width:60%}.hero[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:40%}}@media screen and (max-width: 768px){.hero[_ngcontent-%COMP%]{flex-wrap:wrap}.hero[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .hero[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{width:100%}.formSection[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:35rem;height:35rem;margin:unset;margin-bottom:30px}.form[_ngcontent-%COMP%]{width:100%}}@media screen and (max-width: 610px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:30rem;height:30rem}}@media screen and (max-width: 540px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:25rem;height:25rem}}@media screen and (max-width: 490px){.formSection[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:20rem;height:20rem}}']});let s=o;return s})();var x9=s=>[s];function b9(s,o){if(s&1&&(rn(0,"tr")(1,"td")(2,"a",3),vn(3),Jt()(),rn(4,"td"),vn(5),Jt(),rn(6,"td"),vn(7),Jt(),rn(8,"td"),vn(9),Jt()()),s&2){let f=o.$implicit;ui(2),cr("routerLink",G2(5,x9,"/list/"+f.id)),ui(),ro(" ",f.addressFrom," "),ui(2),rf(f.addressTo),ui(2),rf(f.date),ui(2),rf(f.time)}}var PR=(()=>{let o=class o{constructor(u,g){this.router=u,this.service=g,this.ride=new Ea,this.booked=[],this.creditCard=!1,this.allRides=[],this.service.getRide.subscribe(r=>{this.booked.push(r),r.paymentMethod==="cash"?this.creditCard=!1:this.creditCard=!0})}ngOnInit(){if(this.allRides=JSON.parse(this.service.getData("arrayOfRides")),this.router.navigated===!0){let u=document.getElementById("hamburger");u.checked===!0&&(u.checked=!1)}}};o.\u0275fac=function(g){return new(g||o)(Xn($o),Xn(xf))},o.\u0275cmp=no({type:o,selectors:[["app-list"]],decls:18,vars:0,consts:[[1,"listWrapper"],[1,"list"],[1,"table"],[3,"routerLink"]],template:function(g,r){g&1&&(rn(0,"div",0)(1,"div",1)(2,"h2"),vn(3,"Order history"),Jt(),rn(4,"table",2)(5,"thead")(6,"tr")(7,"td"),vn(8,"Starting place"),Jt(),rn(9,"td"),vn(10,"Destination"),Jt(),rn(11,"td"),vn(12,"Date"),Jt(),rn(13,"td"),vn(14,"Time"),Jt()()(),rn(15,"tbody"),B2(16,b9,10,7,"tr",null,yF),Jt()()()()),g&2&&(ui(16),N2(r.allRides))},dependencies:[gf],styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.listWrapper[_ngcontent-%COMP%]{height:60%;min-height:fit-content;width:100%}.listWrapper[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;margin:50px 0;padding:0 50px}.listWrapper[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{padding:.5rem}@media screen and (max-width: 570px){.listWrapper[_ngcontent-%COMP%]{height:unset}}']});let s=o;return s})();var Jm=gb(aC());var OR=(()=>{let o=class o{constructor(u,g){this.service=u,this.router=g,this.ride=new Ea}ngOnInit(){let u=this.router.routerState.snapshot.url.substring(6),g=JSON.parse(this.service.getData("arrayOfRides"));for(let O of g)O.id==u&&(this.ride=O);Jm.default.accessToken="pk.eyJ1IjoibWF0cmljZTk5IiwiYSI6ImNseDMyMW0yaDAyMjIyanNjZ3FibHg0Mm0ifQ.jkz2w06NI6-ILfDnqXoHRw",navigator.geolocation.getCurrentPosition(r,E,{enableHighAccuracy:!0});function r(O){I([O.coords.longitude,O.coords.latitude])}function E(){I([45.2396,19.8227])}let I=O=>{let U=new Jm.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:O,zoom:8}),V=new Jm.default.NavigationControl;U.addControl(V),U.addControl(new MapboxDirections({accessToken:Jm.default.accessToken,unit:"metric"}),"top-left"),U.loaded()===!1&&(document.getElementsByClassName("mapbox-directions-clearfix")[0].style.display="none",document.getElementById("mapbox-directions-origin-input").children[0].children[1].value=this.ride.addressFrom,document.getElementById("mapbox-directions-destination-input").children[0].children[1].value=this.ride.addressTo)}}};o.\u0275fac=function(g){return new(g||o)(Xn(xf),Xn($o))},o.\u0275cmp=no({type:o,selectors:[["app-details"]],decls:40,vars:9,consts:[[1,"detailsWrapper"],[1,"details"],[1,"infoSection"],[1,"map"],["id","map"]],template:function(g,r){g&1&&(rn(0,"div",0)(1,"h2"),vn(2),Jt(),rn(3,"div",1)(4,"div",2)(5,"ul")(6,"li")(7,"span"),vn(8,"Starting location:"),Jt(),vn(9),Jt(),rn(10,"li")(11,"span"),vn(12,"Destination:"),Jt(),vn(13),Jt(),rn(14,"li")(15,"span"),vn(16,"Date:"),Jt(),vn(17),Jt(),rn(18,"li")(19,"span"),vn(20,"Time:"),Jt(),vn(21),Jt(),rn(22,"li")(23,"span"),vn(24,"Mobile number:"),Jt(),vn(25),Jt(),rn(26,"li")(27,"span"),vn(28,"Payment method:"),Jt(),vn(29),Jt(),rn(30,"li")(31,"span"),vn(32,"Price:"),Jt(),vn(33),Jt(),rn(34,"li")(35,"span"),vn(36,"Range:"),Jt(),vn(37),Jt()()(),rn(38,"div",3),ur(39,"div",4),Jt()()()),g&2&&(ui(2),ro("Ride: ",r.ride.id,""),ui(7),ro(" ",r.ride.addressFrom,""),ui(4),ro(" ",r.ride.addressTo,""),ui(4),ro(" ",r.ride.date,""),ui(4),ro(" ",r.ride.time,""),ui(4),ro(" ",r.ride.mobile,""),ui(4),ro(" ",r.ride.paymentMethod,""),ui(4),ro(" ",r.ride.price," \u20AC"),ui(4),ro(" ",r.ride.range," km"))},styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.detailsWrapper[_ngcontent-%COMP%]{width:100%;padding:60px 50px 50px}.detailsWrapper[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 30px}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .infoSection[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:unset}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .infoSection[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:1rem;padding:8px 0}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .infoSection[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:35rem;height:20rem;margin-left:30px}@media screen and (max-width: 992px){.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:25rem}}@media screen and (max-width: 768px){.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:35rem;margin-left:unset}}@media screen and (max-width: 630px){.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:25rem}}@media screen and (max-width: 500px){.detailsWrapper[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .map[_ngcontent-%COMP%]   #map[_ngcontent-%COMP%]{width:18rem}}']});let s=o;return s})();var w9=[{path:"list/:id",component:OR},{path:"list",component:PR},{path:"",component:FR}],RR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({imports:[YD.forRoot(w9),YD]});let s=o;return s})();var D9=()=>["/"],kR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["app-footer"]],decls:12,vars:2,consts:[[1,"logo",3,"routerLink"],["src","assets/logo.png","alt","logoImage"],[1,"social"],["href","https://github.com/DanijelOsovnikar","target","_blank"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24"],["d","M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"],["href","https://linkedin.com/in/danijel-osovnikar-9395a0276","target","_blank"],["d","M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"]],template:function(g,r){g&1&&(rn(0,"footer")(1,"a",0),ur(2,"img",1),rn(3,"h1"),vn(4,"UrbanRide"),Jt()(),rn(5,"div",2)(6,"a",3),d2(),rn(7,"svg",4),ur(8,"path",5),Jt()(),rM(),rn(9,"a",6),d2(),rn(10,"svg",4),ur(11,"path",7),Jt()()()()),g&2&&(ui(),cr("routerLink",pc(1,D9)))},dependencies:[gf],styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}footer[_ngcontent-%COMP%]{width:100%;margin-top:2rem;padding:50px;display:flex;justify-content:space-between;align-items:center;background-color:#040404}footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:3rem;text-decoration:none;display:flex;align-items:center}footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;margin:0 15px 0 0}footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;color:#fff}footer[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{width:5rem;display:flex;justify-content:space-between;align-items:center}footer[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{opacity:.8}footer[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#fcbe03}']});let s=o;return s})();var hC=()=>["/"],BR=()=>["list"],NR=(()=>{let o=class o{focus(){document.getElementById("form").scrollIntoView({behavior:"smooth"})}};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["app-header"]],decls:20,vars:10,consts:[[1,"nav"],[1,"hamburgerMenu"],["type","checkbox","id","hamburger"],[1,"sidebar"],[3,"routerLink"],["src","assets/logo.png","alt","logoImage",1,"logo"],[1,"navigation"],[1,"reserve",3,"click"]],template:function(g,r){g&1&&(rn(0,"div",0)(1,"label",1),ur(2,"input",2),Jt(),rn(3,"aside",3)(4,"nav")(5,"a",4),vn(6,"Home"),Jt(),rn(7,"a",4),vn(8,"Order history"),Jt()()(),rn(9,"a",4),ur(10,"img",5),rn(11,"h1"),vn(12,"UrbanRide"),Jt()(),rn(13,"div",6)(14,"a",4),vn(15,"Home"),Jt(),rn(16,"a",4),vn(17,"Order history"),Jt(),rn(18,"div",7),yo("click",function(){return r.focus()}),vn(19,"Reserve"),Jt()()()),g&2&&(ui(5),cr("routerLink",pc(5,hC)),ui(2),cr("routerLink",pc(6,BR)),ui(2),cr("routerLink",pc(7,hC)),ui(5),cr("routerLink",pc(8,hC)),ui(2),cr("routerLink",pc(9,BR)))},dependencies:[gf],styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}.nav[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;align-items:center;padding:30px 50px;position:relative}.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:40%}.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#040404;font-weight:700;font-size:1.2rem}.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .reserve[_ngcontent-%COMP%]{background-color:#191920;padding:10px 25px;border-radius:15px;color:#fff;font-weight:700}.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .reserve[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#585858}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:4px;width:max-content;position:absolute;left:25px;top:43px;z-index:2;cursor:pointer}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:28px;height:4px;background-color:#040404;appearance:none;border-radius:10px;outline:none;pointer-events:none;transition:opacity .2s ease-in-out,width .2s ease-in-out}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked{opacity:0;width:0}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]:has(input:checked):before{rotate:45deg;width:28.2842712474px;translate:0 -2px}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]:has(input:checked):after{rotate:-45deg;width:28.2842712474px;translate:0 2px}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]:has(input:checked) + .sidebar[_ngcontent-%COMP%]{translate:0}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]:before, .nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]:after{content:"";width:28px;height:4px;background-color:#040404;border-radius:10px;transform-origin:left center;transition:rotate .2s ease-in-out,width .2s ease-in-out,translate .2s ease-in-out}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;display:flex;align-items:center}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:3rem;margin:0 15px 0 0}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;color:#040404;margin:unset}.sidebar[_ngcontent-%COMP%]{transition:translate .2s ease-in-out;translate:-100% 0;background-color:#040404;width:100%;height:91vh;position:absolute;top:100px;display:none;z-index:99}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:2rem;color:#fff;text-decoration:none;margin:10px 5px;transition:color .2s ease-in-out}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#fcbe03}@media screen and (max-width: 992px){.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{width:50%}}@media screen and (max-width: 768px){.nav[_ngcontent-%COMP%]{justify-content:center;padding:30px 0}.nav[_ngcontent-%COMP%]   .hamburgerMenu[_ngcontent-%COMP%]{display:flex}.nav[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{display:none}.sidebar[_ngcontent-%COMP%]{display:block}}']});let s=o;return s})();var LR=(()=>{let o=class o{constructor(){this.title="TaxiApp"}ngOnInit(){}};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["app-root"]],decls:5,vars:0,consts:[[1,"color"]],template:function(g,r){g&1&&(rn(0,"main"),ur(1,"app-header")(2,"div",0)(3,"router-outlet")(4,"app-footer"),Jt())},dependencies:[GD,kR,NR],styles:['@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMzVo0iPw.woff2) format("woff2");unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0330,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2034-2037,U+2057,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2102,U+210A-210E,U+2110-2112,U+2115,U+2119-211D,U+2124,U+2128,U+212C-212D,U+212F-2131,U+2133-2138,U+213C-2140,U+2145-2149,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B6,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShMhVo0iPw.woff2) format("woff2");unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8B1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA88,U+1FA90-1FABD,U+1FABF-1FAC5,U+1FACE-1FADB,U+1FAE0-1FAE8,U+1FAF0-1FAF8,U+1FB00-1FBFF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNBVo0iPw.woff2) format("woff2");unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Kumbh Sans;font-style:normal;font-weight:100 900;font-display:swap;src:url(https://fonts.gstatic.com/s/kumbhsans/v22/c4mw1n92AsfhuCq6tVsaoIx1LQICk0boNoq0ShNPVo0.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}main[_ngcontent-%COMP%]{width:100vw;height:100vh;max-width:1440px;position:relative}main[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:42rem;height:7rem;border-bottom-left-radius:20px;background-color:#fcbe03;z-index:-1}']});let s=o;return s})();var A9=["*"];var T9=["dialog"];var UR={animation:!0,transitionTimerDelayMs:5},S9=(()=>{let o=class o{constructor(){this.animation=UR.animation}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function I9(s){let{transitionDelay:o,transitionDuration:f}=window.getComputedStyle(s),u=parseFloat(o),g=parseFloat(f);return(u+g)*1e3}function zR(s){return typeof s=="string"}function dC(s){return s!=null}function M9(s){return s&&s.then}function VR(s){return(s||document.body).getBoundingClientRect()}function F9(s){return o=>new ti(f=>{let u=E=>s.run(()=>f.next(E)),g=E=>s.run(()=>f.error(E)),r=()=>s.run(()=>f.complete());return o.subscribe({next:u,error:g,complete:r})})}var P9=()=>{},{transitionTimerDelayMs:O9}=UR,pv=new Map,Ku=(s,o,f,u)=>{let g=u.context||{},r=pv.get(o);if(r)switch(u.runningTransition){case"continue":return Xr;case"stop":s.run(()=>r.transition$.complete()),g=Object.assign(r.context,g),pv.delete(o)}let E=f(o,u.animation,g)||P9;if(!u.animation||window.getComputedStyle(o).transitionProperty==="none")return s.run(()=>E()),Sn(void 0).pipe(F9(s));let I=new nr,O=new nr,U=I.pipe(Nb(!0));pv.set(o,{transition$:I,complete:()=>{O.next(),O.complete()},context:g});let V=I9(o);return s.runOutsideAngular(()=>{let Z=Ds(o,"transitionend").pipe(mo(U),Kr(({target:se})=>se===o)),te=Rb(V+O9).pipe(mo(U));kb(te,Z,O).pipe(mo(U)).subscribe(()=>{pv.delete(o),s.run(()=>{E(),I.next(),I.complete()})})}),I.asObservable()};var jR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var GR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var HR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})(),$R=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var mC=function(s){return s[s.Tab=9]="Tab",s[s.Enter=13]="Enter",s[s.Escape=27]="Escape",s[s.Space=32]="Space",s[s.PageUp=33]="PageUp",s[s.PageDown=34]="PageDown",s[s.End=35]="End",s[s.Home=36]="Home",s[s.ArrowLeft=37]="ArrowLeft",s[s.ArrowUp=38]="ArrowUp",s[s.ArrowRight=39]="ArrowRight",s[s.ArrowDown=40]="ArrowDown",s}(mC||{});var AK=(()=>{let s=()=>/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,o=()=>/Android/.test(navigator.userAgent);return typeof navigator<"u"?!!navigator.userAgent&&(s()||o()):!1})();var R9=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function qR(s){let o=Array.from(s.querySelectorAll(R9)).filter(f=>f.tabIndex!==-1);return[o[0],o[o.length-1]]}var k9=(s,o,f,u=!1)=>{s.runOutsideAngular(()=>{let g=Ds(o,"focusin").pipe(mo(f),ci(r=>r.target));Ds(o,"keydown").pipe(mo(f),Kr(r=>r.which===mC.Tab),B_(g)).subscribe(([r,E])=>{let[I,O]=qR(o);(E===I||E===o)&&r.shiftKey&&(O.focus(),r.preventDefault()),E===O&&!r.shiftKey&&(I.focus(),r.preventDefault())}),u&&Ds(o,"click").pipe(mo(f),B_(g),ci(r=>r[1])).subscribe(r=>r.focus())})};var TK=new Date(1882,10,12),SK=new Date(2174,10,25);var IK=1e3*60*60*24;var gC=1080,B9=24*gC,N9=12*gC+793,MK=29*B9+N9,FK=11*gC+204;var WR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var ZR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})(),L9=(()=>{let o=class o{constructor(){this._ngbConfig=Ot(S9),this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return this._animation??this._ngbConfig.animation}set animation(u){this._animation=u}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),bf=class{constructor(o,f,u){this.nodes=o,this.viewRef=f,this.componentRef=u}};var U9=(()=>{let o=class o{constructor(){this._document=Ot(Hr)}hide(){let u=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),g=this._document.body,r=g.style,{overflow:E,paddingRight:I}=r;if(u>0){let O=parseFloat(window.getComputedStyle(g).paddingRight);r.paddingRight=`${O+u}px`}return r.overflow="hidden",()=>{u>0&&(r.paddingRight=I),r.overflow=E}}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),z9=(()=>{let o=class o{constructor(){this._nativeElement=Ot(Fo).nativeElement,this._zone=Ot(Ui)}ngOnInit(){this._zone.onStable.asObservable().pipe(Vo(1)).subscribe(()=>{Ku(this._zone,this._nativeElement,(u,g)=>{g&&VR(u),u.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Ku(this._zone,this._nativeElement,({classList:u})=>u.remove("show"),{animation:this.animation,runningTransition:"stop"})}};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(g,r){g&2&&(Ly("modal-backdrop"+(r.backdropClass?" "+r.backdropClass:"")),qu("show",!r.animation)("fade",r.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[wm],decls:0,vars:0,template:function(g,r){},encapsulation:2});let s=o;return s})(),mv=class{update(o){}close(o){}dismiss(o){}},V9=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],j9=["animation","backdropClass"],fC=class{_applyWindowOptions(o,f){V9.forEach(u=>{dC(f[u])&&(o[u]=f[u])})}_applyBackdropOptions(o,f){j9.forEach(u=>{dC(f[u])&&(o[u]=f[u])})}update(o){this._applyWindowOptions(this._windowCmptRef.instance,o),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,o)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(mo(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(mo(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(o,f,u,g){this._windowCmptRef=o,this._contentRef=f,this._backdropCmptRef=u,this._beforeDismiss=g,this._closed=new nr,this._dismissed=new nr,this._hidden=new nr,o.instance.dismissEvent.subscribe(r=>{this.dismiss(r)}),this.result=new Promise((r,E)=>{this._resolve=r,this._reject=E}),this.result.then(null,()=>{})}close(o){this._windowCmptRef&&(this._closed.next(o),this._resolve(o),this._removeModalElements())}_dismiss(o){this._dismissed.next(o),this._reject(o),this._removeModalElements()}dismiss(o){if(this._windowCmptRef)if(!this._beforeDismiss)this._dismiss(o);else{let f=this._beforeDismiss();M9(f)?f.then(u=>{u!==!1&&this._dismiss(o)},()=>{}):f!==!1&&this._dismiss(o)}}_removeModalElements(){let o=this._windowCmptRef.instance.hide(),f=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Sn(void 0);o.subscribe(()=>{let{nativeElement:u}=this._windowCmptRef.location;u.parentNode.removeChild(u),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),f.subscribe(()=>{if(this._backdropCmptRef){let{nativeElement:u}=this._backdropCmptRef.location;u.parentNode.removeChild(u),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),im(o,f).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}},pC=function(s){return s[s.BACKDROP_CLICK=0]="BACKDROP_CLICK",s[s.ESC=1]="ESC",s}(pC||{}),G9=(()=>{let o=class o{constructor(){this._document=Ot(Hr),this._elRef=Ot(Fo),this._zone=Ot(Ui),this._closed$=new nr,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new lr,this.shown=new nr,this.hidden=new nr}get fullscreenClass(){return this.fullscreen===!0?" modal-fullscreen":zR(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(u){this.dismissEvent.emit(u)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(Vo(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){let{nativeElement:u}=this._elRef,g={animation:this.animation,runningTransition:"stop"},r=Ku(this._zone,u,()=>u.classList.remove("show"),g),E=Ku(this._zone,this._dialogEl.nativeElement,()=>{},g),I=im(r,E);return I.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),I}_show(){let u={animation:this.animation,runningTransition:"continue"},g=Ku(this._zone,this._elRef.nativeElement,(E,I)=>{I&&VR(E),E.classList.add("show")},u),r=Ku(this._zone,this._dialogEl.nativeElement,()=>{},u);im(g,r).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){let{nativeElement:u}=this._elRef;this._zone.runOutsideAngular(()=>{Ds(u,"keydown").pipe(mo(this._closed$),Kr(r=>r.which===mC.Escape)).subscribe(r=>{this.keyboard?requestAnimationFrame(()=>{r.defaultPrevented||this._zone.run(()=>this.dismiss(pC.ESC))}):this.backdrop==="static"&&this._bumpBackdrop()});let g=!1;Ds(this._dialogEl.nativeElement,"mousedown").pipe(mo(this._closed$),Nr(()=>g=!1),jo(()=>Ds(u,"mouseup").pipe(mo(this._closed$),Vo(1))),Kr(({target:r})=>u===r)).subscribe(()=>{g=!0}),Ds(u,"click").pipe(mo(this._closed$)).subscribe(({target:r})=>{u===r&&(this.backdrop==="static"?this._bumpBackdrop():this.backdrop===!0&&!g&&this._zone.run(()=>this.dismiss(pC.BACKDROP_CLICK))),g=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){let{nativeElement:u}=this._elRef;if(!u.contains(document.activeElement)){let g=u.querySelector("[ngbAutofocus]"),r=qR(u)[0];(g||r||u).focus()}}_restoreFocus(){let u=this._document.body,g=this._elWithFocus,r;g&&g.focus&&u.contains(g)?r=g:r=u,this._zone.runOutsideAngular(()=>{setTimeout(()=>r.focus()),this._elWithFocus=null})}_bumpBackdrop(){this.backdrop==="static"&&Ku(this._zone,this._elRef.nativeElement,({classList:u})=>(u.add("modal-static"),()=>u.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}};o.\u0275fac=function(g){return new(g||o)},o.\u0275cmp=no({type:o,selectors:[["ngb-modal-window"]],viewQuery:function(g,r){if(g&1&&bF(T9,7),g&2){let E;z2(E=V2())&&(r._dialogEl=E.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(g,r){g&2&&(nf("aria-modal",!0)("aria-labelledby",r.ariaLabelledBy)("aria-describedby",r.ariaDescribedBy),Ly("modal d-block"+(r.windowClass?" "+r.windowClass:"")),qu("fade",r.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[wm],ngContentSelectors:A9,decls:4,vars:2,consts:[["dialog",""],["role","document"],[1,"modal-content"]],template:function(g,r){g&1&&(vF(),rn(0,"div",1,0)(2,"div",2),xF(3),Jt()()),g&2&&Ly("modal-dialog"+(r.size?" modal-"+r.size:"")+(r.centered?" modal-dialog-centered":"")+r.fullscreenClass+(r.scrollable?" modal-dialog-scrollable":"")+(r.modalDialogClass?" "+r.modalDialogClass:""))},styles:[`ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}
`],encapsulation:2});let s=o;return s})(),H9=(()=>{let o=class o{constructor(){this._applicationRef=Ot(mc),this._injector=Ot(_o),this._environmentInjector=Ot(eo),this._document=Ot(Hr),this._scrollBar=Ot(U9),this._activeWindowCmptHasChanged=new nr,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new lr;let u=Ot(Ui);this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){let g=this._windowCmpts[this._windowCmpts.length-1];k9(u,g.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(g.location.nativeElement)}})}_restoreScrollBar(){let u=this._scrollBarRestoreFn;u&&(this._scrollBarRestoreFn=null,u())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(u,g,r){let E=r.container instanceof HTMLElement?r.container:dC(r.container)?this._document.querySelector(r.container):this._document.body;if(!E)throw new Error(`The specified modal container "${r.container||"body"}" was not found in the DOM.`);this._hideScrollBar();let I=new mv;u=r.injector||u;let O=u.get(eo,null)||this._environmentInjector,U=this._getContentRef(u,O,g,I,r),V=r.backdrop!==!1?this._attachBackdrop(E):void 0,Z=this._attachWindowComponent(E,U.nodes),te=new fC(Z,U,V,r.beforeDismiss);return this._registerModalRef(te),this._registerWindowCmpt(Z),te.hidden.pipe(Vo(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(this._document.body.classList.remove("modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),I.close=se=>{te.close(se)},I.dismiss=se=>{te.dismiss(se)},I.update=se=>{te.update(se)},te.update(r),this._modalRefs.length===1&&this._document.body.classList.add("modal-open"),V&&V.instance&&V.changeDetectorRef.detectChanges(),Z.changeDetectorRef.detectChanges(),te}get activeInstances(){return this._activeInstances}dismissAll(u){this._modalRefs.forEach(g=>g.dismiss(u))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(u){let g=$y(z9,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(g.hostView),u.appendChild(g.location.nativeElement),g}_attachWindowComponent(u,g){let r=$y(G9,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:g});return this._applicationRef.attachView(r.hostView),u.appendChild(r.location.nativeElement),r}_getContentRef(u,g,r,E,I){return r?r instanceof lc?this._createFromTemplateRef(r,E):zR(r)?this._createFromString(r):this._createFromComponent(u,g,r,E,I):new bf([])}_createFromTemplateRef(u,g){let r={$implicit:g,close(I){g.close(I)},dismiss(I){g.dismiss(I)}},E=u.createEmbeddedView(r);return this._applicationRef.attachView(E),new bf([E.rootNodes],E)}_createFromString(u){let g=this._document.createTextNode(`${u}`);return new bf([[g]])}_createFromComponent(u,g,r,E,I){let O=_o.create({providers:[{provide:mv,useValue:E}],parent:u}),U=$y(r,{environmentInjector:g,elementInjector:O}),V=U.location.nativeElement;return I.scrollable&&V.classList.add("component-host-scrollable"),this._applicationRef.attachView(U.hostView),new bf([[V]],U.hostView,U)}_setAriaHidden(u){let g=u.parentElement;g&&u!==this._document.body&&(Array.from(g.children).forEach(r=>{r!==u&&r.nodeName!=="SCRIPT"&&(this._ariaHiddenValues.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}),this._setAriaHidden(g))}_revertAriaHidden(){this._ariaHiddenValues.forEach((u,g)=>{u?g.setAttribute("aria-hidden",u):g.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(u){let g=()=>{let r=this._modalRefs.indexOf(u);r>-1&&(this._modalRefs.splice(r,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(u),this._activeInstances.emit(this._modalRefs),u.result.then(g,g)}_registerWindowCmpt(u){this._windowCmpts.push(u),this._activeWindowCmptHasChanged.next(),u.onDestroy(()=>{let g=this._windowCmpts.indexOf(u);g>-1&&(this._windowCmpts.splice(g,1),this._activeWindowCmptHasChanged.next())})}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),$9=(()=>{let o=class o{constructor(){this._injector=Ot(_o),this._modalStack=Ot(H9),this._config=Ot(L9)}open(u,g={}){let r=$t(Li($t({},this._config),{animation:this._config.animation}),g);return this._modalStack.open(this._injector,u,r)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(u){this._modalStack.dismissAll(u)}hasOpenModals(){return this._modalStack.hasOpenModals()}};o.\u0275fac=function(g){return new(g||o)},o.\u0275prov=un({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),QR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({providers:[$9]});let s=o;return s})();var YR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var XR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var KR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var JR=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var e3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var t3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var n3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var i3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var r3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var PK=new wn("live announcer delay",{providedIn:"root",factory:()=>100});var o3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})();var s3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({});let s=o;return s})(),q9=[jR,GR,HR,$R,WR,ZR,QR,YR,s3,XR,KR,JR,e3,t3,n3,i3,r3,o3],a3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o}),o.\u0275inj=Ai({imports:[q9,jR,GR,HR,$R,WR,ZR,QR,YR,s3,XR,KR,JR,e3,t3,n3,i3,r3,o3]});let s=o;return s})();var l3=(()=>{let o=class o{};o.\u0275fac=function(g){return new(g||o)},o.\u0275mod=Ti({type:o,bootstrap:[LR]}),o.\u0275inj=Ai({imports:[tP,RR,xO,a3]});let s=o;return s})();eP().bootstrapModule(l3).catch(s=>console.error(s));
